/* (c) Mathigon, generated by Mathigon Studio */
"use strict";(()=>{var Vh=Object.defineProperty,jd=Object.defineProperties,Ud=Object.getOwnPropertyDescriptor,Wd=Object.getOwnPropertyDescriptors;var Ah=Object.getOwnPropertySymbols;var Kd=Object.prototype.hasOwnProperty,Xd=Object.prototype.propertyIsEnumerable;var So=(s,t)=>(t=Symbol[s])?t:Symbol.for("Symbol."+s);var kh=(s,t,e)=>t in s?Vh(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ut=(s,t)=>{for(var e in t||(t={}))Kd.call(t,e)&&kh(s,e,t[e]);if(Ah)for(var e of Ah(t))Xd.call(t,e)&&kh(s,e,t[e]);return s},ft=(s,t)=>jd(s,Wd(t));var T=(s,t,e,i)=>{for(var n=i>1?void 0:i?Ud(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Vh(t,e,n),n};var D=(s,t,e)=>new Promise((i,n)=>{var r=h=>{try{a(e.next(h))}catch(l){n(l)}},o=h=>{try{a(e.throw(h))}catch(l){n(l)}},a=h=>h.done?i(h.value):Promise.resolve(h.value).then(r,o);a((e=e.apply(s,t)).next())}),Yd=function(s,t){this[0]=s,this[1]=t};var Vs=s=>{var t=s[So("asyncIterator")],e=!1,i,n={};return t==null?(t=s[So("iterator")](),i=r=>n[r]=o=>t[r](o)):(t=t.call(s),i=r=>n[r]=o=>{if(e){if(e=!1,r==="throw")throw o;return o}return e=!0,{done:!1,value:new Yd(new Promise(a=>{var h=t[r](o);if(!(h instanceof Object))throw TypeError("Object expected");a(h)}),1)}}),n[So("iterator")]=()=>n,i("next"),"throw"in t?i("throw"):n.throw=r=>{throw r},"return"in t&&i("return"),n};var Eo=(s,t)=>(t=Symbol[s])?t:Symbol.for("Symbol."+s),Zd=function(s,t){this[0]=s,this[1]=t},Qd=s=>{var t=s[Eo("asyncIterator")],e=!1,i,n={};return t==null?(t=s[Eo("iterator")](),i=r=>n[r]=o=>t[r](o)):(t=t.call(s),i=r=>n[r]=o=>{if(e){if(e=!1,r==="throw")throw o;return o}return e=!0,{done:!1,value:new Zd(new Promise(a=>{var h=t[r](o);if(!(h instanceof Object))throw TypeError("Object expected");a(h)}),1)}}),n[Eo("iterator")]=()=>n,i("next"),"throw"in t?i("throw"):n.throw=r=>{throw r},"return"in t&&i("return"),n};function We(s=10){return Math.random().toString(36).substr(2,s)}function _(s,...t){return t.includes(s)}var Jd=(s,t)=>s.concat(t);function Co(s,t,e=Jd){for(let i of Object.keys(t))i in s&&Array.isArray(s[i])&&Array.isArray(t[i])?s[i]=e(s[i],t[i]):i in s&&s[i]instanceof Object&&t[i]instanceof Object?Co(s[i],t[i]):s[i]=t[i]}function Zt(s,t=0){return t?+setTimeout(s,t):(s(),0)}function yi(s){return new Promise(t=>setTimeout(t,s))}function Ke(){let s=()=>{},t=()=>{},e=new Promise((i,n)=>{s=i,t=n});return e.catch(i=>i),{promise:e,resolve:s,reject:t}}var Ih=class extends Error{constructor(s){super("[Cache Error]"),this.data=s}};function Oe(s){let t=new Map;return function(...e){let i=e.join("--");if(!t.has(i))try{t.set(i,s(...e))}catch(r){t.set(i,new Ih(r))}let n=t.get(i);if(n instanceof Ih)throw n.data;return n}}function ve(s,t=0,e=!1){let i=!1,n=!1;return(...r)=>{i?n=!0:(e?n=!0:s(...r),i=!0,setTimeout(()=>{n&&s(...r),i=n=!1},t))}}function tu(s){return function(t,e){if(!t||Array.isArray(this)||s.includes(t))return e}}function we(s,t,e){if(!s)return t;try{return JSON.parse(s,e?tu(e):void 0)||t}catch(i){return t}}function re(s,t){return new Array(t).fill(s)}function Ao(s,t,e){let i=[];for(let n=0;n<t;++n)i.push(re(s,e));return i}function z(s,t){let e=[];for(let i=0;i<t;++i)e.push(s(i));return e}function Rh(s,t,e){let i=[];for(let n=0;n<t;++n){let r=[];for(let o=0;o<e;++o)r.push(s(n,o));i.push(r)}return i}function oe(s,t,e=1){let i=[];if(t===void 0&&s>=0)for(let n=0;n<s;n+=e)i.push(n);else if(t===void 0)for(let n=0;n>s;n-=e)i.push(n);else if(s<=t)for(let n=s;n<=t;n+=e)i.push(n);else for(let n=s;n>=t;n-=e)i.push(n);return i}function O(s,t=0){return s[s.length-1-t]}function N(s){return s.reduce((t,e)=>t+e,0)}function bi(s,t,e=!1){return s.slice(0).sort((i,n)=>{let r=t(i),o=t(n);return r<o?e?1:-1:r>o?e?-1:1:0})}function os(s){let t=0;return()=>s[t++%s.length]}function Wt(s){return s.filter((t,e)=>s.indexOf(t)===e)}function ye(s){return s.reduce((t,e)=>t.concat(Array.isArray(e)?ye(e):e),[])}function as(s){let t=0;return s.map(e=>t+=e)}function ko(s,t){let e=[];for(let i=0;i<s.length;i+=t)e.push(s.slice(i,i+t));return e}function hs(s,t=1){let e=s.length;t=(t%e+e)%e;let i=s.slice(0,t);return s.slice(t).concat(i)}function Dh(...s){return s.reduce((t,e)=>t.concat(e),[])}var Nh=class{constructor(s){let t=s.length,e=s.map(i=>({val:i}));for(let[i,n]of e.entries())n.next=e[(i+1)%t],n.prev=e[(i-1+t)%t];this.root=e[0]}*traverse(){let s=this.root;for(;s;)if(yield s,s=s.next,s===this.root)return}get array(){return Array.from(this.traverse())}delete(s){if(s===this.root){if(s.next===s)return this.root=void 0;this.root=s.next}s.prev.next=s.next,s.next.prev=s.prev}},Vo=(s=>(s[s.first=0]="first",s[s.firstGreater=1]="firstGreater",s))(Vo||{});function Io(s,t,e){let i=0,n=s.length-1,r=-1;for(;i<=n;){let o=Math.floor((i+n)/2),a=s[o].val;a<t?i=o+1:a>t?(e===1&&(r=o),n=o-1):e===0?(r=o,n=o-1):e===1&&(i=o+1)}return r}function Lo(s,t,e){let i=Io(s,e,0);if(i<0)return-1;for(;s[i].val===e;){if(s[i].item===t)return i;i+=1}return-1}function K(s,t=/\s+/){return s?s.trim().split(t):[]}function on(s){return s.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,e)=>e.toUpperCase())}function eu(s,t,e=!1){let i=Ao(0,s.length+1,t.length+1);for(let n=0;n<=s.length;n++)i[n][0]=n;for(let n=0;n<=t.length;n++)i[0][n]=n;for(let n=1;n<=s.length;n++)for(let r=1;r<=t.length;r++)i[n][r]=Math.min(i[n-1][r-1]+(s.charAt(n-1)===t.charAt(r-1)?0:1),i[n-1][r]+1,i[n][r-1]+1);return e?Math.min(...i[s.length]):i[s.length][t.length]}function Gh(s,t){let e=s.length/2,i=t.map(r=>({w:r,d:eu(s,r)})).filter(({d:r})=>r<e),n=bi(i,r=>r.d)[0];return n?n.w:void 0}var Re=class{constructor(){this.events=new Map}on(s,t){for(let e of K(s))this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}one(s,t){let e=i=>{this.off(s,e),t(i)};this.on(s,e)}off(s,t){for(let e of K(s))this.events.has(e)&&this.events.set(e,this.events.get(e).filter(i=>i!==t))}trigger(s,t){for(let e of K(s))if(this.events.has(e))for(let i of this.events.get(e))i(t)}},su=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,iu=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,nu=/rgba?\(([0-9.]+), ?([0-9.]+), ?([0-9.]+)(, ?([0-9.]+))?\)/,ru=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function Lh(s){return s.length===1?`0${s}`:s}function Oh(s,t){if(t<=0)return $t.from(s[0]);if(t>=1)return $t.from(O(s));let e=Math.floor(t*(s.length-1)),i=t*(s.length-1)-e;return $t.mix(s[e+1],s[e],i)}function Mo(s,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+(t-s)*6*e:e<1/2?t:e<2/3?s+(t-s)*(2/3-e)*6:s}var $t=class Ct{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}get hex(){let t=[this.r,this.g,this.b].map(i=>Lh(Math.round(i).toString(16))),e=this.a>=1?"":Lh(Math.round(this.a*255).toString(16));return`#${t.join("")}${e}`}get rgb(){return`rgba(${[this.r,this.g,this.b].map(e=>Math.round(e)).join(",")},${this.a})`}get brightness(){return(this.r*299+this.g*587+this.g*114)/1e3}get hsl(){let t=this.r/255,e=this.g/255,i=this.b/255,n=Math.max(t,e,i),r=Math.min(t,e,i),o=(r+n)/2,a=n-r;if(n===r)return[0,0,Math.round(o*100)];let h=t===n?(e-i)/a:e===n?2+(i-t)/a:4+(t-e)/a;h=Math.min(h*60,360),h<0&&(h+=360);let l=o<=.5?a/(n+r):a/(2-n-r);return[Math.round(h),Math.round(l*100),Math.round(o*100)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new Ct(this.r,this.g,this.b,this.a)}static from(t){return typeof t!="string"?t:t.startsWith("#")?Ct.fromHex(t):Ct.fromRgb(t)}static fromRgb(t){let e=t.match(nu);if(!e)return new Ct(0,0,0);let i=e[4]?+e[5]||0:1;return new Ct(+e[1],+e[2],+e[3],i)}static fromHex(t){t=t.replace(su,(i,n,r,o)=>n+n+r+r+o+o);let e=iu.exec(t);return e?new Ct(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?parseInt(e[4],16)/255:1):new Ct(0,0,0)}static fromHsl(t,e,i){if(t/=360,e/=100,i/=100,e===0){let l=Math.round(i*255);return new Ct(l,l,l)}let n=i<.5?i*(1+e):i+e-i*e,r=2*i-n,o=Mo(r,n,t+1/3),a=Mo(r,n,t),h=Mo(r,n,t-1/3);return new Ct(Math.round(o*255),Math.round(a*255),Math.round(h*255))}static rainbow(t){return z(e=>Oh(ru,e/(t-1)),t)}static gradient(t,e){return z(i=>Oh(t,i/(e-1)),e)}static shades(t,e,i=.5){let n=Ct.mix("#fff",t,i),r=Ct.mix("#000",t,i);return Ct.gradient([n,t,r],e)}static mix(t,e,i=.5){return t=Ct.from(t),e=Ct.from(e),new Ct(i*t.r+(1-i)*e.r,i*t.g+(1-i)*e.g,i*t.b+(1-i)*e.b,i*t.a+(1-i)*e.a)}static mixMany(t,e){e||(e=t.map(()=>1));let i=N(e),n=t.map(v=>v.hsl),r=n.map(v=>v[0]),o=r.map(v=>v<180?v+360:v),a=e.map((v,w)=>v*Math.sqrt(t[w].chroma)),h=N(a),l=N(r.map((v,w)=>v*a[w]))/h,c=N(o.map((v,w)=>v*a[w]))/h,u=N(r.map((v,w)=>Math.abs(v-l)*a[w])),d=N(o.map((v,w)=>Math.abs(v-c)*a[w])),g=u<=d?l:c%360,y=N(n.map((v,w)=>e[w]*v[1]))/i,f=N(n.map((v,w)=>e[w]*v[2]))/i;return Ct.fromHsl(g,y,f)}};function Is(s){return s[Symbol.iterator]().next().value}function*an(...s){for(let t of s)yield*Vs(Qd(t))}function At(s,t){for(let e of s)if(t(e))return!0;return!1}function*zh(s,t){let e=0;for(let i of s)t(i,e)&&(yield i),e+=1}function*Bh(s,t){for(let e of s)for(let i of t(e))yield i}function*xi(s,t){for(let e of s)for(let i of t)yield[e,i]}function*Oo(s){let t=s.length;for(let e=0;e<t;++e)for(let i=e+1;i<t;++i)yield[s[e],s[i]]}function Ls(s,t,e=1/0,i){let n,r=e;for(let o of s){let a=t(o);if(a<r&&(n=o,r=a,i!==void 0&&r<i))return n}return n}var ou=Object.defineProperty,No=(s,t)=>{for(var e in t)ou(s,e,{get:t[e],enumerable:!0})},pn=1e-6;function $(s,t,e=pn){return isNaN(s)||isNaN(t)?!1:Math.abs(s-t)<e}function be(s,t=pn){return $(s,Math.round(s),t)}function nt(s,t,e,i=pn){return t>e&&([t,e]=[e,t]),s>t+i&&s<e-i}function au(s,t=pn){return $(s,0,t)?0:s>0?1:-1}var _h=/(\d+)(\d{3})/,hu=["","k","m","b","t","q"];function lu(s){let[t,e]=s.split(".");for(;_h.test(t);)t=t.replace(_h,"$1,$2");return t+(e?`.${e}`:"")}function cu(s,t=6){if(!t)return`${s}`;let e=`${Math.abs(Math.floor(s))}`.length,i=e+(s<0?1:0);if(i<=t)return`${Dt(s,t-i)}`;let n=Math.floor(Math.log10(Math.abs(s))/3),r=hu[n],o=t-(e%3||3)-(r?1:0)-(s<0?1:0);return Dt(s/Math.pow(10,3*n),o)+r}function Rt(s,t=0,e=!0){let i=cu(s,t).replace("-","\u2013");return e?lu(i):i}var pu=/^-?0,[0-9]+$/,du=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,uu=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;function Uh(s){return s=s.replace(/^–/,"-").trim(),!s||s.match(/[^0-9.,-]/)?NaN:pu.test(s)?parseFloat(s.replace(/,/,".")):du.test(s)?parseFloat(s.replace(/,/g,"")):uu.test(s)?parseFloat(s.replace(/\./g,"").replace(/,/,".")):NaN}var Ro=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],Fh=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],fu=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function mu(s){let[t,e,i]=s.split(""),n=t==="0"?"":` ${Ro[+t]} hundred`;return e+i==="00"?n:+e<2?`${n} ${Ro[+(e+i)]}`:i==="0"?`${n} ${Fh[+e]}`:`${n} ${Fh[+e]}-${Ro[+i]}`}function Go(s){if(s===0)return"zero";let t=Math.round(Math.abs(s)).toString(),e=Math.ceil(t.length/3),i=t.padStart(3*e,"0"),n="";for(let r=0;r<e;r+=1){let o=i.substr(r*3,3);o!=="000"&&(n+=mu(o)+fu[e-1-r])}return n.trim()}function Dt(s,t=0){let e=Math.pow(10,t);return Math.round(s*e)/e}function Pt(s,t=1){return Math.round(s/t)*t}function B(s,t=-1/0,e=1/0){return Math.min(e,Math.max(t,s))}function tt(s,t,e=.5){return s+(t-s)*e}function Qt(s){return s*s}function gt(s,t){return(s%t+t)%t}function zo(s,t,e){if($(s,0)&&$(t,0))return[];if($(s,0))return[-e/t];let i=-t/2/s,n=Math.sqrt(t*t-4*s*e)/2/s;return[i+n,i-n]}function Wh(s,t=0){let e=s.slice(0),i=Kh(e);return t?i.filter(n=>n.length===t):i}function Kh(s){if(s.length===1)return[[],s];let t=s.pop(),e=Kh(s),i=[];for(let n of e)i.push(n,[...n,t]);return i}var hn=(s,t)=>{let e=s<0?"\u2013":"";return Math.abs(s)===1&&t?e+t:e+Math.abs(s)+(t||"")},Xh=class mt{constructor(t=0,e=0){this.re=t,this.im=e}get modulus(){return Math.sqrt(this.re*this.re+this.im*this.im)}get argument(){return Math.atan2(this.im,this.re)}get conjugate(){return new mt(this.re,-this.im)}root(t,e=0){let i=Math.pow(this.modulus,1/t),n=(this.argument+e*2*Math.PI)/t;return new mt(i*Math.cos(n),i*Math.sin(n))}toString(t=2){let e=Dt(this.re,t),i=Dt(this.im,t);return i===0?hn(e):e===0?hn(i,"i"):[hn(e),i<0?"\u2013":"+",hn(Math.abs(i),"i")].join(" ")}add(t){return mt.sum(this,t)}subtract(t){return mt.difference(this,t)}multiply(t){return mt.product(this,t)}divide(t){return mt.quotient(this,t)}static sum(t,e){return typeof t=="number"&&(t=new mt(t,0)),typeof e=="number"&&(e=new mt(e,0)),new mt(t.re+e.re,t.im+e.im)}static difference(t,e){return typeof t=="number"&&(t=new mt(t,0)),typeof e=="number"&&(e=new mt(e,0)),new mt(t.re-e.re,t.im-e.im)}static product(t,e){typeof t=="number"&&(t=new mt(t,0)),typeof e=="number"&&(e=new mt(e,0));let i=t.re*e.re-t.im*e.im,n=t.im*e.re+t.re*e.im;return new mt(i,n)}static quotient(t,e){if(typeof t=="number"&&(t=new mt(t,0)),typeof e=="number"&&(e=new mt(e,0)),Math.abs(e.re)<Number.EPSILON||Math.abs(e.im)<Number.EPSILON)return new mt(1/0,1/0);let i=e.re*e.re+e.im*e.im,n=(t.re*e.re+t.im*e.im)/i,r=(t.im*e.re-t.re*e.im)/i;return new mt(n,r)}static exp(t){typeof t=="number"&&(t=new mt(t,0));let e=Math.exp(t.re);return new mt(e*Math.cos(t.im),e*Math.sin(t.im))}};function xe(...s){let[t,...e]=s;if(e.length>1)return xe(t,xe(...e));let i=Math.abs(t),n=Math.abs(e[0]);for(;n;)[i,n]=[n,i%n];return i}function Os(...s){let[t,...e]=s;return e.length>1?Os(t,Os(...e)):Math.abs(t*e[0])/xe(t,e[0])}function Bo(s){if(s%1!==0||s<2)return!1;if(s%2===0)return s===2;if(s%3===0)return s===3;let t=Math.sqrt(s);for(let e=5;e<=t;e+=6)if(s%e===0||s%(e+2)===0)return!1;return!0}function Do(s){if(s===1)return[];if(Bo(s))return[s];let t=Math.sqrt(s);for(let e=2;e<=t;++e)if(s%e===0)return Do(e).concat(Do(s/e));return[]}function Yh(s){return Wt(Do(s))}var gu=/^([0-9\-.]*)([%πkmbtq]?)(\/([0-9\-.]+))?([%π]?)$/,qh=s=>s>=Number.MAX_SAFE_INTEGER,dn=class X{constructor(t,e,i){this.unit=i,this.num=e!==void 0&&e<0?-t:t,e!==void 0&&Math.abs(e)!==1&&t!==0&&(this.den=Math.abs(e))}valueOf(){return this.value}toMixed(){if(!this.den||this.unit)return this.toString();let t=Math.abs(this.num)%this.den,e=Math.abs(Math.trunc(this.value));return e?`${this.sign<0?"\u2013":""}${e} ${t}/${this.den}`:this.toString()}toExpr(t,e=4){let i=this.value;if(Math.abs(i)>=Number.MAX_VALUE)return"\u221E";if((qh(this.num)||this.den&&qh(this.den))&&(t="decimal"),t==="scientific"||Math.abs(i)>=Number.MAX_SAFE_INTEGER){let[n,r]=this.value.toExponential(e-1).split("e");if(Math.abs(+r)>=e){let o=r.startsWith("-"),a=`${o?"(":""}${o?r:r.slice(1)}${o?")":""}`;return`${n.replace(/\.?0+$/,"")} \xD7 10^${a}${this.unit||""}`}}if(!this.unit&&!this.den||t==="decimal"||t==="scientific"){let n=Rt(this.value,e);return n.match(/^[\d.]+$/g)?n:`"${n}"`}else return t==="mixed"?this.toMixed():this.toString()}toString(t=4){let e=!this.den&&!this.unit,i=Rt(this.num,this.den?0:t,e),n=this.unit||"",r=this.den?`/${Rt(this.den,0,e)}`:"";return i==="0"&&(n=""),n==="\u03C0"&&!this.den&&(i==="1"||i==="\u20131")&&(i=i.replace("1","")),`${i}${r}${n}`}toMathML(){let t=`<mn>${this.num}</mn>`;return this.den!==void 0&&(t=`<mfrac>${t}<mn>${this.den}</mn></mfrac>`),this.unit&&(t+=this.unit==="\u03C0"?"<mi>\u03C0</mi>":"<mo>%</mo>"),t}get value(){let t=this.unit==="%"?.01:this.unit==="\u03C0"?Math.PI:1;return this.num*t/(this.den||1)}get sign(){return Math.sign(this.num)}get simplified(){if(!this.den)return this;let t=xe(Math.abs(this.num),this.den);return new X(this.num/t,this.den/t,this.unit)}get inverse(){return this.den?new X(1/this.num,void 0,this.unit):new X(this.den,this.num)}get negative(){return new X(-this.num,this.den,this.unit)}get fraction(){if(!(this.unit||!be(this.num)))return[this.num,this.den||1]}static fromString(t){t=t.toLowerCase().replace(/[\s,"]/g,"").replace("\u2013","-").replace("pi","\u03C0");let e=t.match(gu);if(!e)return;let i=e[2]||e[5]||void 0,n=e[1]?+e[1]:void 0,r=e[4]?+e[4]:void 0;if(i==="\u03C0"&&(!e[1]||e[1]==="-")&&(n=e[1]?-1:1),n===void 0||isNaN(n))return;let o=i?"kmbtq".indexOf(i):-1;if(o>=0&&(n*=1e3**(o+1),i=void 0),r===void 0)return new X(n,void 0,i);if(!(isNaN(r)||$(r,0)))return!be(n)||!be(r)?new X(n/r,void 0,i):new X(n,r,i)}static fractionFromDecimal(t,e=1e3,i=1e-12){let n=[1,0],r=[0,1],o=Math.abs(t),a=o;for(;Math.abs(n[0]/r[0]-o)>i;){let h=Math.floor(a);if(n=[h*n[0]+n[1],n[0]],r=[h*r[0]+r[1],r[0]],r[0]>e)return new X(t);a=1/(a-h)}return $(n[0]/r[0],o,i)?new X(au(t)*n[0],r[0]===1?void 0:r[0]):new X(t)}clamp(t,e){let i=this.value;return t!==void 0&&i<t?new X(t):e!==void 0&&i>e?new X(e):this}add(t){return X.sum(this,t)}subtract(t){return X.difference(this,t)}multiply(t){return X.product(this,t)}divide(t){return X.quotient(this,t)}static sum(t,e){if(typeof e=="number"&&(e=new X(e)),t.num===0)return e;if(t.unit!==e.unit)return new X(t.value+e.value);if(!t.den&&!e.den)return new X(t.num+e.num,void 0,t.unit);if(t.den||([t,e]=[e,t]),!be(e.num))return new X(t.value+e.value,void 0,t.unit);let i=Os(t.den,e.den||1),n=i/t.den,r=i/(e.den||1);return new X(t.num*n+e.num*r,i,t.unit)}static difference(t,e){return typeof e=="number"&&(e=new X(e)),X.sum(t,e.negative)}static product(t,e){if(typeof e=="number"&&(e=new X(e)),!t.unit&&!t.den&&be(t.num))return new X(t.num*e.num,e.den,e.unit);if(!e.unit&&!e.den&&be(e.num))return new X(t.num*e.num,t.den,t.unit);if(t.unit==="\u03C0"||e.unit==="\u03C0"||!be(t.num)||!be(e.num))return new X(t.value*e.value);let i=(t.unit==="%"?100:1)*(e.unit==="%"?100:1);return new X(t.num*e.num,(t.den||1)*(e.den||1)*i)}static quotient(t,e){return typeof e=="number"&&(e=new X(e)),X.product(t,e.inverse)}},kt={};No(kt,{determinant:()=>xu,fill:()=>Zh,identity:()=>Qh,inverse:()=>el,product:()=>cn,reflection:()=>yu,rotation:()=>vu,scalarProduct:()=>bu,shear:()=>wu,sum:()=>Jh,transpose:()=>tl});function Zh(s,t,e){return Ao(s,t,e)}function Qh(s=2){let t=Zh(0,s,s);for(let e=0;e<s;++e)t[e][e]=1;return t}function vu(s){let t=Math.sin(s),e=Math.cos(s);return[[e,-t],[t,e]]}function wu(s){return[[1,s],[0,1]]}function yu(s){let t=Math.sin(2*s),e=Math.cos(2*s);return[[e,t],[t,-e]]}function Jh(...s){let[t,...e]=s,i=e.length>1?Jh(...e):e[0];if(t.length!==i.length||t[0].length!==i[0].length)throw new Error("Matrix sizes don\u2019t match");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<t[r].length;++a)o.push(t[r][a]+i[r][a]);n.push(o)}return n}function bu(s,t){return s.map(e=>e.map(i=>i*t))}function cn(...s){let[t,...e]=s,i=e.length>1?cn(...e):e[0];if(t[0].length!==i.length)throw new Error("Matrix sizes don\u2019t match.");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<i[0].length;++a){let h=0;for(let l=0;l<i.length;++l)h+=t[r][l]*i[l][a];o.push(h)}n.push(o)}return n}function tl(s){let t=[];for(let e=0;e<s[0].length;++e){let i=[];for(let n=0;n<s.length;++n)i.push(s[n][e]);t.push(i)}return t}function xu(s){if(s.length!==s[0].length)throw new Error("Not a square matrix.");let t=s.length;if(t===1)return s[0][0];if(t===2)return s[0][0]*s[1][1]-s[0][1]*s[1][0];let e=0;for(let i=0;i<t;++i){let n=s[0][i],r=s[0][i];for(let o=1;o<t;++o)r*=s[o][(i+o)%t],n*=s[o][(i-o+t)%t];e+=r-n}return e}function el(s){let t=s.length;if(t!==s[0].length)throw new Error("Not a square matrix.");let e=Qh(t),i=Rh((n,r)=>s[n][r],t,t);for(let n=0;n<t;++n){let r=i[n][n];if($(r,0)){for(let o=n+1;o<t;++o)if(i[o][n]!==0){for(let a=0;a<t;++a)[i[o][a],i[n][a]]=[i[n][a],i[o][a]],[e[o][a],e[n][a]]=[e[n][a],e[o][a]];break}if(r=i[n][n],$(r,0))throw new Error("Matrix not invertible.")}for(let o=0;o<t;++o)i[n][o]=i[n][o]/r,e[n][o]=e[n][o]/r;for(let o=0;o<t;++o){if(o===n)continue;let a=i[o][n];for(let h=0;h<t;++h)i[o][h]-=a*i[n][h],e[o][h]-=a*e[n][h]}}return e}var _t={};No(_t,{bernoulli:()=>il,binomial:()=>Eu,cauchy:()=>Iu,chiCDF:()=>Ou,exponential:()=>ku,find:()=>Tu,geometric:()=>Vu,integer:()=>Pu,integrate:()=>rl,normal:()=>Au,normalPDF:()=>Lu,poisson:()=>Mu,shuffle:()=>$u,smart:()=>Su,uniform:()=>Cu,weighted:()=>sl});function $u(s){s=s.slice(0);for(let t=s.length-1;t>0;--t){let e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s}function Pu(s,t){let e=t===void 0?0:s,i=t===void 0?s:t-s+1;return e+Math.floor(i*Math.random())}function sl(s){let t=Math.random()*N(s),e=0;return s.findIndex(i=>(e+=i)>=t)}function Tu(s){return s[Math.floor(s.length*Math.random())]}var ln=new Map;function Su(s,t){t||(t=We()),ln.has(t)||ln.set(t,re(1,s));let e=ln.get(t),i=sl(e.map(n=>n*n));return e[i]-=1,e[i]<=0&&ln.set(t,e.map(n=>n+1)),i}function il(s=.5){return Math.random()<s?1:0}function Eu(s=1,t=.5){let e=0;for(let i=0;i<s;++i)e+=il(t);return e}function Mu(s=1){if(s<=0)return 0;let t=Math.exp(-s),e=1,i=0;for(;e>t;++i)e*=Math.random();return i-1}function Cu(s=0,t=1){return s+(t-s)*Math.random()}function Au(s=0,t=1){let e=Math.random(),i=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*i)*Math.sqrt(t)+s}function ku(s=1){return s<=0?0:-Math.log(Math.random())/s}function Vu(s=.5){if(!(s<=0||s>1))return Math.floor(Math.log(Math.random())/Math.log(1-s))}function Iu(){let s,t,e;do t=2*Math.random()-1,e=2*Math.random()-1,s=t*t+e*e;while(s>=1);return t/e}function Lu(s,t=1,e=0){return Math.exp(-((s-t)**2)/(2*e))/Math.sqrt(2*Math.PI*e)}var Hh=7,jh=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function nl(s){if(s<.5)return Math.PI/(Math.sin(Math.PI*s)*nl(1-s));s-=1;let t=jh[0];for(let i=1;i<Hh+2;i++)t+=jh[i]/(s+i);let e=s+Hh+.5;return Math.sqrt(2*Math.PI)*Math.pow(e,s+.5)*Math.exp(-e)*t}function rl(s,t,e,i=1){let n=0;for(let r=t;r<e;r+=i)n+=s(r)*i||0;return n}function Ou(s,t){return 1-rl(i=>Math.pow(i,(t-2)/2)*Math.exp(-i/2),0,s)/Math.pow(2,t/2)/nl(t/2)}var _o={};No(_o,{bestPolynomial:()=>Bu,coefficient:()=>al,exponential:()=>Nu,linear:()=>Du,logarithmic:()=>Gu,polynomial:()=>ol,power:()=>zu});function Ru(s,t){let e=1,i=s[0];for(let n=1;n<s.length;++n)e*=t,i+=e*s[n];return i}function Du(s,t=!1){let e=0,i=0,n=0,r=0,o=s.length;for(let l=0;l<o;l++)e+=s[l][0],i+=s[l][1],n+=s[l][0]*s[l][0],r+=s[l][0]*s[l][1];if(t)return[0,r/n];let a=(o*r-e*i)/(o*n-e*e);return[i/o-a*e/o,a]}function Nu(s){let t=[0,0,0,0,0,0];for(let r of s)t[0]+=r[0],t[1]+=r[1],t[2]+=r[0]*r[0]*r[1],t[3]+=r[1]*Math.log(r[1]),t[4]+=r[0]*r[1]*Math.log(r[1]),t[5]+=r[0]*r[1];let e=t[1]*t[2]-t[5]*t[5],i=Math.exp((t[2]*t[3]-t[5]*t[4])/e),n=(t[1]*t[4]-t[5]*t[3])/e;return[i,n]}function Gu(s){let t=[0,0,0,0],e=s.length;for(let r of s)t[0]+=Math.log(r[0]),t[1]+=r[1]*Math.log(r[0]),t[2]+=r[1],t[3]+=Math.pow(Math.log(r[0]),2);let i=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[(t[2]-i*t[0])/e,i]}function zu(s){let t=[0,0,0,0],e=s.length;for(let r of s)t[0]+=Math.log(r[0]),t[1]+=Math.log(r[1])*Math.log(r[0]),t[2]+=Math.log(r[1]),t[3]+=Math.pow(Math.log(r[0]),2);let i=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[Math.exp((t[2]-i*t[0])/e),i]}function ol(s,t=2){let e=s.map(h=>oe(t+1).map(l=>Math.pow(h[0],l))),i=tl(e),n=s.map(h=>[h[1]]),r=cn(i,e),o=el(r);return cn(o,i,n).map(h=>h[0])}function al(s,t){let i=s.reduce((o,a)=>o+a[1],0)/s.length,n=s.reduce((o,a)=>o+(a[1]-i)**2,0);return 1-s.reduce((o,a)=>o+(a[1]-t(a[0]))**2,0)/n}function Bu(s,t=.85,e=8){if(!(s.length<=1))for(let i=1;i<e;++i){let n=ol(s,i),r=a=>Ru(n,a);if(al(s,r)>=t)return{order:i,coefficients:n,fn:r}}}function Rs(s){return s.length?N(s)/s.length:0}var Tt=2*Math.PI;function Pi(s,t){let e=Math.atan2(s.y-(t?t.y:0),s.x-(t?t.x:0));return gt(e,Tt)}function hl(s,t){let e,i=1/0,n=-1;for(let[r,o]of t.entries()){let a=o.project(s),h=p.distance(s,a);h<i&&(e=a,i=h,n=r)}return e?[e,n]:void 0}var p=class et{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return $(this.length,0)?new et(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new et(-this.x,-this.y)}get flip(){return new et(this.y,this.x)}get perpendicular(){return new et(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return et.distance(this,t.project(this))}clamp(t,e=0){let i=B(this.x,t.xMin+e,t.xMax-e),n=B(this.y,t.yMin+e,t.yMax-e);return new et(i,n)}changeCoordinates(t,e){let i=e.xMin+(this.x-t.xMin)/t.dx*e.dx,n=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new et(i,n)}add(t){return et.sum(this,t)}subtract(t){return et.difference(this,t)}round(t=1){return new et(Pt(this.x,t),Pt(this.y,t))}floor(){return new et(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new et(this.x%t,this.y%e)}angle(t=R){return Pi(this,t)}snap(t,e=5){return $(this.x,t.x,e)?new et(t.x,this.y):$(this.y,t.y,e)?new et(this.x,t.y):this}static average(...t){let e=N(t.map(n=>n.x))/t.length,i=N(t.map(n=>n.y))/t.length;return new et(e,i)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new et(t.x+e.x,t.y+e.y)}static difference(t,e){return new et(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(Qt(t.x-e.x)+Qt(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,i=.5){return new et(tt(t.x,e.x,i),tt(t.y,e.y,i))}static interpolateList(t,e=.5){let i=t.length-1,n=Math.floor(B(e,0,1)*i);return et.interpolate(t[n],t[n+1],i*e-n)}static fromPolar(t,e=1){return new et(e*Math.cos(t),e*Math.sin(t))}static random(t){let e=_t.uniform(t.xMin,t.xMax),i=_t.uniform(t.yMin,t.yMax);return new et(e,i)}static equals(t,e,i){return $(t.x,e.x,i)&&$(t.y,e.y,i)}static colinear(t,e,i,n){let r=t.x-e.x,o=t.y-e.y,a=e.x-i.x,h=e.y-i.y;return $(r*h,a*o,n)}transform(t){let e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],i=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new et(e,i)}rotate(t,e=R){if($(t,0))return this;let i=this.x-e.x,n=this.y-e.y,r=Math.cos(t),o=Math.sin(t),a=i*r-n*o+e.x,h=i*o+n*r+e.y;return new et(a,h)}reflect(t){let e=t.p2.x-t.p1.x,i=t.p2.y-t.p1.y,n=this.x-t.p1.x,r=this.y-t.p1.y,o=(e*r-i*n)/(e*e+i*i),a=this.x+2*o*i,h=this.y-2*o*e;return new et(a,h)}scale(t,e=t){return new et(this.x*t,this.y*e)}shift(t,e=t){return new et(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return et.equals(this,t,e)}toString(){return`point(${this.x},${this.y})`}},R=new p(0,0);function St(s){return["polygon","polyline","rectangle","triangle"].includes(s.type)}function Ye(s){return["polygon","triangle"].includes(s.type)}function gn(s){return s.type==="polyline"}function Uo(s){return s.type==="rectangle"}function it(s){return["line","ray","segment"].includes(s.type)}function Wo(s){return s.type==="line"}function vn(s){return s.type==="ray"}function $e(s){return s.type==="segment"}function U(s){return s.type==="circle"}function Ze(s){return s.type==="ellipse"}function Nt(s){return s.type==="arc"}function Pe(s){return s.type==="sector"}function Ft(s){return s.type==="angle"}function rt(s){return s.type==="point"}var vt=class $i{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}get length(){return p.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return p.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y-this.slope*this.p1.x}get angle(){return Pi(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new p(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){return new $i(t,t.add(this.p2).subtract(this.p1))}perpendicular(t){let e=this.line.project(t);return p.equals(t,e)?new $i(e,e.add(this.perpendicularVector.scale(this.length/2))):new $i(e,t)}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(t){let e=this.project(t);return(t.x-e.x)**2+(t.y-e.y)**2}get line(){return this.type==="line"?this:new $i(this.p1,this.p2)}get ray(){return vn(this)?this:new Ko(this.p1,this.p2)}get segment(){return $e(this)?this:new Y(this.p1,this.p2)}offset(t){let e=p.difference(this.p2,this.p1),i=p.difference(t,this.p1);return p.dot(e,i)/this.lengthSquared}project(t){return this.at(this.offset(t))}side(t,e){let i=p.difference(this.p2,this.p1),n=p.difference(t,this.p1),r=n.x*i.y-n.y*i.x;return $(r,0,e)?0:Math.sign(r)}contains(t,e){return this.side(t,e)===0}at(t){return p.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=R){return $(t,0)?this:new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return new this.constructor(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return new this.constructor(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t,e){return this.contains(t.p1,e)&&this.contains(t.p2,e)}toString(){return`line(${this.p1},${this.p2})`}},Ko=class extends vt{constructor(){super(...arguments),this.type="ray"}equals(s,t){return s.type!=="ray"||!this.p1.equals(s.p1,t)?!1:this.p2.equals(s.p2,t)?!0:s.contains(this.p2,t)||this.contains(s.p2,t)}contains(s,t){if(!super.contains(s,t))return!1;let e=this.offset(s);return $(e,0,t)||e>0}toString(){return`ray(${this.p1},${this.p2})`}},Y=class fl extends vt{constructor(){super(...arguments),this.type="segment"}contains(t,e){return super.contains(t,e)?this.p1.equals(t,e)||this.p2.equals(t,e)?!0:$(this.p1.x,this.p2.x,e)?nt(t.y,this.p1.y,this.p2.y):nt(t.x,this.p1.x,this.p2.x):!1}project(t){let e=p.difference(this.p2,this.p1),i=p.difference(t,this.p1),n=B(p.dot(e,i)/this.lengthSquared,0,1);return this.p1.add(e.scale(n))}contract(t){return new fl(this.at(t),this.at(1-t))}equals(t,e,i=!1){return t.type!=="segment"?!1:this.p1.equals(t.p1,e)&&this.p2.equals(t.p2,e)||!i&&this.p1.equals(t.p2,e)&&this.p2.equals(t.p1,e)}toString(){return`segment(${this.p1},${this.p2})`}},wt=class Ds{constructor(t=R,e=1){this.c=t,this.r=e,this.type="circle"}get circumference(){return Tt*this.r}get area(){return Math.PI*this.r**2}get arc(){let t=this.c.shift(this.r,0);return new qt(this.c,t,Tt)}tangentAt(t){let e=this.at(t),i=this.c.rotate(Math.PI/2,e);return new vt(e,i)}collision(t){let e=this.c.x<t.p.x?t.p.x:this.c.x>t.p.x+t.w?t.p.x+t.w:this.c.x,i=this.c.y<t.p.y?t.p.y:this.c.y>t.p.y+t.h?t.p.y+t.h:this.c.y;return p.distance(this.c,new p(e,i))<=this.r}project(t){let e=t.subtract(this.c).unitVector.scale(this.r);return p.sum(this.c,e)}at(t){let e=Tt*t;return this.c.shift(this.r*Math.cos(e),this.r*Math.sin(e))}offset(t){return Pi(t,this.c)/Tt}contains(t){return p.distance(t,this.c)<=this.r}transform(t){let e=Math.abs(t[0][0])+Math.abs(t[1][1]);return new Ds(this.c.transform(t),this.r*e/2)}rotate(t,e=R){return $(t,0)?this:new Ds(this.c.rotate(t,e),this.r)}reflect(t){return new Ds(this.c.reflect(t),this.r)}scale(t,e=t){return new Ds(this.c.scale(t,e),this.r*(t+e)/2)}shift(t,e=t){return new Ds(this.c.shift(t,e),this.r)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return $(this.r,t.r,e)&&this.c.equals(t.c,e)}toString(){return`circle(${this.c},${this.r})`}},qt=class{constructor(s,t,e){this.c=s,this.start=t,this.angle=e,this.type="arc"}get circle(){return new wt(this.c,this.radius)}get radius(){return p.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}get startAngle(){return Pi(this.start,this.c)}contract(s){return new this.constructor(this.c,this.at(s/2),this.angle*(1-s))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,Tt-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,Tt-this.angle)}get center(){return this.at(.5)}project(s){let t=this.startAngle,e=t+this.angle,i=Pi(s,this.c);return e>Tt&&i<e-Tt&&(i+=Tt),i=B(i,t,e),this.c.shift(this.radius,0).rotate(i,this.c)}at(s){return this.start.rotate(this.angle*s,this.c)}offset(s){return new Vt(this.start,this.c,s).rad/this.angle}contains(s){return s.equals(this.project(s))}transform(s){return new this.constructor(this.c.transform(s),this.start.transform(s),this.angle)}rotate(s,t=R){return $(s,0)?this:new this.constructor(this.c.rotate(s,t),this.start.rotate(s,t),this.angle)}reflect(s){return new this.constructor(this.c.reflect(s),this.start.reflect(s),this.angle)}scale(s,t=s){return new this.constructor(this.c.scale(s,t),this.start.scale(s,t),this.angle)}shift(s,t=s){return new this.constructor(this.c.shift(s,t),this.start.shift(s,t),this.angle)}translate(s){return this.shift(s.x,s.y)}equals(){return!1}toString(){return`arc(${this.c},${this.start},${this.angle})`}},Xo=class extends qt{constructor(){super(...arguments),this.type="sector"}contains(s){return p.distance(s,this.c)<=this.radius&&new Vt(this.start,this.c,s).rad<=this.angle}toString(){return`sector(${this.c},${this.start},${this.angle})`}},ls=.001;function Ho(s,t,e){let i=(e.x-t.x)*(s.y-t.y),n=(e.y-t.y)*(s.x-t.x);return i-n>=-ls}function ll(s,t,e){let i=s.y-t.y,n=e.x-t.x,r=s.x-t.x,o=e.y-t.y,a=r*n+i*o;if(a<ls)return!1;let h=n*n+o*o;return a-h<=-ls}function ml(s,t){return $(s.x,t.x)?$(s.y,t.y)?0:s.y<t.y?-1:1:s.x<t.x?-1:1}function cl(s){return s<=-ls?-2:s<ls?-1:s-1<=-ls?0:s-1<ls?1:2}function _u(s,t,e,i){let n=t.x-s.x,r=t.y-s.y,o=i.x-e.x,a=i.y-e.y,h=n*a-r*o;if($(h,0))return!1;let l=s.x-e.x,c=s.y-e.y,u=(o*c-a*l)/h,d=(n*c-r*l)/h,g=new p(s.x+u*n,s.y+u*r);return{alongA:cl(u),alongB:cl(d),pt:g}}var Gs=class{constructor(){this.root={root:!0,next:void 0}}exists(s){return s!==void 0&&s!==this.root}get head(){return this.root.next}insertBefore(s,t){let e=this.root,i=this.root.next;for(;i;){if(t(i)){s.prev=i.prev,s.next=i,i.prev.next=s,i.prev=s;return}e=i,i=i.next}e.next=s,s.prev=e,s.next=void 0}findTransition(s){let t=this.root,e=this.root.next;for(;e&&!s(e);)t=e,e=e.next;return{before:t===this.root?void 0:t,after:e,insert:i=>(i.prev=t,i.next=e,t.next=i,e&&(e.prev=i),i)}}static node(s){let t=s;return t.remove=()=>{t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev=t.next=void 0},t}};function jo(s,t,e){let i={above:e.myFill.above,below:e.myFill.below};return{start:s,end:t,myFill:i}}function Fu(s,t,e,i,n,r){let o=ml(t,n);return o!==0?o:p.equals(e,r)?0:s!==i?s?1:-1:Ho(e,i?n:r,i?r:n)?1:-1}function Yo(s,t,e){s.insertBefore(t,i=>Fu(!!t.isStart,t.pt,e,!!i.isStart,i.pt,i.other.pt)<0)}function qu(s,t,e){let i=Gs.node({isStart:!0,pt:t.start,seg:t,primary:e});return Yo(s,i,t.end),i}function Hu(s,t,e,i){let n=Gs.node({pt:e.end,seg:e,primary:i,other:t});t.other=n,Yo(s,n,t.pt)}function fn(s,t,e){let i=qu(s,t,e);return Hu(s,i,t,e),i}function ju(s,t,e){t.other.remove(),t.seg.end=e,t.other.pt=e,Yo(s,t.other,t.pt)}function ue(s,t,e){let i=jo(e,t.seg.end,t.seg);return ju(s,t,e),fn(s,i,!!t.primary)}function Uu(s,t){let e=s.seg.start,i=s.seg.end,n=t.seg.start,r=t.seg.end;return p.colinear(e,n,r)?p.colinear(i,n,r)||Ho(i,n,r)?1:-1:Ho(e,n,r)?1:-1}function Fo(s,t,e){let i=t.seg,n=e.seg,r=i.start,o=i.end,a=n.start,h=n.end,l=_u(r,o,a,h);if(l===!1){if(!p.colinear(r,o,a)||p.equals(r,h)||p.equals(o,a))return!1;let c=p.equals(r,a),u=p.equals(o,h);if(c&&u)return e;let d=!c&&ll(r,a,h),g=!u&&ll(o,a,h);if(c)return g?ue(s,e,o):ue(s,t,h),e;d&&(u||(g?ue(s,e,o):ue(s,t,h)),ue(s,e,r))}else l.alongA===0&&(l.alongB===-1?ue(s,t,a):l.alongB===0?ue(s,t,l.pt):l.alongB===1&&ue(s,t,h)),l.alongB===0&&(l.alongA===-1?ue(s,e,r):l.alongA===0?ue(s,e,l.pt):l.alongA===1&&ue(s,e,o));return!1}function gl(s,t){var e,i;let n=new Gs,r=[];for(;s.head;){let a=s.head;if(a.isStart){let h=function(){if(c){let g=Fo(s,a,c);if(g)return g}return u?Fo(s,a,u):!1};var o=h;let l=n.findTransition(g=>Uu(a,g.ev)>0),c=(e=l.before)==null?void 0:e.ev,u=(i=l.after)==null?void 0:i.ev,d=h();if(d&&(t?(!a.seg.myFill.below||a.seg.myFill.above!==a.seg.myFill.below)&&(d.seg.myFill.above=!d.seg.myFill.above):d.seg.otherFill=a.seg.myFill,a.other.remove(),a.remove()),s.head!==a)continue;if(t){let g=a.seg.myFill.below?a.seg.myFill.above!==a.seg.myFill.below:!0;a.seg.myFill.below=u?u.seg.myFill.above:!1,a.seg.myFill.above=g?!a.seg.myFill.below:a.seg.myFill.below}else if(a.seg.otherFill===void 0){let g=u?a.primary===u.primary?u.seg.otherFill.above:u.seg.myFill.above:!1;a.seg.otherFill={above:g,below:g}}a.other.status=l.insert(Gs.node({ev:a}))}else{let h=a.status;if(h===void 0)throw new Error("[Euclid.js] Zero-length segment detected!");if(n.exists(h.prev)&&n.exists(h.next)&&Fo(s,h.prev.ev,h.next.ev),h.remove(),!a.primary){let l=a.seg.myFill;a.seg.myFill=a.seg.otherFill,a.seg.otherFill=l}r.push(a.seg)}s.head.remove()}return r}function Wu(s){let t=[],e=[];return s.forEach(i=>{let n=i.start,r=i.end;if(p.equals(n,r))return;let o={index:0,matchesHead:!1,matchesPt1:!1},a={index:0,matchesHead:!1,matchesPt1:!1},h=o;function l(f,v,w){h.index=f,h.matchesHead=v,h.matchesPt1=w;let x=h===o;return h=x?a:void 0,!x}for(let f=0;f<t.length;f++){let v=t[f],w=v[0],x=O(v);if(p.equals(w,n)){if(l(f,!0,!0))break}else if(p.equals(w,r)){if(l(f,!0,!1))break}else if(p.equals(x,n)){if(l(f,!1,!0))break}else if(p.equals(x,r)&&l(f,!1,!1))break}if(h===o){t.push([n,r]);return}if(h===a){let f=o.index,v=o.matchesPt1?r:n,w=o.matchesHead,x=t[f],I=w?x[0]:x[x.length-1],A=w?x[1]:x[x.length-2],M=w?x[x.length-1]:x[0],P=w?x[x.length-2]:x[1];if(p.colinear(A,I,v)&&(w?x.shift():x.pop(),I=A),p.equals(M,v)){t.splice(f,1),p.colinear(P,M,I)&&(w?x.pop():x.shift()),e.push(x);return}w?x.unshift(v):x.push(v);return}function c(f){t[f].reverse()}function u(f,v){let w=t[f],x=t[v],I=w[w.length-1],A=w[w.length-2],M=x[0],P=x[1];p.colinear(A,I,M)&&(w.pop(),I=A),p.colinear(I,M,P)&&x.shift(),t[f]=w.concat(x),t.splice(v,1)}let d=o.index,g=a.index,y=t[d].length<t[g].length;o.matchesHead?a.matchesHead?y?(c(d),u(d,g)):(c(g),u(g,d)):u(g,d):a.matchesHead?u(d,g):y?(c(d),u(g,d)):(c(g),u(d,g))}),e}function Ku(s,t){let e=[];for(let i of s){let n=(i.myFill.above?8:0)+(i.myFill.below?4:0)+(i.otherFill&&i.otherFill.above?2:0)+(i.otherFill&&i.otherFill.below?1:0);t[n]!==0&&e.push({start:i.start,end:i.end,myFill:{above:t[n]===1,below:t[n]===2}})}return e}function pl(s){let t=new Gs;for(let e of s)for(let i=0;i<e.length;i++){let n=i?e[i-1]:O(e),r=e[i],o=ml(n,r);if(o===0)continue;let a=o<0?n:r,h=o<0?r:n;fn(t,{start:a,end:h,myFill:{}},!0)}return gl(t,!0)}function Zo(s,t,e){let i=new Gs;for(let r of pl(s))fn(i,jo(r.start,r.end,r),!0);for(let r of pl(t))fn(i,jo(r.start,r.end,r),!1);let n=Ku(gl(i,!1),e);return Wu(n)}var Xu=[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],Yu=[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],Zu=[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0];var Qu=(s,t)=>Zo(s,t,Xu),Ju=(s,t)=>Zo(s,t,Yu),tf=(s,t)=>Zo(s,t,Zu);function ef(s,t){return $(s.p1.x,s.p2.x)?nt(t.y,s.p1.y,s.p2.y):nt(t.x,s.p1.x,s.p2.x)}function sf(s,t){return $(s.p1.x,s.p2.x)?(t.y-s.p1.y)/(s.p2.y-s.p1.y)>0:(t.x-s.p1.x)/(s.p2.x-s.p1.x)>0}function nf(s,t){return nt(s.offset(t),0,1)}function rf(s,t){let e=s.p1.x-s.p2.x,i=s.p1.y-s.p2.y,n=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,o=e*r-i*n;if($(o,0))return[];let a=s.p1.x*s.p2.y-s.p1.y*s.p2.x,h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,l=a*n-e*h,c=a*r-i*h;return[new p(l/o,c/o)]}function of(s,t){let e=p.distance(s.c,t.c);if(e>s.r+t.r)return[];if(e<Math.abs(s.r-t.r))return[];if($(e,0)&&$(s.r,t.r))return[];if($(e,s.r+t.r))return[new vt(s.c,t.c).midpoint];let i=(Qt(s.r)-Qt(t.r)+Qt(e))/(2*e),n=Math.sqrt(Qt(s.r)-Qt(i)),r=(t.c.x-s.c.x)*i/e+(t.c.y-s.c.y)*n/e+s.c.x,o=(t.c.y-s.c.y)*i/e-(t.c.x-s.c.x)*n/e+s.c.y,a=(t.c.x-s.c.x)*i/e-(t.c.y-s.c.y)*n/e+s.c.x,h=(t.c.y-s.c.y)*i/e+(t.c.x-s.c.x)*n/e+s.c.y;return[new p(r,o),new p(a,h)]}function dl(s,t){let e=s.p2.x-s.p1.x,i=s.p2.y-s.p1.y,n=Qt(e)+Qt(i),r=t.c.x,o=t.c.y,a=(s.p1.x-r)*(s.p2.y-o)-(s.p2.x-r)*(s.p1.y-o),h=Qt(t.r)*n-Qt(a);if(h<0)return[];let l=a*i/n,c=-a*e/n;if($(h,0))return[t.c.shift(l,c)];let u=e*(i<0?-1:1)*Math.sqrt(h)/n,d=Math.abs(i)*Math.sqrt(h)/n;return[t.c.shift(l+u,c+d),t.c.shift(l-u,c-d)]}function af(s,t){let e=[],i=Nt(s)?s.circle:s,n=Nt(t)?t.circle:t;it(s)&&it(t)?e=rf(s,t):it(i)&&U(n)?e=dl(i,n):U(i)&&it(n)?e=dl(n,i):U(i)&&U(n)&&(e=of(i,n));for(let r of[s,t])$e(r)&&(e=e.filter(o=>ef(r,o))),vn(r)&&(e=e.filter(o=>sf(r,o))),Nt(r)&&(e=e.filter(o=>nf(r,o)));return e}function Q(...s){if(s.length<2)return[];if(s.length>2)return ye(Wh(s,2).map(i=>Q(...i)));let[t,e]=s;if(Ft(t)&&(t=t.shape(!0)),Ft(e)&&(e=e.shape(!0)),St(e)&&([t,e]=[e,t]),St(t)){let i=it(e)?t.points.filter(n=>e.contains(n)):[];for(let n of t.edges)i.push(...Q(n,e));return i}return af(t,e)}var V=class Xe{constructor(...t){this.type="polygon",this.points=t}get circumference(){if(this.points.length<=1)return 0;let t=p.distance(this.points[0],O(this.points));for(let e=1;e<this.points.length;++e)t+=p.distance(this.points[e-1],this.points[e]);return t}get signedArea(){let t=this.points,e=t.length,i=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let n=1;n<e;++n)i+=t[n-1].x*t[n].y-t[n].x*t[n-1].y;return i/2}get area(){return Math.abs(this.signedArea)}get centroid(){let t=this.points,e=t.length,i=0;for(let r=0;r<e;++r)i+=t[r].x;let n=0;for(let r=0;r<e;++r)n+=t[r].y;return new p(i/e,n/e)}get edges(){let t=this.points.length,e=[];for(let i=0;i<t;++i)e.push(new Y(this.points[i],this.points[(i+1)%t]));return e}get radius(){let t=this.centroid,e=this.points.map(i=>p.distance(i,t));return Math.max(...e)}get oriented(){if(this.signedArea>=0)return this;let t=[...this.points].reverse();return new this.constructor(...t)}cut(t){let e=this.radius/t.length*10,i=t.at(-e),n=t.at(e),r=t.perpendicularVector.scale(t.length*e),o=[i,n,n.add(r),i.add(r)],a=Ju([this.points],[o]),h=tf([this.points],[o]);return[...a,...h].map(l=>new Xe(...l))}static collision(t,e){if(t.points.some(i=>e.contains(i))||e.points.some(i=>t.contains(i)))return!0;for(let i of t.edges)for(let n of e.edges)if(Q(i,n)[0])return!0;return!1}static union(...t){let[e,...i]=t;if(!i.length)return[e];let n=[e.points],r=i.length>1?Xe.union(...i).map(o=>o.points):[t[1].points];return Qu(n,r).map(o=>new Xe(...o))}static regular(t,e=1){let i=Tt/t,n=Math.PI/2-i/2,r=z(o=>p.fromPolar(n+i*o,e),t);return new Xe(...r)}static interpolate(t,e,i=.5){let n=t.points.map((r,o)=>p.interpolate(r,e.points[o],i));return new Xe(...n)}static convexHull(...t){if(t.length<=3)return new Xe(...t);let e=t.sort((o,a)=>o.x!==a.x?o.x-a.x:o.y-a.y),i=e.slice(0).reverse(),n=[],r=[];for(let[o,a]of[[e,n],[i,r]]){for(let h of o){for(;a.length>=2;){let l=a[a.length-1],c=a[a.length-2];if((l.x-c.x)*(h.y-c.y)>=(h.x-c.x)*(l.y-c.y))a.pop();else break}a.push(h)}a.pop()}return new Xe(...n.concat(r))}contains(t){let e=!1;for(let i of this.edges){if(i.p1.equals(t)||i.contains(t))return!1;if(i.p1.y>t.y==i.p2.y>t.y)continue;let n=(i.p2.x-i.p1.x)/(i.p2.y-i.p1.y);t.x<n*(t.y-i.p1.y)+i.p1.x&&(e=!e)}return e}at(t){t<0&&(t+=Math.floor(t));let e=t*this.circumference,i=0;for(let n of this.edges){let r=n.length;if(i+r>e)return n.at((e-i)/r);i+=r}return this.points[0]}offset(t){let e=this.edges,i=hl(t,this.edges)||[this.points[0],0],n=0;for(let r=0;r<i[1];++r)n+=e[r].length;return n+=e[i[1]].offset(t)*e[i[1]].length,n/this.circumference}project(t){let e=hl(t,this.edges);return e?e[0]:this.points[0]}centerAt(t=R){return this.translate(t.subtract(this.centroid))}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=R){if($(t,0))return this;let i=this.points.map(n=>n.rotate(t,e));return new this.constructor(...i)}reflect(t){let e=this.points.map(i=>i.reflect(t));return new this.constructor(...e)}scale(t,e=t){let i=this.points.map(n=>n.scale(t,e));return new this.constructor(...i)}shift(t,e=t){let i=this.points.map(n=>n.shift(t,e));return new this.constructor(...i)}translate(t){return this.shift(t.x,t.y)}equals(t,e,i){let n=this.points.length;if(n!==t.points.length)return!1;let r=i?this:this.oriented,o=i?t:t.oriented;for(let a=0;a<n;++a)if(r.points.every((h,l)=>h.equals(o.points[(l+a)%n],e)))return!0;return!1}toString(){return`polygon(${this.points.join(",")})`}},te=class extends V{constructor(){super(...arguments),this.type="polyline"}get circumference(){return this.length}get length(){let s=0;for(let t=1;t<this.points.length;++t)s+=p.distance(this.points[t-1],this.points[t]);return s}get edges(){let s=[];for(let t=0;t<this.points.length-1;++t)s.push(new Y(this.points[t],this.points[t+1]));return s}toString(){return`polyline(${this.points.join(",")})`}},Ti=class extends V{constructor(){super(...arguments),this.type="triangle"}get circumcircle(){let[s,t,e]=this.points,i=2*(s.x*(t.y-e.y)+t.x*(e.y-s.y)+e.x*(s.y-t.y)),n=(s.x**2+s.y**2)*(t.y-e.y)+(t.x**2+t.y**2)*(e.y-s.y)+(e.x**2+e.y**2)*(s.y-t.y),r=(s.x**2+s.y**2)*(e.x-t.x)+(t.x**2+t.y**2)*(s.x-e.x)+(e.x**2+e.y**2)*(t.x-s.x),o=new p(n/i,r/i),a=p.distance(o,this.points[0]);if(!(isNaN(a)||a>Number.MAX_SAFE_INTEGER))return new wt(o,a)}get incircle(){let s=this.edges,t=s.map(c=>c.length),e=t[0]+t[1]+t[2],[i,n,r]=this.points,o=t[1]*i.x+t[2]*n.x+t[0]*r.x,a=t[1]*i.y+t[2]*n.y+t[0]*r.y,h=new p(o/e,a/e),l=h.distanceFromLine(s[0]);return isNaN(l)?void 0:new wt(h,l)}get orthocenter(){let[s,t,e]=this.points,i=new vt(s,t).perpendicular(e),n=new vt(s,e).perpendicular(t);return Q(i,n)[0]}},hf=180/Math.PI,lf=Math.PI/180;function Kt(s){return s*hf}function J(s){return s*lf}var Vt=class fe{constructor(t,e,i){this.a=t,this.b=e,this.c=i,this.type="angle"}static fromDegrees(t){return fe.fromRadians(t*(Math.PI/180))}static fromRadians(t){let e=new p(1,0),i=e.rotate(t);return new fe(e,R,i)}static equals(t,e,i=Math.PI/360){return $(t.rad,e.rad,i)}get rad(){let t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),i=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-t;return i<0&&(i+=Tt),i}get deg(){return this.rad*180/Math.PI}get isRight(){return $(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a)||this.b.equals(this.c))return;let t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),e=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),i=(t+e)/2;t>e&&(i+=Math.PI);let n=Math.cos(i)+this.b.x,r=Math.sin(i)+this.b.y;return new vt(this.b,new p(n,r))}get sup(){return this.rad<Math.PI?this:new fe(this.c,this.b,this.a)}get arc(){return new qt(this.b,this.a,this.rad)}get radius(){return 24+20*(1-B(this.rad,0,Math.PI)/Math.PI)}shape(t=!0,e,i){if(this.a.equals(this.b)||this.c.equals(this.b))return new V(R);let n=this.isRight&&!i;e||(e=n?20:this.radius);let r=new Y(this.b,this.a),o=r.at(e/r.length);if(n){let a=p.difference(this.c,this.b).unitVector.scale(e);return t?new V(this.b,o,o.add(a),this.b.add(a)):new te(o,o.add(a),this.b.add(a))}return t?new Xo(this.b,o,this.rad):new qt(this.b,o,this.rad)}project(t){return this.contains(t)?t:this.shape(!0).project(t)}at(){return this.c}offset(){return 0}contains(t){return this.shape(!0).contains(t)}transform(t){return new fe(this.a.transform(t),this.b.transform(t),this.c.transform(t))}rotate(t,e){return $(t,0)?this:new fe(this.a.rotate(t,e),this.b.rotate(t,e),this.c.rotate(t,e))}reflect(t){return new fe(this.a.reflect(t),this.b.reflect(t),this.c.reflect(t))}scale(t,e=t){return new fe(this.a.scale(t,e),this.b.scale(t,e),this.c.scale(t,e))}shift(t,e=t){return new fe(this.a.shift(t,e),this.b.shift(t,e),this.c.shift(t,e))}translate(t){return new fe(this.a.translate(t),this.b.translate(t),this.c.translate(t))}equals(t,e){return fe.equals(t,this,e)}toString(){return`angle(${this.a},${this.b},${this.c})`}},G=class Ns{constructor(t,e=1,i=e){this.p=t,this.w=e,this.h=i,this.type="rectangle"}static aroundPoints(t){let e=1/0,i=-1/0,n=1/0,r=-1/0;for(let o of t)e=e<o.x?e:o.x,i=i>o.x?i:o.x,n=n<o.y?n:o.y,r=r>o.y?r:o.y;return new Ns(new p(e,n),i-e,r-n)}get center(){return new p(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.signedArea)}get signedArea(){return this.w*this.h}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let t=new p(this.p.x+this.w,this.p.y),e=new p(this.p.x+this.w,this.p.y+this.h),i=new p(this.p.x,this.p.y+this.h);return new V(this.p,t,e,i)}get bounds(){return new lt(this.p.x,this.p.x+this.w,this.p.y,this.p.y+this.h)}collision(t){return this.p.x<t.p.x+t.w&&this.p.x+this.w>t.p.x&&this.p.y<t.p.y+t.h&&this.p.y+this.h>t.p.y}padding(t,e,i,n){return new Ns(this.p.shift(-n,-t),this.w+n+e,this.h+t+i)}get unsigned(){if(this.w>0&&this.h>0)return this;let t=this.p.shift(this.w<0?this.w:0,this.h<0?this.h:0);return new Ns(t,Math.abs(this.w),Math.abs(this.h))}contains(t,e){return nt(t.x,this.p.x,this.p.x+this.w,e)&&nt(t.y,this.p.y,this.p.y+this.h,e)}project(t){let e;for(let i of this.edges){let n=i.project(t);(!e||p.distance(t,n)<p.distance(t,e))&&(e=n)}return e}at(t){return this.polygon.at(t)}offset(t){return this.polygon.offset(t)}cut(t){return this.polygon.cut(t)}get oriented(){return this.polygon.oriented}transform(t){return this.polygon.transform(t)}rotate(t,e=R){return $(t,0)?this:this.polygon.rotate(t,e)}reflect(t){return this.polygon.reflect(t)}scale(t,e=t){return new Ns(this.p.scale(t,e),this.w*t,this.h*e)}shift(t,e=t){return new Ns(this.p.shift(t,e),this.w,this.h)}translate(t){return this.shift(t.x,t.y)}equals(t){return!1}toString(){return`rectangle(${this.p},${this.w},${this.h})`}},lt=class un{constructor(t,e,i,n,r){this.xMin=t,this.xMax=e,this.yMin=i,this.yMax=n,r==="swap"?(this.dx<0&&([this.xMin,this.xMax]=[e,t]),this.dy<0&&([this.yMin,this.yMax]=[n,i])):r==="center"&&(this.dx<0&&(this.xMin=this.xMax=(t+e)/2),this.dy<0&&(this.yMin=this.yMax=(i+n)/2))}contains(t){return this.containsX(t)&&this.containsY(t)}containsX(t){return nt(t.x,this.xMin,this.xMax)}containsY(t){return nt(t.y,this.yMin,this.yMax)}resize(t,e){return new un(this.xMin,this.xMax+t,this.yMin,this.yMax+e)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}extend(t,e=t,i=t,n=e){return new un(this.xMin-n,this.xMax+e,this.yMin-t,this.yMax+i)}get rect(){return new G(new p(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new p(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new un(this.yMin,this.yMax,this.xMin,this.xMax)}};function Qo(s,t,e={}){if(Ft(t))return Qo(s,t.shape(!!e.fill),e);if(e.fill&&(s.fillStyle=e.fill),e.opacity&&(s.globalAlpha=e.opacity),e.stroke&&(s.strokeStyle=e.stroke,s.lineWidth=e.strokeWidth||1,e.lineCap&&(s.lineCap=e.lineCap),e.lineJoin&&(s.lineJoin=e.lineJoin)),s.beginPath(),$e(t))s.moveTo(t.p1.x,t.p1.y),s.lineTo(t.p2.x,t.p2.y);else if(it(t)){if(!e.box)return;let[i,n]=Q(t,e.box);if(vn(t)&&(n=t.p1),!i||!n)return;s.moveTo(i.x,i.y),s.lineTo(n.x,n.y)}else if(U(t))s.arc(t.c.x,t.c.y,t.r,0,Tt);else if(St(t)){let i=t.points;s.moveTo(i[0].x,i[0].y);for(let n of i.slice(1))s.lineTo(n.x,n.y);s.closePath()}else if(gn(t)){s.moveTo(t.points[0].x,t.points[0].y);for(let i of t.points.slice(1))s.lineTo(i.x,i.y)}else Ze(t)&&s.ellipse(t.c.x,t.c.y,t.a,t.b,t.angle,0,Tt);e.fill&&s.fill(),e.stroke&&s.stroke()}function ul(s,t,e){let n=t.x*(e.y-s.y)+s.x*(t.y-e.y)+e.x*(s.y-t.y)>0?1:0,r=p.distance(t,s);return[s.x,`${s.y}A${r}`,r,0,n,1,e.x,e.y].join(",")}function Jt(...s){return`M${s.map(t=>`${t.x},${t.y}`).join("L")}`}function qo(s,t){let e=s.perpendicularVector.scale(6),i=s.unitVector.scale(3),n=s.midpoint;switch(t){case"bar":return Jt(n.add(e),n.add(e.inverse));case"bar2":return Jt(n.add(i).add(e),n.add(i).add(e.inverse))+Jt(n.add(i.inverse).add(e),n.add(i.inverse).add(e.inverse));case"arrow":return Jt(n.add(i.inverse).add(e),n.add(i),n.add(i.inverse).add(e.inverse));case"arrow2":return Jt(n.add(i.scale(-2)).add(e),n,n.add(i.scale(-2)).add(e.inverse))+Jt(n.add(e),n.add(i.scale(2)),n.add(e.inverse));default:return""}}function mn(s,t){if(!s||!t)return"";let e=t.perpendicular,i=s.add(t.scale(9)).add(e.scale(9)),n=s.add(t.scale(9)).add(e.scale(-9));return Jt(i,s,n)}function cf(s,t){let e="";return _(t,"start","both")&&(e+=mn(s.p1,s.unitVector)),_(t,"end","both")&&(e+=mn(s.p2,s.unitVector.inverse)),e}function pf(s,t){let e="";if(_(t,"start","both")){let i=new vt(s.c,s.start).perpendicularVector.inverse;e+=mn(s.start,i)}if(_(t,"end","both")){let i=new vt(s.c,s.end).perpendicularVector;e+=mn(s.end,i)}return e}function df(s,t,e=t,i=t,n=e){let{p:r,w:o,h:a}=s;return`M${r.x} ${r.y+t}a${t} ${t} 0 0 1 ${t} ${-t}h${o-t-e}a${e} ${e} 0 0 1 ${e} ${e}v${a-e-i}a${i} ${i} 0 0 1 ${-i} ${i}h${-o+n+i}a${n} ${n} 0 0 1 ${-n} ${-n}Z`}function De(s,t={}){if(Ft(s)){let e=s.shape(!!t.fill,t.size,t.round);return De(e,t)}if($e(s)){if(s.p1.equals(s.p2))return"";let e=Jt(s.p1,s.p2);return t.mark&&(e+=qo(s,t.mark)),t.arrows&&(e+=cf(s,t.arrows)),e}if(vn(s)){if(!t.box)return"";let e=Q(s,t.box)[0];if(!e)return"";let i=Jt(s.p1,e);return t.mark&&(i+=qo(s,t.mark)),i}if(Wo(s)){if(!t.box)return"";let e=Q(s,t.box);if(e.length<2)return"";let i=Jt(e[0],e[1]);return t.mark&&(i+=qo(s,t.mark)),i}if(U(s))return`M${s.c.x-s.r} ${s.c.y}a${s.r},${s.r} 0 1 0 ${2*s.r} 0a${s.r} ${s.r} 0 1 0 ${-2*s.r} 0Z`;if(Ze(s)){let[e,i]=s.majorVertices,n=Kt(s.angle);return`M${e.x} ${e.y}A${s.a} ${s.b} ${n} 0 0 ${i.x} ${i.y}A${s.a} ${s.b} ${n} 0 0 ${e.x} ${e.y}Z`}if(Nt(s)){let e=`M${ul(s.start,s.c,s.end)}`;return t.arrows&&(e+=pf(s,t.arrows)),e}if(Pe(s))return`M${s.c.x} ${s.c.y} L ${ul(s.start,s.c,s.end)}Z`;if(gn(s))return Jt(...s.points);if(Ye(s))return`${Jt(...s.points)}Z`;if(Uo(s)){if(!t.cornerRadius)return`${Jt(...s.polygon.points)}Z`;let e=s.unsigned,i=Math.min(t.cornerRadius,e.w/2,e.h/2);return df(e,i)}return""}var Jo=(s,t)=>(t=Symbol[s])?t:Symbol.for("Symbol."+s),he=(s,t,e)=>new Promise((i,n)=>{var r=h=>{try{a(e.next(h))}catch(l){n(l)}},o=h=>{try{a(e.throw(h))}catch(l){n(l)}},a=h=>h.done?i(h.value):Promise.resolve(h.value).then(r,o);a((e=e.apply(s,t)).next())}),uf=function(s,t){this[0]=s,this[1]=t},ff=s=>{var t=s[Jo("asyncIterator")],e=!1,i,n={};return t==null?(t=s[Jo("iterator")](),i=r=>n[r]=o=>t[r](o)):(t=t.call(s),i=r=>n[r]=o=>{if(e){if(e=!1,r==="throw")throw o;return o}return e=!0,{done:!1,value:new uf(new Promise(a=>{var h=t[r](o);if(!(h instanceof Object))throw TypeError("Object expected");a(h)}),1)}}),n[Jo("iterator")]=()=>n,i("next"),"throw"in t?i("throw"):n.throw=r=>{throw r},"return"in t&&i("return"),n},wn="_M",zs=window.navigator.userAgent.toLowerCase(),mf=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,vl=/iphone|ipad|ipod/i,gf=/^((?!chrome|android).)*safari/i,wl,vf=class{constructor(){this.isMobile=mf.test(zs),this.isRetina=(window.devicePixelRatio||1)>1,this.isTouch=!!window.Touch||"ontouchstart"in window,this.isChrome=!!window.chrome,this.isFirefox=zs.indexOf("firefox")>=0,this.isAndroid=zs.indexOf("android")>=0,this.isIOS=vl.test(zs),this.isSafari=vl.test(zs)||gf.test(zs),this.loadQueue=[],this.loaded=!1,this.width=window.innerWidth,this.height=window.innerHeight,this.resizeCallbacks=[],this.theme={name:"light",isDark:!1},this.themeChangedCallbacks=[],this.themeOverride="",this.darkQuery=(wl=window.matchMedia)==null?void 0:wl.call(window,"(prefers-color-scheme: dark)");var s,t;window.onload=()=>this.afterLoad(),document.addEventListener("DOMContentLoaded",()=>this.afterLoad());let e=ve(()=>this.applyResize());window.addEventListener("resize",e);try{(s=this.darkQuery)==null||s.addEventListener("change",()=>this.applyThemeChange())}catch(n){(t=this.darkQuery)==null||t.addListener(()=>this.applyThemeChange())}let i=this.getCookie("theme");i&&this.setTheme(i);try{this.localStorage=window.localStorage}catch(n){console.warn("Unable to access Local Storage in this context.")}}afterLoad(){if(!this.loaded){this.loaded=!0;for(let s of this.loadQueue)s();setTimeout(()=>this.resize())}}ready(s){this.loaded?s():this.loadQueue.push(s)}redraw(){document.body.offsetHeight}applyResize(){let s=window.innerWidth,t=window.innerHeight;if(!(this.width===s&&this.height===t)){this.width=s,this.height=t;for(let e of this.resizeCallbacks)e({width:this.width,height:this.height});C.trigger("scroll",{top:C.scrollTop})}}onResize(s){s({width:this.width,height:this.height}),this.resizeCallbacks.push(s)}offResize(s){let t=this.resizeCallbacks.indexOf(s);t>=0&&this.resizeCallbacks.splice(t,1)}resize(){this.applyResize()}applyThemeChange(){let s=this.theme.name,t=s==="dark"||s==="auto"&&this.darkQuery.matches;if(t!==this.theme.isDark){this.theme.isDark=t;for(let e of this.themeChangedCallbacks)e(this.theme);setTimeout(()=>Xt.setAttr("theme",this.themeOverride||(t?"dark":"light")))}}setTheme(s){s!==this.theme.name&&(this.theme.name=s,this.setCookie("theme",s),this.applyThemeChange())}onThemeChange(s){this.themeChangedCallbacks.push(s)}getHash(){return window.location.hash.slice(1)}setHash(s){let t=document.body.scrollTop;window.location.hash=s,document.body.scrollTop=t}setURL(s,t=""){window.history.replaceState({},t,s),t&&(window.document.title=t)}getCookies(){let s=document.cookie.split(";"),t={};for(let e=0,i=s.length;e<i;++e){let n=s[e].split("=");t[decodeURIComponent(n[0]).trim()]=decodeURIComponent(n[1])}return t}getCookie(s){let t=document.cookie.match(new RegExp(`(^|;) ?${s}=([^;]*)(;|$)`));return t?t[2]:void 0}setCookie(s,t,e=60*60*24*365){let i=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${s}=${t};path=/;max-age=${e};domain=${i}`}deleteCookie(s){this.setCookie(s,"",-1)}setStorage(s,t){var e,i;let n=(s||"").split("."),r=we(((e=this.localStorage)==null?void 0:e.getItem(wn))||void 0,{}),o=r;for(let a=0;a<n.length-1;++a)o[n[a]]===void 0&&(o[n[a]]={}),o=o[n[a]];o[n[n.length-1]]=t,(i=this.localStorage)==null||i.setItem(wn,JSON.stringify(r))}getStorage(s){var t;let e=we((t=this.localStorage)==null?void 0:t.getItem(wn),{});if(!s)return e;let i=(s||"").split("."),n=i.pop();for(let r of i){if(!(r in e))return;e=e[r]}return e[n]}deleteStorage(s){var t;s?this.setStorage(s,void 0):(t=this.localStorage)==null||t.setItem(wn,"")}getActiveInput(){let s=document.activeElement;return s!=null&&s.shadowRoot&&(s=s.shadowRoot.activeElement),s===document.body?void 0:k(s)}get formIsActive(){var s;return!!((s=this.getActiveInput())!=null&&s.is("input, select, textarea, [contenteditable]"))}},b=window.BoostBrowser||new vf;window.BoostBrowser=b;var wf=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,yf=/\bAppleWebKit\/(\d+)\b/,bf=/\bEdge\/12\.(\d+)\b/,xf=wf.test(navigator.userAgent)||+(navigator.userAgent.match(bf)||[])[1]<10547||+(navigator.userAgent.match(yf)||[])[1]<537,ta={};function $f(){if(!xf)return;Array.from(document.querySelectorAll("svg > use")).forEach(function(t){let e=t.getAttribute("xlink:href"),[i,n]=e.split("#");if(!i.length||!n)return;let r=t.parentNode;r.removeChild(t),i in ta||(ta[i]=fetch(i).then(a=>a.text())),ta[i].then(a=>{let h=document.implementation.createHTMLDocument("");h.documentElement.innerHTML=a;let c=h.getElementById(n).cloneNode(!0),u=document.createDocumentFragment();for(;c.childNodes.length;)u.appendChild(c.firstChild);r.appendChild(u)})})}var Pf=new Map(Object.entries({" ":"Space",Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Down:"ArrowDown",Up:"ArrowUp"}));function Mi(s){return Pf.get(s.key)||s.key}function El(s){let t=new Set(["Enter","Space"]),e=!1;document.addEventListener("keyup",i=>{t.has(Mi(i))&&(e=!1)}),(s||document).addEventListener("keydown",i=>{if(!e&&t.has(Mi(i))){e=!0;let n=b.getActiveInput();n&&n.hasAttr("tabindex")&&n.tagName!=="TEXTAREA"&&(i.preventDefault(),n.trigger("pointerdown",i),n.trigger("pointerstop",i),C.trigger("pointerstop",i),n.trigger("click",i))}})}var Tn=!1;setTimeout(()=>Tn=!0);var Tf="cubic-bezier(0.175, 0.885, 0.32, 1.275)",Sf="cubic-bezier(0.68, -0.275, 0.825, 0.115)",ds={cancel:()=>{},promise:Promise.resolve()};function pt(s,t){if(t===0)return s(1,0,()=>{}),ds;let e=Date.now(),i=Ke(),n=0,r=!0,o=()=>{r=!1,i.reject()};function a(){if(!r)return;(!t||n<=t)&&window.requestAnimationFrame(a);let h=Date.now()-e;s(t?Math.min(1,h/t):h,h-n,o),t&&h>=t&&i.resolve(),n=h}return a(),{cancel:o,promise:i.promise}}function yn(s,t=0,e=0){switch(s){case"quad":return t**2;case"cubic":return t**3;case"quart":return t**4;case"quint":return t**5;case"circ":return 1-Math.sqrt(1-t**2);case"sine":return 1-Math.cos(t*Math.PI/2);case"exp":return t<=0?0:Math.pow(2,10*(t-1));case"back":return e||(e=1.70158),t*t*((e+1)*t-e);case"elastic":return e||(e=.3),-Math.pow(2,10*(t-1))*Math.sin(((t-1)*2/e-.5)*Math.PI);case"swing":return .5-Math.cos(t*Math.PI)/2;case"spring":return 1-Math.cos(t*4.5*Math.PI)*Math.exp(-t*6);case"bounce":return t<1/11?1/64-7.5625*(.5/11-t)*(.5/11-t):t<3/11?1/16-7.5625*(2/11-t)*(2/11-t):t<7/11?1/4-7.5625*(5/11-t)*(5/11-t):1-7.5625*(1-t)*(1-t);default:return t}}function yt(s,t=0,e=0){if(t===0)return 0;if(t===1)return 1;let[i,n]=s.split("-");return n==="in"?yn(i,t,e):n==="out"?1-yn(i,1-t,e):t<=.5?yn(i,2*t,e)/2:1-yn(i,2*(1-t),e)/2}function Ht(s,t,e=400,i=0,n="ease-in-out"){if(!Tn)return Object.keys(t).forEach(f=>{let v=t[f];s.css(f,Array.isArray(v)?v[1]:v)}),ds;n==="bounce-in"&&(n=Tf),n==="bounce-out"&&(n=Sf);let r="";b.isSafari&&(r=s._el.style.transition,s.css("transition","none"),b.redraw());let o=s._data.animation;o&&o.cancel();let a={},h={},l=Ke(),c=window.getComputedStyle(s._el);Object.keys(t).forEach(f=>{let v=t[f],w=on(f);h[w]=Array.isArray(v)?v[0]:c.getPropertyValue(f),a[w]=Array.isArray(v)?v[1]:v,i&&s.css(f,h[w])});let u=a.height;if(a.height==="auto"){let f=s.children.filter(v=>v.css("position")!=="absolute");a.height=`${N(f.map(v=>v.outerHeight))}px`}let d,g=!1;Zt(()=>{g||(d=s._el.animate([h,a],{duration:e,easing:n,fill:"forwards"}),d.onfinish=()=>{s._el&&Object.keys(t).forEach(f=>s.css(f,f==="height"?u:a[f])),b.isSafari&&s.css("transition",r),l.resolve(),d.cancel(),s._data.animation=void 0})},i);let y={cancel(){g||(g=!0,s._el&&Object.keys(t).forEach(f=>s.css(f,s.css(f))),d&&d.cancel(),s._data.animation=void 0)},promise:l.promise};return setTimeout(()=>s._data.animation=y),y}var Ef=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;function Mf(s,t="fade",e=500,i=0){if(s.show(),!Tn)return ds;let n=s._data.animation?1:+s.css("opacity")||1;if(t==="fade")return Ht(s,{opacity:[0,n]},e,i);if(t==="pop"){let r=s.transform.replace(/scale\([0-9.]*\)/,"").replace(Ef,"translate($1px,$2px)");return Ht(s,{opacity:[0,n]},e,i),Ht(s,{transform:[`${r} scale(0.5)`,`${r} scale(1)`]},e,i,"bounce-in")}else{if(t==="descend")return Ht(s,{opacity:[0,1],transform:["translateY(-50%)","none"]},e,i);if(t.startsWith("draw")){let r=s.strokeLength;s.css("stroke-dasharray",`${r}px`),s.css("opacity")||s.css("opacity",1);let o=t==="draw-reverse"?`${2*r}px`:0,a={"stroke-dashoffset":[`${r}px`,o]},h=Ht(s,a,e,i,"linear");return h.promise.then(()=>s.css("stroke-dasharray","")),h}else if(t.startsWith("slide")){let r={opacity:[0,n],transform:["translateY(50px)","none"]};return t.includes("down")&&(r.transform[0]="translateY(-50px)"),t.includes("right")&&(r.transform[0]="translateX(-50px)"),t.includes("left")&&(r.transform[0]="translateX(50px)"),Ht(s,r,e,i)}else if(t.startsWith("reveal")){let r={opacity:[0,n],height:[0,"auto"]};return t.includes("left")&&(r.transform=["translateX(-50%)","none"]),t.includes("right")&&(r.transform=["translateX(50%)","none"]),Ht(s,r,e,i)}}return ds}function Cf(s,t="fade",e=400,i=0,n=!1){if(!s._el)return ds;if(!Tn)return s.hide(),ds;if(s.css("display")==="none")return ds;let r;if(t==="fade")r=Ht(s,{opacity:[1,0]},e,i);else if(t==="pop"){let o=s.transform.replace(/scale\([0-9.]*\)/,"");Ht(s,{opacity:[1,0]},e,i),r=Ht(s,{transform:[`${o} scale(1)`,`${o} scale(0.5)`]},e,i,"bounce-out")}else if(t==="ascend")r=Ht(s,{opacity:[1,0],transform:["none","translateY(-50%)"]},e,i);else if(t.startsWith("draw")){let o=s.strokeLength;s.css("stroke-dasharray",o);let h={"stroke-dashoffset":[t==="draw-reverse"?`${2*o}px`:0,`${o}px`]};r=Ht(s,h,e,i,"linear")}else if(t.startsWith("slide")){let o={opacity:0,transform:"translateY(50px)"};t.includes("up")&&(o.transform="translateY(-50px)"),r=Ht(s,o,e,i)}else if(t.startsWith("reveal")){let o={opacity:0,height:0};t.includes("left")&&(o.transform="translateX(-50%)"),t.includes("right")&&(o.transform="translateX(50%)"),r=Ht(s,o,e,i)}return r.promise.then(()=>n?s.remove():s.hide()),r}var Ml={"===":(s,t)=>s===t,"!==":(s,t)=>s!==t,"||":(s,t)=>s||t,"&&":(s,t)=>s&&t,"==":(s,t)=>s==t,"!=":(s,t)=>s!=t,"<=":(s,t)=>s<=t,">=":(s,t)=>s>=t,"**":(s,t)=>s**t,"<":(s,t)=>s<t,">":(s,t)=>s>t,"+":(s,t)=>s+t,"-":(s,t)=>s-t,"*":(s,t)=>s*t,"/":(s,t)=>s/t,"%":(s,t)=>s%t},Cl={"-":s=>-s,"+":s=>+s,"!":s=>!s},yl={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},bl={true:!0,false:!1,undefined:void 0},Af=/\s/,kf=/[0-9]/,ea=/[a-zA-Zα-ωΑ-Ω$_]/,Vf=/[0-9a-zA-Zα-ωΑ-Ω$_]/;function If(s){let t=s.length,e=0;function i(f){throw new Error(`${f} at character ${e} of "${s}"`)}function n(){for(;Af.test(s[e]);)e+=1}function r(){var f;let v=((f=s.slice(e).match(/^\d*(\.\d+)?([eE][+-]?\d+)?/))==null?void 0:f[0])||"";e+=v.length;let w=s[e];return w&&(ea.test(w)||w===".")&&i(`Unexpected character (${v+w})`),{type:5,value:parseFloat(v)}}function o(){let f=s[e];e+=1;let v=!1,w="";for(;e<t;){let x=s[e++];if(x===f){v=!0;break}w+=x}return v||i(`Unclosed quote after "${w}"`),{type:5,value:w}}function a(){let f=s[e];for(ea.test(s[e])||i(`Unexpected ${f}`),e+=1;e<t&&Vf.test(s[e]);)f+=s[e++];return f in bl?{type:5,value:bl[f]}:{type:4,name:f}}function h(f){let v=[],w=!1,x;for(;e<t;)if(s[e]===f){x&&v.push(x),w=!0,e+=1;break}else s[e]===","?(v.push(x||{type:5,value:void 0}),e+=1):x=g();return w||i(`Expected ${f}`),v}function l(){let f;if(s[e]==="("){if(e+=1,f=g(),n(),s[e]===")")return e+=1,f;i("Unclosed (")}else f=a();for(n();".[(".includes(s[e]);)s[e]==="."?(e++,n(),f={type:6,object:f,computed:!1,property:a()}):s[e]==="["?(e++,f={type:6,object:f,computed:!0,property:g()},n(),s[e]!=="]"&&i("Unclosed ["),e++):s[e]==="("&&(e++,f={type:2,args:h(")"),callee:f}),n();return f}function c(){n();for(let f of[3,2,1]){let v=s.substr(e,f);if(v in Ml)return e+=f,v}}function u(){n();let f=s[e];if(kf.test(f)||f===".")return r();if(f==="'"||f==='"')return o();if(f==="[")return e+=1,{type:0,elements:h("]")};if(f in Cl)return e+=1,{type:7,operator:f,argument:u()};if(ea.test(f)||f==="(")return l();i("Expression parsing error")}function d(){let f=u(),v=c();if(!v)return f;let w=u();w||i(`Expected expression after ${v}`);let x,I=[f,v,w];for(;v=c();){let M=yl[v],P=v;for(;I.length>2&&M<=yl[I[I.length-2]];)w=I.pop(),v=I.pop(),f=I.pop(),x={type:1,operator:v,left:f,right:w},I.push(x);x=u(),x||i(`Expected expression after ${P}`),I.push(P,x)}let A=I.length-1;for(x=I[A];A>1;)x={type:1,operator:I[A-1],left:I[A-2],right:x},A-=2;return x}function g(){let f=d();if(n(),f&&s[e]==="?"){e+=1;let v=g();if(v||i("Expected expression"),n(),s[e]===":"){e++;let w=g();return w||i("Expected expression"),{type:3,test:f,consequent:v,alternate:w}}else i("Expected :")}else return f}let y=g();return e<s.length&&i(`Unexpected "${s[e]}"`),y}var cs=[void 0,void 0],xl=["__proto__","constructor","prototype"];function ae(s,t,e){switch(s.type){case 0:let i=s.elements.map(y=>ae(y,t,e)[0]);return i.some(y=>y===void 0)?cs:[i,void 0];case 1:let n=ae(s.left,t,e)[0],r=ae(s.right,t,e)[0];return"+-**/%".includes(s.operator)&&(n===void 0||r===void 0)?cs:[Ml[s.operator](n,r),void 0];case 2:let[o,a]=ae(s.callee,t,e);if(o===Function||o===eval)return cs;let h=s.args.map(y=>ae(y,t,e)[0]);return h.some(y=>y===void 0)||typeof o!="function"?cs:[o.apply(a,h),void 0];case 3:let l=ae(s.consequent,t,e),c=ae(s.alternate,t,e);return ae(s.test,t,e)[0]?l:c;case 4:return xl.includes(s.name)?cs:[e[s.name]||t[s.name],void 0];case 5:return[s.value,void 0];case 6:let u=ae(s.object,t,e)[0],d=s.computed?ae(s.property,t,e)[0]:s.property.name;return xl.includes(d)?cs:u?[u[d],u]:[void 0,void 0];case 7:let g=ae(s.argument,t,e)[0];return g===void 0&&s.operator!=="!"?cs:[Cl[s.operator](g),void 0]}}function ct(s){let t=If(s);return t?(e={},i={})=>ae(t,e,i)[0]:(e={})=>{}}var Lf=/\${([^}]+)}/g;function xn(s,t=!1){let e=s.split(Lf),i=e.map((n,r)=>r%2?ct(n.replace(/×/g,"*")):void 0);return n=>e.map((r,o)=>{if(!(o%2))return r;let a=i[o](n);return!t&&typeof a=="number"&&a<0?`\u2013${-a}`:a}).join("")}var Si="ontouchstart"in window,Bs="onpointerdown"in window;function It(s){if(s.touches){let t=s.targetTouches.length?s.targetTouches:s.changedTouches;return new p(t[0].clientX,t[0].clientY)}else return new p(s.clientX||0,s.clientY||0)}function Of(s){return s.touches||[]}function me(s,t){return It(s).transform(t.inverseTransformMatrix)}function Al(s,t){let e=It(s),i=t.bounds,n=(e.x-i.left)*t.canvasWidth/i.width,r=(e.y-i.top)*t.canvasHeight/i.height;return new p(n,r)}function Rf(s){if(s instanceof PointerEvent&&s.pointerType==="mouse")return k(s.target);let t=It(s);return k(document.elementFromPoint(t.x,t.y)||void 0)}function Df(s){if(s._data.tapEvent)return;s._data.tapEvent=!0;let t;s.on("pointerdown",e=>t=It(e)),s.on("pointerup",e=>{if(!t)return;let i=It(e);p.distance(t,i)<6&&s.trigger("tap",e),t=void 0}),s.on("pointercancel",()=>t=void 0)}function Nf(s){s._data.clickOutsideEvent||(s._data.clickOutsideEvent=!0,C.on("pointerdown",t=>{let e=t.composedPath()[0]||t.target;!e||s._el===e||s._el.contains(e)||s.trigger("clickOutside",t)}))}function us(s,t){let e=t.$box||s,i=It;e.type==="svg"?i=d=>me(d,e.$ownerSVG):e.type==="canvas"&&(i=d=>Al(d,e));let n=t.justInside?s:C,r,o,a=!1,h=0;s.css("touch-action")==="auto"&&s.css("touch-action","none"),s.addClass("noselect");function l(d){d.handled||Of(d).length>1||(d.preventDefault(),a=!1,h=d.pointerId||0,n.on("pointermove",c),n.on("pointerstop",u),r=o=i(d),t.down&&t.down(r))}function c(d){if(!r||h&&d.pointerId!==h)return;d.preventDefault();let g=i(d);p.distance(g,o)<.5||(!a&&t.start&&t.start(r),t.move&&t.move(g,r,o),o=g,a=!0)}function u(d,g=!1){r&&(h&&d.pointerId!==h||(d.preventDefault(),n.off("pointermove",c),n.off("pointerstop",u),t.up&&t.up(o,r),a&&t.end&&t.end(o,r),!a&&t.click&&!g&&t.click(r),r=void 0))}C.onKey("Escape",()=>{if(!r)return;a&&t.move&&t.move(r,r,o),o=r;let d=document.createEvent("MouseEvent");d.pointerId=h,u(d,!0)}),s.on("pointerdown",l),t.justInside&&s.on("mouseleave",u),t.accessible&&(s.setAttr("tabindex","0"),document.addEventListener("keydown",d=>{if(![37,38,39,40].includes(d.keyCode)||s!==b.getActiveInput())return;let g=s.boxCenter,y=i({clientX:g.x,clientY:g.y}),f=d.keyCode===37?-25:d.keyCode===39?25:0,v=d.keyCode===38?-25:d.keyCode===40?25:0,w=y.shift(f,v);t.down&&t.down(y),t.start&&t.start(y),t.move&&t.move(w,y,y),t.end&&t.end(w,y)}))}function kl(s,t){let e=It;s.type==="svg"?e=n=>me(n,s.$ownerSVG):s.type==="canvas"&&(e=n=>Al(n,s));let i=!1;s.on("touchstart mouseenter",n=>{!i&&t.enter&&t.enter(),t.move&&t.move(e(n)),i=!0},{passive:!0}),s.on("pointermove",n=>{i&&t.move&&t.move(e(n))}),s.on("touchend mouseleave",()=>{i&&t.exit&&t.exit(),i=!1},{passive:!0})}function Gf(s){if(s._data.scrollEvents)return;s._data.scrollEvents=!0;let t=!1,e;function i(){let h=s.scrollTop;if(h===e){t=!1;return}e=h,s.trigger("scroll",{top:e}),window.requestAnimationFrame(i)}function n(){t||window.requestAnimationFrame(i),t=!0}(s.type==="window"?window:s._el).addEventListener("scroll",n);function o(){window.addEventListener("touchmove",n),window.addEventListener("touchend",a)}function a(){window.removeEventListener("touchmove",n),window.removeEventListener("touchend",a)}s._el.addEventListener("touchstart",function(h){h.handled||o()})}function _s(s,t){let e=t.$clickTarget||s,i=0,n=!1,r=!1,o=!1;function a(){n||(t.enter&&t.enter(),n=!0)}function h(){n&&(clearTimeout(i),t.exit&&t.exit(),n=!1)}s.on("mouseover",()=>{t.preventMouseover&&t.preventMouseover()||(clearTimeout(i),i=Zt(()=>{a(),r=!0},t.delay))}),s.on("mouseout",()=>{r&&(clearTimeout(i),i=Zt(h,t.exitDelay||t.delay))}),e.on("focus",()=>{n||t.preventMouseover&&t.preventMouseover()||(clearTimeout(i),a(),o=!0)});let l=()=>{o&&(t.canFocusWithin?setTimeout(()=>{let c=b.getActiveInput();c&&c.hasParent(s)?c.one("blur",l):h()}):h())};e.on("blur",l),e.on("click",()=>{n&&!r?h():n||(a(),r=!1)}),s.on("clickOutside",h)}var sa;function zf(s){for(let t of s){let e=t.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>k(t.target).trigger(e))}}function $l(s){if(!s._data.intersectionEvents){if(s._data.intersectionEvents=!0,!window.IntersectionObserver){let t=!1;C.on("scroll",()=>{let e=s.isInViewport;t&&!e?(s.trigger("exitViewport"),t=!1):e&&!t&&(s.trigger("enterViewport"),t=!0)});return}sa||(sa=new IntersectionObserver(zf)),sa.observe(s._el)}}function Bf(s,t=!1){if(t&&(s._data.resizeObserver&&s._data.resizeObserver.disconnect(),s._data.resizeObserver=void 0),!s._data.resizeObserver){if(window.ResizeObserver){let e=new window.ResizeObserver(()=>s.trigger("resize"));e.observe(s._el),s._data.resizeObserver=e}else if(window.MutationObserver){let e=new MutationObserver(()=>s.trigger("resize"));e.observe(s._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),s._data.resizeObserver=e}}}function Pl(s){if(s._data.pointerPositionEvents)return;s._data.pointerPositionEvents=!0;let t=s.parent,e;t.on("pointerend",()=>e=void 0),t.on("pointermove",i=>{let n=e,r=Rf(i);e=r.equals(s)||r.hasParent(s),n!==void 0&&e&&!n&&s.trigger("pointerenter",i),!e&&n&&s.trigger("pointerleave",i)})}function ia(s,t){t._data[`_${s}`]||(t._data[`_${s}`]=!0,Bs?t.on(s.replace("mouse","pointer"),e=>{e.pointerType==="mouse"&&t.trigger(s,e)}):Si||t._el.addEventListener(s,e=>t.trigger(s,e)))}function _f(s){s.on("keydown",t=>{if(t.metaKey||t.ctrlKey||b.isAndroid&&t.keyCode===229)return;let e=t.key||String.fromCharCode(t.which),i=!!t.shiftKey;s.trigger("key",{code:t.keyCode,key:e,char:e,shift:i})}),b.isAndroid&&s.type==="input"&&s.on("input",t=>{let e=t.key||t.data[t.data.length-1];s.trigger("key",{code:void 0,key:e,char:e}),s.value=""})}var $n={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:Bs?"pointerdown":Si?"touchstart":"mousedown",pointermove:Bs?"pointermove":Si?"touchmove":"mousemove",pointerup:Bs?"pointerup":Si?"touchend":"mouseup",pointercancel:Bs?"pointercancel":"touchcancel",pointerstop:Bs?"pointerup pointercancel":Si?"touchend touchcancel":"mouseup"},Pn={scroll:Gf,tap:Df,clickOutside:Nf,key:_f,mousedown:ia.bind(void 0,"mousedown"),mousemove:ia.bind(void 0,"mousemove"),mouseup:ia.bind(void 0,"mouseup"),pointerenter:Pl,pointerleave:Pl,enterViewport:$l,exitViewport:$l,resize:Bf};function Ff(s,t,e,i){if(t in Pn)Pn[t](s,!1);else if(t in $n){let n=K($n[t]);for(let r of n)s._el.addEventListener(r,e,i)}else s._el.addEventListener(t,e,i)}function qf(s,t,e){if(t in Pn)(!s._events[t]||!s._events[t].length)&&Pn[t](s,!0);else if(e&&t in $n){let i=K($n[t]);for(let n of i)s._el.removeEventListener(n,e)}else e&&s._el.removeEventListener(t,e)}var bn=0,na=new Map;function Tl(s,t){na.set(s,t)}function Hf(s){if(bn++,s(),bn--,bn===0){for(let[t,e]of na.entries())t(e);na.clear()}}function le(s,t){let e=new Map,i=new Map,n=new Set,r,o=0;function a(M){r=M;let P=M(A,!0);return r=void 0,P}function h(M){for(let P of e.values())P.has(M)&&P.delete(M);n.delete(M)}function l(M,P){return n.add(M),P?void 0:M(A,!0)}function c(M,P){i.has(M)&&h(i.get(M));let j=()=>{s[M]=P(A),r===j&&(r=void 0),u(M)};i.set(M,j),a(j)}function u(M){if(bn>0){for(let P of e.get(M)||[])Tl(P,s);for(let P of n)Tl(P,s)}else{for(let P of e.get(M)||[])P(s);for(let P of n)P(s)}}function d(){for(let M of e.values())for(let P of M)P(s);for(let M of n)M(s)}function g(M,P){P&&(s={}),Hf(()=>{for(let[j,ne]of Object.entries(M))j in w||(w[j]=s[j]),A[j]=ne})}function y(){for(o+=1;`_x${o}`in s;)o+=1;return`_x${o}`}function f(){s={},e.clear(),i.clear(),o=0}function v(){return Object.assign({},s)}let w={};function x(){let M=[{},{}];for(let P of Object.keys(w))w[P]!==s[P]&&(M[0][P]=w[P],M[1][P]=s[P]);return w={},M}function I(M){t&&t.watch(()=>A[M]=t[M])}let A=new Proxy(s,{get(M,P){return P==="watch"?a:P==="unwatch"?h:P==="watchAll"?l:P==="setComputed"?c:P==="forceUpdate"?d:P==="getChanges"?x:P==="assign"?g:P==="getKey"?y:P==="clear"?f:P==="copy"?v:P==="_internal"?[s,e]:(r&&(e.has(P)||e.set(P,new Set),e.get(P).add(r)),P in s||I(P),s[P])},set(M,P,j){return s[P]===j||(P in w||(w[P]=s[P]),s[P]=j,i.has(P)&&(h(i.get(P)),i.delete(P)),u(P)),!0},deleteProperty(M,P){return delete s[P],e.delete(P),i.delete(P),!0}});return A}var jf={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},Uf=/[astvzqmhlc]([^astvzqmhlc]*)/ig,Wf=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function Sn(s){let t=[],e;for(let i of s.match(Uf)||[]){let n=i[0].toUpperCase();if(n==="Z"){t.push({type:"Z",points:[]});continue}let r=(i.slice(1).match(Wf)||[]).map(a=>+a),o=n===i[0];for(let[a,h]of ko(r,jf[n]).entries()){let l=[],c=n==="M"&&a>0?"L":n,u;n==="H"?(c="L",l=[new p(h[0],o&&(e==null?void 0:e.y)||0)]):n==="V"?(c="L",l=[new p(o&&(e==null?void 0:e.x)||0,h[0])]):n==="A"?(c="A",l=[new p(h[5],h[6])],u=h.slice(0,5)):"MLCSQT".includes(n)&&(l=ko(h,2).map(d=>new p(d[0],d[1]))),!o&&e&&(l=l.map(d=>d.translate(e))),e=O(l),t.push({type:c,points:l,options:u})}}return t}function ra(s){return s?Sn(s).map(e=>O(e.points)).filter(e=>!!e):[]}var Kf=["font-family","font-size","font-style","font-weight","letter-spacing","text-decoration","color","display","visibility","alignment-baseline","baseline-shift","opacity","text-anchor","clip","clip-path","clip-rule","mask","filter","transform","transform-origin","white-space","line-height"],Xf=["fill","fill-rule","marker","marker-start","marker-mid","marker-end","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-width","text-rendering","dominant-baseline","transform-box","paint-order"],Yf=["padding","min-width","max-width","height","border-width","border-style","border-color","box-sizing","background","width","grid-template-columns","text-align"],Zf=["class","tabindex","contenteditable"],Qf=new Set(["opacity","transform-box","transform-origin","border-width","border-style","border-color"]),Jf={"font-style":"normal","font-weight":"400","letter-spacing":"normal","text-decoration":"none",display:"block",visibility:"visible","alignment-baseline":"auto","baseline-shift":"0px","text-anchor":"start",clip:"auto","clip-path":"none","clip-rule":"nonzero",mask:"none",opacity:"1",filter:"none",fill:"rgb(0, 0, 0)","fill-rule":"nonzero",marker:"none",stroke:"none","stroke-dasharray":"none","stroke-dashoffset":"0px","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-width":"1px","text-rendering":"auto",transform:"none","dominant-baseline":"auto","transform-origin":"0px 0px","transform-box":"view-box","paint-order":"normal"};function Vl(s){var t,e;if(s.getAttribute("hidden")||s.style.opacity==="0"||s.style.display==="none")(t=s.parentNode)==null||t.removeChild(s);else{for(let i of Array.from(s.children))Vl(i);if(s.tagName==="g"&&s.childElementCount===0)(e=s.parentNode)==null||e.removeChild(s);else for(let i of Zf)s.hasAttribute(i)&&s.removeAttribute(i)}}function tm(s,t){let e=s.parentElement;for(;e;){let i=e.style.getPropertyValue(t);if(i)return i;e=e.parentElement}}function Il(s,t,e=!1){let i=window.getComputedStyle(s);t.removeAttribute("style");let n=e||s.tagName==="foreignObject",r=[...Kf,...n?Yf:Xf];for(let h of r){let l=i.getPropertyValue(h),c=tm(t,h);l===Jf[h]&&!c||!Qf.has(h)&&l===c||t.style.setProperty(h,l)}let o=s.children,a=t.children;for(let h=0;h<a.length;++h)Il(o[h],a[h],n)}var Ll=class{constructor(s){this._el=s,this._data={},this._events={},this.type="default",s._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(s){return this._el===s._el}addClass(s){for(let t of K(s))this._el.classList.add(t)}removeClass(s){for(let t of K(s))this._el.classList.remove(t)}hasClass(s){return this._el.classList.contains(s)}toggleClass(s){return this._el.classList.toggle(s)}setClass(s,t){t?this.addClass(s):this.removeClass(s)}attr(s){return this._el.getAttribute(s)||""}hasAttr(s){return this._el.hasAttribute(s)}setAttr(s,t){t===void 0?this.removeAttr(s):this._el.setAttribute(s,`${t}`)}removeAttr(s){this._el.removeAttribute(s)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(s){this._el.innerHTML=s}get text(){return this._el.textContent||""}set text(s){this._el.textContent=s}set textStr(s){this._el.textContent=`${s}`}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){let s=this.parent;return s?s.model||s.getParentModel():void 0}bindModel(s,t=!0){var e;if(!this.model){if(this.model=s,this.hasAttr(":for"))return this.makeDynamicList(s);for(let{name:i,value:n}of this.attributes)this.makeDynamicAttribute(i,n,s);for(let i of this.childNodes)if(i instanceof Text){if((e=i.textContent)!=null&&e.includes("${")){let n=xn(i.textContent);s.watch(()=>i.textContent=n(s)||"")}}else t&&i.bindModel(s)}}bindVariable(s,t){}toggleDOM(s=!0){s!==!!this._el.parentNode&&(this.$placeholder||(this.$placeholder=k(document.createComment("")),this.insertBefore(this.$placeholder)),s?this.$placeholder.insertBefore(this):this.detach())}makeDynamicAttribute(s,t,e){if(s.startsWith("@")){let i=s.slice(1),n=ct(t);this.on(i,r=>n(e,{$event:r}))}else if(s===":show"){let i=ct(t);e.watch(()=>this.toggle(!!i(e)))}else if(s===":if"){let i=ct(t);e.watch(()=>this.toggleDOM(!!i(e)))}else if(s===":html"){let i=ct(t);e.watch(()=>this.html=i(e)||"")}else if(s===":draw"){let i=ct(t);e.watch(()=>this.draw(i(e)))}else if(s===":class"){let i=ct(t),n=`${this.attr("class")} `;e.watch(()=>this.setAttr("class",n+i(e)))}else if(s===":bind")this.bindVariable(e,t);else if(s.startsWith(":")){let i=ct(t),n=s.slice(1);e.watch(()=>this.setAttr(n,i(e)))}else if(t.includes("${")){let i=xn(t,!0);e.watch(()=>this.setAttr(s,i(e)||""))}(s.startsWith("@")||s.startsWith(":"))&&this.removeAttr(s)}makeDynamicList(s){let[t,e]=this.attr(":for").split(" in ");this.removeAttr(":for");let i=ct(e),n=k(document.createComment(""));this.insertBefore(n),this.detach();let r=[],o=0;s.watch(()=>{let a=i(s);Array.isArray(a)||(a=[]);for(let h=a.length;h<o;++h)r[h].detach();for(let h=o;h<r.length;++h)n.insertBefore(r[h]);for(let h=r.length;h<a.length;++h){let l=this.copy(!0);l.bindModel(le({[t]:void 0},s)),n.insertBefore(l),r.push(l)}o=a.length;for(let h=0;h<o;++h)r[h].model[t]=a[h]})}get bounds(){return this._el.getBoundingClientRect()}get boundsRect(){let s=this.bounds;return new G(new p(s.x,s.y),s.width,s.height)}contains(s){return this.boundsRect.contains(s)}get isInViewport(){if(this.height===0)return!1;let s=this.bounds;return nt(s.top,-s.height,b.height)}get topLeftPosition(){let s=this.bounds;return new p(s.left,s.top)}get boxCenter(){let s=this.bounds;return new p(s.left+s.width/2,s.top+s.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(s){this._el.scrollTop=s,this.trigger("scroll",{top:s,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(s){this._el.scrollLeft=s,this.trigger("scroll",{top:this.scrollTop,left:s})}scrollTo(s,t=1e3,e="cubic"){s<0&&(s=0);let i=this.scrollTop,n=s-i;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=pt(r=>{let o=i+n*yt(e,r);this.scrollTop=o,this.trigger("scroll",{top:o})},t)}scrollBy(s,t=1e3,e="cubic"){s&&this.scrollTo(this.scrollTop+s,t,e)}css(s,t){if(t===void 0){if(typeof s=="string")return window.getComputedStyle(this._el).getPropertyValue(s);{let e=Object.keys(s);for(let i of e)this._el.style.setProperty(i,`${s[i]}`)}}else typeof s=="string"&&this._el.style.setProperty(s,`${t}`)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){let s=this.transform;if(!s)return[[1,0,0],[0,1,0]];let t=s.match(/matrix\(([0-9,.\s-]*)\)/);if(!t||!t[1])return[[1,0,0],[0,1,0]];let e=t[1].split(",");return[[+e[0],+e[2],+e[4]],[+e[1],+e[3],+e[5]]]}get scale(){let s=this.transformMatrix;return[s[0][0],s[1][1]]}setTransform(s,t=0,e=1){let i="";s&&(i+=`translate(${Pt(s.x,.1)}px,${Pt(s.y,.1)}px)`),t&&(i+=` rotate(${t}rad)`),e&&(i+=` scale(${e})`),this._el.style.transform=i}translate(s,t){this.setTransform(new p(s,t))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),this.data.display==="visibility"?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){this.data.display==="visibility"?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(s){s?this.show():this.hide()}is(s){return this._el.matches?this._el.matches(s):Array.from(document.querySelectorAll(s)).includes(this._el)}index(){let s=0,t=this._el;for(;(t=t.previousSibling||void 0)!==void 0;)++s;return s}prepend(s){let t=this._el.childNodes;t.length?this._el.insertBefore(s._el,t[0]):this._el.appendChild(s._el)}append(s){this._el.appendChild(s instanceof Text?s:s._el)}insertBefore(s){this.parent._el.insertBefore(s._el,this._el)}insertAfter(s){let t=this._el.nextSibling;t?this.parent._el.insertBefore(s._el,t):this.parent._el.appendChild(s._el)}get next(){return k(this._el.nextSibling)}get prev(){return k(this._el.previousSibling)}$(s){return k(s,this)}$$(s){return Te(s,this)}get parent(){return k(this._el.parentElement||void 0)}parents(s){let t=[],e=this.parent;for(;e;)(!s||e.is(s))&&t.push(e),e=e.parent;return t}hasParent(...s){let t=s.map(i=>i._el),e=this._el.parentNode;for(;e;){if(_(e,...t))return!0;e=e.parentNode}return!1}get children(){return Array.from(this._el.children||[],s=>k(s))}get childNodes(){return Array.from(this._el.childNodes,s=>{if(!(s instanceof Comment))return s instanceof Text?s:k(s)}).filter(s=>s)}restartAnimation(){let s=this.next,t=this.parent;this.detach(),s?s.insertBefore(this):t.append(this)}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach()}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}copy(s=!0){return k(this._el.cloneNode(s))}on(s,t,e){for(let i of K(s))i in this._events?this._events[i].includes(t)||this._events[i].push(t):this._events[i]=[t],Ff(this,i,t,e)}one(s,t,e){let i=n=>{this.off(s,i),t(n)};this.on(s,i,e)}off(s,t){for(let e of K(s))e in this._events&&(this._events[e]=t?this._events[e].filter(i=>i!==t):[]),qf(this,e,t)}trigger(s,t={}){for(let e of K(s)){if(!this._events[e])return;for(let i of this._events[e])i.call(this,t)}}onKey(s,t,e){s=s.replace("AllArrows","ArrowUp ArrowDown ArrowLeft ArrowRight");let i=new Set(K(s)),n=e!=null&&e.up?"keyup":"keydown";(this._el===document.body?document:this._el).addEventListener(n,o=>{var a,h;let l=Mi(o);(e!=null&&e.meta?!o.ctrlKey&&!o.metaKey:o.ctrlKey||o.metaKey)||!l||!i.has(l)||document.activeElement!==this._el&&((h=(a=document.activeElement)==null?void 0:a.shadowRoot)==null?void 0:h.activeElement)!==this._el&&b.formIsActive||t(o,l)})}onAttr(s,t){new MutationObserver(i=>{for(let n of i)n.type==="attributes"&&n.attributeName===s&&t(this.attr(s))}).observe(this._el,{attributes:!0}),t(this.attr(s),!0)}onPromise(s,t=!1){return t?Promise.resolve():new Promise(e=>this.one(s,()=>e()))}animate(s,t=400,e=0,i="ease-in-out"){return Ht(this,s,t,e,i)}enter(s="fade",t=500,e=0){return Mf(this,s,t,e)}exit(s="fade",t=500,e=0,i=!1){return Cf(this,s,t,e,i)}effect(s){this.one("animationend",()=>this.removeClass(`effects-${s}`)),this.addClass(`effects-${s}`)}},fs=class extends Ll{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return k(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){let s=parseFloat(this.css("padding-left")),t=parseFloat(this.css("padding-right"));return this._el.clientWidth-s-t}get innerHeight(){let s=parseFloat(this.css("padding-bottom")),t=parseFloat(this.css("padding-top"));return this._el.clientHeight-s-t}get outerWidth(){let s=parseFloat(this.css("margin-left")),t=parseFloat(this.css("margin-right"));return this.width+s+t||0}get outerHeight(){let s=parseFloat(this.css("margin-bottom")),t=parseFloat(this.css("margin-top"));return this.height+s+t||0}get positionTop(){let s=this._el,t=0;for(;s;)t+=s.offsetTop,s=s.offsetParent;return t}get positionLeft(){let s=this._el,t=0;for(;s;)t+=s.offsetLeft,s=s.offsetParent;return t}offset(s){if(s._el===this._el.offsetParent){let t=this.offsetTop+s._el.clientTop,e=this.offsetLeft+s._el.clientLeft,i=t+this.height,n=e+this.width;return{top:t,left:e,bottom:i,right:n}}else{let t=s._el.getBoundingClientRect(),e=this._el.getBoundingClientRect();return{top:e.top-t.top,left:e.left-t.left,bottom:e.bottom-t.top,right:e.right-t.left}}}},Ol=class extends Ll{constructor(){super(...arguments),this.type="svg"}get $ownerSVG(){return k(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){let s=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+s}get positionTop(){let s=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+s}get inverseTransformMatrix(){let s=this._el.getScreenCTM().inverse(),t=[[s.a,s.c,s.e],[s.b,s.d,s.f]];if(b.isFirefox){let e=this.transformMatrix;t[0][2]-=e[0][2],t[1][2]-=e[1][2]}return t}setTransform(s,t=0,e=1){let i=s?`translate(${Pt(s.x,.1)} ${Pt(s.y,.1)})`:"",n=$(t,0)?"":`rotate(${t*180/Math.PI})`,r=$(e,1)?"":`scale(${e})`;this.setAttr("transform",[i,n,r].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{let s=this.bounds;return 2*s.height+2*s.width}}getPointAtLength(s){if(this._el instanceof SVGGeometryElement){let t=this._el.getPointAtLength(s);return new p(t.x,t.y)}else return new p(0,0)}getPointAt(s){return this.getPointAtLength(s*this.strokeLength)}get points(){return ra(this.attr("d"))}set points(s){let t=s.length?`M${s.map(e=>`${e.x},${e.y}`).join("L")}`:"";this.setAttr("d",t)}addPoint(s){let t=`${this.attr("d")} L ${s.x},${s.y}`;this.setAttr("d",t)}get center(){let s=+this.attr(this.tagName==="TEXT"?"x":"cx")||0,t=+this.attr(this.tagName==="TEXT"?"y":"cy")||0;return new p(s,t)}setCenter(s){this.setAttr(this.tagName==="TEXT"?"x":"cx",s.x),this.setAttr(this.tagName==="TEXT"?"y":"cy",s.y)}setLine(s,t){this.setAttr("x1",s.x),this.setAttr("y1",s.y),this.setAttr("x2",t.x),this.setAttr("y2",t.y)}setRect(s){this.setAttr("x",s.p.x),this.setAttr("y",s.p.y),this.setAttr("width",s.w),this.setAttr("height",s.h)}draw(s,t={}){if(!s)return this.setAttr("d","");let e={};for(let i of["mark","arrows","round"])this.hasAttr(i)&&(e[i]=this.attr(i));this.hasClass("fill")&&(e.fill="fill"),this.hasAttr("size")&&(e.size=+this.attr("size")||void 0),this.setAttr("d",De(s,Object.assign(t,e)))}},em=class extends Ol{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}drawPath(s,t={},e={}){let i=m("path",t,this);return i.draw(s,e),i}image(s,t,e,i){return he(this,null,function*(){let n=this.copy(!0);Il(this._el,n._el),s==="svg"&&Vl(n._el),e||(e=t||this.svgHeight),t||(t=this.svgWidth),n.setAttr("width",t),n.setAttr("height",e),n.setAttr("viewBox",i||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),n.setAttr("xmlns","http://www.w3.org/2000/svg");let r=n.$$("image");if(s==="svg")for(let c of r)c.setAttr("href",new URL(c.attr("href"),location.href));else yield Promise.all(r.map(c=>he(this,null,function*(){c.setAttr("href",yield am(c.attr("href")))})));let o=new XMLSerializer().serializeToString(n._el),a=`data:image/svg+xml;utf8,${encodeURIComponent(o)}`;if(s==="svg")return a;let h=m("canvas",{width:t,height:e});s==="jpg"&&(h.ctx.fillStyle="white",h.ctx.fillRect(0,0,t,e));let l=yield Gl(a);return h.ctx.drawImage(l,0,0,t,e),h.image(s)})}downloadImage(s,t,e,i){let n=b.isIOS?window.open("","_blank"):void 0,r=b.theme.isDark;r&&b.setTheme("light");let o=s.endsWith(".jpg")?"jpg":s.endsWith(".svg")?"svg":"png",a=this.image(o,t,e,i);r&&b.setTheme("dark"),a.then(h=>{if(n)return n.location.href=h;m("a",{download:s,href:h,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))})}},Rl=class extends fs{constructor(){super(...arguments),this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(s){document.body.scrollTop=document.documentElement.scrollTop=s,this.trigger("scroll",{top:s,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(s){document.body.scrollLeft=document.documentElement.scrollLeft=s,this.trigger("scroll",{top:this.scrollTop,left:s})}},sm=class extends fs{constructor(){super(...arguments),this.type="form"}get action(){return this._el.action}get formData(){let s={};for(let t of Array.from(this._el.elements)){let e=t.name||t.id;e&&(s[e]=t.value)}return s}get isValid(){return this._el.checkValidity()}},im=class extends fs{constructor(){super(...arguments),this.type="input"}get checked(){return this._el.checked||!1}set checked(s){this._el.checked=s}get value(){return this._el.value}set value(s){this._el.value=s}bindVariable(s,t){if(this._el.type==="checkbox"){let e=t.startsWith("!"),i=n=>e?!n:n;e&&(t=t.slice(1)),s[t]!==void 0?this.checked=i(s[t]):this.hasAttr("checked")&&(s[t]=i(this.checked)),this.on("change",()=>s[t]=i(this.checked)),s.watch(()=>this.checked=i(s[t]));return}if(this._el.type==="number"){let e=this.hasAttr("min")?+this.attr("min"):-1/0,i=this.hasAttr("max")?+this.attr("max"):1/0;this.change(n=>{n&&(s[t]=B(+n,e,i))})}else this.change(e=>s[t]=e);s[t]!==void 0?this.value=s[t]:this.value&&(s[t]=this.value),this.on("blur",()=>this.value=s[t]),s.watch(()=>{document.activeElement!==this._el&&(this.value=s[t])})}setInputPattern(s){if(isNaN(+s))return;let t=s.match(/^[0-9]+$/);this.setAttr("inputmode",t?"numeric":"decimal"),t&&this.setAttr("pattern","[0-9]*")}change(s){let t=this.value||"";this.on("focus",()=>t=this.value),this.on("change keyup input paste",()=>{this.value!==t&&(t=this.value,s(t))})}validate(s){this.change(t=>this.setValidity(s(t)))}setValidity(s){this._el.setCustomValidity(s)}get isValid(){return this._el.checkValidity()}},nm=class extends fs{constructor(){super(...arguments),this.type="canvas"}getContext(s="2d",t={}){return this._el.getContext(s,t)}image(s="png"){return this._el.toDataURL(s==="png"?"image/png":"image/jpeg")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(s,t={}){this.ctx.save(),Qo(this.ctx,s,t),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(s){this.ctx.save(),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(s,t){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(s.x,s.y,t,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(s){let t=this.image(s.endsWith(".jpg")?"jpg":"png");m("a",{download:s,href:t,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}},rm=class extends fs{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}},Dl=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","tspan","pattern","mask","svg","foreignObject","image","use","clipPath","linearGradient","radialGradient"];function k(s,t){if(!s)return;let e=t?t._el:document.documentElement,i=typeof s=="string"?e.querySelector(s):s;if(!i)return;if(i._view)return i._view;let n=(i.tagName||"").toLowerCase();return n==="svg"?new em(i):n==="canvas"?new nm(i):n==="form"?new sm(i):n==="input"||n==="select"||n==="textarea"?new im(i):n==="video"||n==="audio"?new rm(i):Dl.includes(n)?new Ol(i):new fs(i)}function Te(s,t){let e=t?t._el:document.documentElement,i=s?e.querySelectorAll(s):[];return Array.from(i,n=>k(n))}function m(s,t={},e){let i=Dl.includes(s)?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s);for(let[r,o]of Object.entries(t))o!==void 0&&(r==="id"?i.id=o:r==="html"?i.innerHTML=o:r==="text"?i.textContent=o:r==="path"?i.setAttribute("d",De(o)):i.setAttribute(r,o));let n=k(i);return e&&e.append(n),n}var C=new Rl(document.body),Xt=new Rl(document.documentElement);function om(s){let t=[];for(let e of Object.keys(s)){let i=s[e];if(e=encodeURIComponent(e),i==null){t.push(e);continue}i=Array.isArray(i)?i.join(","):`${i}`,i=i.replace(/(\r)?\n/g,`\r
`),i=encodeURIComponent(i),i=i.replace(/%20/g,"+"),t.push(`${e}=${i}`)}return t.join("&")}function Nl(s){s=s.replace(/^[?,&]/,"");let t=decodeURIComponent(s).split("&"),e={};return t.forEach(i=>{let n=i.split("=");e[n[0]]=n[1]}),e}function Ne(s,t){return he(this,null,function*(){let e=t instanceof FormData,i={method:"POST",body:e?t:t?om(t):void 0,headers:{"X-CSRF-Token":window.csrfToken||""}};e||(i.headers["Content-Type"]="application/x-www-form-urlencoded");let n=s.includes("?")?"&xhr=1":"?xhr=1",r=yield fetch(s+n,i);if(!r.ok)throw new Error(`Fetch error ${r.status}: ${s}`);return r.text()})}function Gl(s,t=!1){return new Promise(e=>{let i=new Image;t||(i.crossOrigin="Anonymous"),i.onload=()=>e(i),i.src=s})}var am=Oe(s=>he(void 0,null,function*(){let t=yield Gl(s),e=m("canvas",{width:t.width,height:t.height});return e.ctx.drawImage(t,0,0,t.width,t.height),e.image("png")})),Ei=new Map;function zl(s,t){Ei.has(s)?Co(Ei.get(s),t,(e,i)=>Wt(e.concat(i))):Ei.set(s,t)}function Bl(){if(window.navigator.onLine)for(let[s,t]of Ei)Ei.delete(s),Ne(s,{data:JSON.stringify(t)}).catch(e=>{console.error("Failed to send POST request:",e),zl(s,t)})}var _l=ve(Bl,5e3);window.addEventListener("online",_l);window.onbeforeunload=Bl;function Fl(s,t){zl(s,t),_l()}var ee=class{constructor(s,t=1,e=!0){this.src=s,this.defaultVolume=t,this.player=new Audio,this.player.src=s,e&&(this.player.preload="auto")}play(s){this.player.currentTime=0,this.player.volume=s||this.defaultVolume,this.player.play()}},hm=os(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]),lm=class{constructor(s){this.index=s,this.color=hm(),this.tilt=Math.floor(Math.random()*10)-10,this.tiltAngleIncrement=Math.random()*.07+.05,this.tiltAngle=0,this.x=Math.random()*b.width,this.y=(Math.random()-1)*b.height,this.r=_t.uniform(10,30)}draw(s){s.beginPath(),s.lineWidth=this.r/2,s.strokeStyle=this.color,s.moveTo(this.x+this.tilt+this.r/4,this.y),s.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),s.stroke()}update(s,t){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(s)+3+this.r/2)/2,this.x+=Math.sin(s),this.tilt=Math.sin(this.tiltAngle-this.index/3)*15,this.x<-20?(this.x=-20,this.y=Math.random()*b.height,this.tilt=Math.floor(Math.random()*10)-20):this.x>b.width+20?(this.x=b.width+20,this.y=Math.random()*b.height,this.tilt=Math.floor(Math.random()*10)-20):t&&this.y>b.height&&(this.x=Math.random()*b.width,this.y=-10,this.tilt=Math.floor(Math.random()*10)-20)}},cm="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999",ps=void 0;function Ci(s=2e3,t=150){ps||(ps=m("canvas",{style:cm},C)),ps.setAttr("width",b.width),ps.setAttr("height",b.height),ps.show();let e=ps.ctx,i=z(r=>new lm(r),t),n=pt(r=>{e.clearRect(0,0,b.width,b.height);let o=r<s,a=0;for(let h of i)h.draw(e),h.update(r,o),h.y<b.height&&(a+=1);a||(n.cancel(),ps.hide())})}var ms=class extends Re{constructor(s,t={}){super(),this.$el=s,this.startPos=new p(0,0),this.position=new p(0,0),this.disabled=!1,this.options=Object.assign({moveX:!0,moveY:!0,withinBounds:!0},t),b.onResize(()=>this.updateBounds()),us(s,{start:()=>{this.disabled||(this.startPos=this.position,this.trigger("start"),Xt.addClass("grabbing"))},move:(e,i)=>{this.disabled||(this.setPosition(this.startPos.x+e.x-i.x,this.startPos.y+e.y-i.y),this.trigger("drag",{posn:this.position,pointerPosn:e}),this.checkTarget(e))},end:(e,i)=>{this.disabled||(this.trigger(e.equals(i)?"click":"end",{$target:this.$over}),this.options.$targets&&!this.$over&&this.options.resetOnMiss&&this.resetPosition(),this.$over=void 0,Xt.removeClass("grabbing"))},click:()=>this.trigger("click"),accessible:!0})}addTarget(s){var t;this.options.$targets||(this.options.$targets=[]),(t=this.options.$targets)==null||t.push(s)}removeTarget(s){var t,e;this.options.$targets=(t=this.options.$targets)==null?void 0:t.filter(i=>i!==s),(e=this.options.$targets)!=null&&e.length||(this.options.$targets=void 0)}checkTarget(s){if(!this.options.$targets)return;let t=this.options.$targets.find(e=>e.boundsRect.contains(s));t!==this.$over&&(this.$over&&this.trigger("exit-target",{$target:this.$over}),t&&this.trigger("enter-target",{$target:t}),this.$over=t)}updateBounds(){if(!this.options.withinBounds)return this.bounds=void 0;if(this.options.bounds)return this.bounds=this.options.bounds;let s=this.bounds,t=this.options.$parent||this.$el.parent,e=t.type==="svg"?t.svgWidth:t.width,i=t.type==="svg"?t.svgHeight:t.height;this.bounds=new lt(0,e,0,i),!e&&!i&&setTimeout(()=>this.updateBounds()),s&&this.setPosition(this.position.x*this.bounds.dx/s.dx||0,this.position.y*this.bounds.dy/s.dy||0)}setPosition(s,t){var e;let i=new p(this.options.moveX?s:0,this.options.moveY?t:0);this.bounds&&(i=i.clamp(this.bounds,(e=this.options.margin)!=null?e:0)),i=i.round(this.options.snap||1),this.options.round&&(i=this.options.round(i)),!i.equals(this.position)&&(this.position=i,this.options.useTransform?this.$el.translate(i.x,i.y):(this.options.moveX&&this.$el.css("left",`${i.x}px`),this.options.moveY&&this.$el.css("top",`${i.y}px`)),this.trigger("move",{posn:i}))}resetPosition(s=250){return he(this,null,function*(){let t=this.position;this.$el.css({"pointer-events":"none"}),yield pt(e=>{let i=p.interpolate(t,this.startPos,e);this.setPosition(i.x,i.y)},s).promise,this.$el.css({"pointer-events":"initial"})})}},pm="position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;";function Sl(s,t){let e=t.regex.exec(s);if(e){e.shift();let i={};for(let[n,r]of t.params.entries())i[r]=e[n];return i}else return}function dm(s,t,e){return he(this,null,function*(){return s.template?typeof s.template=="string"?s.template:s.template(t):(yield fetch(e+(e.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()})}var ql=document.readyState==="complete";window.addEventListener("load",()=>setTimeout(()=>ql=!0));"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var um=class extends Re{constructor(){super(...arguments),this.$viewport=C,this.views=[],this.active={path:"",hash:""},this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(s={}){s.$viewport&&(this.$viewport=s.$viewport),s.initialise&&(this.initialise=s.initialise),s.preloaded&&(this.preloaded=s.preloaded),s.transition&&(this.transition=s.transition),s.noLoad&&(this.noLoad=s.noLoad),s.click&&C.on("click",t=>this.onLinkClick(t)),s.history&&window.addEventListener("popstate",t=>he(this,null,function*(){var e;if(!ql||!((e=t.state)!=null&&e.path))return;(yield this.load(t.state.path,t.state.hash))||window.history.pushState(this.active,"",this.active.path+this.active.hash)}))}view(s,{enter:t,exit:e,template:i}={}){let n=(s.match(/:\w+/g)||[]).map(u=>u.substr(1)),r=`${s.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")}\\/?`,o=s.includes("?")?"":"(\\?.*)?",h={regex:new RegExp(`^${r}${o}$`,"i"),params:n,enter:t,exit:e,template:i};this.views.push(h);let l=window.location.pathname+window.location.search,c=Sl(l,h);c&&(this.active={path:l,hash:window.location.hash},window.history.replaceState(this.active,"",this.active.path+this.active.hash),b.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,c),h.enter&&h.enter(this.$viewport,c)):this.loadView(h,c)})}))}paths(...s){for(let t of s)this.view(t)}getView(s){for(let t of this.views){let e=Sl(s,t);if(e)return{view:t,params:e}}}load(s,t){return he(this,null,function*(){if(s===this.active.path&&t!==this.active.hash)return this.trigger("hashChange",t.slice(1)),this.trigger("change",s+t),this.active={path:s,hash:t},!0;let e=this.getView(s);return!e||this.beforeChange&&!(yield this.beforeChange())?!1:(this.active={path:s,hash:t},this.trigger("change",s+t),window.ga&&window.ga("send","pageview",s+t),this.noLoad?e.view.enter&&e.view.enter(this.$viewport,e.params):this.loadView(e.view,e.params),!0)})}loadView(s){return he(this,arguments,function*(t,e={}){this.showLoadingBar();let i=this.active.path,n=yield dm(t,e,i);if(this.active.path!==i)return;yield this.$viewport.animate({opacity:0},200).promise,this.$viewport.removeChildren(),C.scrollTop=0,this.$viewport.html=n,b.resize(),$f(),this.$viewport.animate({opacity:1},200),this.hideLoadingBar();let r=this.$viewport.$("title");r&&(document.title=r.text),this.initialise(this.$viewport,e),t.enter&&t.enter(this.$viewport,e),this.trigger("afterChange",{$viewport:this.$viewport})})}onLinkClick(s){if(s.metaKey||s.ctrlKey||s.shiftKey||s.defaultPrevented)return;let t=s.target;for(;t&&t.nodeName!=="A";)t=t.parentNode;if(!t||t.nodeName!=="A")return;let e=t;if(e.target||e.origin!==window.location.origin||e.hasAttribute("download")||e.getAttribute("rel")==="external")return;let i=e.getAttribute("href");i&&i.indexOf("mailto:")>-1||this.getView(e.pathname+e.search)&&(s.preventDefault(),this.goTo(e.pathname+e.search,e.hash))}goTo(s,t=""){return he(this,null,function*(){let e=this.active.path+this.active.hash;(yield this.load(s,t))&&e!==this.active.path+this.active.hash&&window.history.pushState(this.active,"",s+t)})}replace(s,t=""){this.active={path:s,hash:t},window.history.replaceState(this.active,"",s+t)}back(){window.history.back()}forward(){window.history.forward()}showLoadingBar(){this.$loadingBar||(this.$loadingBar=m("div",{style:pm},C)),this.$loadingBar.css({transform:"translateX(-100%)",opacity:1}),this.$loadingBar.show(),this.animation=pt(s=>{this.$loadingBar.css("transform",`translateX(-${10+90*Math.exp(-4*s)}%)`)},3e3)}hideLoadingBar(){return he(this,null,function*(){var s,t,e;(s=this.animation)==null||s.cancel(),yield(t=this.$loadingBar)==null?void 0:t.animate({transform:"none",opacity:0}).promise,(e=this.$loadingBar)==null||e.hide()})}},Ai=new um;function fm(s,t){let e=Array.from(s.childNodes);s.innerHTML=t;let i={};for(let n of Array.from(s.querySelectorAll("slot")))i[n.getAttribute("name")||""]=n;for(let n of e){let r=n.getAttribute&&n.getAttribute("slot")||"",o=i[r]||i[""];o&&o.parentNode.insertBefore(n,o)}for(let n of Object.values(i))n.parentNode.removeChild(n)}function*Hl(s){for(let t of Array.from(s.children))t.tagName.includes("-")?yield t:yield*Vs(ff(Hl(t)))}var jl=new Map,mm=class extends HTMLElement{constructor(){super(...arguments),this.wasConnected=!1,this.isReady=!1}connectedCallback(){return he(this,null,function*(){if(this.wasConnected){this._view.trigger("connected");return}this.wasConnected=!0,this.isReady=!1,this._view.created();let s=jl.get(this._view.tagName)||{};s.template&&fm(this,s.template);let t=[...Hl(this)].filter(e=>!e.isReady).map(e=>new Promise(i=>e.addEventListener("ready",i)));setTimeout(()=>{this.isReady||console.error(`Children of custom element ${this.tagName} not ready after 1s.`)},1e3),yield Promise.all(t),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0})}disconnectedCallback(){this._view.trigger("disconnected")}},E=class extends fs{created(){}ready(){}},gm=new Map;function S(s,t={}){return function(e){if(window.customElements.get(s)){console.warn(`Trying to declare the custom element ${s} twice!`);return}class i extends mm{constructor(){super(),this._view=new e(this)}}gm.set(s,e),jl.set(s.toUpperCase(),t),window.customElements.define(s,i)}}var En=class{constructor(t){this.clipEndTime=0;this.player=new Audio(t),this.player.preload="true",this.player.addEventListener("timeupdate",()=>{this.player.currentTime>=this.clipEndTime&&this.triggerCallback(!0)}),window.addEventListener("beforeunload",()=>this.player.pause())}playClip(t,e,i){this.triggerCallback(!1),this.player.currentTime=t,this.clipEndTime=e,this.clipCallback=i,this.player.play()}triggerCallback(t){if(!this.clipCallback)return;let e=this.clipCallback;this.clipCallback=void 0,this.player.pause(),e({ended:t})}pause(){this.triggerCallback(!1)}get isPlaying(){return!!this.clipCallback}},aa=!1,oa,Mn=class{constructor(t,e){this.audio=t;this.paragraphs=[];this.paragraphs=e.$$(".voice").map(i=>new ha(i,t));for(let[i,n]of this.paragraphs.entries())n.on("end",()=>{var r;if(this.paragraphs[i+1])this.paragraphs[i+1].play();else{let o=e.nextStep;o&&o.isShown&&((r=o.narration)==null||r.play())}})}play(){var t;this.audio.isPlaying||!aa||(t=this.paragraphs[0])==null||t.play()}},ha=class extends Re{constructor(e,i){super();this.$p=e;this.audio=i;this.playing=void 0;this.sentences=e.$$(".sentence[data-timings]").map(n=>new la(n,i)),this.$button=m("button",{class:"playback-btn",title:"Play Narration"}),this.$button.on("click",()=>{this.playing?this.audio.pause():this.play(),aa=!aa,oa=void 0}),e.prepend(this.$button),e.addClass("sentence-wrap");for(let[n,r]of this.sentences.entries())r.on("end",o=>{this.playing=void 0,o&&this.sentences[n+1]?setTimeout(()=>this.play(this.sentences[n+1]),200):(this.$button.removeClass("active"),o&&setTimeout(()=>this.trigger("end"),400))})}play(e){let i=e||this.sentences[0],n=i.$reveal;if(n&&n.css("visibility")==="hidden"){this.$button.removeClass("active"),oa=n,n.one("reveal",()=>{oa===n&&!this.audio.isPlaying&&this.play(i)});return}this.playing=i,this.playing.play(),this.$button.addClass("active");let r=this.$p.parents("x-tabbox .tab")[0];if(r){let h=r.parents("x-tabbox")[0];h.makeActive(r.index());let l=h.active;h.one("change",c=>{this.playing&&c!==l&&this.audio.pause()})}let o=this.$p.bounds,a=o.top+o.height-b.height+20;a>0&&C.scrollBy(a+100),setTimeout(()=>this.$button.focus(),800)}},la=class extends Re{constructor(e,i){super();this.$el=e;this.audio=i;let n=e.attr("data-timings").split("-");this.start=+n[0]/1e3,this.end=(+n[1]-200)/1e3}play(){this.$el.addClass("playing"),this.audio.playClip(this.start,this.end,({ended:e})=>{this.$el.removeClass("playing"),this.trigger("end",e)})}get $reveal(){return this.$el.parents(".reveal")[0]}};var vm=Object.defineProperty,wm=Object.getOwnPropertyDescriptor,ki=(s,t,e,i)=>{for(var n=i>1?void 0:i?wm(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&vm(t,e,n),n},Ul=(s,t,e)=>new Promise((i,n)=>{var r=h=>{try{a(e.next(h))}catch(l){n(l)}},o=h=>{try{a(e.throw(h))}catch(l){n(l)}},a=h=>h.done?i(h.value):Promise.resolve(h.value).then(r,o);a((e=e.apply(s,t)).next())}),Fs,ym=m("div",{class:"snackbar"},C),Wl=class extends E{ready(){var s;ym.append(this),(s=this.$("button"))==null||s.on("click",()=>this.close())}open(s=2e3){return Ul(this,null,function*(){Fs!==this&&(Fs&&(yield Fs.close()),Fs=this,yield this.enter("pop",300).promise,this.setAttr("role","alert"),s&&setTimeout(()=>this.close(),s))})}close(){return Ul(this,null,function*(){Fs===this&&(Fs=void 0,this.removeAttr("role"),yield this.exit("pop",300).promise)})}};Wl=ki([S("x-alert")],Wl);var Kl=class extends E{ready(){if(this.children.length)return;let s=m("svg",{viewBox:"0 0 24 24",alt:"",role:"presentation"},this),t=m("use",{},s),e=+this.attr("size")||24;for(let i of[this,s])i.css({width:`${e}px`,height:`${e}px`});this.onAttr("name",i=>t.setAttr("href",`/icons.040bc2f9.svg#${i}`))}};Kl=ki([S("x-icon")],Kl);var gs=m("div",{class:"modal-background"},C),ca,Se=void 0,pa=void 0;function da(){Se&&Se.canClose&&Se.close()}gs.on("click",da);C.onKey("Escape",da);Ai.on("change",da);gs.on("scrollwheel touchmove",s=>{s.preventDefault(),s.stopPropagation()});C.onKey("Space ArrowUp ArrowDown PageDown PageUp",s=>{Se&&(s.preventDefault(),s.stopPropagation())});var Xl=class extends E{constructor(){super(...arguments),this.isOpen=!1,this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]"),this.$video=this.$("video");let s=Te(`[data-modal=${this.id}]`);for(let e of s)e.on("click",()=>this.open());Ai.on("afterChange",({$viewport:e})=>{let i=e.$$(`[data-modal=${this.id}]`);for(let n of i)n.on("click",()=>this.open())}),(this.hasClass("open")||b.getHash()===this.id)&&!Se&&this.open(!0),this.$("input")&&this.addClass("interactive");let t=this.$(".close");t&&t.on("click",()=>this.close());for(let e of this.$$(".btn"))e.on("click",()=>this.trigger("btn-click",e))}open(s=!1){var t,e;if(this.isOpen)return;gs.setClass("light",this.hasClass("light")),Se?Se.close(!0):s?gs.show():gs.css("display")==="block"?ca==null||ca.cancel():gs.enter("fade",250),this.isOpen=!0,Se=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),this.$video&&this.$video.play(),s?this.show():this.enter("pop",250).promise.then(()=>this.css("transform","")),this.setAttr("role","dialog"),this.trigger("open"),pa=document.activeElement;let i=this.$('input, a, button, textarea, [tabindex="0"]');i&&i.focus(),(t=window.ga)==null||t.call(window,"send","event","Modal",this.id),(e=window.gtag)==null||e.call(window,"event","modal",{action:this.id})}close(s=!1,t=!1){this.isOpen&&(this.isOpen=!1,this.removeAttr("role"),Se=void 0,this.$iframe&&this.$iframe.setAttr("src",""),this.$video&&this.$video.pause(),s||(ca=gs.exit("fade",250)),this.exit("pop",250).promise.then(()=>this.css("transform","")),t||this.trigger("close"),pa&&pa.focus())}getOpenModal(){return Se}};Xl=ki([S("x-modal")],Xl);var Yl=class extends E{constructor(){super(...arguments),this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide(),this.$(".popup-target").on("click",()=>this.toggleOpen()),this.on("clickOutside",()=>this.close());for(let t of this.$bubble.$$("a"))t.on("click",()=>this.close());C.onKey("Escape",()=>this.close())}toggleOpen(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,150),this.$bubble.setAttr("role","dialog"),this.$bubble.focus(),this.trigger("open"))}close(){this.isOpen&&(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,150),this.$bubble.removeAttr("role"),this.trigger("close"))}};Yl=ki([S("x-popup")],Yl);var Zl=class extends E{constructor(){super(...arguments),this.$options={}}ready(){let s=this.children;this.$active=this.$(".active")||s[0],this.$active.addClass("active");for(let[t,e]of s.entries())!_(e.tagName,"A","BUTTON")&&!e.hasAttr("tabindex")&&e.setAttr("tabindex",0),e.on("click",()=>this.makeActive(e)),this.$options[e.attr("value")||t]=e;this.trigger("change",this.$active)}makeActive(s){s!==this.$active&&(this.$active.removeClass("active"),this.$active=s,s.addClass("active"),this.trigger("change",s))}bindVariable(s,t){s[t]===void 0&&(s[t]=this.$active.attr("value")),this.on("change",e=>s[t]=e.attr("value")),s.watch(()=>{let e=this.$options[s[t]];e&&this.makeActive(e)})}};Zl=ki([S("x-select")],Zl);var ua=12;function bm(s){return`M${s},${s/2}a${s/2},${s/2},0,0,1,0,${s}A${s/2},${s/2},0,0,1,${s},${s/2}`}function xm(s){return`M ${s},0 C ${s/2},0,0,${s/2},0,${s}  s ${s/2},${s},${s},${s} s ${s}-${s/2},${s}-${s}     S ${s*1.5},0,${s},0 z M ${s*44.6/50},${s*76.1/50} L ${s*19.2/50},${s*48.8/50} l ${s*4/50}-${s*4.2/50}     l ${s*19.8/50},${s*11.9/50} l ${s*34.2/50}-${s*32.6/50} l ${s*3.5/50},${s*3.5/50} L ${s*44.6/50},${s*76.1/50} z`}var Cn=class extends E{constructor(){super(...arguments);this.completed=!1}ready(){this.r=+this.attr("r")||10,this.r1=this.r+ua,this.$svg=m("svg",{width:2*this.r1,height:2*this.r1},this),this.$progress=m("path",{class:"pie",d:bm(this.r),"stroke-width":this.r},this.$svg),this.onAttr("p",e=>this.setProgress(+e,!1))}setProgress(e,i=!0){if(e>.99)return this.complete(i);let n=Math.PI*this.r;this.$progress.css("stroke",e?"currentColor":"none"),this.$progress.css("stroke-dasharray",`${e*n} ${n}`)}complete(e=!0){if(this.completed||(this.completed=!0,this.$progress.css("stroke","none"),this.$progress.css("fill","currentColor"),this.$progress.setAttr("d",xm(this.r)),!e))return;let i=`translate(${this.r1} ${this.r1})`,n=m("g",{transform:i},this.$svg),r=z(()=>m("line",{},n),18);pt(o=>{let a=this.r+ua*yt("quint-out",o),h=this.r+ua*o;for(let l=0;l<18;++l){let c=Math.cos(Math.PI*2*l/18),u=Math.sin(Math.PI*2*l/18);r[l].setLine({x:c*a,y:u*a},{x:c*h,y:u*h})}},800).promise.then(()=>n.remove())}};Cn=T([S("x-progress")],Cn);var Ql="2.4.1",fa="i5iSjo",Jl="_av",ma="_au",ga="(not set)";var An=[],se=class{static add(t,e,i){tc(t,e).add(i)}static remove(t,e,i){tc(t,e).remove(i)}constructor(t,e){this.context=t,this.methodName=e,this.isTask=/Task$/.test(e),this.originalMethodReference=this.isTask?t.get(e):t[e],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=(...i)=>{let n=this.boundMethodChain[this.boundMethodChain.length-1];return n(...i)},this.isTask?t.set(e,this.wrappedMethod):t[e]=this.wrappedMethod}add(t){this.methodChain.push(t),this.rebindMethodChain()}remove(t){let e=this.methodChain.indexOf(t);e>-1&&(this.methodChain.splice(e,1),this.methodChain.length>0?this.rebindMethodChain():this.destroy())}rebindMethodChain(){this.boundMethodChain=[];for(let t,e=0;t=this.methodChain[e];e++){let i=this.boundMethodChain[e-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(t(i))}}destroy(){let t=An.indexOf(this);t>-1&&(An.splice(t,1),this.isTask?this.context.set(this.methodName,this.originalMethodReference):this.context[this.methodName]=this.originalMethodReference)}};function tc(s,t){let e=An.filter(i=>i.context==s&&i.methodName==t)[0];return e||(e=new se(s,t),An.push(e)),e}var qs=window.Element.prototype,_w=qs.matches||qs.matchesSelector||qs.webkitMatchesSelector||qs.mozMatchesSelector||qs.msMatchesSelector||qs.oMatchesSelector;var Tm="80",Sm="443",Qw=RegExp(":("+Tm+"|"+Sm+")$"),Jw=document.createElement("a");function kn(s,t,e=void 0,i=void 0,n=void 0,r=void 0){if(typeof i=="function"){let o=e.get("buildHitTask");return{buildHitTask:a=>{a.set(s,null,!0),a.set(t,null,!0),i(a,n,r),o(a)}}}else return Qe({},s,t)}var va={};function sc(s,t){let e=s.get("trackingId"),i=va[e]=va[e]||{},n=()=>{clearTimeout(i.timeout),i.send&&se.remove(s,"send",i.send),delete va[e],i.queue.forEach(r=>r())};clearTimeout(i.timeout),i.timeout=setTimeout(n,0),i.queue=i.queue||[],i.queue.push(t),i.send||(i.send=r=>(...o)=>{n(),r(...o)},se.add(s,"send",i.send))}var Qe=Object.assign||function(s,...t){for(let e=0,i=t.length;e<i;e++){let n=Object(t[e]);for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=n[r])}return s};function ic(s){return s.charAt(0).toUpperCase()+s.slice(1)}function nc(s){return typeof s=="object"&&s!==null}function Je(){return+new Date}var Vi=function s(t){return t?(t^Math.random()*16>>t/4).toString(16):("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,s)};function wa(s,t){let e=window.GoogleAnalyticsObject||"ga";window[e]=window[e]||function(...i){(window[e].q=window[e].q||[]).push(i)},window.gaDevIds=window.gaDevIds||[],window.gaDevIds.indexOf(fa)<0&&window.gaDevIds.push(fa),window[e]("provide",s,t),window.gaplugins=window.gaplugins||{},window.gaplugins[ic(s)]=t}var Ii=class{constructor(){this.registry_={}}on(t,e){this.getRegistry_(t).push(e)}off(t=void 0,e=void 0){if(t&&e){let i=this.getRegistry_(t),n=i.indexOf(e);n>-1&&i.splice(n,1)}else this.registry_={}}emit(t,...e){this.getRegistry_(t).forEach(i=>i(...e))}getEventCount(){let t=0;return Object.keys(this.registry_).forEach(e=>{t+=this.getRegistry_(e).length}),t}getRegistry_(t){return this.registry_[t]=this.registry_[t]||[]}};var Vn="autotrack",Hs={},ba=!1,Li,vs=class s extends Ii{static getOrCreate(t,e,i){let n=[Vn,t,e].join(":");return Hs[n]||(Hs[n]=new s(n,i),ba||Mm()),Hs[n]}static isSupported_(){if(Li!=null)return Li;try{window.localStorage.setItem(Vn,Vn),window.localStorage.removeItem(Vn),Li=!0}catch(t){Li=!1}return Li}static get_(t){return window.localStorage.getItem(t)}static set_(t,e){window.localStorage.setItem(t,e)}static clear_(t){window.localStorage.removeItem(t)}constructor(t,e={}){super(),this.key_=t,this.defaults_=e,this.cache_=null}get(){if(this.cache_)return this.cache_;if(s.isSupported_())try{this.cache_=ya(s.get_(this.key_))}catch(t){}return this.cache_=Qe({},this.defaults_,this.cache_)}set(t){if(this.cache_=Qe({},this.defaults_,this.cache_,t),s.isSupported_())try{s.set_(this.key_,JSON.stringify(this.cache_))}catch(e){}}clear(){if(this.cache_={},s.isSupported_())try{s.clear_(this.key_)}catch(t){}}destroy(){delete Hs[this.key_],Object.keys(Hs).length||Cm()}};function Mm(){window.addEventListener("storage",rc),ba=!0}function Cm(){window.removeEventListener("storage",rc),ba=!1}function rc(s){let t=Hs[s.key];if(t){let e=Qe({},t.defaults_,ya(s.oldValue)),i=Qe({},t.defaults_,ya(s.newValue));t.cache_=i,t.emit("externalSet",i,e)}}function ya(s){let t={};if(s)try{t=JSON.parse(s)}catch(e){}return t}var Am=1e3,km=60*Am,In={},ws=class s{static getOrCreate(t,e,i){let n=t.get("trackingId");return In[n]?In[n]:In[n]=new s(t,e,i)}constructor(t,e,i){this.tracker=t,this.timeout=e||s.DEFAULT_TIMEOUT,this.timeZone=i,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),se.add(t,"sendHitTask",this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat("en-US",{timeZone:this.timeZone})}catch(r){}let n={hitTime:0,isExpired:!1};this.store=vs.getOrCreate(t.get("trackingId"),"session",n),this.store.get().id||this.store.set({id:Vi()})}getId(){return this.store.get().id}isExpired(t=this.getId()){if(t!=this.getId())return!0;let e=this.store.get();if(e.isExpired)return!0;let i=e.hitTime;if(i){let n=new Date,r=new Date(i);if(n-r>this.timeout*km||this.datesAreDifferentInTimezone(n,r))return!0}return!1}datesAreDifferentInTimezone(t,e){return this.dateTimeFormatter?this.dateTimeFormatter.format(t)!=this.dateTimeFormatter.format(e):!1}sendHitTaskOverride(t){return e=>{t(e);let i=e.get("sessionControl"),n=i=="start"||this.isExpired(),r=i=="end",o=this.store.get();o.hitTime=Je(),n&&(o.isExpired=!1,o.id=Vi()),r&&(o.isExpired=!0),this.store.set(o)}}destroy(){se.remove(this.tracker,"sendHitTask",this.sendHitTaskOverride),this.store.destroy(),delete In[this.tracker.get("trackingId")]}};ws.DEFAULT_TIMEOUT=30;var xa={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9,MAX_SCROLL_TRACKER:10},oc=Object.keys(xa).length;function ac(s,t){Dm(s),Rm(s,t)}function Vm(s){return parseInt(s||"0",16).toString(2)}function Im(s){return parseInt(s||"0",2).toString(16)}function Lm(s,t){if(s.length<t){let e=t-s.length;for(;e;)s="0"+s,e--}return s}function Om(s,t){return s.substr(0,t)+1+s.substr(t+1)}function Rm(s,t){let e=s.get("&"+ma),i=Lm(Vm(e),oc);i=Om(i,oc-t),s.set("&"+ma,Im(i))}function Dm(s){s.set("&"+Jl,Ql)}var Oi="hidden",Ee="visible",js=Vi(),hc=1e3,$a=class{constructor(t,e){if(ac(t,xa.PAGE_VISIBILITY_TRACKER),!document.visibilityState)return;let i={sessionTimeout:ws.DEFAULT_TIMEOUT,visibleThreshold:5*hc,sendInitialPageview:!1,fieldsObj:{}};this.opts=Qe(i,e),this.tracker=t,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=vs.getOrCreate(t.get("trackingId"),"plugins/page-visibility-tracker"),this.store.on("externalSet",this.handleExternalStoreSet),this.session=ws.getOrCreate(t,this.opts.sessionTimeout,this.opts.timeZone),se.add(t,"set",this.trackerSetOverride),window.addEventListener("unload",this.handleWindowUnload),document.addEventListener("visibilitychange",this.handleChange),sc(this.tracker,()=>{document.visibilityState==Ee?(this.opts.sendInitialPageview&&(this.sendPageview({isPageLoad:!0}),this.isInitialPageviewSent_=!0),this.store.set({time:Je(),state:Ee,pageId:js,sessionId:this.session.getId()})):this.opts.sendInitialPageview&&this.opts.pageLoadsMetricIndex&&this.sendPageLoad()})}handleChange(){if(!(document.visibilityState==Ee||document.visibilityState==Oi))return;let t=this.getAndValidateChangeData(),e={time:Je(),state:document.visibilityState,pageId:js,sessionId:this.session.getId()};document.visibilityState==Ee&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),document.visibilityState==Oi&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(t.sessionId)?(this.store.clear(),this.lastPageState==Oi&&document.visibilityState==Ee&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout(()=>{this.store.set(e),this.sendPageview({hitTime:e.time})},this.opts.visibleThreshold))):(t.pageId==js&&t.state==Ee&&this.sendPageVisibilityEvent(t),this.store.set(e)),this.lastPageState=document.visibilityState}getAndValidateChangeData(){let t=this.store.get();return this.lastPageState==Ee&&t.state==Oi&&t.pageId!=js&&(t.state=Ee,t.pageId=js,this.store.set(t)),t}sendPageVisibilityEvent(t,{hitTime:e}={}){let i=this.getTimeSinceLastStoredChange(t,{hitTime:e});if(i&&i>=this.opts.visibleThreshold){let n=Math.round(i/hc),r={transport:"beacon",nonInteraction:!0,eventCategory:"Page Visibility",eventAction:"track",eventValue:n,eventLabel:ga};e&&(r.queueTime=Je()-e),this.opts.visibleMetricIndex&&(r["metric"+this.opts.visibleMetricIndex]=n),this.tracker.send("event",kn(r,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}sendPageLoad(){let t={transport:"beacon",eventCategory:"Page Visibility",eventAction:"page load",eventLabel:ga,["metric"+this.opts.pageLoadsMetricIndex]:1,nonInteraction:!0};this.tracker.send("event",kn(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}sendPageview({hitTime:t,isPageLoad:e}={}){let i={transport:"beacon"};t&&(i.queueTime=Je()-t),e&&this.opts.pageLoadsMetricIndex&&(i["metric"+this.opts.pageLoadsMetricIndex]=1),this.tracker.send("pageview",kn(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}trackerSetOverride(t){return(e,i)=>{let n=nc(e)?e:{[e]:i};n.page&&n.page!==this.tracker.get("page")&&this.lastPageState==Ee&&this.handleChange(),t(e,i)}}getTimeSinceLastStoredChange(t,{hitTime:e}={}){return t.time?(e||Je())-t.time:0}handleExternalStoreSet(t,e){t.time!=e.time&&e.pageId==js&&e.state==Ee&&!this.session.isExpired(e.sessionId)&&this.sendPageVisibilityEvent(e,{hitTime:t.time})}handleWindowUnload(){this.lastPageState!=Oi&&this.handleChange()}remove(){this.store.destroy(),this.session.destroy(),se.remove(this.tracker,"set",this.trackerSetOverride),window.removeEventListener("unload",this.handleWindowUnload),document.removeEventListener("visibilitychange",this.handleChange)}};wa("pageVisibilityTracker",$a);El();Xt.addClass((b.isMobile?"is":"not")+"-mobile");b.isSafari&&Xt.addClass("is-safari");setTimeout(()=>Xt.addClass("ready"));window.addEventListener("keydown",s=>{s.keyCode===9&&Xt.addClass("is-tabbing")});window.addEventListener("mousedown",()=>{Xt.removeClass("is-tabbing")});var lc=k(".cookie-warning");lc&&k("#yes-to-cookies").on("click",function(){lc.exit("pop",300),b.setCookie("cookie_consent",1)});var Pa=k("x-modal#privacy");Pa&&Pa.$("form").on("submit",s=>{s.preventDefault(),fetch("/profile/accept-policies",{method:"POST"}),Pa.close()});var pc;(pc=navigator.serviceWorker)==null||pc.register("/service_worker.js",{scope:"/"}).catch(()=>console.warn("Unable to register Service Worker."));var dc;(dc=k("#skip-nav"))==null||dc.on("click",()=>{var t;(t=(k("article")||k(".panel.active")||k(".body")||C).$("input, button, a, textarea, [contenteditable], [tabindex]"))==null||t.focus()});var Ta=k("nav x-popup");if(Ta){let s=Ta.$$(".popup-body a, .popup-body button");for(let t of s)t.on("click",()=>Ta.close())}var Nm=Te("#language .locale-link");Ai.on("change",s=>{for(let t of Nm)t.setAttr("href",t.data.host+s)});var Ln=k("#dark-mode");Ln&&(Ln.checked=b.theme.isDark,Ln.on("change",()=>b.setTheme(Ln.checked?"dark":"light")));var Ri={},ys=k("#search"),ts=ys==null?void 0:ys.$(".form-field input"),On=ys==null?void 0:ys.$(".search-body");Ri[""]=(On==null?void 0:On.html)||"";function Gm(s){return s=s.trim().replace(/\s+/," ").toLowerCase().slice(0,50),s==="pi"||s.length>=3?s:""}function zm(s){return D(this,null,function*(){if(s=encodeURIComponent(Gm(s)),s in Ri)return Ri[s];let t=yield fetch(`/api/search?q=${s}`);return t.ok?Ri[s]=yield t.text():Ri[s]=""})}var Bm=0,cc=0;function uc(s){return D(this,null,function*(){let t=Bm+=1,e=yield zm(s);t<=cc||(cc=t,On.html=e)})}ts==null||ts.change(s=>{b.setCookie("search",s,60*60*24),setTimeout(()=>{ts.value===s&&uc(s)},300)});ts!=null&&ts.value&&ys.one("open",()=>uc(ts.value));var fc='<label class="target"><input maxlength="15" autocomplete="off" aria-label="Fill in this blank"></label>';function mc(s){if(s.match("^[0-9]+/[0-9]+$")){let t=s.split("/");return+t[0]/+t[1]}else return Uh(s)}var Rn=class extends E{constructor(){super(...arguments);this.solution="";this.solutionNum=NaN;this.solutionDisplay="";this.range=0;this.input="";this.hint="";this.attempts=0;this.placeholder="???";this.done=!1}ready(){if(this.$input=this.$("input"),this.$target=this.$(".target"),this.solution=this.attr("solution"),this.solution.indexOf("\xB1")>=0){let e=this.solution.split("\xB1");this.solution=e[0].trim(),this.range=+e[1]}this.solutionNum=mc(this.solution),this.solutionDisplay=this.solution,this.hint=this.attr("hint"),this.removeAttr("solution"),this.removeAttr("hint"),this.$input.setInputPattern(this.solution),this.hasAttr("placeholder")&&(this.placeholder=this.attr("placeholder")),this.$input.setAttr("placeholder",this.placeholder),this.removeAttr("placeholder"),this.$input.change(e=>{this.input=e,this.isCorrect&&(this.solve(),this.trigger("valid",e),this.moveCursor())}),this.$input.onKey("Enter",()=>this.$input.blur()),this.$input.on("focus",()=>{this.addClass("on"),this.removeClass("invalid"),this.$input.setAttr("placeholder"," ")}),this.$input.on("blur",()=>{if(this.removeClass("on"),this.setClass("invalid",!!this.input&&!this.done),this.$input.setAttr("placeholder",this.placeholder),this.input&&!this.done){this.attempts+=1;let e=this.attempts>=(this.hint?4:3)?`Hmmm\u2026 maybe try ${this.solution}?`:this.attempts>=2?this.hint:void 0;this.trigger("invalid",{hint:e})}})}setup(e,i,n){var r;this.goal=i,this.$step=e,(r=n==null?void 0:n.scores)!=null&&r.includes(i)&&this.solve(!0),this.one("valid",()=>{e.addHint("correct"),e.score(this.solvedBlank?this.solvedBlank.goal:i)}),this.on("invalid",o=>e.addHint(o.hint||"incorrect",{class:"incorrect"}))}get isCorrect(){if(this.done)return!0;if(this.linkedBlanks){let e=this.linkedBlanks.map(i=>i.solvedBlank);return this.solvedBlank=this.linkedBlanks.find(i=>{if(i.done&&!i.solvedBlank||e.includes(i))return!1;if(i.checkAnswer(this.input))return!0}),this.solvedBlank&&(this.solutionDisplay=this.solvedBlank.solution),!!this.solvedBlank}return this.checkAnswer(this.input)}checkAnswer(e){let i=mc(e);return e.toLowerCase()===this.solution.toLowerCase()?!0:this.range&&Math.abs(i-this.solutionNum)<=this.range?(this.solutionDisplay=e,!0):$(i,this.solutionNum)||Go(i)===this.solution||e===Go(this.solutionNum)}moveCursor(){if(!this.$step)return;let e=this.$step.$blanks[this.$step.$blanks.indexOf(this)+1];!e||e.done||e.tagName==="X-BLANK-MC"||e.css("visibility")==="hidden"||!e.bounds.width||e.focus()}solve(e=!1){this.done=!0,this.$input.remove(),this.$target.html=this.solutionDisplay,this.addClass("done"),this.trigger("solve",{solution:this.solutionDisplay,restore:e})}focus(){this.$input.focus()}blur(){this.$input.blur()}};Rn=T([S("x-blank",{template:fc})],Rn);var gc='<span class="target" slot="target" tabindex="0" aria-label="Fill in this blank">???</span><div class="popup"><slot></slot></div>';var Dn=class extends E{constructor(){super(...arguments);this.done=!1}ready(){this.$target=this.$(".target"),this.$popup=this.$(".popup");let e=this.$popup.$$(".choice");this.solution=e[0].html,_t.shuffle(oe(e.length)).forEach(r=>{this.$popup.append(e[r]),e[r].on("click",()=>{this.removeClass("on"),e[r].blur(),r?(this.$target.html=e[r].html,this.addClass("invalid"),this.trigger("invalid")):(this.solve(),this.trigger("valid",this.solution))})});let n=this.$target.bounds.left+this.$popup.width>b.width-15;this.setClass("left",n),_s(this,{enter:()=>{if(this.done)return;this.addClass("on");let r=this.$target.bounds,o=this.$popup.width,a=this.$popup.height,h=b.width-10-r.left,l=o<h,c=r.right-o>10,u=r.top+r.height+a>b.height-10;this.setClass("left",c&&!l),this.setClass("top",u),this.$popup.css("max-width",!c&&!l?`${h}px`:"none")},exit:()=>{this.removeClass("on")},delay:100,exitDelay:400,$clickTarget:this.$target})}setup(e,i,n){var r;(r=n==null?void 0:n.scores)!=null&&r.includes(i)&&this.solve(!0),this.one("valid",()=>{e.addHint("correct"),e.score(i)}),this.on("invalid",o=>e.addHint(o.hint||"incorrect",{class:"incorrect"}))}solve(e=!1){this.done=!0,this.$target.html=this.solution,this.removeClass("on invalid"),this.addClass("done"),this.trigger("solve",{solution:this.solution,restore:e}),setTimeout(()=>this.$popup.remove(),250),this.$target.removeAttr("tabindex")}};Dn=T([S("x-blank-mc",{template:gc})],Dn);var vc='<div class="text-area" contenteditable="true"></div><div class="toolbar"><button class="command" data-command="bold"><x-icon name="bold" size="20"></x-icon></button><button class="command" data-command="italic"><x-icon name="italic" size="20"></x-icon></button><button class="command" data-command="underline"><x-icon name="underline" size="20"></x-icon></button><div class="space"></div><button class="btn btn-green submit"><x-icon name="check"></x-icon> Done</button></div>';var wc=40,yc="free-text",Nn=class extends E{setup(t,e,i){var l,c;let n=this.$(".text-area"),r=this.$(".toolbar .submit"),o=((l=i==null?void 0:i.data)==null?void 0:l[yc])||"";o&&(n.html=o);for(let u of this.$$(".toolbar .command")){let d=u.data.command.split(":");u.on("click",()=>document.execCommand(d[0],!1,d[1]))}let a=o,h=ve(()=>{a!==o&&t.storeData(yc,o),a=o},5e3);n.on("change keyup input paste",()=>{o=n.html.replace(/&nbsp;/g," ").trim().slice(0,500).trim(),r.setClass("invisible",o.length<wc),h()}),(c=i==null?void 0:i.scores)!=null&&c.includes(e)?r.remove():(r.setClass("invisible",o.length<wc),r.on("click",()=>{h(),t.score(e),r.exit("pop"),this.trigger("submit")}))}};Nn=T([S("x-free-text",{template:vc})],Nn);var bc='<div class="wrapper"><div class="panel"><slot></slot></div></div><div class="nav"><button class="btn back" aria-label="Previous Step"><x-icon name="left"></x-icon></button><button class="btn next" aria-label="Next Step"><x-icon name="right"></x-icon></button><div class="dots"></div></div>';var Gn=class extends E{ready(){let t=this.$(".wrapper"),e=this.$(".panel"),i=e.children,n=this.$(".next"),r=this.$(".back"),o=this.$(".dots"),a=i.map(()=>m("div",{class:"dot"},o)),h=i.length,l=+this.attr("slide-width")||void 0,c=this.width,u=1,d=c,g=0,y=0,f=dt=>{y=dt,e.translate(dt,0),this.trigger("move",dt)},v=dt=>{g=dt;for(let[ge,wi]of a.entries())wi.setClass("on",ge>=dt&&ge<dt+u);n.setClass("disabled",dt===h-u),r.setClass("disabled",dt===0),this.trigger("change",dt)};b.onResize(()=>{c=this.width,u=l?Math.ceil(c/l):1,d=c/u;for(let dt of i)dt.css("width",d+"px");e.css("width",h*d+"px"),f(-g*d),v(g)});let w="quad",x=500,I,A,M,P,j=!1,ne=()=>{I=Date.now()-P,f(A+M*yt(w,I/x)),!j&&I<x?requestAnimationFrame(ne):this.trigger("slide-end")},ks=dt=>{j=!1,I=0,A=y,M=-dt*d-y,P=Date.now(),v(dt),ne()};n.on("click",()=>{w="quad",g<h-u&&ks(g+1)}),r.on("click",()=>{w="quad",g>0&&ks(g-1)});let nn,Po,To,rn;us(t,{start:dt=>{j=!0,nn=y,Po=dt.x,rn=To=Po},move:dt=>{To=rn,rn=dt.x;let ge=nn-Po+dt.x,wi=-(h-u)*d,Hd=ge>0?ge/4:ge<wi?wi+(ge-wi)/4:ge;f(Hd),this.css("pointer-events","none")},end:()=>{let dt=rn-To,ge=dt>12?1:dt<-12?-1:0;w="quad-out",ks(B(Math.round(-y/d-ge),0,h-u)),setTimeout(()=>this.css("pointer-events","auto"))}})}};Gn=T([S("x-gallery",{template:bc})],Gn);var xc='<svg width="70" height="80"><path d="M20.5,7.4,27.2,24c-1.9-4.7,6-7.1,8-2.3l1.4,3.6c-1.9-4.8,6.1-7.1,8-2.3l1.3,3.1c-2-4.7,5.7-6.5,7.7-1.8,3.3,7.8,5.8,13.6,9,21.3S60.8,56.2,65,66.7L44.9,75A13.9,13.9,0,0,0,36,66.9c-7.7-2.2-11.4-8.3-18.4-14.3a44.2,44.2,0,0,0-9.5-6.5c-2.6-1.5-4.2-3.4-2.2-5.7,3.5-4.1,9.3-1.3,13.1,1.5,1.6,1.2,4.4,4.1,5.9,3.8s1.7-.8,1-2.6L12.8,10.5c-1.9-4.7,5.8-7.9,7.7-3.1Z"></path></svg>';function Sa(s,t){let e=t.positionLeft-s.positionLeft+t.width/2,i=t.positionTop-s.positionTop+t.height/2;return new p(e,i)}function $c(s){return s?new p(...s.split(",").map(t=>+t)):void 0}var zn=class extends E{constructor(){super(...arguments);this.doAnimation=!1}created(){this.slide=$c(this.attr("slide")),this.shift=$c(this.attr("offset"))}ready(){this.$target=k(this.attr("target")),this.$target&&(this.$target.on("click pointerdown focus",()=>this.stop()),this.hasAttr("start")&&this.start())}setTarget(e,i,n){this.$target=typeof e=="string"?k(e):e,i&&(this.slide=i),n&&(this.slide=n)}start(e){this.doAnimation||!this.from&&!this.$target||(this.doAnimation=!0,e&&(this.slide=e),this.slide||this.$end?this.runSlideAnimation():this.runClickAnimation())}startSlide(e,i){this.$target=e,this.$end=i,this.start()}stop(){this.doAnimation=!1}runSlideAnimation(){return D(this,null,function*(){this.show();let e=this.from||Sa(this,this.$target);this.shift&&(e=e.add(this.shift));let i=this.slide?e.add(this.slide):Sa(this,this.$end),n=`translate(${e.x-15}px,${e.y-10}px)`,r=`translate(${i.x-15}px,${i.y-10}px)`;yield this.animate({transform:[n+" scale(2)",n],opacity:[0,1]},300).promise,yield this.animate({transform:[n,r]},1e3).promise,yield this.animate({transform:[r,r+" scale(2)"],opacity:[1,0]},300).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runSlideAnimation()},1e3)})}runClickAnimation(){return D(this,null,function*(){this.show();let e=this.from||Sa(this,this.$target);this.shift&&(e=e.add(this.shift));let i=`translate(${e.x-15}px,${e.y-10}px)`;yield this.animate({transform:[i+" scale(2)",i],opacity:[0,1]},500).promise,yield this.animate({transform:[i,i+" scale(2)"],opacity:[1,0]},500,200).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runClickAnimation()},1e3)})}};zn=T([S("x-gesture",{template:xc})],zn);var Ea='<span class="target" tabindex="0"><slot></slot></span><div class="popup"></div>';var _m=JSON.parse(k("#glossary").text),Fm=JSON.parse(k("#bios").text),Ma=600,_n;b.onResize(()=>{_n&&_n.hide()});var Di=class extends E{ready(){this.xid=this.attr("xid"),this.$target=this.$(".target"),this.$popup=this.$(".popup"),this.$popup.html=this.body()||"",this.setClass("left",b.width>Ma&&this.$target.bounds.left+this.$popup.width>b.width-15),_s(this,{enter:()=>this.show(),exit:()=>this.hide(),delay:100,exitDelay:200,$clickTarget:this.$target,canFocusWithin:!0,preventMouseover:()=>b.width<=Ma})}show(){if(_n=this,this.addClass("on"),b.width<=Ma){let o=k("#glossary-modal");return o.$(".modal-body").html=this.body(),o.open()}let t=this.$target.bounds,e=this.$popup.width,i=this.$popup.height,n=t.top+t.height+i<b.height-10,r=t.top-i>54;this.setClass("top",r&&!n),this.setClass("left",t.left+e>b.width-15)}hide(){_n=void 0,this.removeClass("on")}body(){let t=_m[this.xid];if(!t)return console.warn("missing gloss:",this.xid);let e=t.text;return t.image&&(e+=`<img class="gloss-img" alt="" src="/content/shared/glossary/${t.image}"/>`),t.link&&(location.pathname===t.link.split("#")[0]||(e+=`<p><a href="${t.link}" class="btn btn-white btn-small">Learn more\u2026</a></p>`)),e}};Di=T([S("x-gloss",{template:Ea})],Di);var Bn=class extends Di{body(){let t=Fm[this.xid];if(!t)return console.warn("missing bio:",this.xid);let e=`<img class="bio-img" alt="" src="/content/shared/bios/${this.xid}.jpg"/>`,i=t.born?`<p><a href="/timeline/${this.xid}" class="btn btn-white btn-small" target="_blank">Timeline</a></p>`:"";return(t.image===!1?"":e)+t.bio+i}};Bn=T([S("x-bio",{template:Ea})],Bn);var Pc='<div class="wrap"><img alt=""><div class="credit"></div><button class="zoom"><x-icon name="fullscreen" size="24"></x-icon></button><slot></slot></div>';var qm=document.createElement("a").relList.supports("ar"),qn=!1,Ca={x:0,y:0,s:1},Tc,bs=m("div",{class:"lightbox-overlay"},C),Ge=m("div",{class:"lightbox-img"},bs);function Hm(s,t,e){qn=!0,Tc=s,bs.show(),Ge.show();let i=s.bounds,n=Ge.bounds,r=i.left+i.width/2-n.left-n.width/2,o=i.top+i.height/2-n.top-n.height/2,a=Math.max(i.width/n.width,i.height/n.height);Ca={x:r,y:o,s:a},Ge.css("background-image",`url(${e}), url(${t})`),Ge.css("transform",`translate(${r}px, ${o}px) scale(${a})`),b.redraw(),Ge.addClass("transitions"),b.redraw(),s.css("visibility","hidden"),bs.addClass("on"),Ge.css("transform","scale(1) translate(0,0)")}function Sc(){qn&&(qn=!1,bs.removeClass("on"),Ge.setTransform(Ca,0,Ca.s),setTimeout(()=>{Tc.css("visibility","visible"),bs.css("display","none"),Ge.css("transform","none"),Ge.removeClass("transitions")},400))}bs.on("click touchmove",Sc);C.onKey("Escape",Sc);bs.on("scrollwheel touchmove",s=>{s.preventDefault(),s.stopPropagation()});C.onKey("Space AllArrows PageDown PageUp",s=>{qn&&(s.preventDefault(),s.stopPropagation())});var Fn=class extends E{ready(){let t=this.attr("src"),e=this.$(".wrap"),i=this.attr("width"),n=this.attr("height");this.css("width",i+"px"),e.css("padding-bottom",+n/+i*100+"%");let r=e.$("img");r.setAttr("src",t),r.setAttr("alt",this.attr("alt")||""),r.setAttr("width",i),r.setAttr("height",n),t.endsWith(".gif")&&r.on("click",()=>r.setAttr("src",t));let o=e.$(".credit"),a=this.attr("credit");a?o.text=a:o.remove();let h=e.$(".zoom");if(this.hasAttr("lightbox")){this.addClass("interactive");let l=t.replace(/\.(?=[^.]*$)/,"-large.");this.on("click",()=>Hm(this,t,l))}else h.remove();if(qm&&this.hasAttr("ar")){let l=m("a",{href:this.attr("ar"),rel:"ar"});e.prepend(l),l.append(r)}}};Fn=T([S("x-img",{template:Pc})],Fn);var Hn=class extends E{constructor(){super(...arguments);this.correctCount=0;this.solvedCount=0;this.isSolved=!1}setup(e,i,n){var h;let r=this.children,o=r.map(()=>!1);for(let[l,c]of r.entries()){let u=c.data.error,d=u?"incorrect":"correct";u||(this.correctCount+=1),c.one("click",()=>{o[l]||this.isSolved||(e.addHint(u||"correct",{class:d}),c.addClass(d),u||(this.solvedCount+=1,e.score("picker-"+l),this.checkSolved()))})}let a=((h=n==null?void 0:n.scores)==null?void 0:h.filter(l=>l.startsWith("picker-")))||[];for(let l of a){let c=+l.slice(7);o[c]=!0,r[c].addClass("correct")}this.solvedCount=a.length,this.checkSolved()}checkSolved(){this.solvedCount<this.correctCount||(this.addClass("solved"),this.isSolved=!0)}};Hn=T([S("x-picker")],Hn);var Ec='<button class="play" aria-label="Play Slider"><x-icon name="play" size="32"></x-icon></button><div class="bar"><div class="knob"></div></div>';var jn=class extends E{constructor(){super(...arguments);this.current=0}ready(){this.onAttr("steps",a=>this.steps=+a),this.speed=+this.attr("speed")||1;let e=this.$(".bar"),i=this.$(".knob"),n=this.$(".play");this.hasAttr("no-play")?n.remove():n.on("click",()=>this.play());let r=this.hasAttr("continuous"),o=this.hasAttr("snap")?e.width/this.steps:.001;this.drag=new ms(i,{moveY:!1,snap:o}),this.drag.on("start",()=>{this.animation&&this.animation.cancel(),this.animation=void 0}),this.drag.on("move",({posn:a})=>{let h=a.x/this.drag.bounds.dx*this.steps;r||(h=Math.round(h)),!$(h,this.current)&&(this.current=h,this.trigger("move",h))}),this.drag.on("end",()=>this.trigger("slide-end"))}setup(e,i){this.bindModel(e.model),this.one("slide-end",()=>e.score(i))}set(e){$(e,this.current)||this.drag.setPosition(e*this.drag.bounds.dx/this.steps,0)}play(){return D(this,null,function*(){this.current>=this.steps&&this.set(0);let e=(1-this.current/this.steps)*3e3/this.speed;this.moveTo(this.steps,e)})}moveTo(e,i=600){return D(this,null,function*(){if(this.animation||e===this.current)return;let n=this.current;this.animation=pt(r=>{this.set(n+(e-n)*yt("quad",r))},i),yield this.animation.promise,this.animation=void 0,this.trigger("slide-end")})}bindVariable(e,i){e[i]=0,this.on("move",n=>e[i]=n),e.watch(()=>this.set(e[i]))}};jn=T([S("x-slider",{template:Ec})],jn);var Mc='<slot name="stage"></slot><div class="nav"><button class="btn back disabled" aria-label="Previous Step"><x-icon name="left" size="24"></x-icon></button><button class="btn next" aria-label="Next Step"><x-icon name="right" size="24"></x-icon></button><div class="dots"></div></div><div class="legend-box"><slot></slot></div>';function jm(s){let t=s.$$("x-blank, x-blank-mc");if(!t.length)return Promise.resolve();let e=0;return new Promise(i=>{for(let n of t)n.on("solve",()=>{e+=1,e>=t.length&&i()})})}var Un=class extends E{constructor(){super(...arguments);this.length=0;this.current=0;this.locked=!1}ready(){this.$legend=this.$(".legend-box"),this.$steps=this.$legend.children,this.$back=this.$(".back"),this.$next=this.$(".next");let e=this.$(".dots");this.$dots=this.$steps.map(()=>m("div",{class:"dot"},e)),this.length=this.$steps.length,this.current=0,this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.blanks=this.$steps.map(i=>jm(i)),this.reveals=this.$$("[slide]").map(i=>{let n=i.attr("slide").split("-"),r=n.length>1?[+n[0]||0,+n[1]||this.length]:[+n[0],+n[0]],o=[i.data.animation||"fade",+i.data.duration||400];return i.data.display="visibility",r[0]>=0&&!i.hasClass("reveal")&&i.hide(),[i,r,o]}),this.autoAdvance=this.attr("step")==="auto",this.$steps[0].show(),this.$dots[0].addClass("on"),this.setupSlide(0)}setup(e,i,n){var o;let r=(o=n==null?void 0:n.scores)==null?void 0:o.filter(a=>a.startsWith("slide-")).length;if(r&&r<this.$steps.length-1){this.go(r);for(let a=1;a<=r;++a)this.trigger("next",a)}this.on("next",a=>e.score("slide-"+(a-1)))}go(e){if(this.locked||e<0||e>this.length-1||e===this.current)return;this.locked=!0,setTimeout(()=>this.locked=!1,600),this.$back.setClass("disabled",e===0),this.$next.setClass("disabled",e===this.length-1),this.$dots[this.current].removeClass("on"),this.$dots[e].addClass("on"),this.$steps[e].show();let i=this.$steps[e].height+"px";this.$steps[e].hide(),this.$steps[this.current].exit("fade",300).promise.then(()=>this.$steps[e].enter("fade",300)),this.$legend.animate({height:i},600).promise.then(()=>this.$legend.css("height","auto")),this.setupSlide(e),this.current=e,this.trigger("step",e)}setupSlide(e){this.$next.setAttr("disabled","true"),this.blanks[e].then(()=>this.$next.removeAttr("disabled"));for(let[i,n,r]of this.reveals){if(i.hasClass("reveal"))continue;let o=i.css("visibility")!=="hidden",a=e>=n[0]&&e<=n[1];a&&!o&&i.enter(...r,300),!a&&o&&i.exit(...r)}}goNext(){this.locked||(this.go(this.current+1),this.trigger("next",this.current))}goBack(){this.locked||(this.go(this.current-1),this.trigger("back",this.current))}};Un=T([S("x-slideshow",{template:Mc})],Un);var Wn=class extends E{ready(){var g,y;(g=k(".sidebar-toggle"))==null||g.on("click",()=>this.addClass("open")),(y=k(".sidebar-shadow"))==null||y.on("pointerdown",()=>this.removeClass("open"));let t=k("#feedback form"),e=k("#feedback button"),i=k("#feedback .error"),n=k("#feedback-success"),r=k('#feedback textarea[name="message"]'),o=k("x-course").id;t==null||t.on("submit",f=>{f.preventDefault(),e.setAttr("disabled","true"),i.hide(),Ne(`/course/${o}/feedback`,t.formData).then(()=>{n.open(),r.value=""}).catch(()=>i.show()).then(()=>e.removeAttr("disabled"))});let a=JSON.parse(k("#glossary").text),h=k("#glossary-search"),l=h.$(".gloss-body"),c=h.$(".gloss-list"),u=h.$(".gloss-search input"),d;for(let f of Object.keys(a).sort()){let v=a[f],w=m("div",{class:"gloss-item",html:v.title,tabindex:0},c);w.on("click",()=>{d&&d.removeClass("on"),d=w,w.addClass("on"),l.html=v.text});let x=v.title.toLowerCase();u.change(I=>w.setClass("hidden",!!I&&x.indexOf(I.toLowerCase())<0))}}};Wn=T([S("x-course-sidebar")],Wn);function Aa(s,t){let e=as(s.map(i=>i.h+10));for(let[i,n]of s.entries())n.drag.bounds=new lt(0,0,0,O(e)),n!==t&&n.drag.setPosition(0,e[i-1]||0)}function Um(s){return s.every((t,e)=>t.index===e)||s.every((t,e)=>t.index===s.length-e-1)}var Kn=class extends E{ready(){this.items=this.children.map(t=>({drag:new ms(t,{moveX:!1,useTransform:!0}),index:+t.data.index,h:0}));for(let t of this.children)t.removeAttr("data-index");for(let t of this.items)t.drag.on("drag",()=>{this.items=bi(this.items,e=>e.drag.position.y-(e===t?10:0)),Aa(this.items,t)}),t.drag.on("end",()=>{Aa(this.items),Um(this.items)&&this.solve()});b.onResize(()=>{for(let e of this.items)e.h=e.drag.$el.height;let t=N(this.items.map(e=>e.h));this.css("height",t+this.items.length*10-10+"px"),Aa(this.items)})}setup(t,e,i){var n;(n=i==null?void 0:i.scores)!=null&&n.includes(e)&&this.solve(),this.one("solve",()=>{t.addHint("correct"),t.score(e)})}solve(){this.trigger("solve"),this.addClass("solved");for(let t of this.items)t.drag.disabled=!0}};Kn=T([S("x-sortable")],Kn);function Cc(s,t=!1){return D(this,null,function*(){if(s.css("visibility")==="visible")return;s.data.display="visibility";let e=+s.data.duration||400,i=(t?0:600)+(+s.data.delay||0);yield s.enter(s.data.animation||"fade",e,i).promise,s.css({opacity:"",transform:""}),s.trigger("reveal"),s.removeClass("reveal")})}var Xn=class extends E{constructor(){super(...arguments);this.model=le({});this.isShown=!1;this.isCompleted=!1;this.scores=new Set}ready(){var i,n,r,o;this.$course=this.parents("x-course")[0],this.$blanks=this.$$("x-blank, x-blank-mc"),this.$components=this.$$("[goal]"),this.userData=(r=(n=(i=this.$course)==null?void 0:i.userData)==null?void 0:n.steps)==null?void 0:r[this.id],this.goals=K(this.attr("goals")),this.$reveals=this.$$(".reveal");let e=this.$$(".check[data-when]");for(let a of[...this.$reveals,...e])this.onScore(a.data.when,()=>Cc(a));this.$nextBtn=this.$$(".next-step");for(let[a,h]of this.$nextBtn.entries())this.onScore("next-"+a,()=>h.exit("pop")),h.one("click",()=>this.score("next-"+a));for(let a of this.$$(".step-target"))a.tagName!=="X-TARGET"&&_s(a,{enter:()=>{let h=this.$$('[target~="'+a.data.to+'"]');for(let l of h)l.addClass("focus");this.addClass("focus"),this.trigger("target-focus",{$targets:h})},exit:()=>{for(let h of this.$$(".focus"))h.removeClass("focus");this.removeClass("focus")}});for(let a of this.$$(".var, .var-action"))a.bindModel(this.model);(o=this.$course)!=null&&o.audio&&(this.narration=new Mn(this.$course.audio,this))}show(){var n,r,o;if(this.isShown)return;this.isShown=!0,(n=StepFunctions==null?void 0:StepFunctions[on(this.id)])==null||n.call(StepFunctions,this);for(let a of this.$components)a.setup(this,a.attr("goal"),this.userData);let e=((r=this.userData)==null?void 0:r.scores)||[];for(let a of e)this.score(a,!1);let i=this.$$("x-gesture[target]");setTimeout(()=>{if(!this.isReady)for(let a of i)a.start()},2e3),(o=this.$course)==null||o.log("Step","show",this.id),this.trigger("show"),this.addClass("on"),this.narration&&setTimeout(()=>this.narration.play(),400)}complete(){if(!this.isCompleted){this.isShown||this.show(),this.isCompleted=!0;for(let e=0;e<this.$nextBtn.length;++e)this.score("next-"+e);for(let e of this.$reveals)e.parents("svg").length||Cc(e,!0);this.trigger("complete")}}get isReady(){return this.goals.every(e=>this.scores.has(e))}get isPageLoaded(){return this.$course?this.$course.isReady:!0}score(e,i=!0){this.scores.has(e)||(this.scores.add(e),this.trigger("score-"+e),this.trigger("score"),this.$course&&(this.$course.trigger("score"),this.$course.saveProgress({steps:{[this.id]:{scores:[e]}}}),this.$course.log("Step","score",this.id+"/"+e)),i&&this.isReady&&this.$course&&this.$course.isReady&&setTimeout(()=>{this.$course.$activeStep===this&&this.$course.nextStep()},1200))}storeData(e,i){var n;(n=this.$course)==null||n.saveProgress({steps:{[this.id]:{data:{[e]:i}}}})}onScore(e,i){let n=K(e);if(n.every(a=>this.scores.has(a)))return i&&i(),Promise.resolve();let r=Ke(),o=()=>{n.every(a=>this.scores.has(a))&&(i&&i(),r.resolve(),this.off("score",o))};return this.on("score",o),r.promise}addHint(e,i={}){var n,r,o;return this.trigger("hint",e),(n=this.$course)!=null&&n.isReady?this.isInViewport?(r=this.$course.$tutor)==null?void 0:r.showHint(e,i):(this.one("enterViewport",()=>{var a;return(a=this.$course.$tutor)==null?void 0:a.showHint(e,i)}),{text:((o=this.$course.$tutor)==null?void 0:o.hints[e])||e}):{text:e}}delayedHint(e,i=1e4){let n=setTimeout(e,i);this.on("score",()=>{clearTimeout(n),this.isCompleted||(n=setTimeout(e,i))}),this.on("complete",()=>clearTimeout(n))}get nextStep(){if(!this.$course)return;let e=this.$course.$steps.indexOf(this);return this.$course.$steps[e+1]}groupBlanks(...e){let i=e.map(n=>this.$blanks[n]);for(let n of i)n.linkedBlanks=i}};Xn=T([S("x-step")],Xn);var Wm='<div class="titles"></div><div class="body"><slot></slot></div>',Yn=class extends E{constructor(){super(...arguments);this.$titles=[];this.active=0}ready(){let e=this.$(".titles");this.$body=this.$(".body"),this.$tabs=this.$$(".tab");for(let i=0;i<this.$tabs.length;++i){let n=this.$tabs[i].$("h3")||m("h3");n.setAttr("tabindex","0"),e.append(n),this.$titles.push(n),n.on("click",()=>this.makeActive(i))}this.$titles[0].addClass("active"),this.$tabs[0].show()}makeActive(e){if(this.active===e)return;this.$titles[this.active].removeClass("active"),this.$titles[e].addClass("active"),this.$tabs[e].show();let i=this.$tabs[e].outerHeight+"px";this.$tabs[e].hide(),this.$tabs[this.active].exit("fade",300).promise.then(()=>this.$tabs[e].enter("fade",300)),this.$body.animate({height:i},600).promise.then(()=>this.$body.css("height","auto")),this.active=e,this.trigger("change",e)}};Yn=T([S("x-tabbox",{template:Wm})],Yn);var Ac='<defs><mask id="masking"><rect width="100%" height="100%" fill="white"></rect></mask></defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker><rect x="0" y="0" width="100%" height="100%" mask="url(#masking)" opacity="0.8"></rect><path class="target-arrow" stroke-width="5" marker-end="url(#arrow)" opacity="0.4" stroke-linecap="round"></path>';function Km(s,t,e,i){let n=new p(s.left-15,s.top+e-15),r=new G(n,s.width+30,s.height+30),o=new p(t.left-15,t.top+i-15),a=new G(o,t.width+30,t.height+30),h=new Y(r.center,a.center);return[Q(h,r)[0],Q(h,a)[0]]}function Xm(s,t){return Math.abs(s[0]-t[0])+Math.abs(s[1]-t[1])}var kc=Te("header, x-tutor, .sidebar"),Ws=m("svg",{class:"target-body",html:Ac},C),Ym=Ws.$("mask"),Zm=Ws.$(".target-arrow"),Us=!1,Vc=[],Zn=class extends E{ready(){this.setAttr("tabindex",0);let t=this.attr("to").replace(/_/g," "),e=this.hasClass("no-margins"),i,n,r,o,a=()=>{Us=!0;let u=Te(t);if(!u.length)return;let d=u[0].hasParent(...kc);i===void 0&&(i=this.hasParent(...kc));let g=this.bounds,y=u.map(f=>f.bounds).filter(f=>f.width||f.height);if(r=0,!d){let f=Math.min(...y.map(I=>I.top)),v=Math.max(...y.map(I=>I.top+I.height)),w=b.height-12-v,x=56-f;r=w<0?w:x>0?x:0}for(let f of Vc)f.remove();Vc=[g,...y].map((f,v)=>{let w=!v||e?4:10;return m("rect",{x:f.left-w,y:f.top-w+(v||!i?r:0),width:f.width+2*w,height:f.height+2*w,rx:v?4:18,ry:v?4:18},Ym)}),Zm.points=Km(g,y[0],i?0:r,d?0:r)},h=()=>{r&&C.scrollBy(-r,300),Ws.css("display","block"),b.redraw(),Zt(function(){Ws.css("opacity",1)},r?300:0)},l=u=>{Us&&(u&&_(u.type,"mousemove","pointermove")&&Xm(n,[u.clientX,u.clientY])<40||(clearTimeout(o),Us=!1,Ws.css("opacity",0),setTimeout(()=>{Us||Ws.css("display","none")},300),C.off("mousewheel mousemove touchend touchmove",l),this.off("mouseleave blur",l)))},c=()=>{r&&!i?C.on("mousemove",l):this.on("mouseleave",l),C.on("mousewheel touchend touchmove",l),this.on("blur",l)};this.on("mouseenter touchstart focus",u=>{n=[u.clientX,u.clientY],a(),o=window.setTimeout(h,r?50:30),c()}),this.on("click",u=>{Us?(u.handled=!0,l(),setTimeout(()=>k(t).trigger("click mousedown"))):(Us=!0,r=0,h(),c())})}};Zn=T([S("x-target")],Zn);var ot=class ce extends Error{constructor(t,e){super(e),this.name=t}static undefinedVariable(t){return new ce("EvalError",`Undefined variable \u201C${t}\u201D.`)}static undefinedFunction(t){return new ce("EvalError",`Undefined function \u201C${t}\u201D.`)}static uncallableExpression(t){return new ce("EvalError",`Cannot call \u201C${t}\u201D.`)}static evalLoop(t){return new ce("EvalError",`Loop in nested evaluation \u201C${t}\u201D.`)}static invalidCharacter(t){return new ce("SyntaxError",`Unknown symbol \u201C${t}\u201D.`)}static conflictingBrackets(t){return new ce("SyntaxError",`Conflicting brackets \u201C${t}\u201D.`)}static unclosedBracket(t){return new ce("SyntaxError",`Unclosed bracket \u201C${t}\u201D.`)}static startOperator(t){return new ce("SyntaxError",`A term cannot start with a \u201C${t}\u201D.`)}static endOperator(t){return new ce("SyntaxError",`A term cannot end with a \u201C${t}\u201D.`)}static consecutiveOperators(t,e){return new ce("SyntaxError",`A \u201C${t}\u201D cannot be followed by a \u201C${e}\u201D.`)}static invalidExpression(){return new ce("SyntaxError","This expression is invalid.")}},Ga={pi:Math.PI,\u03C0:Math.PI,e:Math.E},La={"(":")","[":"]","{":"}"},Ys={"*":"\xB7","**":"\u2217","//":"//","+-":"\xB1","\u2013":"\u2212","-":"\u2212",xx:"\xD7",sum:"\u2211",prod:"\u220F",int:"\u222B",del:"\u2202",grad:"\u2207",aleph:"\u2135",not:"\xAC",AA:"\u2200",EE:"\u2203","'":"\u2019","!=":"\u2260","?=":"\u225F","<=":"\u2264",">=":"\u2265",in:"\u2208","!in":"\u2209","==":"\u2261","~=":"\u2245","~~":"\u2248",sub:"\u2282",sube:"\u2286",prop:"\u221D",oo:"\u221E",cap:"\u2229",cup:"\u222A","<-":"\u2190","->":"\u2192","=>":"\u21D2","<=>":"\u21D4","|->":"\u21A6",uarr:"\u2191",darr:"\u2193",lArr:"\u21D0"},Gi={Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u025B",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",CC:"\u2102",NN:"\u2115",QQ:"\u211A",RR:"\u211D",ZZ:"\u2124"},Bc="abcdefghijklmnopqrstuvwxyz",Qm=Bc.split(""),Jm=Bc.toUpperCase().split(""),tg=Object.values(Gi),eg=[...Qm,...Jm,...tg,"$"],sg="|()[]{}\xF7,!?<>=*/+-\u2013\u2212~^_\u2026\xB0\u2022\u2225\u22A5'\u2220:%\u223C\u25B3",ig=Object.values(Ys),ng=[...sg,...ig],rg={_:"sub","^":"sup","//":"/","\xF7":"/"},Ic={"<":"&lt;",">":"&gt;"};function _c(s){return s in Ic?Ic[s]:s}var og=["abs","round","floor","ceil","max","min","mod","lcm","gcd","gcf","log","exp","ln","sqrt","root","sin","cos","tan","sec","csc","cot","cosec","cotan","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","cosech"];function Ps(s){return og.includes(s)}var Zs={"+":"plus","\u2212":"minus","\xB7":"times","\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\xB1":"plus-minus","=":"equals","\u2260":"does not equal","\u225F":"is it equal?","<":"is less than",">":"is greater than","\u2264":"is less than or equal to","\u2265":"is greater than or equal to",\u03C0:"pi","\u2245":"is congruent to","\u2225":"is parallel to","\u22A5":"is perpendicular to"};for(let s of Object.keys(Gi))Zs[Gi[s]]=s;var Fc=s=>typeof s=="number"?s:s[0],qc=s=>typeof s=="number"?[s,s]:s,ss=class{evaluate(s={},t){return NaN}interval(s={},t){return qc(this.evaluate(s))}substitute(s={}){return this}recursiveSubstitute(s){let t=Object.keys(s);return this.unknowns.filter(e=>t.includes(e)).length?this.substitute(s).recursiveSubstitute(s):this}get simplified(){return this}get unknowns(){return this.variables.filter(s=>!Object.prototype.hasOwnProperty.call(Ga,s))}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(s={}){return""}toMathML(s={}){return""}},ka=new Set;function Oa(s,t,e=!1){var i;let n=(i=t[s])!=null?i:Ga[s];if(n===void 0)throw ot.undefinedVariable(s);if(typeof n=="string"||n instanceof ss){if(e||ka.clear(),ka.has(s))throw ot.evalLoop(s);return ka.add(s),typeof n=="string"&&(n=Et.parse(n)),n.evaluate(t,!0)}else return typeof n=="function"?n():n}var zi=class extends ss{constructor(s){super(),this.n=s}evaluate(){return this.n}toString(){return`${this.n}`}toVoice(){return`${this.n}`}toMathML(){return`<mn>${this.n}</mn>`}},Qs=class extends ss{constructor(s){super(),this.i=s}evaluate(s={},t){return Fc(Oa(this.i,s,t))}interval(s={},t){return qc(Oa(this.i,s,t))}toMathML(){return`<mi${Ps(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(s={}){return s[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in Zs?Zs[this.i]:this.i.length===1?`_${this.i}_`:this.i}},ag=class extends ss{constructor(s){super(),this.s=s}evaluate(s={},t){return Fc(Oa(this.s,s,t))}toString(){return`"${this.s}"`}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}},Hc=class extends ss{toString(){return" "}toMathML(){return"<mspace></mspace>"}},Ce=class extends ss{constructor(s){super(),this.o=s}toString(){return this.o.replace("//","/")}toVoice(){return Zs[this.o]||this.o}get functions(){return[this.o]}toMathML(){let s=_c(this.toString());return`<mo value="${s}">${s}</mo>`}},Lc=[-1/0,1/0],Xs=[NaN,NaN],xs=Math.PI/2,Ra=Math.PI*2,ht=(s,t)=>[s-Number.EPSILON,t+Number.EPSILON],$s=(...s)=>ht(Math.min(...s),Math.max(...s)),hg=s=>Math.abs(s[1]-s[0]);var Ks=s=>isNaN(s[0])||isNaN(s[1]),Oc=s=>!isFinite(s[0])&&s[0]===s[1],lg=(s,t)=>nt(t,s[0]-Number.EPSILON,s[1]+Number.EPSILON),tr=s=>lg(s,0),Me={add:(...s)=>s.reduce((t,e)=>t+e,0),sub:(...s)=>s.length>1?s[0]-s[1]:-s[0],mul:(...s)=>s.reduce((t,e)=>t*e,1),div:(s,t)=>s/t,abs:s=>Math.abs(s),round:s=>Math.round(s),floor:s=>Math.floor(s),ceil:s=>Math.ceil(s),max:(...s)=>Math.max(...s),min:(...s)=>Math.min(...s),mod:(s,t)=>s%t,lcm:(...s)=>Os(...s),gcd:(...s)=>xe(...s),gcf:(...s)=>xe(...s),sup:(s,t)=>Math.pow(s,t),log:(s,t)=>Math.log(s)/(t===void 0?1:Math.log(t)),exp:s=>Math.exp(s),ln:s=>Math.log(s),sqrt:s=>Math.sqrt(s),root:(s,t)=>Math.pow(s,1/t),sin:s=>Math.sin(s),cos:s=>Math.cos(s),tan:s=>Math.tan(s),sec:s=>1/Math.cos(s),csc:s=>1/Math.sin(s),cot:s=>1/Math.tan(s),cosec:s=>Me.csc(s),cotan:s=>Me.cot(s),arcsin:s=>Math.asin(s),arccos:s=>Math.acos(s),arctan:s=>Math.atan(s),sinh:s=>Math.sinh(s),cosh:s=>Math.cosh(s),tanh:s=>Math.tanh(s),sech:s=>1/Math.cosh(s),csch:s=>1/Math.sinh(s),coth:s=>1/Math.tanh(s),cosech:s=>Me.csch(s)};function Qn(s,t){if(s[0]>0)return t[0]>=0?ht(s[0]**t[0],s[1]**t[1]):$s(s[0]**t[0],s[0]**t[1],s[1]**t[0],s[1]**t[1]);let e=t[0];return Number.isInteger(e)&&e===t[1]?e===0?[tr(s)?0:1,1]:e%2?ht(s[0]**e,s[1]**e):tr(s)?[0,Math.max(s[0]**e,s[1]**e)]:$s(s[1]**e,s[0]**e):Xs}function Rc(s,t=Ra){let e=Math.floor(s[0]/t)*t;return[s[0]-e,s[1]-e]}var F={add:(...s)=>ht(N(s.map(t=>t[0])),N(s.map(t=>t[1]))),sub:(s,t)=>t!==void 0?ht(s[0]-t[1],s[1]-t[0]):ht(-s[1],-s[0]),mul:(s,...t)=>(t.length>1&&(t=[F.mul(...t)]),$s(s[0]*t[0][0],s[0]*t[0][1],s[1]*t[0][0],s[1]*t[0][1])),div:(s,t)=>tr(t)?Lc:$s(s[0]/t[0],s[0]/t[1],s[1]/t[0],s[1]/t[1]),abs:s=>tr(s)?ht(0,Math.max(-s[0],s[1])):$s(Math.abs(s[0]),Math.abs(s[1])),round:s=>ht(Math.round(s[0]),Math.round(s[1])),floor:s=>ht(Math.floor(s[0]),Math.floor(s[1])),ceil:s=>ht(Math.ceil(s[0]),Math.ceil(s[1])),max:(...s)=>ht(Math.max(...s.map(t=>t[0])),Math.max(...s.map(t=>t[1]))),min:(...s)=>ht(Math.min(...s.map(t=>t[0])),Math.min(...s.map(t=>t[1]))),mod:(s,t)=>{if(Ks(s)||Ks(t))return Xs;let e=s[0]/(s[0]<0?t[0]:t[1]);return e=e<0?Math.ceil(e):Math.floor(e),F.sub(s,F.mul(t,[e,e]))},lcm:(...s)=>$s(Os(...s.map(t=>t[0]))),gcd:(...s)=>$s(xe(...s.map(t=>t[0]))),gcf:(...s)=>F.gcd(...s),sup:(s,t)=>Qn(s,t),log:(s,t)=>(t!==void 0&&F.div(F.log(s),F.log(t)),ht(s[0]<=0?-1/0:Math.log(s[0]),Math.log(s[1]))),exp:s=>Qn([Math.E,Math.E],s),ln:s=>F.log(s),sqrt:s=>Qn(s,[.5,.5]),root:(s,t)=>Qn(s,F.div([1,1],t)),sin:s=>F.cos(F.sub(s,[xs,xs])),cos:s=>Ks(s)||Oc(s)?Xs:hg(s)>=Ra-Number.EPSILON?[-1,1]:(s=Rc(s),s[0]>Math.PI+Number.EPSILON?F.sub(F.cos(F.sub(s,[Math.PI,Math.PI]))):s[1]<Math.PI-Number.EPSILON?ht(Math.cos(s[1]),Math.cos(s[0])):s[1]<Ra-Number.EPSILON?ht(-1,Math.max(Math.cos(s[1]),Math.cos(s[0]))):ht(-1,1)),tan:s=>Ks(s)||Oc(s)?Xs:(s=Rc(s,Math.PI),s[0]>xs+Number.EPSILON&&(s=F.sub(s,[Math.PI,Math.PI])),s[0]<-xs+Number.EPSILON||s[1]>xs-Number.EPSILON?Lc:ht(Math.tan(s[0]),Math.tan(s[1]))),sec:s=>F.div([1,1],F.cos(s)),csc:s=>F.div([1,1],F.sin(s)),cot:s=>F.div([1,1],F.tan(s)),cosec:s=>F.csc(s),cotan:s=>F.cot(s),arcsin:s=>Ks(s)||s[1]<-1||s[0]>1?Xs:ht(s[0]<=-1?-xs:Math.asin(s[0]),s[1]>=1?xs:Math.asin(s[1])),arccos:s=>Ks(s)||s[1]<-1||s[0]>1?Xs:ht(s[1]>=1?0:Math.acos(s[1]),s[0]<=-1?Math.PI:Math.acos(s[0])),arctan:s=>ht(Math.atan(s[0]),Math.atan(s[1])),sinh:s=>ht(Math.sinh(s[0]),Math.sinh(s[1])),cosh:s=>s[1]<0?ht(Math.cosh(s[1]),Math.cosh(s[0])):s[0]>0?ht(Math.cosh(s[0]),Math.cosh(s[1])):ht(1,Math.cosh(Math.max(-s[0],s[1]))),tanh:s=>ht(Math.tanh(s[0]),Math.tanh(s[1])),sech:s=>F.div([1,1],F.cosh(s)),csch:s=>F.div([1,1],F.sinh(s)),coth:s=>F.div([1,1],F.tanh(s)),cosech:s=>F.csch(s)},Jn=K("+ \u2212 * \xD7 \xB7 / \xF7 // sup sub subsup"),Dc=K("sub sup subsup"),Va='<mo value="," lspace="0">,</mo>';function jc(s,t){return Jn.includes(t)?s instanceof er?!0:!(s instanceof jt)||!Jn.includes(s.fn)?!1:Dc.includes(s.fn)&&Dc.includes(t)?!0:Jn.indexOf(t)>Jn.indexOf(s.fn):!1}function cg(s,t,e){return jc(s,t)?`<mfenced>${e}</mfenced>`:e}function es(s,t){return s instanceof er||s instanceof jt?`<mrow>${t}</mrow>`:t}function Nc(s){return s==="2"?"squared":s==="3"?"cubed":`to the power of ${s}`}var jt=class Da extends ss{constructor(t,e=[]){super(),this.fn=t,this.args=e}evaluate(t={}){let e=this.args.map(i=>i.evaluate(t));if(this.fn in t){let i=t[this.fn];if(typeof i=="function")return i(...e);if(typeof i=="number"&&e.length===1)return Me.mul(i,e[0]);throw ot.uncallableExpression(this.fn)}if(this.fn==="+")return Me.add(...e);if(this.fn==="\u2212")return Me.sub(...e);if(["*","\xB7","\xD7"].includes(this.fn))return Me.mul(...e);if(this.fn==="/")return Me.div(...e);if(this.fn==="sup")return Me.sup(...e);if(Ps(this.fn))return Me[this.fn](...e);if(this.fn==="(")return e[0];throw ot.undefinedFunction(this.fn)}interval(t={}){let e=this.args.map(i=>i.interval(t));if(this.fn in t){let i=t[this.fn];if(typeof i=="function")return re(i(...e.map(n=>n[0])),2);if(typeof i=="number"&&e.length===1)return F.mul([i,i],e[0]);if(Array.isArray(i)&&e.length===1)return F.mul(i,e[0]);throw ot.uncallableExpression(this.fn)}if(this.fn==="+")return F.add(...e);if(this.fn==="\u2212")return F.sub(...e);if(["*","\xB7","\xD7"].includes(this.fn))return F.mul(...e);if(this.fn==="/")return F.div(...e);if(this.fn==="sup")return F.sup(...e);if(Ps(this.fn))return F[this.fn](...e);if(this.fn==="(")return e[0];throw ot.undefinedFunction(this.fn)}substitute(t={}){return new Da(this.fn,this.args.map(e=>e.substitute(t)))}collapse(){return this.fn==="("?this.args[0].collapse():new Da(this.fn,this.args.map(t=>t.collapse()))}get simplified(){return this}get variables(){return Wt(ye(this.args.map(t=>t.variables)))}get functions(){return Wt([this.fn,...ye(this.args.map(t=>t.functions))])}toString(){let t=this.args.map(e=>jc(e,this.fn)?`(${e.toString()})`:e.toString());return this.fn==="\u2212"?t.length>1?t.join(" \u2212 "):`\u2212${t[0]}`:this.fn==="sup"?t.join("^"):this.fn==="sub"?t.join("_"):this.fn==="subsup"?`${t[0]}_${t[1]}^${t[2]}`:K("+ * \xD7 \xB7 / = < > \u2264 \u2265 \u2248 \u225F \u2260").includes(this.fn)?t.join(` ${this.fn} `):_(this.fn,"(","[","{")?this.fn+this.args.join(", ")+La[this.fn]:_(this.fn,"!","%")?t[0]+this.fn:`${this.fn}(${t.join(", ")})`}toMathML(t={}){let e=this.args.map(r=>r.toMathML(t)),i=this.args.map((r,o)=>cg(r,this.fn,e[o]));if(this.fn in t){let r=e.map((o,a)=>({toString:()=>o,val:this.args[a]}));return t[this.fn](...r)}if(this.fn==="\u2212")return i.length>1?i.join('<mo value="\u2212">\u2212</mo>'):`<mo rspace="0" value="\u2212">\u2212</mo>${i[0]}`;if(_(this.fn,"+","=","<",">","\u2264","\u2265","\u2248","\u225F","\u2260")){let r=_c(this.fn);return i.join(`<mo value="${r}">${r}</mo>`)}if(_(this.fn,"*","\xD7","\xB7")){let r=i[0];for(let o=1;o<i.length-1;++o){let a=this.args[0]instanceof zi&&this.args[1]instanceof zi;r+=(a?'<mo value="\xD7">\xD7</mo>':"")+i[1]}return r}if(this.fn==="//")return i.join('<mo value="/">/</mo>');if(this.fn==="sqrt")return`<msqrt>${i[0]}</msqrt>`;if(_(this.fn,"/","root")){let r=this.fn==="/"?"mfrac":"mroot",o=this.args.map((a,h)=>es(a,e[h]));return`<${r}>${o.join("")}</${r}>`}if(_(this.fn,"sup","sub")){let r=[es(this.args[0],i[0]),es(this.args[1],e[1])];return`<m${this.fn}>${r.join("")}</m${this.fn}>`}return this.fn==="subsup"?`<msubsup>${[es(this.args[0],i[0]),es(this.args[1],e[1]),es(this.args[2],e[2])].join("")}</msubsup>`:_(this.fn,"(","[","{")?`<mfenced open="${this.fn}" close="${La[this.fn]}">${i.join(Va)}</mfenced>`:_(this.fn,"!","%")?`${i[0]}<mo value="${this.fn}" lspace="0">${this.fn}</mo>`:this.fn==="abs"?`<mfenced open="|" close="|">${i.join(Va)}</mfenced>`:this.fn==="bar"?`<mover>${es(this.args[0],i[0])}<mo value="\u203E">\u203E</mo></mover>`:this.fn==="vec"?`<mover>${es(this.args[0],i[0])}<mo value="\u2192">\u2192</mo></mover>`:`<mi${Ps(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${i.join(Va)}</mfenced>`}toVoice(t={}){let e=this.args.map(n=>n.toVoice(t)),i=e.join(" ");if(this.fn in t){let n=e.map((r,o)=>({toString:()=>r,val:this.args[o]}));return t[this.fn](...n)}return _(this.fn,"(","[","{")?i:this.fn==="sqrt"?`square root of ${i}`:this.fn==="%"?`${i} percent`:this.fn==="!"?`${i} factorial`:this.fn==="/"?`${e[0]} over ${e[1]}`:this.fn==="//"?`${e[0]} divided by ${e[1]}`:this.fn==="sub"?i:this.fn==="subsup"?`${e[0]} ${e[1]} ${Nc(e[2])}`:this.fn==="sup"?`${e[0]} ${Nc(e[1])}`:Zs[this.fn]?e.join(` ${Zs[this.fn]} `):Ps(this.fn)?`${this.fn} ${i}`:`${this.fn} of ${i}`}},er=class extends ss{constructor(s){super(),this.items=s}evaluate(s={}){return this.collapse().evaluate(s)}interval(s={}){return this.collapse().interval(s)}substitute(s={}){return this.collapse().substitute(s)}get simplified(){return this.collapse().simplified}get variables(){return Wt(Dh(...this.items.map(s=>s.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(s=>s.toString()).join(" ")}toMathML(s={}){return this.items.map(t=>t.toMathML(s)).join("")}toVoice(s={}){return this.items.map(t=>t.toVoice(s)).join(" ")}collapse(){return Na(this.items).collapse()}};function Ia(s,t){if(t===2)return new ag(s);if(!(!s||!t)){if(t===1&&s.length>1)return new Hc;if(t===3){if(isNaN(+s))throw ot.invalidExpression();return new zi(+s)}if(t===4)return s in Gi?new Qs(Gi[s]):s in Ys?new Ce(Ys[s]):new Qs(s);if(t===5)return s in Ys?new Ce(Ys[s]):new Ce(s)}}function pg(s){let t=[],e="",i=0;for(let r of s){if(r==='"'){let a=i===2?0:2,h=Ia(e,i);h&&t.push(h),e="",i=a;continue}else if(i===2){e+=r;continue}let o=r.match(/[0-9.]/)?3:eg.includes(r)?4:ng.includes(r)?5:r.match(/\s/)?1:0;if(!o)throw ot.invalidCharacter(r);if(!i||i===3&&o!==3||i===4&&o!==4&&o!==3||i===5&&!(e+r in Ys)||i===1&&o!==1){let a=Ia(e,i);a&&t.push(a),e="",i=o}e+=r}let n=Ia(e,i);return n&&t.push(n),t}function dg(s){return s.length>1?new er(s):s[0]instanceof Ce?new er(s):s[0]}function ug(s,t){let e=[[]];for(let i of s)t(i)?e.push([]):O(e).push(i);return e}function Gt(s,t){return s instanceof Ce&&K(t).includes(s.o)}function Ni(s){return s instanceof jt&&s.fn==="("?s.args[0]:s}function sr(s,t){if(Gt(s[0],t))throw ot.startOperator(s[0]);if(Gt(O(s),t))throw ot.endOperator(O(s));for(let e=1;e<s.length-1;++e){if(!Gt(s[e],t))continue;let i=s[e],n=s[e-1],r=s[e+1];if(n instanceof Ce)throw ot.consecutiveOperators(n.o,i.o);if(r instanceof Ce)throw ot.consecutiveOperators(i.o,r.o);let o=s[e+2];if(t==="^ _"&&Gt(i,"_ ^")&&Gt(o,"_ ^")&&i.o!==o.o){let a=s[e+3];if(a instanceof Ce)throw ot.consecutiveOperators(o.o,a.o);let h=[Ni(n),Ni(r),Ni(a)];i.o==="^"&&([h[1],h[2]]=[h[2],h[1]]),s.splice(e-1,5,new jt("subsup",h)),e-=4}else{let a=rg[i.o]||i.o,h=[Ni(n),Ni(r)];s.splice(e-1,3,new jt(a,h)),e-=2}}}function Gc(s){return sr(s,"^ _"),sr(s,"/"),dg(s)}function fg(s,t){let e=[[]],i=["\u03C0",...(t==null?void 0:t.variables)||[]];for(let n of s){let r=O(e).length?O(e)[0].o:void 0;if(Gt(n,") ] }")){if(!Gt(n,La[r]))throw ot.conflictingBrackets(n.o);let o=e.pop(),a=O(e),h=O(a),c=Gt(n,")")&&h instanceof Qs&&!i.includes(h.i)?a.pop().i:o[0].o,u=ug(o.slice(1),d=>Gt(d,","));a.push(new jt(c,u.map(Gc)))}else Gt(n,"( [ {")?e.push([n]):O(e).push(n)}if(e.length>1)throw ot.unclosedBracket(O(e)[0].o);return Gc(e[0])}function zc(s,t,e=!1){let i=[],n=[],r=!1;function o(){if(r)throw ot.invalidExpression();n.length&&(i.push(n.length>1?new jt(t[0],n):n[0]),n=[])}for(let a of s)if(Gt(a,t)){if(r||!n.length)throw ot.invalidExpression();r=!0}else if(a instanceof Ce)o(),i.push(a),r=!1;else{let h=!e||a instanceof zi;if(n.length&&!r&&h)throw ot.invalidExpression();n.push(a),r=!1}return o(),i}function Na(s){if(s=s.filter(e=>!(e instanceof Hc)),!s.length)throw ot.invalidExpression();let t=s.findIndex(e=>Gt(e,"= < > \u2264 \u2265 \u225F \u2260"));if(t===0)throw ot.startOperator(s[0]);if(t===s.length-1)throw ot.endOperator(s[0]);if(t>0){let e=Na(s.slice(0,t)),i=Na(s.slice(t+1));return new jt(s[t].o,[e,i])}if(Gt(s[0],"%!"))throw ot.startOperator(s[0]);for(let e=0;e<s.length;++e)Gt(s[e],"%!")&&(s.splice(e-1,2,new jt(s[e].o,[s[e-1]])),e-=1);sr(s,"// \xF7");for(let e=1;e<s.length;++e){let i=s[e];if(i instanceof jt&&i.fn==="/"){let n=s[e-1];if(n instanceof zi)s.splice(e-1,2,new jt("+",[n,i])),e-=1;else if(!(n instanceof Ce))throw ot.consecutiveOperators(n.toString(),i.toString())}}if(s=zc(s,"\xD7 * \xB7",!0),Gt(s[0],"\u2212 \xB1")&&s.splice(0,2,new jt(s[0].o,[s[1]])),sr(s,"\u2212 \xB1"),Gt(s[0],"+")&&(s=s.slice(1)),s=zc(s,"+"),s.length>1)throw ot.invalidExpression();return s[0]}function mg(s,t=!1,e){let i=fg(pg(s),e);return t?i.collapse():i}function gg(s,t){try{let e=Wt([...s.variables,...t.variables]),i=s.collapse(),n=t.collapse(),r=0;for(let o=0;o<5;++o){let a={};for(let c of e)a[c]=Ga[c]||Math.random()*5;let h=i.evaluate(a),l=n.evaluate(a);if(!(isNaN(h)||isNaN(l))){if(!$(h,l))return!1;r+=1}}return!!r}catch(e){return!1}}var Et={numEquals:gg,parse:Oe(mg)};var Uc='<div class="toasts"><div class="msg-wrap"><button class="msg archie" aria-label="Virtual Tutor"><slot name="icon"></slot></button></div></div><div class="chat" data-display="flex"><div class="chat-header"><slot name="header"></slot><button class="close"><x-icon name="close" size="24"></x-icon></button></div><div class="chat-body"></div><div class="chat-footer"><div class="input" contenteditable></div><button class="hint"><x-icon name="lightbulb" size="24"></x-icon></button></div></div>';var vg=/[0-9+\-*/()^\s]+/g,wg=os(_t.shuffle(["happy","spongebob","sloth","party","robot","excited","cute","highfive1","applause","highfive2"])),yg=os(_t.shuffle(["minions","panther","dog","snape","what","door","horrible"]));function za(s,t,e={}){let i=m("div",{class:"msg-wrap","data-display":"flex"}),n=m("div",{class:"msg "+t},i);return e.class&&n.addClass(e.class),e.visible||i.hide(),_(t,"hint","question")?n.html=s:t==="img"?n.css("background-image",`url(${s})`):t==="video"&&m("iframe",{src:s,allowfullscreen:!0},n),i}var ir=class extends E{constructor(){super(...arguments);this.recentMessages=[];this.isOpen=!1;this.queuePromise=Promise.resolve()}ready(){var r;this.$course=this.parents("x-course")[0],this.hints=this.$course?JSON.parse(this.$course.$("#hints").text):{};let e=window.user;this.correct=os(_t.shuffle(this.hints.correct||[])),this.incorrect=os(_t.shuffle(this.hints.incorrect||[])),this.$toasts=this.$(".toasts"),this.$chat=this.$(".chat"),this.$chatBody=this.$(".chat-body"),this.$toasts.on("click",o=>{o.handled||this.open()}),this.$(".close").on("click",()=>this.close());let i=this.$(".chat-footer");if(this.$query=i.$(".input"),this.$query.onKey("Enter",o=>{o.preventDefault(),this.askQuestion(this.$query.text.trim()),this.$query.text=""}),this.$query.on("focus",()=>i.addClass("focus")),this.$query.on("blur",()=>i.removeClass("focus")),this.$(".hint").on("click",()=>{this.queue(this.hints.tutorial1),this.queue(e?this.hints.tutorial2:this.hints.account)}),this.$course&&((r=this.$course.userData)!=null&&r.messages))for(let o of this.$course.userData.messages)this.$chatBody.append(za(o.content,o.kind||"hint",{visible:!0}));if(!b.getCookie("sessionWelcome")&&this.$course){b.setCookie("sessionWelcome",1,60*60*4);let o=new Date().getHours(),a=o<12?"Morning":o<18?"Afternoon":"Evening";e?setTimeout(()=>this.showHint(`welcome${a}Named`,{variables:{name:e.shortName}}),3e3):b.getCookie("welcome")?(setTimeout(()=>this.showHint(`welcome${a}`),3e3),setTimeout(()=>this.queue(this.hints.account),4500)):(b.setCookie("welcome",1),setTimeout(()=>this.queue(this.hints.welcome),3e3),setTimeout(()=>this.queue(this.hints.tutorial1),4500))}}open(){this.isOpen||(this.isOpen=!0,this.$chat.enter("slide-up",200),this.$chatBody.scrollTop=this.$chatBody.scrollHeight,this.trigger("open"))}close(){this.isOpen&&(this.isOpen=!1,this.$query.blur(),this.trigger("close"),this.$chat.exit("slide-down",200))}queue(e,i="hint",n={}){this.queuePromise=this.queuePromise.then(()=>(this.display(e,i,n),yi(500)))}display(e,i="hint",n={}){let r=n.timeout||8e3;if(b.width<640&&(r*=.7),(n.toast==null?!0:n.toast)&&!this.isOpen){let h=za(e,i,n);h.setAttr("role","alert"),this.$toasts.append(h),h.enter("reveal-right"),setTimeout(()=>h.exit("reveal-right",400,0,!0),r),this.on("open",()=>h.exit("reveal",200,0,!0))}let a=za(e,i,{class:n.class,visible:!this.isOpen});this.$chatBody.append(a),this.isOpen&&(a.enter("reveal",300),pt(()=>this.$chatBody.scrollTop=this.$chatBody.scrollHeight,200))}showHint(e,i={}){if(_(e,"correct","incorrect")){let r=e==="correct"?this.correct():this.incorrect(),o=e==="correct"?3e3:5e3;if(this.queue(r,"hint",{class:i.class||e,timeout:o}),Math.random()<.2){let a=e==="correct"?wg():yg();this.queue(`/images/gifs/${a}.gif`,"img",{timeout:o})}return{text:r}}let n=this.hints[e]||e;if(i.variables)for(let[r,o]of Object.entries(i.variables))n=n.replace(new RegExp("\\$"+r,"g"),o);return!i.force&&this.recentMessages.includes(e)?{text:n}:(this.recentMessages.push(e),setTimeout(()=>this.recentMessages.shift(),1e4),i.store!==!1&&this.$course&&this.$course.saveProgress({hints:[{content:n,kind:"hint"}]}),this.queue(n,"hint",{class:i.class}),{text:n})}askQuestion(e){if(!e)return;this.queue(e,"question"),this.$course&&this.$course.log("Tutor","ask",e);let i=(e.match(vg)||[]).filter(n=>n.length>=3&&!n.match(/^[\s0-9]+$/));if(i.length)try{let n=Et.parse(i[0],!0),r=Et.parse("="+n.evaluate());return this.queue(`<span class="math">${n.toMathML()}${r.toMathML()}</span>`)}catch(n){console.log("Parse Error:",i[0])}this.$chatBody.addClass("loading"),Ne(this.attr("api"),{query:e}).then(n=>{this.$chatBody.removeClass("loading");let r=JSON.parse(n);for(let o of r)this.queue(o.content,o.kind)}).catch(n=>{this.$chatBody.removeClass("loading"),this.queue(this.hints.serverError),console.error("Tutor Error:",n)})}};ir=T([S("x-tutor",{template:Uc})],ir);var Wc='<div class="left" tabindex="0"><x-icon name="left" size="14"></x-icon></div><div class="content"><slot></slot></div><div class="right" tabindex="0"><x-icon name="right" size="14"></x-icon></div><div class="bubble"><div class="bubble-box"><div class="progress"></div></div><div class="bubble-arrow"></div></div>';var Kc=m("div",{class:"var-overlay"},C),nr=class extends E{constructor(){super(...arguments);this.valueChange=!1}ready(){let e=this.attr("bind");if(!e)return;let[i,n,r]=e.split("|");[this.min,this.max,this.step]=r.split(",").map(l=>+l),this.name=i,this.model=this.getParentModel(),this.$(".content").bindModel(this.model),this.$progress=this.$(".progress"),this.setValue(+n);let o=20*(b.isMobile?1.5:1)/B((this.max-this.min)/this.step/12,1,3),a=0,h=0;for(let l of this.$$(".left, .right")){let c=l.hasClass("left")?-this.step:this.step;l.on("click",()=>{this.setValue(this.value+c),this.trigger("slide-end")})}us(this,{start:l=>{a=l.x,h=this.value,this.addClass("on"),this.valueChange=!1,Kc.show(),Xt.addClass("grabbing")},move:l=>{let c=(l.x-a)/o;this.setValue(h+Dt(c)*this.step)},end:()=>{this.removeClass("on"),this.valueChange&&this.trigger("slide-end"),Kc.hide(),Xt.removeClass("grabbing")}})}setup(e,i){this.one("slide-end",()=>e.score(i))}setValue(e){let i=Dt(B(e,this.min,this.max),2);if(i===this.value)return;this.value=i,this.valueChange=!0,this.model&&(this.model[this.name]=i);let n=this.max-this.min;this.$progress.css("width",116*(i-this.min)/n+"px")}};nr=T([S("x-var",{template:Wc})],nr);var Xc='<button class="play-btn-box" aria-label="Play"><x-icon name="play" size="44"></x-icon></button>';var rr=class extends E{constructor(){super(...arguments);this.visible=!0}ready(){this.on("click",()=>{this.play(),setTimeout(()=>this.trigger("play"),400)})}play(){this.visible&&(this.visible=!1,this.exit("pop",400))}reset(){this.visible||(this.visible=!0,setTimeout(()=>this.enter("pop"),400))}};rr=T([S("x-play-btn",{template:Xc})],rr);var or=class extends E{constructor(){super(...arguments);this.playing=!1}ready(){this.$icon=this.$("x-icon"),this.$("button").on("click",()=>this.toggle())}toggle(){this.playing?this.pause():this.play()}play(){this.playing||(this.playing=!0,this.$icon.setAttr("name","pause"),this.trigger("play"))}pause(){this.playing&&(this.playing=!1,this.$icon.setAttr("name","play"),this.trigger("pause"))}};or=T([S("x-play-toggle",{template:'<button class="icon-btn"><x-icon name="play"></x-icon></button>'})],or);var Yc='<div class="video-wrap"><video playsinline></video></div><div class="credit"></div><x-play-btn></x-play-btn><div class="controls"><div class="shadow"></div><button class="play-pause-btn" tabindex="0" aria-label="Play video"><div class="play-icon"><x-icon name="play" size="32"></x-icon></div><div class="pause-icon"><x-icon name="pause" size="32"></x-icon></div></button><div class="timeline"><div class="bar"><div class="background"></div><div class="buffer"></div><div class="progress"></div></div><div class="handle"></div></div><div class="timecode"></div></div>';function Zc(s){let t=Math.floor(s/60),e=Math.floor(s%60);return t+":"+(e<10?"0":"")+e}var ar=class extends E{ready(){let t=this.attr("src"),e=this.$(".video-wrap"),i=this.$("video"),n=this.attr("width"),r=this.attr("height");this.css("width",n+"px"),e.css("padding-bottom",+r/+n*100+"%"),i.setAttr("poster",this.attr("poster")||t.replace(/mp4$/,"jpg")),this.hasAttr("loop")&&(i._el.loop=!0),this.hasAttr("audio")||(i._el.muted=!0),i._el.preload=this.attr("preload")==="no"?"metadata":"auto",m("source",{src:t,type:"video/mp4"},i),this.hasAttr("credit")&&(this.$(".credit").text=this.attr("credit"));let o=this.$(".bar"),a=this.$(".progress"),h=this.$(".buffer"),l=this.$(".timecode"),c=new ms(this.$(".handle"),{$parent:o,moveY:!1}),u=this.video=i._el,d=this.width-110;b.onResize(()=>d=this.width-110),i.on("canplay",()=>{l.text=Zc(+u.duration)}),i.on("timeupdate",()=>{let f=u.currentTime/u.duration;a.css("width",f*100+"%"),l.text=Zc(+u.currentTime),c.setPosition(f*d,0),this.trigger("timeupdate",u.currentTime)}),i.on("progress",()=>{if(u.buffered.length<=0||u.duration<=0)return;let v=u.buffered.end(u.buffered.length-1)/u.duration*100;h.css("width",v+"%")}),i.on("ended",()=>{u.pause(),this.removeClass("playing"),this.trigger("end")});let g=()=>u.paused?this.play():this.pause(),y=f=>this.setTime(f/d*u.duration);this.hasAttr("hover")?(i.on("mouseover touchstart",()=>this.play()),i.on("mouseout touchend touchcancel",()=>this.pause())):i.on("click",g),this.hasAttr("controls")&&(this.$(".controls").show(),this.$(".play-pause-btn").on("click",g),c.on("start",()=>this.pause()),c.on("drag",({posn:f})=>y(f.x)),o.on("click",f=>y(f.offsetX)))}setTime(t){this.video.currentTime=t}play(){this.video.play(),this.addClass("playing"),this.trigger("play")}pause(){this.video.pause(),this.removeClass("playing")}};ar=T([S("x-video",{template:Yc})],ar);var hr=class extends E{constructor(){super(...arguments);this.isCompleted=!1;this.isReady=!1}created(){this.userData=window.progressData||JSON.parse(this.$("#userdata").text)||{},this.$steps=this.$$("x-step");for(let e of this.$steps)e.on("score",()=>this.trigger("score"));this.data.audio&&(this.audio=new En(this.data.audio))}ready(){this.$footer=this.$("footer"),this.$skipStep=this.$footer.$(".skip-step"),this.$progress=this.$(".sidebar-row.active x-progress"),this.$tutor=this.$("x-tutor"),this.$stepsWrap=this.$(".steps");let e=this.findStep(b.getHash()),i=this.findStep(this.userData.activeStep);this.$activeStep=i||this.$steps[0];for(let r of this.$steps){if(r.show(),r===this.$activeStep)break;r.complete()}if(this.userData.completed||b.getHash()==="full"||this.data.reveal)this.complete();else for(;this.$activeStep&&this.$activeStep.isReady&&!this.isCompleted;)this.nextStep();(e||i&&!this.userData.completed)&&this.goToStep(e||i,!1),this.$(".section-dev")&&this.complete();let n=this.$(".reveal-banner");setTimeout(()=>{this.isCompleted||(n.removeClass("off"),this.on("score complete",()=>n.addClass("off")))},1500),n.$(".complete").one("click",()=>this.complete()),C.onKey("Space",r=>{r.preventDefault(),this.nextStep(),n.addClass("off")}),this.$footer.$(".skip").on("click",()=>this.nextStep()),this.$footer.$(".show-all").on("click",()=>this.complete()),this.$footer.show(),this.isReady=!0,setTimeout(()=>this.addClass("ready"))}nextStep(){if(this.isCompleted)return;let e=this.$activeStep,i=this.$stepsWrap.height;do{if(e.complete(),e=this.$steps[this.$steps.indexOf(e)+1],!e)return this.complete(!0);e.show()}while(e.isReady);this.$stepsWrap.animate({height:[i+"px","auto"]},800),this.$activeStep=e,this.saveProgress({activeStep:e.id})}goToStep(e,i=!0){let n=this.$stepsWrap.height;for(let a of this.$steps){if(a.isShown||(this.$activeStep=a),a.show(),e.isShown&&!a.isReady)break;a.complete()}let r=e.positionTop-Math.max(50,(b.height-e.height)/2);i?(this.$stepsWrap.animate({height:[n+"px","auto"]},800),C.scrollTo(r)):C.scrollTop=r;let o=O(this.$steps);if(o.isShown&&o.isReady)return this.complete();this.$activeStep&&this.saveProgress({activeStep:this.$activeStep.id})}complete(e=!1){if(this.isCompleted)return;this.isCompleted=!0,this.$steps.forEach(n=>n.complete()),this.$activeStep=void 0;let i=this.$footer.$(".next-section");e?(this.$skipStep.exit("fade",200),i&&i.enter("pop")):(this.$skipStep.hide(),i&&i.show()),this.trigger("complete"),this.saveProgress({completed:!0}),this.log("Course","complete")}findStep(e){for(let i of this.$steps)if(i.id===e)return i}saveProgress(e){if(!this.isReady)return;let n=N(this.$steps.map(r=>r.scores.size))/+this.data.goals||0;this.$progress.setProgress(n),Fl(`/course/${this.id}/${this.data.section}`,e)}log(e,i,n){if(window.ga&&this.isReady){let r=i+(n?":"+n:"");window.ga("send","event",e,r,this.id)}}};hr=T([S("x-course")],hr);var lr=class{constructor(){this.callbacks=[]}add(t){this.callbacks.push(t)}start(t=1e3){return pt(i=>{for(let n of this.callbacks)n(i)},t).promise}};function Qc(s,t){return s.every((e,i)=>$(e,t[i]))}function Jc(s,t){s.scale*=t.scale,s.x=s.x*t.scale+t.x,s.y=s.y*t.scale+t.y}function tp(s,t){return $(s.x,t.x)&&$(s.y,t.y)&&$(s.scale,t.scale)}function ep(s,t,e){if(e==="adding"){let i=s.strokeLength,n=t<.5?0:yt("cubic-in",t*2-1);s.css({"stroke-dasharray":i+"px","stroke-dashoffset":i*(1-n)+"px"})}else if(e==="deleting"){let i=s.strokeLength,n=t<.5?yt("cubic-in",2*t):1;s.css({"stroke-dasharray":i+"px","stroke-dashoffset":i*(2-n)+"px"})}}function sp(s,t){let e=[s],i=s.expr;for(;t.startsWith(i);){if(t===i)return e;let n=O(e).next;if(!n)return;e.push(n),i+=n.expr}}function ip(s,t,e=1){let i=e*Math.abs(t.x-s.x)/3,n=p.average(s,t).shift(0,i);return function(r){let o=(1-r)**2*s.x+2*r*(1-r)*n.x+r*r*t.x,a=(1-r)**2*s.y+2*r*(1-r)*n.y+r*r*t.y;return{x:o,y:a}}}function Ba(s,t){return Math.max(t*s,.4)/s}function ze(s){return s instanceof Ae&&s.children.length>1||s instanceof Bi?`(${s.expr})`:s.expr}function Js(s,t){return t.length===1&&t[0].type==="mrow"?t[0]:new Ae(t,s)}var zt=class s{constructor(t,e,i,n){this.type=t;this.equation=i;this.$element=n;this.children=[];this.status="";this.value="";this.customColor="";this.roundedMotion=!1;this.width=0;this.height=0;this.baseline=0;this.transform={x:0,y:0,scale:1};this.currentDimensions=[0,0,0];this.currentWorldTransform={x:0,y:0,scale:1};this.addChildren(e),n&&i.$row.append(n)}get expr(){return""}get log(){let t=this.children.map(e=>e.log);return`<${this.type}>${t.join("")}</${this.type}>`}get color(){return this.customColor||(this.parent?this.parent.color:"")}static create(t,e){let i=t.nodeName.toLowerCase();if(_(i,"mn","mi","mo","mtext")){if(t.textContent==="placeholder")return new qa(e);let r=t.getAttribute("mathvariant")||void 0;return new cr(i,t.textContent||"",e,r)}if(!_(i,"mrow","mfrac","mfenced","msqrt","mroot","msub","msup","msubsup","munder","mover","munderover","mspace"))return new Wa(t,e);if(i==="mfenced"&&t.getAttribute("open")==="["){let r=t.children.length,o=ye(Array.from(t.children,h=>Array.from(h.children,l=>s.create(l,e)))),a=new Ua(o,e,r);return new pr([a],e)}let n=Array.from(t.children,r=>s.create(r,e));switch(i){case"mrow":return new Ae(n,e);case"mfrac":return n=n.map(r=>Js(e,[r])),new Ha(n,e);case"mfenced":return n=[Js(e,n)],new pr(n,e);case"msqrt":return n=[Js(e,n)],new dr(i,n,e);case"mroot":return n=n.map(r=>Js(e,[r])),new dr(i,n,e);case"msub":case"msup":case"msubsup":return n=n.map(r=>Js(e,[r])),new Bi(i,n,e);case"munder":case"mover":case"munderover":return n=n.map(r=>Js(e,[r])),new ja(i,n,e);case"mspace":return new Fa(e)}throw new Error(`Unknown element type tag ${t.nodeName}`)}get marginLeft(){return .1}get marginRight(){return .1}setTransform(t=0,e=0,i=1){this.transform.x=t,this.transform.y=e,this.transform.scale=i}get worldTransform(){let t=this,e=Object.assign({},this.transform);for(;t=t.parent;)Jc(e,t.transform);return e}get index(){return this.parent?this.parent.children.indexOf(this):-1}get next(){if(!this.parent)return;let t=this.parent.children.indexOf(this);return this.parent.children[t+1]}get prev(){if(!this.parent)return;let t=this.parent.children.indexOf(this);return this.parent.children[t-1]}addChildren(t,e=this.children.length){for(let i of this.children)i.type==="placeholder"&&i.deleteFromDom();for(let i of t)i.detach(),i.parent=this;this.children.splice(e,0,...t)}insertAfter(t){let e=this.parent.children.indexOf(this);this.parent.addChildren(t,e+1)}insertBefore(t){let e=this.parent.children.indexOf(this);this.parent.addChildren(t,e)}detach(){if(this.parent){let t=this.parent.children.indexOf(this);t>=0&&this.parent.children.splice(t,1),this.parent=void 0}}deleteFromDom(){this.parent&&this.detach(),this.$element&&this.$element.remove(),this.$element=void 0;for(let t of this.children.slice(0))t.deleteFromDom()}*parents(t=!1){let e=t?this:this.parent;for(;e;)yield e,e=e.parent}hasParent(t,e=!1){return At(this.parents(e),t)}hitTest(t){let{x:e,scale:i}=this.worldTransform,n=this.marginLeft*i*this.equation.fontSize,r=this.marginRight*i*this.equation.fontSize;if(nt(t.x,e-n,e+this.width*i+n+r))return this.hitTestChildren(t)||this}hitTestChildren(t){for(let e of this.children){let i=e.hitTest(t);if(i)return i}}measure(t=1){for(let e of this.children)e.measure(t)}clean(){for(let t of this.children)t.clean()}setStatus(t){this.status=t;for(let e of this.children)e.setStatus(t)}render(t){for(let h of this.children)h.render(t);if(!this.$element)return;let e=this.currentWorldTransform,i=this.currentWorldTransform=this.worldTransform,n=this.currentDimensions,r=this.currentDimensions=[this.width,this.height,this.baseline];if(tp(e,i)&&Qc(n,r)&&!this.status)return;if(!t){this.positionElement(i),this.drawElement(1,r[0],r[1],r[2],i.scale);return}this.status==="adding"&&this.positionElement(i);let o=i.y+this.baseline<this.equation.root.baseline?-1:1,a=this.roundedMotion?ip(e,i,o):void 0;this.roundedMotion=!1,t.add(h=>{if(!this.$element)return;let l=yt("cubic",h),c=_(this.status,"adding","deleting"),u=c?r[0]:tt(n[0],r[0],l),d=c?r[1]:tt(n[1],r[1],l),g=c?r[2]:tt(n[2],r[2],l),y=c?i.scale:tt(e.scale,i.scale,l);if(this.drawElement(h,u,d,g,y),!this.status){let f=a?a(l):p.interpolate(e,i,l);this.positionElement({x:f.x,y:f.y,scale:y})}})}positionElement(t){this.$element.setTransform(t,0,t.scale)}drawElement(t,e,i,n,r){}setPath(t,e){this.$element.setAttr("d",t),this.$element.css("stroke",this.color||"currentColor"),this.$element.css("stroke-width",this.equation.isBold?2:1.5),ep(this.$element,e,this.status)}},bg="acegmnopqrsuvwxyz",Ts=1.1,ti=.2,_a=new Set(["=","\u2248","<",">","\u2264","\u2265"]),xg=document.createElement("canvas"),np=xg.getContext("2d"),$g=Oe((s,t)=>(np.font=`${t}px "Source Sans Pro", sans-serif`,np.measureText(s).width)),cr=class extends zt{constructor(e,i,n,r){super(e,[],n,m("text",{}));this.variant=r;this.setValue(i)}setValue(e){this.$element.text=this.value=e;let i=this.value.split("").every(r=>bg.includes(r));this.width=$g(e,this.equation.fontSize),this.height=(Ts-(i?.1:0))*this.equation.fontSize,this.baseline=this.height-ti*this.equation.fontSize;let n=this.type==="mtext"||this.variant==="normal";this.$element.setClass("font-normal",n||Ps(this.value))}get expr(){return this.value==="xx"?'"xx"':this.type==="mtext"?`"${this.value}"`:this.value}get log(){return`<${this.type}>${this.value}</${this.type}>`}get marginLeft(){if(this.type==="mo")return _a.has(this.value)?this.equation.isDisplay?.5:.35:_(this.value,"\u2221","\u25B3","!","%","\u2019")||_(this.value,"\u2026","\xB0")&&this.prev&&this.prev.type==="mn"?0:.25;if(this.type==="mi"){if(this.prev&&this.prev.type==="mn")return .1;if(this.prev&&this.prev.type==="mi")return .05;if(this.prev&&this.prev.type==="mfrac")return .15}return 0}get marginRight(){return this.type==="mo"?this.equation.isDisplay&&_a.has(this.value)?.5:_(this.value,"\u2221","\u25B3")?0:this.value==="\u2212"&&(!this.prev||_a.has(this.prev.value))?.1:.25:0}positionElement(e){if(!this.$element)return;let i=(this.equation.fontSize-this.baseline)*e.scale;this.$element.setTransform({x:e.x,y:e.y-i},0,e.scale)}drawElement(e,i,n,r,o){this.status==="adding"?this.$element.setAttr("opacity",e<.5?0:yt("cubic-in",e*2-1)):this.status==="deleting"&&this.$element.setAttr("opacity",e<.5?1-yt("cubic-in",2*e):0);let a=(1-o)*1.5+(this.equation.isBold?.9:0);this.$element.css("stroke-width",a+"px"),this.$element.css("color",this.color||"currentColor")}},Fa=class extends zt{constructor(t){super("mspace",[],t),this.height=(Ts-.1)*t.fontSize,this.baseline=this.height-ti*this.equation.fontSize,this.width=t.fontSize*.2}get expr(){return" "}},Ae=class extends zt{constructor(e,i,n,r=0){super("mrow",e,i);this.align=n;this.dx=r}addChildren(e,i=this.children.length){let n=[];for(let r of e)r.type==="mrow"?(n.push(...r.children),r.detach()):n.push(r);super.addChildren(n,i)}get expr(){return this.children.map(e=>e.expr).join(" ").replace(/− /,"\u2212")||"placeholder"}measure(e=1){if(super.measure(e),!this.children.length){this.height=this.width=this.baseline=0;return}this.baseline=Math.max(...this.children.map(n=>n.baseline)),this.height=this.baseline+Math.max(...this.children.map(n=>n.height-n.baseline));let i=0;for(let[n,r]of this.children.entries())r.setTransform(i,this.baseline-r.baseline),i+=r.width,n<this.children.length-1&&(i+=Math.max(r.marginRight,this.children[n+1].marginLeft)*this.equation.fontSize);if(this.align){let n=this.children.find(r=>r.expr===this.align);n&&(this.transform.x=this.dx-n.transform.x-n.width/2)}this.width=i}},qa=class extends zt{constructor(t){let e=t.fontSize,i=`M${.1*e} ${.3*e}h${e/2}v${e/2}h-${e/2}Z`,n=m("path",{class:"placeholder",d:i});super("placeholder",[],t,n),this.width=.7*e,this.height=Ts*e,this.baseline=this.height-ti*e}get expr(){return"placeholder"}get marginLeft(){return 0}get marginRight(){return 0}},Ha=class extends zt{constructor(t,e){super("mfrac",t,e,m("path"))}get expr(){return this.children.map(t=>ze(t)).join("/")}measure(t){let e=this.hasParent(a=>a.type==="mfrac"||a.type==="matrix"),i=Ba(t,!this.equation.isDisplay||e?.66:1),n=.1*this.equation.fontSize,[r,o]=this.children;super.measure(t*i),this.width=(Math.max(r.width,o.width)+2*n)*i,this.height=(r.height+o.height)*i,this.baseline=r.height*i+this.equation.fontSize*(Ts/2-ti),r.setTransform((this.width-r.width*i)/2,0,i),o.setTransform((this.width-o.width*i)/2,r.height*i,i)}drawElement(t,e,i,n){let r=n-this.equation.fontSize*(Ts/2-ti);this.setPath(`M0 ${r}h${e}`,t)}hitTestChildren(t){let{scale:e,y:i}=this.worldTransform,n=this.baseline-this.equation.fontSize*(Ts/2-ti),r=t.y<=i+n*e,o=this.children[r?0:1];return o.hitTestChildren(t)||o}},Bi=class extends zt{get expr(){let t=ze(this.children[0]);return this.type!=="msup"&&(t+="_"+ze(this.children[1])),this.type==="msup"&&(t+="^"+ze(this.children[1])),this.type==="msubsup"&&(t+="^"+ze(this.children[2])),t}measure(t){let[e,i,n]=this.children,r=this.type==="msup"?void 0:i,o=this.type==="msubsup"?n:this.type==="msup"?i:void 0,a=.05*this.equation.fontSize,h=Ba(t,.65);e.measure(t),r&&r.measure(t*h),o&&o.measure(t*h);let l=o?o.height*h-.4*this.equation.fontSize:0,c=r?r.height*h-.5*this.equation.fontSize:0,u=o?o.width:0,d=r?r.width:0;this.width=e.width+a+Math.max(u,d)*h,this.height=e.height+l+c,this.baseline=e.baseline+l,e.setTransform(0,this.baseline-e.baseline),o&&o.setTransform(e.width+a,0,h),r&&r.setTransform(e.width+a,this.height-r.height*h,h)}clean(){if(super.clean(),this.children=this.children.filter(t=>t.type!=="mrow"||t.children.length),this.children.length===0)return this.detach();this.children.length===1&&(this.insertAfter(this.children),this.detach())}},ja=class extends zt{get expr(){let t=this.children[0].expr;return this.type!=="munder"&&(t+="_"+ze(this.children[1])),this.type==="mover"&&(t+="^"+ze(this.children[1])),this.type==="munderover"&&(t+="^"+ze(this.children[2])),t}measure(t){super.measure(t)}},pr=class extends zt{constructor(t,e){super("mfenced",t,e,m("path"))}get expr(){return`(${this.children.map(t=>t.expr).join(",")})`}get marginLeft(){return .2}get marginRight(){return .2}measure(t){super.measure(t);let e=this.children[0];this.height=e.height+2,this.baseline=e.baseline+1;let i=1+this.height/this.equation.fontSize,n=.1*this.equation.fontSize;this.width=e.width+2*(i+n),e.setTransform(i+n,1)}drawElement(t,e,i){let n=Math.min(2+i/this.equation.fontSize,5),r=i-4,o=e-n,a=`M${n},2c${-2*n/3},${.15*r},${-n},${.32*r},${-n},${r/2}s${n/3},${.35*r},${n},${r/2}M${o},2c${2*n/3},${.15*r},${n},${.32*r},${n},${r/2}s${-n/3},${.35*r},${-n},${r/2}`;this.setPath(a,t)}clean(){super.clean(),this.children.length||this.detach()}},dr=class extends zt{constructor(t,e,i){super(t,e,i,m("path"))}get expr(){return`sqrt(${this.children.map(t=>t.expr).join(", ")})`}get marginLeft(){return .2}get marginRight(){return .2}measure(t){super.measure(t);let e=this.children[0];this.height=e.height+2,this.baseline=e.baseline+2;let i=Math.min(16,3+5*this.height/this.equation.fontSize),n=.05*this.equation.fontSize;this.width=e.width+i+2*n,e.setTransform(i+n,2)}drawElement(t,e,i){let n=Math.min(16,3+5*i/this.equation.fontSize),r=i-2,o=`M0,${.55*r}L${.18*n},${.51*r}L${.45*n},${r}L${n},2L${e},2`;this.setPath(o,t)}clean(){super.clean(),this.children.length||this.detach()}},Ua=class extends zt{constructor(e,i,n){super("matrix",e,i,m("g"));this.rows=n;this.cols=Math.floor(e.length/n)}get expr(){return`${this.children.map(e=>e.expr).join(", ")}`}measure(e){super.measure(e);let i=.6*this.equation.fontSize,n=z(a=>Math.max(...z(h=>this.children[a*this.cols+h].height,this.cols)),this.rows),r=z(a=>Math.max(...z(h=>this.children[h*this.cols+a].width,this.rows)),this.cols);this.height=N(n)+(this.rows-1)*i/2,this.width=N(r)+this.cols*i,this.baseline=(this.height+Ts*this.equation.fontSize)/2;let o=0;for(let a=0;a<this.rows;++a){let h=i/2;for(let l=0;l<this.cols;++l){let c=this.children[a*this.cols+l],u=h+(r[l]-c.width)/2,d=o+(n[a]-c.height)/2;c.setTransform(u,d),h+=r[l]+i}o+=n[a]+i/2}}},Wa=class extends zt{constructor(t,e){var i;super("foreign",[],e,m("g")),this.$body=m("div",{},e.$overlay),this.$body._el.append(t),this.$measure=m("span",{text:".",style:"font-size: 0"},this.$body),this.checkForResize(),this.$body.on("resize",()=>{this.checkForResize()&&this.equation.resize()}),(i=this.$body.$("x-blank, x-blank-mc"))==null||i.on("solve",n=>{Zt(()=>this.replace(n.solution,"#0f82f2"),n.restore?0:200)})}deleteFromDom(){var t;super.deleteFromDom(),(t=this.$body)==null||t.remove(),this.$body=void 0,this.$measure=void 0}replace(t,e){var r;let i=Number.isNaN(+t)?"mtext":"mn",n=new cr(i,t,this.equation);n.customColor=e,this.insertAfter([n]),(r=this.$body)==null||r.off("resize"),this.deleteFromDom(),this.equation.resize()}checkForResize(){var n,r;let t=this.height,e=this.width,i=this.baseline;return this.height=((n=this.$body)==null?void 0:n.height)||0,this.width=((r=this.$body)==null?void 0:r.width)||0,this.baseline=this.$measure.bounds.top-this.$body.bounds.top,!($(t,this.height)&&$(e,this.width)&&$(i,this.baseline))}positionElement(t){var e,i;(e=this.$body)==null||e.css({left:t.x+"px",top:t.y+"px"}),$(t.scale,1)||(i=this.$body)==null||i.css("transform",`scale(${t.scale})`)}get expr(){var t;return`"${(t=this.$body)==null?void 0:t.text}"`}get log(){return`<foreign>${this.expr}</foreign>`}};var Be=class extends Re{constructor(e,i,n=0,r="=",o=18,a=!0,h=!1){super();this.$row=e;this.$overlay=i;this.fontSize=o;this.isDisplay=a;this.isBold=h;this.isReady=!0;this.deletedNodes=new Set;this.root=new Ae([],this,r,n)}setValue(e){let i=Array.isArray(e)?e.map(n=>zt.create(n,this)):this.parse(e);for(;this.root.children.length;)this.root.children[0].deleteFromDom();this.root.addChildren(i),this.updateDescription(),this.resize()}updateDescription(){try{let e=Et.parse(this.root.expr).toVoice();this.$row.setAttr("aria-label",e)}catch(e){this.$row.setAttr("aria-label","Invalid expression: "+this.root.expr)}}resize(){this.root.measure(),this.root.render()}parse(e){var a;let i=new DOMParser,n=Et.parse(e).toMathML(),r=i.parseFromString(`<math>${n}</math>`,"text/xml");if(((a=r.firstChild)==null?void 0:a.nodeName)==="parsererror")throw new Error(r.firstChild.textContent);let o=r.firstChild.childNodes;return Array.from(o,h=>zt.create(h,this))}find(e){let[i,n]=e.split("`");i=i.replace(/[–-]/g,"\u2212");let r=+n||1,o=this.root.children.slice(0),a=0;for(;o.length;){let h=o.shift(),l=h instanceof Ae?void 0:sp(h,i);if(l&&(a+=1,a===r))return l;o.unshift(...h.children)}throw new Error(`Can't find element ${i}.`)}animate(e=1200){return D(this,null,function*(){this.isReady=!1,this.root.clean(),this.root.measure();let i=new lr;this.root.render(i),this.trigger("resize",{height:this.root.height});for(let n of this.deletedNodes)n.render(i);yield i.start(e);for(let n of this.deletedNodes)n.deleteFromDom();this.root.setStatus(""),this.deletedNodes.clear(),this.isReady=!0})}addTermAfter(e,i){let n=O(i?this.find(i):this.root.children),r=this.parse(e);n.insertAfter(r);for(let o of r)o.setStatus("adding");this.updateDescription()}addTermBefore(e,i){let n=i?this.find(i)[0]:this.root.children[0],r=this.parse(e);n.insertBefore(r);for(let o of r)o.setStatus("adding");this.updateDescription()}deleteTerm(e){for(let i of this.find(e))i.setStatus("deleting"),i.detach(),this.deletedNodes.add(i);this.updateDescription()}replaceTerm(e,i){let n=this.find(e),r=this.parse(i);n[0].insertBefore(r);for(let o of r)o.setStatus("adding");for(let o of n)o.setStatus("deleting"),o.detach(),this.deletedNodes.add(o);this.updateDescription()}moveTermAfter(e,i){let n=this.find(e);for(let o of n)o.roundedMotion=!0;O(i?this.find(i):this.root.children).insertAfter(n),this.updateDescription()}moveTermBefore(e,i){let n=this.find(e);for(let o of n)o.roundedMotion=!0;(i?this.find(i)[0]:this.root.children[0]).insertBefore(n),this.updateDescription()}moveTermToStart(e){let i=this.find(e);for(let n of i)n.roundedMotion=!0;this.root.children[0].insertBefore(i),this.updateDescription()}wrapTerms(e,...i){let n=i.map(o=>this.find(o));for(let o of n)for(let a of o)a.roundedMotion=!0;let r=this.parse(e);for(let o of r)o.setStatus("adding");n[0][0].insertBefore(r);for(let[o,a]of n.entries()){let h=this.find("$"+(o+1))[0];h.insertAfter(a),h.deleteFromDom()}this.updateDescription()}unwrapTerm(e,i=1){let n=this.find(e),r=n[0],o=1;for(;o<=i;)r=r.parent,r instanceof Ae&&(r=r.parent),o+=1;r.insertAfter(n),r.setStatus("deleting"),r.detach(),this.deletedNodes.add(r),this.updateDescription()}get leftSide(){let e=this.root.children.findIndex(i=>i.expr==="=");return this.root.children.slice(0,e-1)}get rightSide(){let e=this.root.children.findIndex(i=>i.expr==="=");return this.root.children.slice(e+1)}};var rp='<svg class="equation"><g></g></svg><div class="overlay"></div><div class="nav"><div class="btn back hide"><x-icon name="left"></x-icon></div><div class="btn next"><x-icon name="right"></x-icon></div></div><div class="legend-box"><slot></slot></div>';var op=1200,Pg=400,ap=1200,ei=600,_i=16,ur=class extends E{constructor(){super(...arguments);this.rows=[];this.isReady=!0;this.topOffset=4;this.currentHeight=0;this.currentStep=0;this.nextEvents={};this.backEvents={}}ready(){this.$svg=this.$("svg"),this.$lastRow=this.$svg.$("g"),this.$overlay=this.$(".overlay"),this.$legend=this.$(".legend-box"),this.$steps=this.$legend.$$("li"),this.$back=this.$(".back"),this.$next=this.$(".next");let e=+this.attr("dx")||0;this.equation=new Be(this.$lastRow,this.$overlay,e);let i=this.$(".math"),n=i?Array.from(i._el.children):[];this.equation.setValue(this.attr("expr")||n),this.currentHeight=this.topOffset+this.$lastRow.height+16,this.$svg.css("height",this.currentHeight+"px"),this.equation.on("resize",({height:o})=>{let a=this.topOffset+o+_i;Math.abs(a-this.currentHeight)<_i/2||(this.currentHeight=a,this.$svg.animate({height:a+"px"},ap))}),this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.$steps[0].show(),b.onResize(()=>{let o=this.$svg.width/2;for(let a of[this.$lastRow,this.$overlay])a.css("transform",`translate(${o}px, ${this.topOffset}px)`);for(let a of this.rows)a.$el.css("transform",`translate(${o}px, ${a.top}px)`)});let r=this.$overlay.$$("x-blank, x-blank-mc");r.length&&(this.$next.addClass("hide"),Promise.all(r.map(o=>o.onPromise("solve"))).then(()=>setTimeout(()=>this.goNext(),op)))}setup(e){this.one("next",({step:i})=>e.score("algebra-flow-"+(i-1)))}newRow(){return D(this,null,function*(){let e=this.$lastRow.copy(!0,!1),i=this.equation.root.height;this.rows.push({$el:e,height:i,top:this.topOffset}),this.$lastRow.insertBefore(e),b.redraw(),this.topOffset+=i+_i,this.currentHeight=this.topOffset+i+_i;for(let n of[this.$lastRow,this.$overlay])n.animate({transform:`translate(${this.$svg.width/2}px, ${this.topOffset}px)`},ei);yield this.$svg.animate({height:this.currentHeight+"px"},ei).promise})}hideLastRow(){return D(this,null,function*(){if(!this.rows.length)return;let e=this.rows.pop();this.topOffset=e.top;for(let i of[this.$lastRow,this.$overlay])i.animate({transform:`translate(${this.$svg.width/2}px, ${e.top}px)`},ei);this.currentHeight=e.top+this.$lastRow.height+_i,this.$svg.animate({height:this.currentHeight+"px"},ei),yield e.$el.exit("fade",ei/2,ei/2).promise,e.$el.remove()})}onNextStep(e){this.nextEvents=e}onBackStep(e){this.backEvents=e}goNext(){return D(this,null,function*(){if(!this.isReady||!this.equation.isReady||this.currentStep>=this.$steps.length-1)return;this.isReady=!1;let e=this.currentStep+1;this.$steps[e].hasClass("new-row")&&(yield this.newRow(),yield yi(Pg)),e in this.nextEvents&&(yield this.nextEvents[e](this.equation),yield this.equation.animate(ap),yield yi(op)),yield this.go(e),this.trigger("next",{step:e}),this.isReady=!0})}goBack(){return D(this,null,function*(){if(!this.isReady||!this.equation.isReady||this.currentStep<=0)return;let e=this.currentStep-1;this.isReady=!1,this.currentStep in this.backEvents&&(yield this.backEvents[this.currentStep](this.equation),yield this.equation.animate()),this.$steps[this.currentStep].hasClass("new-row")&&this.hideLastRow(),yield this.go(e),this.trigger("back",{step:e}),this.isReady=!0})}go(e){return D(this,null,function*(){this.$steps[e].show();let i=this.$steps[e].height+"px";this.$steps[e].hide(),this.$legend.animate({height:i},800).promise.then(()=>this.$legend.css("height","auto"));let n=this.currentStep;this.currentStep=e,this.trigger("step",e),yield this.$steps[n].exit("fade",400).promise,this.$back.setClass("hide",e<=0),this.$next.setClass("hide",e>=this.$steps.length-1),yield this.$steps[e].enter("fade",400).promise})}};ur=T([S("x-algebra-flow",{template:rp})],ur);var hp='<div class="input"><textarea></textarea></div><div class="math empty"><span class="cursor">&#8203;</span></div><div class="keys"><!-- TODO Make these buttons tabbable--><div class="btn" data-type="+">+</div><div class="btn" data-type="\u2212">\u2212</div><div class="btn" data-type="\xD7">\xD7</div><div class="btn" data-type="\xF7">\xF7</div><div class="btn i" data-type="\u03C0">\u03C0</div><div class="btn" data-type="frac"><x-icon name="fraction"></x-icon></div><div class="btn" data-type="sup"><x-icon name="power"></x-icon></div><div class="btn" data-type="sqrt"><x-icon name="sqrt"></x-icon></div><div class="btn" data-type="brackets"><x-icon name="brackets"></x-icon></div></div><div class="error"><x-icon name="warning"></x-icon></div><div class="error-message"></div>';function pp(s){let t=s.prev;t&&_(t.tagName,"MO","MI","MN")?t.insertBefore(s):t?O(t.children).append(s):s.parent.hasClass("math")||(s.parent.prev?s.parent.prev.append(s):s.parent.parent.insertBefore(s))}function Tg(s){let t=s.next;if(t&&_(t.tagName,"MO","MI","MN"))return t.insertAfter(s);t?t.children[0].prepend(s):s.parent.hasClass("math")||(s.parent.next?s.parent.next.prepend(s):s.parent.parent.insertAfter(s))}function Sg(s){let t=s.parent;for(;t.parent.tagName!=="MFRAC"||!t.prev;){if(t.hasClass("math"))return;t=t.parent}t.prev.append(s)}function Eg(s){let t=s.parent;for(;t.parent.tagName!=="MFRAC"||!t.next;){if(t.hasClass("math"))return;t=t.parent}t.next.prepend(s)}function Mg(s){let t=s.prev,e=s.parent;if(t&&_(t.tagName,"MO","MI","MN"))t.remove(),e.children.length<=1&&e.addClass("empty");else if(!t&&!e.prev&&!e.hasClass("math")){let i=e.parent;i.insertBefore(s);for(let n of i.children)for(let r of n.children)i.insertBefore(r);i.remove(),s.parent.children.length<=1&&s.parent.addClass("empty")}else pp(s)}function Ss(s,t){t.insertBefore(s),t.parent.removeClass("empty"),s.children.length&&s.children[0].append(t)}function lp(s,t){"abcdefghijklmnopqrstuvwxyz\u03C0".includes(t)?Ss(m("mi",{text:t}),s):"0123456789.".includes(t)?Ss(m("mn",{text:t}),s):"+\u2212\xB1\xD7\xF7<>\u2264\u2265=%!".includes(t)?Ss(m("mo",{text:t,value:t}),s):t==="frac"?Ss(m("mfrac",{html:'<mrow class="empty"></mrow><mrow class="empty"></mrow>'}),s):t==="sqrt"?Ss(m("msqrt",{html:'<mrow class="empty"></mrow>'}),s):_(t,"^","sup")?Ss(m("msup",{html:'<mrow class="empty"></mrow>'}),s):t==="brackets"||"([{|".includes(t)?Ss(m("mfenced",{html:'<mrow class="empty"></mrow>',type:"("}),s):")]}".includes(t)&&!s.next&&s.parent.parent.tagName==="MFENCED"&&s.parent.parent.insertAfter(s)}function cp(s,t){let e=s.$$(`${t}:first-child, *:not(${t}) + ${t}`);for(let i of e)if(i.parent.tagName!=="MFRAC")for(;i.next&&i.next.tagName===t.toUpperCase();)i.text+=i.next.text,i.next.remove()}var Cg="This is not a valid mathematical expression.",Ag="Fill in all empty placeholders in the expression.",kg={"+":"addition","\xD7":"multiplication","/":"fractions or division","\u2212":"subtraction",sqrt:"square roots","^":"powers"};function Es(s,t){if(s instanceof Text)return s.textContent||"";if(s.hasClass("cursor"))return"";let e=s.childNodes;return s.tagName==="MI"?s.text+(t?" ":""):s.tagName==="MFENCED"?"("+Es(e[0],t)+")":s.tagName==="MSUP"?"^("+Es(e[0],t)+")":s.tagName==="MFRAC"?`(${Es(e[0],t)})/(${Es(e[1],t)})`:s.tagName==="MSQRT"?"sqrt("+Es(e[0],t)+")":e.map(i=>Es(i,t)).join("")}function Vg(s,t){try{return{expr:Et.parse(s,!0,{variables:t})}}catch(e){return{error:e instanceof ot?e.message:Cg}}}function Ig(s,t,e){let i=s.variables;if(t.length){let n=i.find(o=>!t.includes(o));if(n){let o=Gh(n,e||t);return o?`Did you mean \u201C<em>${o}</em>\u201D instead of \u201C<em>${n}</em>\u201D?`:`There shouldn\u2019t be a variable called \u201C<em>${n}</em>\u201D.`}let r=t.find(o=>!i.includes(o));if(r)return`Your expression should contain \u201C<em>${r}</em>\u201D.`}}function Lg(s,t){if(t.length){let e=s.functions.find(i=>!t.includes(i));if(e)return`This expression should not contain ${kg[e]||"\u201C"+e+"\u201D"}.`}}function Og(s,t,e=.001){try{return $(s.evaluate(),t.evaluate(),e)}catch(i){return!1}}var fr=class extends E{constructor(){super(...arguments);this.isDone=!1;this.shortVar=!1;this.lastAttempt="";this.errorCount=0;this.hints=[];this.fns=[];this.vars=[];this.validate=void 0}ready(){if(this.$math=this.$(".math"),this.$textarea=this.$("textarea"),this.$cursor=this.$(".cursor"),this.$error=this.$(".error-message"),this.solution=Et.parse(this.attr("solution")),this.hasAttr("numeric")&&(this.numeric=+this.attr("precision")||.01),this.vars=this.hasAttr("vars")?K(this.attr("vars")):this.solution?this.solution.variables:[],this.hasAttr("fns")&&(this.fns=K(this.attr("fns"))),this.solution&&this.fns.push(...this.solution.functions),this.fns.includes("/")&&!this.fns.includes("\xD7")&&this.fns.push("\xD7"),this.hasAttr("hints")&&(this.hints=K(this.attr("hints"))),this.hasAttr("substitutions")){this.substitutions={},this.autocomplete=this.vars.slice(0);for(let n of this.attr("substitutions").split("|"))if(n.trim()){let[r,o]=n.split(":");this.autocomplete.push(r.trim()),this.substitutions[r.trim()]=Et.parse(o)}}for(let n of["solution","precision","vars","fns","vars-required","substitutions"])this.removeAttr(n);this.shortVar=this.hasAttr("short-var");let e=K(this.attr("keys")||"+ \u2212 \xD7 \xF7 frac sup sqrt brackets"),i=this.$(".keys");for(let n of i.children)e.includes(n.data.type)?(n.on("pointerdown",r=>r.preventDefault()),n.on("pointerup",()=>{lp(this.$cursor,n.data.type),this.check()})):n.remove();this.on("pointerdown",n=>this.onPointerdown(n)),this.$textarea.on("focus",()=>this.onPointerdown()),this.$textarea.on("blur",()=>this.onBlur()),this.$textarea.on("key",n=>this.handleKey(n))}setup(e,i,n){var r;this.$step=e,(r=n==null?void 0:n.scores)!=null&&r.includes(i)&&this.solve(),this.on("solve",()=>{e.addHint("correct"),e.score(i)})}focus(){this.trigger("pointerdown")}onPointerdown(e){if(this.isDone)return;e&&e.preventDefault&&e.preventDefault(),this.addClass("active"),this.$textarea.focus();let i=e&&e.target?k(e.target):this;if(i.tagName==="X-EQUATION"||i.hasClass("math")){let n=this.$math.children,r=N(n.map(a=>a.outerWidth))/2;(e?It(e).x<this.$math.bounds.left+r:!0)?this.$math.prepend(this.$cursor):this.$math.append(this.$cursor)}else if(i.tagName[0]==="M"){let n=It(e).x<i.boxCenter.x;i.tagName==="MROW"?n?i.prepend(this.$cursor):i.append(this.$cursor):n?i.insertBefore(this.$cursor):i.insertAfter(this.$cursor)}}handleKey(e){let i=Mi(e);if(_(i,"Enter","Escape"))this.$textarea.blur();else if(i==="ArrowLeft")pp(this.$cursor);else if(i==="ArrowRight")Tg(this.$cursor);else if(i==="ArrowUp")Sg(this.$cursor);else if(i==="ArrowDown")Eg(this.$cursor);else if(_(i,"Backspace","Delete"))Mg(this.$cursor),this.check();else{let n=e.key.replace("*","\xD7").replace("/","\xF7").replace("-","\u2212");lp(this.$cursor,n),this.check()}}onBlur(){if(this.isDone)return;if(!this.value)return this.removeClass("active has-error");if(this.removeClass("active"),this.addClass("has-error"),this.value===this.lastAttempt||(this.lastAttempt=this.value,!this.$step))return;let e=this.error||(this.hints||[]).shift()||"incorrect",i=this.$step.addHint(e,{class:"incorrect"});this.$error.html=(i==null?void 0:i.text)||"",this.errorCount+=1,this.trigger("error",{count:this.errorCount,msg:e}),this.errorCount>=5&&this.$step.addHint(`Hmmm\u2026 maybe try ${this.solution.toMathML()}?`)}check(){if(this.error=void 0,this.value=Es(this.$math,this.shortVar).trim(),!this.value)return;if(this.$math.$(".empty"))return this.error=Ag;let e=Vg(this.value,this.vars);if(e.error)return this.error=e.error;let i=this.substitutions?e.expr.substitute(this.substitutions):e.expr;if(this.numeric&&Og(this.solution,i,this.numeric))return this.solve();if(this.validate){let o=this.validate(e.expr)||{};if(o.isCorrect)return this.complete(e.expr);if(o.error)return this.error=o.error}if(this.solution&&Et.numEquals(this.solution,i))return this.complete(e.expr);let n=Ig(i,this.vars,this.autocomplete);if(n)return this.error=n;let r=Lg(i,this.fns);if(r)return this.error=r}complete(e){this.isDone||(this.isDone=!0,this.removeClass("has-error active"),this.addClass("done"),this.$textarea.blur(),this.shortVar||cp(this.$math,"mi"),cp(this.$math,"mn"),this.trigger("solve",{expr:e}))}solve(){this.$math.removeClass("empty"),this.$math.html=this.solution.toMathML(),this.complete(this.solution)}};fr=T([S("x-equation",{template:hp})],fr);var Rg={opacity:[0,1],transform:["translateX(-50px)","none"]},Dg={error:"You\u2019ve already had this expression before. Try simplifying it."},Ng="You have to fully simplify this expression. The correct solution is $0.",mr=class extends E{constructor(){super(...arguments);this.rowCount=1;this.previousAnswers=[];this.isSolved=!1;this.maxRows=6;this.steps=[];this.hints=[]}created(){this.$table=this.$("table tbody"),this.lastRowContent=this.$table.$("tr:last-child").html}ready(){this.hasAttr("max-rows")&&(this.maxRows=+this.attr("max-rows")),this.hasAttr("steps")&&(this.steps=this.attr("steps").split("|")),this.hasAttr("hints")&&(this.hints=this.attr("hints").split("|")),this.removeAttr("steps"),this.removeAttr("hints"),this.setupEquation(this.$("x-equation"))}setup(e,i,n){var r;this.$step=this.$equation.$step=e,(r=n==null?void 0:n.scores)!=null&&r.includes(i)&&this.solve(),this.on("solve",()=>{e.addHint("correct"),e.score(i)}),this.on("hint",o=>e.addHint(o))}setupEquation(e){this.$equation=e,this.$equation.$step=this.$step,e.one("solve",i=>this.onSolveRow(i.expr)),e.hints=this.hints,e.validate=i=>{let n=this.previousAnswers.includes(i.toString());return(this.validate?this.validate(i,n):void 0)||(n?Dg:{})}}onSolveRow(e){if(this.trigger("solve-row",{expr:e,$math:this.$equation.$math}),this.isFinal&&this.isFinal(e))return this.trigger("solve");if(this.isSolved)return;if(this.rowCount+=1,this.previousAnswers.push(e.toString()),this.rowCount>this.maxRows){let n=this.$equation.solution.toMathML();this.trigger("hint",Ng.replace("$0",n)),this.trigger("solve")}let i=m("tr",{html:this.lastRowContent},this.$table);i.animate(Rg,400,500),this.setupEquation(i.$("x-equation")),setTimeout(()=>this.$equation.focus(),1200)}solve(){if(this.isSolved=!0,this.steps.length){let e=this.$table.$("tr:last-child"),i=this.lastRowContent.replace(/<x-equation.*<\/x-equation>/,'<span class="math fill"></span>');for(let n of this.steps){let r=m("tr",{html:i},this.$table),o=r.$(".math.fill"),a=Et.parse(n);o.html=a.toMathML(),e.insertBefore(r),this.trigger("solve-row",{expr:a,$math:o})}}this.$equation.solve()}};mr=T([S("x-equation-system")],mr);var Xa=Math.PI/2;function gr(s){if(rt(s))return[s];if(St(s))return s.points;if(it(s))return[s.p1,s.p2];if(Ft(s))return gr(s.shape(!0));if(U(s))return[s.c.shift(s.r,0),s.c.shift(-s.r,0),s.c.shift(0,s.r),s.c.shift(0,-s.r)];if(Ze(s))return s.extremes;if(Pe(s)||Nt(s)){let t=[s.start,s.end];Pe(s)&&t.push(s.c);let e=s.radius;for(let[i,n]of[[e,0],[0,e],[-e,0],[0,-e]]){let r=s.c.shift(i,n);qt.prototype.contains.call(s,r)&&t.push(r)}return t}return[]}function Lt(...s){return G.aroundPoints(function*(){for(let t of s)for(let e of gr(t))yield e}())}function dp(s,t){let e=Lt(...Array.from(s,n=>n.transformed.rotate(-t))),i=e.p.shift(e.w/2,e.h/2).rotate(t).shift(-e.w/2,-e.h/2);return new G(i,e.w,e.h)}function Fi(s,t,e){if(!s.size&&!t.size)return new lt(0,100,0,100);let i=[...s.values()].every(r=>r.props.status==="hidden"),n=e||i;return G.aroundPoints(function*(){for(let r of s.values())if(r.transformed&&(r.props.status!=="hidden"||n))for(let o of gr(r.transformed))yield o;for(let r of t.values())if(r.path)for(let o of gr(r.path))yield o}()).bounds}function qi(s,t,e){if(rt(t))return s.contains(t);if(Ye(t))return V.collision(s.polygon,t);if(Uo(t))return t.collision(s);if(it(t))return Q(t,s).length>0||s.contains(t.p1);if(Ft(t))return qi(s,t.shape(!0),e);if(U(t))return e==="geo"?Q(t,s).length>0||s.contains(t.at(0)):t.collision(s);if(Pe(t)||Nt(t)){let i=new V(t.c,t.start,t.at(.25),t.at(.5),t.at(.75),t.end);return V.collision(s.polygon,i)}if(Ze(t)){let i=new V(...oe(0,1,.125).map(n=>t.at(n)));return V.collision(s.polygon,i)}return!1}var vr=class{constructor(t){this.$parent=t;this.visible=!1;this.$el=m("div",{class:"tile-error",hidden:!0},t.$html),this.$text=m("span",{},this.$el),this.$button=m("button",{text:"Select Errors"},this.$el),this.$button.on("click",()=>{t.selection.clear(),this.error&&t.selection.select(this.error.locations||[]),this.hide()})}show(t,e){var i;this.visible&&this.error===e||(this.visible=!0,this.$el.setTransform(t),this.$text.html=e.message,this.$button.toggle(!!((i=e==null?void 0:e.locations)!=null&&i.length)),this.$el.enter("pop",200),this.error=e)}hide(){this.visible&&(this.visible=!1,this.$el.exit("pop",200),this.error=void 0)}},Ka=new Map;function _e(s,t=!0){if(!s||!t||!b.theme.isDark)return s;if(Ka.has(s))return Ka.get(s);let e=$t.fromHex(s),i=e.hsl;nt(i[2],30,70)||(i[2]=100-i[2]);let n=$t.fromHsl(...i);n.a=e.a;let r=n.hex;return Ka.set(s,r),r}var wr=Oe(s=>{let t=$t.fromHex(s),[e,i,n]=["r","g","b"].map(o=>t[o]<=128?0:2*t[o]-255);return new $t(e,i,n).hex}),yr=Oe(s=>$t.from(s).brightness<195?"#fff":"#000");function up(s){let t=s==null?void 0:s.items;if(t!=null&&t.length)for(let e=0;e<t.length;++e){if(!t[e].type.startsWith("image/"))continue;let i=t[e].getAsFile();if(i)return i}}var Gg=80,zg=[5,2,1];function Ya(s,t,e,i=.01){let n=s?s.split(","):[];if(n.length===3)return n.map(d=>+d);let r=n.length>0?+n[0]:e?e[0]:0,o=n.length>1?+n[1]:e?e[1]:t;if($(r,o))return[r-1,o+1,1];i&&(o+=.01*(o-r));let a=Math.floor(Math.abs(t)/Gg),h=(o-r)/a,l=Math.floor(Math.log10(h)),c=Math.pow(10,l),u=zg.find(d=>c*d<=h)*c;return o=u*Math.ceil(o/u),r=u*Math.floor(r/u),[r,o,u]}function br(s,t=4e3){let e=k(`x-alert[key=${s}]`);return e==null?void 0:e.open(t)}function fp(s,t){let e=new p(-s/2,-t/2);return new G(e,s,t)}function Za(s,t,e){if(!s)return;let i={},n=0;for(let r of s){let o=t(r);if(o&&(i[r.id]=o,n+=1),e&&n>e)break}return n?i:void 0}function mp(s,t,e,i,n){return m("use",{href:`/icons.040bc2f9.svg#${s}`,fill:t,width:e,height:e,x:i==null?void 0:i.x,y:i==null?void 0:i.y},n)}function gp(s=0){return 20*1.2**s}function*ke(s,t=!1){for(let e of s){let i=e.is("group");(!i||t)&&(yield e),i&&(yield*Vs(ke(e.children,t)))}}function*vp(s){let t=new Set;for(let e of s)if(e.group){let i=e.group;for(;i.group;)i=i.group;if(t.has(i))continue;t.add(i),yield i}else yield e}function Qa(s){let t=Math.min(...s.map(i=>Math.min(...i.map(n=>n.y)))),e=Math.max(...s.map(i=>Math.max(...i.map(n=>n.y))));return[t,e]}function Ve(s,t,e){return s.hasAttr(t)?s.attr(t)!=="no":e}function wp(s){let t=K(s).map(e=>+e);return t.length===1?[t[0],t[0],t[0],t[0]]:t.length===2?[t[0],t[1],t[0],t[1]]:t.length===3?[t[0],t[1],t[2],t[1]]:t}function yp(s){let t=s.split(",");return[t[0]!=="no",(t.length>1?t[1]:t[0])!=="no"]}var bp={hasGeoModel:!0,pi:Math.PI,point:(s,t)=>s!==void 0&&t!==void 0?new p(s,t):void 0,angle:(s,t,e)=>s&&t&&e?new Vt(s,t,e):void 0,line:(s,t)=>s&&t&&!s.equals(t)?new vt(s,t):void 0,ray:(s,t)=>s&&t&&!s.equals(t)?new Ko(s,t):void 0,segment:(s,t)=>s&&t&&!s.equals(t)?new Y(s,t):void 0,circle:(s,t)=>s&&t?new wt(s,t):void 0,arc:(s,t,e)=>s&&t&&e?new qt(s,t,e):void 0,sector:(s,t,e)=>s&&t&&e?new Xo(s,t,e):void 0,polygon:(...s)=>s.every(t=>t)?new V(...s):void 0,polyline:(...s)=>s.every(t=>t)?new te(...s):void 0,triangle:(s,t,e)=>s&&t&&e?new Ti(s,t,e):void 0,rectangle:(s,t,e)=>s?new G(s,t,e):void 0,distance:p.distance,round:(s,t=0)=>Dt(s,t),sqrt:Math.sqrt,floor:Math.floor,ceil:Math.ceil,intersections:Q};function xr(s,t,e){let i=e,n;for(let r of s){let o=t(r);o!==void 0&&o<i&&(i=o,n=r)}return n}function xp(s,t){t.clear();for(let e of s)if(!(e.isHidden||!e.value))for(let i of s){if(e.isHidden||!i.value||e===i)continue;let n=Q(e.value,i.value);for(let[r,o]of n.entries())t.add({path1:e,path2:i,posn:o,index:r})}}var $p="M100,50h0l-5.2-4.9L52.6,10.2v-9C52.6.6,51.4,0,50,0s-2.6.6-2.6,1.2v9L5.2,45.1,0,50H0l6.6-3L35,25.9H65L93.4,47ZM38.4,23.5,50,14.8l11.6,8.7Z",Pp="M0,0V8H100V0ZM7,6A2,2,0,1,1,9,4,2,2,0,0,1,7,6Z";function Ms(s,t,e,i){return`translate(${s.x}px, ${s.y-t}px) scale(${i/100}) rotate(${e}rad)`}var Tp=4,Bg=`<marker id="axis-arrow" refX="3" refY="3" markerWidth="6"
    markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"/></marker>`,is=class extends E{constructor(){super(...arguments);this.labelSuffix=["",""];this.gridSize=[1,1];this.showGrid=!1;this.showXAxis=!1;this.showYAxis=!1;this.showLabels=!1}setupCoordinates(e,i={}){this.$svg=e,e.addClass("canvas"),this.proportional=!!i.proportional,this.padding=wp(this.attr("padding")||i.padding||"0"),Ve(this,"grid",i.showGrid||!1)&&(this.$grid=m("g",{class:"grid"}),e.prepend(this.$grid),this.showGrid=!0);let n=this.attr("axes")||(i.showAxes?"yes":"no");[this.showXAxis,this.showYAxis]=yp(n),(this.showXAxis||this.showYAxis)&&(m("defs",{html:Bg},e),this.$axes=m("g",{class:"axes"}),e.prepend(this.$axes),this.axisNames=(this.attr("axis-names")||",").split(",")),this.$axes&&Ve(this,"labels",!0)&&(this.labelSuffix=(this.attr("label-suffix")||",").split(","),this.showLabels=!0),(this.showLabels||this.axisNames)&&(this.$labels=m("g",{class:"labels"},e)),this.resize()}resize(){this.css("max-width","none");let e=+this.attr("width")||this.width,i=+this.attr("height")||(this.hasAttr("width")?e:this.height);this.css("max-width",e+"px"),this.$svg.setAttr("width",e),this.$svg.setAttr("height",i),this.$svg.setAttr("viewBox",`0 0 ${e} ${i}`);let n=this.padding;this.viewportBounds=new lt(n[3],e-n[1],n[0],i-n[2]),this.updatePlotBounds(),this.positionElements(e,i)}updatePlotBounds(e){let[i,n,r]=Ya(this.attr("x-axis"),this.viewportBounds.dx,e==null?void 0:e.xRange),[o,a,h]=Ya(this.attr("y-axis"),this.viewportBounds.dy,e==null?void 0:e.yRange),l=Math.abs(this.viewportBounds.dx/(n-i)),c=Math.abs(this.viewportBounds.dy/(a-o)),u=Math.min(l,c),d=this.proportional?l/u:1,g=this.proportional?c/u:1;this.plotBounds=new lt(d*i,d*n,g*a,g*o),this.plotScale=this.proportional?u:(l+c)/2,this.gridSize=[r,h];let[y,f]=[this.plotBounds,this.viewportBounds];this.plotToViewportMatrix=[[f.dx/y.dx,0,f.xMin-y.xMin/y.dx*f.dx],[0,f.dy/y.dy,f.yMin-y.yMin/y.dy*f.dy]];let v=i>0?d*i:n<0?d*n:0,w=o>0?g*o:a<0?g*a:0;this.plotOrigin=new p(v,w),this.drawAxes()}drawAxes(){let[e,i]=[this.plotBounds,this.viewportBounds],n=this.toViewportCoords(this.plotOrigin),[r,o]=this.gridSize;if(this.$grid&&this.$grid.removeChildren(),this.$axes&&this.$axes.removeChildren(),this.$labels&&this.$labels.removeChildren(),this.showGrid||this.showXAxis){let a=r*Math.trunc(e.xMin/r+.01);for(let h=a;h<e.xMax;h+=r){if(this.showYAxis&&h===this.plotOrigin.x)continue;let l=this.toViewportCoords(new p(h,0)).x;this.showGrid&&m("line",{x1:l,y1:i.yMin,x2:l,y2:i.yMax},this.$grid),this.showLabels&&this.makeLabel(0,h,l,n)}}if(this.showGrid||this.showYAxis){let[a,h]=e.yMin<e.yMax?[e.yMin,e.yMax]:[e.yMax,e.yMin],l=o*Math.trunc(a/o+.01);for(let c=l;c<h;c+=o){if(this.showXAxis&&c===this.plotOrigin.y)continue;let u=this.toViewportCoords(new p(0,c)).y;this.showGrid&&m("line",{x1:i.xMin,y1:u,x2:i.xMax,y2:u},this.$grid),this.showLabels&&this.makeLabel(1,c,u,n)}}this.showXAxis&&(this.$xAxis=m("line",{x1:i.xMin,x2:i.xMax,y1:n.y,y2:n.y},this.$axes)),this.showYAxis&&(this.$yAxis=m("line",{x1:n.x,x2:n.x,y1:i.yMax,y2:i.yMin},this.$axes)),this.showLabels&&this.showXAxis&&this.showYAxis&&(e.xMin===0&&e.yMax===0&&!this.labelSuffix[0]&&!this.labelSuffix[1]?m("text",{text:0,x:n.x-5,y:n.y+15,"text-anchor":"end"},this.$labels):e.yMax===this.plotOrigin.y?this.makeLabel(0,this.plotOrigin.x,n.x,n):this.makeLabel(1,this.plotOrigin.y,n.y,n)),this.axisNames&&(this.axisNames[0]&&m("text",{text:this.axisNames[0],x:this.viewportBounds.xMax-2,y:n.y-12,"text-anchor":"end"},this.$labels),this.axisNames[1]&&m("text",{text:this.axisNames[1],x:n.x+10,y:this.viewportBounds.yMin+5},this.$labels))}makeLabel(e,i,n,r){let o=this.labelSuffix[e],a=o==="i"?new Xh(0,i).toString():Rt(i,4)+o;m("text",{text:a,x:e?r.x-8:n,y:e?n+4:r.y+18,"text-anchor":e?"end":"middle"},this.$labels),m("line",{class:"tick",x1:e?r.x:n,y1:e?n:r.y,x2:e?r.x-Tp:n,y2:e?n:r.y+Tp},this.$axes)}positionElements(e,i){for(let n of this.$$("[data-bounds]")){let r=n.data.bounds.split(","),o=this.toViewportCoords(new p(+r[3],+r[0])),a=this.toViewportCoords(new p(+r[1],+r[2]));n.css({left:`${o.x/e*100}%`,top:`${o.y/i*100}%`,width:`${(a.x-o.x)/e*100}%`,height:`${(a.y-o.y)/i*100}%`})}}toPlotCoords(e){return e.changeCoordinates(this.viewportBounds,this.plotBounds)}toViewportCoords(e){return e.transform(this.plotToViewportMatrix)}};var $r=class extends is{constructor(){super(...arguments);this.steps=400}ready(){let e=m("svg",{},this),i=m("g",{class:"plot"},e);this.$path=m("path",{},i),this.setupCoordinates(e,{showGrid:!0,showAxes:!0,padding:"20"}),this.clear();let n=this.viewportBounds,r=this.steps/n.dx,o;us(e,{start:()=>o=void 0,move:a=>{let h=B(Math.round((a.x-n.xMin)*r),0,this.steps-1);this.points[h]=this.toPlotCoords(new p(n.xMin+h/r,a.y)),o&&this.interpolate(o,h),o=h,this.redraw()},end:()=>this.snap()})}interpolate(e,i){i<e&&([e,i]=[i,e]);let n=this.points[e],r=this.points[i];for(let o=e+1;o<i;++o)this.points[o]=p.interpolate(n,r,(o-e)/(i-e))}redraw(){let e="",i=!0;for(let n of this.points){if(n){let r=this.toViewportCoords(n);e+=(i?"M":"L")+`${r.x},${r.y}`}i=!n}this.$path.setAttr("d",e)}snap(){let e=this.points.filter(n=>n).map(n=>[n.x,n.y]),i=_o.bestPolynomial(e);if(i){for(let n=0;n<this.steps;++n){if(!this.points[n])continue;let r=this.plotBounds.xMin+n/this.steps*this.plotBounds.dx;this.points[n]=new p(r,i.fn(r))}this.redraw(),this.trigger("snap",{regression:i})}}clear(){this.points=re(void 0,this.steps),this.$path.setAttr("d","")}};$r=T([S("x-coordinate-sketch")],$r);var _g=2,Sp=5e3,Pr=class extends is{constructor(){super(...arguments);this.isAnimated=this.hasAttr("animate");this.crosshairGrid=10;this.getCrosshairPosn=e=>e}ready(){let e=m("svg",{},this);if(this.$plot=m("g",{class:"plot"},e),this.$overlay=m("g",{class:"overlay"},e),this.setupCoordinates(e,{showGrid:!0,showAxes:!0,padding:"20"}),this.hasAttr("fn")){let i=Et.parse(this.attr("fn"),!0);this.setFunctions(n=>i.evaluate({x:n}))}Ve(this,"crosshairs",!0)&&(this.crosshairGrid=+this.attr("crosshair-grid")||10,this.setupCrosshairs(e))}setPoints(e,i=1){let n=e.map((r,o)=>new p(o+i,r));this.setSeries(n)}setSeries(...e){let i=Math.max(...e.map(o=>O(o).x)),[n,r]=Qa(e);this.updatePlotBounds(new lt(0,i,n,r)),this.$plot.removeChildren();for(let o of e)this.drawLinePlot(o);this.getCrosshairPosn=o=>e[0].reduce((a,h)=>Math.abs(h.x-o.x)<=Math.abs(a.x-o.x)?h:a)}setFunctions(...e){let[i,n]=[this.plotBounds,this.viewportBounds],r=e.map(l=>{let c=[];for(let u=n.xMin;u<n.xMax;u+=_g){let d=this.toPlotCoords(new p(u,0)).x;c.push(new p(d,l(d)))}return c}),[o,a]=Qa(r);this.updatePlotBounds(new lt(i.xMin,i.xMax,o,a)),this.$plot.removeChildren();for(let l of r)this.drawLinePlot(l);let h=this.gridSize[0]/this.crosshairGrid;this.getCrosshairPosn=l=>{let c=Pt(B(l.x,i.xMin,i.xMax),h);return new p(c,e[0](c))}}drawLinePlot(e){let i=m("g",{},this.$plot),n=m("path",{},i),r=this.plotBounds;e=e.filter(a=>a.y>=r.yMax&&a.y<=r.yMin);let o=e.map(a=>this.toViewportCoords(a));this.isAnimated?pt(a=>{let h=e.findIndex(l=>l.x>r.xMin+a*r.dx);n.points=o.slice(0,h)},Sp):n.points=o}drawPoints(e){let i=m("g",{},this.$plot),n=this.plotBounds;for(let r of e){let o=this.toViewportCoords(r),a=m("circle",{r:4,cx:o.x,cy:o.y},i);if(this.isAnimated){a.hide();let h=Sp*(r.x-n.xMin)/(n.xMax-n.xMin);setTimeout(()=>a.show(),h)}}}setupCrosshairs(e){let i=m("g",{class:"crosshair"},e),n=m("path",{},i),r=m("circle",{r:4},i),o=m("text",{},i),a=0,h=l=>{let c=this.getCrosshairPosn(this.toPlotCoords(l));if($(c.x,a))return;a=c.x;let u=this.toViewportCoords(c),d=this.toViewportCoords(this.plotOrigin);r.setCenter(u),n.points=[new p(d.x,u.y),u,new p(u.x,d.y)],o.text=`(${Rt(c.x,5,!1)}, ${Rt(c.y,5,!1)})`;let g=o.width,y=u.x+8+g<this.viewportBounds.dx;o.setAttr("x",y?u.x+5:u.x-g-5),o.setAttr("y",u.y>20?u.y-7:u.y+18)};kl(e,{enter:()=>i.show(),move:l=>h(l),exit:()=>i.hide()})}};Pr=T([S("x-coordinate-system")],Pr);var si=class{constructor(t,e){this.$canvas=t;this.defaultCallbacks=e;this.callbacks=new WeakMap;this.global=[];this.isMoving=!1;this.shiftKey=!1;this.altKey=!1;this.cancelled=!1;document.addEventListener("keydown",i=>this.checkKeys(i)),document.addEventListener("keyup",i=>this.checkKeys(i)),document.addEventListener("visibilitychange",()=>{this.shiftKey=this.altKey=!1}),this.$root=Xt,t.css("touch-action","none"),t.on("pointerdown",i=>this.startEvent(i)),C.onKey("Escape",()=>this.cancel()),e.hover&&t.on("pointermove",i=>{this.isMoving||e.hover({posn:me(i,t),event:i,target:i.target})})}checkKeys(t){this.shiftKey=t.shiftKey,this.altKey=t.altKey}listen(t,e){this.callbacks.set(t._el,e),t.hasParent(this.$canvas)||(t.css("touch-action","none"),t.on("pointerdown",i=>this.startEvent(i)))}listenAll(t){this.global.push(t)}startEvent(t){var d,g,y;if(t.handled||t.button)return;this.isMoving=!0,this.cancelled=!1,t.preventDefault(),this.checkKeys(t);let e=t.pointerId,i=t.target,n=this.getCallbacks(i);"shiftKey"in t&&(this.shiftKey=t.shiftKey),n.blurInput!==!1&&((d=b.getActiveInput())==null||d.blur());let r=me(t,this.$canvas),o=r,a=!1,h;if(this.constrainInBox){let f=this.$canvas.boundsRect;h=new lt(f.p.x,f.p.x+f.w,f.p.y,f.p.y+f.h)}let l=f=>{var x,I,A,M;if(f.pointerId&&f.pointerId!==e)return;if(f.preventDefault(),this.checkKeys(f),this.cancelled)return c(f);let v=It(f);if(h&&(v=v.clamp(h)),v=v.transform(this.$canvas.inverseTransformMatrix),p.distance(v,o)<.5)return;if(!a){let P={posn:r,event:f,target:i};(x=n.start)==null||x.call(n,P);for(let j of this.global)(I=j.start)==null||I.call(j,P)}let w={posn:v,startPosn:r,lastPosn:o,event:f,target:i};(A=n.move)==null||A.call(n,w);for(let P of this.global)(M=P.move)==null||M.call(P,w);!a&&n.cursor!==!1&&this.grabbing(),o=v,a=!0},c=f=>{var w,x,I,A,M,P;if(f.pointerId&&f.pointerId!==e)return;f.preventDefault(),this.checkKeys(f),C.off("pointermove",l),C.off("pointerstop",c);let v={posn:r,event:f,target:i};(w=n.up)==null||w.call(n,v);for(let j of this.global)(x=j.up)==null||x.call(j,v);if(a){let j={posn:o,lastPosn:o,startPosn:r,event:f,cancelled:this.cancelled,target:i};(I=n.end)==null||I.call(n,j);for(let ne of this.global)(A=ne.end)==null||A.call(ne,j)}else if(!this.cancelled){(M=n.click)==null||M.call(n,v);for(let j of this.global)(P=j.click)==null||P.call(j,v)}this.grabbing(!1),this.isMoving=this.cancelled=!1},u={posn:r,event:t,target:i};(g=n.down)==null||g.call(n,u);for(let f of this.global)(y=f.down)==null||y.call(f,u);C.on("pointermove",l),C.on("pointerstop",c)}grabbing(t=!0){this.$root.setClass("grabbing",t)}getCallbacks(t){for(;t&&t!==this.$canvas._el;){let e=this.callbacks.get(t);if(e&&(!e.checkIfActive||e.checkIfActive()))return e;t=t.parentNode||void 0}return this.defaultCallbacks}cancel(){this.cancelled=!0}};function Fg(s,t){if(typeof s=="string"){let e=ct(s);return i=>{var n;return(n=e(t))==null?void 0:n.equals(i)}}return typeof s=="function"?s:e=>s.equals(e)}function Ja(s,t,e){let i=t.map(g=>Fg(g,s.model)),n=re(void 0,t.length),r=Ke(),o=[],a=({point:g})=>o.push(g),h=e.maxErrors||4,l=0,c=({path:g})=>{e.onBegin&&e.onBegin(g)},u=()=>{n.every(g=>g)&&(e.onComplete&&e.onComplete(!0),s.off("add:path",d),s.off("begin:path",c),s.off("add:point",a),r.resolve(n))},d=({path:g})=>{let y=g.value;if(y){for(let[f,v]of i.entries())if(!n[f]&&v(y))return n[f]=g,e.onCorrect&&e.onCorrect(g,f),l=0,o=[],u();g.delete();for(let f of o)f.delete();if(o=[],!(it(y)&&y.length<1))if(l+=1,l>=h){let f=n.findIndex(w=>!w),v=t[f];if(typeof v!="function"){let w=s.drawPath(v,{animated:1e3});n[f]=w,e.onHint&&e.onHint(w,f),l=0,u()}}else e.onIncorrect&&e.onIncorrect(g)}};return s.on("begin:path",c),s.on("add:path",d),s.on("add:point",a),r.promise}function Cp(s,t){return m("text",{target:s.attr("target")||void 0,class:s.attr("label-class")||s.attr("class")||void 0,"data-when":s.data.when,style:t?`color: ${t}`:void 0,"text-anchor":"middle"})}function Ep(s,t){let e=[];for(let i of t.paths)i!==s&&i.value&&e.push(i.value.transform(t.plotToViewportMatrix));return e}var qg=new wt(new p(0,-9),12);function Mp(s,t,e){for(let i of e)if(t.every(n=>!Q(qg.translate(i),n).length))return i;return e[0]}function Ap(s,t){let e=s.value.transform(t.plotToViewportMatrix),i=s.$el;if(it(e)){let n=e.perpendicularVector,r=e.angle;n.y>=0&&(n=n.scale(-1),r+=Math.PI);let o=[];for(let l of[.5,.35,.65])for(let c of[-15,5])o.push(e.at(l).add(n.scale(c)));if(!t.labelPositioning)return[o[0],r];let a=Ep(s,t),h=Mp(e,a,o);return i.hasAttr("mark")&&(h=h.add(e.unitVector.scale(12))),[h,r]}if(Pe(e))return[e.at(.5).subtract(e.c).scale(.6).add(e.c).shift(0,5)];if(Nt(e)){let n=new vt(e.start,e.end),r=n.perpendicularVector.y>=0,o=n.angle+(r?Math.PI:0);return[e.at(.5).add(n.perpendicularVector.scale(r?14:5)),o]}if(Ft(e)){let n=(+i.attr("size")||(e.isRight&&!i.hasAttr("round")?20:e.radius))+8;return[e.b.add(e.bisector.unitVector.scale(n+5)).shift(0,3)]}if(rt(e)){let n=i.hasClass("move")?10:8,r=[e.shift(n,-n),e.shift(-n,-n),e.shift(n,10+n),e.shift(-n,10+n)];if(!t.labelPositioning)return[r[0]];let o=Ep(s,t);return[Mp(e,o,r)]}return St(e)?[e.centroid.shift(0,5)]:U(e)?[e.c.shift(0,5)]:[]}var Tr=class{constructor(t,e,i,n){this.$parent=t;this.$el=i;this.color="";this.label="";this.isPending=!1;this.isLocked=!1;this.components=[];this.dependencies=[];this.fixedLabel=!1;this.name=n||t.model.getKey(),t.shapes.set(this.name,this),t.model.watch(r=>{let o=r[this.name];this.$el.css("display",o?"block":"none"),this.$label&&this.$label.css("display",o?"block":"none"),o&&this.redraw(o),t.queueLabelPositioning()}),this.color=i.css("color")||"",this.setValue(e),i.hasAttr("label")&&this.setLabel(i.attr("label"))}get value(){return this.$parent.model[this.name]}get type(){var t;return(t=this.value)==null?void 0:t.type}get locked(){return this.isLocked}get isHidden(){return this.isPending||this.$el.hasAttr("hidden")||this.$el.hasClass("transparent")}setValue(t){t instanceof Function?this.$parent.model.setComputed(this.name,t):this.$parent.model[this.name]=t}setLabel(t,e,i){this.$label||(this.$label=Cp(this.$el,e),this.$parent.$objLabels.append(this.$label));let n=xn(t);if(this.$parent.model.watch(r=>this.$label.text=n(r)||""),this.fixedLabel=!!i,i){let r=ct(i);this.$parent.model.watch(o=>{this.$label.setTransform(r(o).shift(0,5))})}this.updateLabelPosition()}setColor(t){this.color=t,this.$el.css("color",t);for(let e of this.dependencies)e.setColor(t);this.$label&&this.$label.css("color",t)}updateLabelPosition(){if(!this.$label||!this.value||this.fixedLabel)return;let[t,e]=Ap(this,this.$parent);this.$label.setTransform(t,e)}select(){this.$el.addClass("selected"),this.$el.parent.append(this.$el);for(let t of this.dependencies)t.select()}deselect(){this.$el.removeClass("selected");for(let t of this.dependencies)t.deselect()}hover(t=!1){if(!t){if(this.$parent.hovering===this)return;this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.hovering=this}this.$el.addClass("hover");for(let e of this.dependencies)e.hover(!0)}unhover(t=!1){if(!t){if(this.$parent.hovering!==this)return;this.$parent.hovering=void 0}this.$el.removeClass("hover");for(let e of this.dependencies)e.unhover(!0)}delete(t=300){return D(this,null,function*(){this.$parent.shapes.delete(this.name);for(let e of this.components)e.deselect();this.$label&&this.$label.exit("fade",t,0,!0),yield this.removeElement(t),this.$parent.model[this.name]=void 0})}},Ie=class extends Tr{constructor(t,e,i,n,r=!1){n||(n=m("circle",{})),super(t,e,n,i),this.$parent.hidePoints||t.$points.append(this.$el),t.points.add(this),this.projectionId=t.model.getKey(),this.projectionOffset=void 0,t.model.watch(o=>{this.projection=o[this.projectionId],this.projection&&(this.projectionOffset===void 0&&(this.projectionOffset=this.projection.offset(this.$parent.model[this.name])),this.$parent.model[this.name]=this.projection.at(this.projectionOffset))}),this.lock(r)}setValue(t){t instanceof Function?(this.project(void 0),this.$parent.model.setComputed(this.name,t)):(t&&this.projection&&(t=this.projection.project(t),this.projectionOffset=this.projection.offset(t)),this.$parent.model[this.name]=t)}redraw(t){let e=t.transform(this.$parent.plotToViewportMatrix);this.$el.setCenter(e),this.$halo&&this.$halo.setCenter(e),this.$pulse&&this.$pulse.setCenter(e)}removeElement(t){return D(this,null,function*(){this.$parent.points.delete(this),yield this.$el.exit("pop",t,0,!0).promise})}distance(t){return this.value?p.distance(t,this.value):1/0}lock(t=!0){this.isLocked=t,this.$el.setClass("move",!t),t?this.$el.removeAttr("tabindex"):this.$el.setAttr("tabindex",0)}project(t){if(this.projectionOffset=void 0,typeof t=="string"){let e=ct(t);this.$parent.model.setComputed(this.projectionId,e)}else t?this.$parent.model.setComputed(this.projectionId,()=>t.value):this.$parent.model[this.projectionId]=void 0}makeIntersection({path1:t,path2:e,index:i}){this.setValue(n=>{if(!n[t.name]||!n[e.name])return;let r=Q(n[t.name],n[e.name]);return r[Math.min(i,r.length-1)]}),this.lock()}addHalo(){this.$halo=m("circle",{class:"halo",r:18},this.$parent.$pulses),this.$halo.setCenter(this.$el.center),this.$halo.enter("pop")}removeHalo(){return D(this,null,function*(){this.$halo&&(this.$halo.exit("pop",500,0,!0),this.$halo=void 0)})}pulsate(){this.$pulse=m("circle",{class:"pulse",r:8},this.$parent.$pulses),this.$pulse.setCenter(this.$el.center),this.$el.one("mouseover pointerdown focus",()=>{this.$pulse&&this.$pulse.remove(),this.$pulse=void 0})}},Fe=class extends Tr{constructor(t,e,i,n){super(t,e,n||m("path"),i),t.$paths.append(this.$el),t.paths.add(this)}get locked(){return this.isLocked||!this.components.length||this.components.every(t=>t.locked)}redraw(t){let e=t.transform(this.$parent.plotToViewportMatrix);this.$el.draw(e,{box:this.$parent.viewportRect})}distance(t){return this.value?p.distance(t,this.value.project(t)):1/0}removeElement(t){return D(this,null,function*(){this.$parent.paths.delete(this),yield this.$el.exit("draw",t,0,!0).promise})}setComponents(t,e){this.components=this.dependencies=t,this.setValue(()=>{let i=t.map(n=>n.value);if(!i.some(n=>n===void 0))return e(...i)})}};var Hi=class{constructor(t){this.$parent=t}enable(){}down(t){}start(t){}move(t,e){}end(t){}hover(t){}click(t){}cancel(){}snapToGrid(t){return this.$parent.snapToGrid?t.round(this.$parent.snapToGrid):t}snapToPoint(t,e){if(this.snapPoint=this.$parent.getPointAt(e),this.snapPoint)return t.$el.setClass("move",!this.snapPoint.locked),t.setValue(this.snapPoint.value);if(this.snapIntersect=this.$parent.getIntersectionAt(e),this.snapIntersect)return t.$el.removeClass("move"),t.setValue(this.snapIntersect.posn);if(!this.$parent.snapToGrid&&(this.snapPath=this.$parent.getPathAt(e),this.snapPath))return t.setValue(this.snapPath.value.project(e));t.$el.addClass("move"),t.setValue(this.snapToGrid(e))}getOrMakePointAt(t){let e=this.$parent.getPointAt(t);if(!e){e=new Ie(this.$parent,this.snapToGrid(t));let i=this.$parent.getIntersectionAt(t);if(i)e.makeIntersection(i);else if(!this.$parent.snapToGrid){let n=this.$parent.getPathAt(t);n&&e.project(n)}this.$parent.trigger("add:point",{point:e})}return e}showPendingPointAt(t){var n,r,o;let e=((n=this.$parent.getIntersectionAt(t))==null?void 0:n.posn)||((o=(r=this.$parent.getPathAt(t))==null?void 0:r.value)==null?void 0:o.project(t)),i=!!e;if(this.$parent.$pendingPoint.toggle(i),i){let a=this.$parent.toViewportCoords(e||t);this.$parent.$pendingPoint.setCenter(a)}}},ji=class extends Hi{constructor(){super(...arguments);this.isMoving=!1}enable(){}down(e){this.obj=this.$parent.getPointAt(e)||this.$parent.getPathAt(e),this.obj||this.$parent.deselect();let i=this.$parent.selection;i!==this.obj&&(i&&i.components.includes(this.obj)||this.$parent.select(this.obj))}start(){this.obj&&(this.isMoving=!0,this.obj.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("move",{obj:this.obj}))}move(e,i){if(!(!this.obj||this.obj.locked||this.$parent.locked))if(this.obj instanceof Fe){let n=e.subtract(i);for(let r of this.obj.components)r.locked||r.setValue(r.value.add(n))}else this.obj instanceof Ie&&this.obj.setValue(this.snapToGrid(e))}end(){this.obj&&(this.isMoving=!1,this.obj.isPending=!1,this.snapPoint||(this.snapIntersect?this.obj.makeIntersection(this.snapIntersect):this.snapPath&&this.obj.project(this.snapPath)),this.$parent.trigger("moveEnd",{path:this.obj}),this.obj=void 0,this.$parent.updateIntersections())}hover(e){if(this.isMoving)return;let i=this.$parent.getPointAt(e)||this.$parent.getPathAt(e),n=i&&!this.$parent.locked&&!i.locked,r=i&&this.$parent.canSelect;this.$parent.setCursor(n?"grab":r?"pointer":"default"),n||r?i.hover():this.$parent.hovering&&this.$parent.hovering.unhover()}},Sr=class extends ji{down(t){this.$parent.deselect(),this.obj=this.getOrMakePointAt(t),this.$parent.select(this.obj)}hover(t){let e=this.$parent.getPointAt(t);if(e)return this.$parent.setCursor(this.$parent.locked||e.locked?"default":"grab"),this.$parent.$pendingPoint.hide(),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}},ii=class extends Hi{enable(){this.$parent.setCursor("crosshair")}down(t){this.$parent.deselect(),this.startPoint=this.getOrMakePointAt(t)}start(t){this.startPoint&&(this.$parent.$pendingPoint.hide(),this.endPoint=new Ie(this.$parent,t),this.endPoint.isPending=!0,this.endPoint.$el.addClass("pending"),this.path=new Fe(this.$parent,void 0),this.path.setComponents([this.startPoint,this.endPoint],this.expr),this.path.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("begin:path",{path:this.path,start:this.startPoint}))}move(t){if(!this.startPoint||!this.path||!this.endPoint)return;if(p.distance(t,this.startPoint.value)<20/this.$parent.plotScale)return this.endPoint.setValue(this.snapToGrid(t));this.snapToPoint(this.endPoint,t)}end(){if(!this.startPoint||!this.path||!this.endPoint)return;this.path.isPending=!1,this.endPoint.isPending=!1,this.startPoint.value.equals(this.endPoint.value)?(this.endPoint.delete(),this.path.delete(),this.path=this.endPoint=void 0):this.snapPoint?(this.path.setComponents([this.startPoint,this.snapPoint],this.expr),this.endPoint.delete(),this.endPoint=void 0):this.snapIntersect?this.endPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.endPoint.project(this.snapPath),this.endPoint&&(this.$parent.trigger("add:point",{point:this.endPoint}),this.endPoint.$el.removeClass("pending"));let t=this.path;this.startPoint=this.endPoint=this.path=void 0,t&&(this.$parent.trigger("add:path",{path:t}),this.$parent.updateIntersections())}hover(t){let e=this.$parent.getPointAt(t);if(e)return this.$parent.$pendingPoint.hide(),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.showPendingPointAt(t)}cancel(){this.endPoint&&this.endPoint.delete(),this.path&&this.path.delete(),this.$parent.$pendingPoint.hide(),this.startPoint=this.endPoint=this.path=void 0}},Er=class extends ii{expr(t,e){return new Y(t,e)}},Mr=class extends ii{expr(t,e){return new wt(t,p.distance(t,e))}},Cr=class extends ii{expr(t,e){return new G(t,e.x-t.x,e.y-t.y)}},Ar=class extends ii{expr(t,e){return new Y(t,e).perpendicularBisector}},kp=(s,t,e)=>new Vt(s,t,e).bisector,kr=class extends Hi{enable(){}down(t){if(this.$parent.deselect(),!this.firstPoint)this.firstPoint=this.getOrMakePointAt(t),this.firstPoint&&this.firstPoint.addHalo();else if(this.secondPoint){this.path.isPending=this.thirdPoint.isPending=!1,this.thirdPoint.$el.removeClass("pending"),this.firstPoint.removeHalo(),this.secondPoint.removeHalo(),this.snapPoint?(this.path.setComponents([this.firstPoint,this.secondPoint,this.snapPoint],kp),this.thirdPoint.delete(),this.thirdPoint=void 0):this.snapIntersect?this.thirdPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.thirdPoint.project(this.snapPath);let e=this.path,i=this.thirdPoint;this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0,i&&this.$parent.trigger("add:point",{point:i}),this.$parent.trigger("add:path",{path:e}),this.$parent.updateIntersections()}else{if(this.secondPoint=this.getOrMakePointAt(t),!this.secondPoint)return;this.secondPoint.addHalo(),this.thirdPoint=new Ie(this.$parent,this.secondPoint.value),this.thirdPoint.$el.addClass("pending"),this.path=new Fe(this.$parent,void 0),this.path.setComponents([this.firstPoint,this.secondPoint,this.thirdPoint],kp),this.path.isPending=this.thirdPoint.isPending=!0}}hover(t){if(this.$parent.$pendingPoint.hide(),this.thirdPoint){this.snapToPoint(this.thirdPoint,t),this.$parent.setCursor(this.snapPoint?"pointer":"crosshair");return}let e=this.$parent.getPointAt(t);if(e)return this.$parent.setCursor("pointer"),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}cancel(){this.firstPoint&&this.firstPoint.removeHalo(),this.secondPoint&&this.secondPoint.removeHalo(),this.thirdPoint&&this.thirdPoint.delete(),this.path&&this.path.delete(),this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0}};var Vp='<x-select class="tools"><div class="tool" data-tool="move"><x-icon name="hand" size="28"></x-icon></div><div class="tool" data-tool="point"><x-icon name="geo-point" size="28"></x-icon></div><div class="tool" data-tool="line"><x-icon name="geo-line" size="28"></x-icon></div><div class="tool" data-tool="rectangle"><x-icon name="geo-rectangle" size="28"></x-icon></div><div class="tool" data-tool="circle"><x-icon name="geo-circle" size="28"></x-icon></div><div class="tool" data-tool="perpBisector"><x-icon name="geo-perp-bisector" size="28"></x-icon></div><div class="tool" data-tool="angleBisector"><x-icon name="geo-angle-bisector" size="28"></x-icon></div></x-select><slot></slot>';var Vr=class extends is{constructor(){super(...arguments);this.shapes=new Map;this.points=new Set;this.paths=new Set;this.intersections=new Set;this.snapToGrid=0;this.locked=!1;this.hidePoints=!1;this.canSelect=!1;this.canIntersect=!1;this.canProject=!0;this.labelPositioning=!1;this.cursor="default"}ready(){let e=this.children.filter(h=>h.tagName==="SVG")[0];if(this.hasAttr("complex")&&(this.setAttr("label-suffix",",i"),this.setAttr("axis-names","Real, Imaginary"),this.setAttr("axes","true"),this.setAttr("grid","true")),!this.hasAttr("x-axis")&&!this.hasAttr("y-axis")){let h=+this.attr("grid"),l=+this.attr("width")||this.width,c=+this.attr("height")||l;this.setAttr("x-axis",h?`-0.5,${l/h-.5},1`:`0,${l},1`),this.setAttr("y-axis",h?`${c/h-.5},-0.5,1`:`${c},0,1`),h&&this.setAttr("snap",1)}this.setupCoordinates(e,{proportional:!0}),this.viewportRect=this.viewportBounds.rect,this.model=this.getParentModel()||le({}),this.model.hasGeoModel||this.model.assign(bp),this.$paths=m("g",{class:"paths"},e),this.$pulses=m("g",{class:"pulses"},e),this.$points=m("g",{class:"points"},e),this.$objLabels=m("g",{class:"labels"},e),this.snapToGrid=this.hasAttr("snap")?+this.attr("snap")||1:0,this.hidePoints=this.hasAttr("no-points"),this.canIntersect=Ve(this,"intersections",!1),this.canProject=Ve(this,"projections",!0),this.canSelect=Ve(this,"selectable",!1),this.labelPositioning=Ve(this,"label-positioning",!0),this.hasClass("sticky")&&this.css("top",`calc(50vh - ${this.height/2}px)`),this.queueLabelPositioning=ve(()=>{for(let h of this.shapes.values())h.updateLabelPosition()},0,!0);let i=e.$$("path[x], path[\\:d], circle");for(let h of i){let l=h.hasAttr("x")?ct(h.attr("x")):void 0,c=h.attr("name");if(h.hasAttr(":d"))this.$paths.append(h),h.bindModel(this.model);else if(h.tagName==="PATH")this.$paths.append(h),new Fe(this,l,c,h);else{this.$points.append(h);let u=!h.hasClass("move"),d=l||h.center,g=new Ie(this,d,c,h,u);h.hasAttr("project")&&g.project(h.attr("project")),h.hasClass("pulsate")&&g.pulsate()}}this.$pendingPoint=m("circle",{class:"pending"},this.$points),this.$pendingPoint.hide(),this.updateIntersections();let n={move:new ji(this),point:new Sr(this),line:new Er(this),circle:new Mr(this),perpBisector:new Ar(this),angleBisector:new kr(this),rectangle:new Cr(this)};this.$tools=this.$(".tools");let r=n[this.$tools.$active.data.tool];r.enable();let o=()=>this.toolOverride||r;this.$tools.on("change",h=>{o().cancel(),this.toolOverride=void 0,r=n[h.data.tool],this.hovering&&this.hovering.unhover(),this.$pendingPoint.hide(),this.hovering=void 0,this.deselect(),r.enable()});let a=(h,l=!1)=>this.toPlotCoords(l?h.clamp(this.viewportBounds,8):h);new si(e,{down:h=>o().down(a(h.posn)),start:h=>o().start(a(h.posn)),move:h=>o().move(a(h.posn,!0),a(h.lastPosn,!0)),end:h=>o().end(a(h.posn,!0)),click:h=>o().click(a(h.posn)),hover:h=>o().hover(a(h.posn))}),C.onKey("Escape",()=>o().cancel()),C.onKey("Backspace Clear Delete",()=>this.delete()),document.addEventListener("keydown",h=>{if([37,38,39,40].indexOf(h.keyCode)<0)return;let c=b.getActiveInput();if(!(!c||!c.hasParent(this))){h.preventDefault();for(let u of this.points){if(u.$el!==c||!u.value)continue;let d=15/this.plotScale,g=this.plotBounds.yMin>this.plotBounds.yMax?-1:1,y=h.keyCode===37?-d:h.keyCode===39?d:0,f=h.keyCode===38?-g*d:h.keyCode===40?g*d:0;u.setValue(u.value.shift(y,f));return}}})}switchTool(e){this.$tools.makeActive(this.$(`.tool[data-tool="${e}"]`))}setCursor(e="default"){e!==this.cursor&&(this.cursor=e,this.$svg.css("cursor",e))}select(e){this.canSelect&&(this.deselect(),e&&(this.selection=e,e.select()),this.trigger("select",{shape:e}))}deselect(){this.selection&&(this.selection.deselect(),this.selection=void 0,this.trigger("select",{shape:void 0}))}delete(){this.hovering&&this.hovering.unhover(),this.selection&&this.selection.delete(),this.trigger("select",{shape:void 0})}redraw(){this.resize(),this.viewportRect=this.viewportBounds.rect,this.model.forceUpdate()}getPointAt(e,i=20){if(this.hidePoints)return;let n=r=>r.isHidden?void 0:r.distance(e);return xr(this.points,n,i/this.plotScale)}getPathAt(e,i=10){if(this.hidePoints||!this.canProject)return;let n=r=>r.isHidden?void 0:r.distance(e);return xr(this.paths,n,i/this.plotScale)}getIntersectionAt(e,i=20){if(!this.canIntersect)return;let n=r=>p.distance(e,r.posn);return xr(this.intersections,n,i/this.plotScale)}updateIntersections(){!this.canIntersect||this.hidePoints||xp(this.paths,this.intersections)}drawPath(e,i={}){typeof e=="string"&&(e=ct(e));let n=new Fe(this,e,i.name);i.classes&&n.$el.addClass(i.classes),i.target&&n.$el.setAttr("target",i.target);let r=n.$el.hasClass("fill")?"fade":"draw";return i.animated&&n.$el.enter(r,i.animated),n}drawPoint(e,i={}){typeof e=="string"&&(e=ct(e));let n=new Ie(this,e,i.name,void 0,i.interactive===!1);return i.classes&&n.$el.addClass(i.classes),i.target&&n.$el.setAttr("target",i.target),i.animated!==0&&n.$el.enter("pop",i.animated||500),n}animatePoint(e,i,n=400){let r=this.shapes.get(e),o=new Y(this.model[e],i);return pt(a=>r.setValue(o.at(yt("quad",a))),n)}animateConstruction(e,i=2e3){return D(this,null,function*(){let n=this.shapes.get(e),r=n.value;if(U(r)&&(r=r.arc),it(r)){this.$ruler||(this.$ruler=m("path",{d:Pp,class:"sketch"},this.$svg));let o=Ms(r.at(-.1),12,r.angle-.3,r.length*1.2),a=Ms(r.at(-.1),12,r.angle,r.length*1.2);this.$ruler.show(),n.$el.hide(),yield this.$ruler.animate({opacity:[0,1],transform:[o,a]},500).promise,yield n.$el.enter("draw",i).promise,yield this.$ruler.animate({opacity:[1,0],transform:[a,o]},500).promise}else if(Nt(r)){this.$compass||(this.$compass=m("path",{d:$p,class:"sketch"},this.$svg));let o=Ms(r.c,50,r.startAngle,r.radius*1.5),a=Ms(r.c,50,r.startAngle,r.radius),h=Ms(r.c,50,r.startAngle+r.angle,r.radius),l=Ms(r.c,50,r.startAngle+r.angle,r.radius*1.5);this.$compass.show(),n.$el.hide(),yield this.$compass.animate({opacity:[0,1],transform:[o,a]},500).promise,n.$el.enter("draw",i),yield this.$compass.animate({transform:[a,h]},i,0,"linear").promise,yield this.$compass.animate({opacity:[1,0],transform:[h,l]},500).promise}})}showGesture(e,i){this.$gesture||(this.$gesture=m("x-gesture",{},this)),this.$gesture.stop();let n=this.toViewportCoords(ct(e)(this.model));if(this.$gesture.from=n,i){let r=this.toViewportCoords(ct(i)(this.model));this.$gesture.start(r.subtract(n))}else this.$gesture.start();this.one("click mouseover pointerdown",()=>this.$gesture.stop())}waitForPoint(){return D(this,null,function*(){return new Promise(e=>{this.one("add:point",({point:i})=>e(i))})})}waitForPath(n){return D(this,arguments,function*(e,i={}){return(yield Ja(this,[e],i))[0]})}waitForPaths(e,i={}){return Ja(this,e,i)}};Vr=T([S("x-geopad",{template:Vp})],Vr);var Ip='<div class="image"></div><div class="content"><slot></slot></div>';var Ir=class extends E{ready(){let t=this.$(".image"),e=this.positionTop<50,i,n;t.css({"background-image":`url("${this.attr("background")}")`,height:e?"100%":"150%"});let r=({height:a})=>{let h=this.positionTop;i=Math.max(0,h-a),n=h+this.height};function o(a){if(a.top<i||a.top>n)return;let h=(a.top-i)/(n-i)*(e?50:33);t.css("transform",`translateY(${h}%)`)}b.onResize(r),C.on("scroll",o)}};Ir=T([S("x-parallax",{template:Ip})],Ir);var st=new AudioContext,Or,qe,Lr=.05,Dp="/audio/samples/",Lp=new Map,Np=new Map,Op=!1;function Hg(){return D(this,null,function*(){if(Op)return;Op=!0,qe=st.createDynamicsCompressor(),qe.threshold.setValueAtTime(-15,0),qe.knee.setValueAtTime(1,0),qe.ratio.setValueAtTime(2,0),qe.attack.setValueAtTime(1e-5,0),qe.release.setValueAtTime(1,0),Or=st.createConvolver();let t=yield(yield fetch(`${Dp}IR13.mp3`)).arrayBuffer();Or.buffer=yield st.decodeAudioData(t)})}function Gp(s){if(!s||s==="synth"||Lp.has(s))return;let t=fetch(`${Dp}${s}.mp3`).then(e=>e.arrayBuffer()).then(e=>st.decodeAudioData(e)).then(e=>Np.set(s,e)).catch(()=>console.error("Unable to load sample for",s));Lp.set(s,t)}var th={piano:{label:"Piano",pitch:-6,vol:-1.5},epiano:{label:"E-Piano",pitch:-1,vol:-2},organ:{label:"Organ",pitch:-1,vol:-1.75},marimba:{label:"Marimba",pitch:1},synth:{label:"Synth"},bass:{label:"Synth Bass",pitch:6.2,vol:-1.75,icon:"synth"},aguitar:{label:"Guitar",pitch:5},eguitar:{label:"E-Guitar",vol:-2},violin:{label:"Violin",vol:-1.75},cello:{label:"Cello",vol:-1.5},banjo:{label:"Banjo",vol:3},trumpet:{label:"Trumpet",vol:-1.75,pitch:-14},clarinet:{label:"Clarinet",pitch:-2,vol:-2},ubass:{label:"Upright Bass",vol:2,icon:"cello"},kick:{label:"Kick",noLoop:!0},snare:{label:"Snare",noLoop:!0},"tom-high":{label:"High Tom",noLoop:!0},"tom-low":{label:"Low Tom",noLoop:!0},"hihat-open":{label:"Open HiHat",noLoop:!0,icon:"hihat"},"hihat-closed":{label:"HiHat",noLoop:!0,icon:"hihat"},ride:{label:"Ride Cymbal",noLoop:!0},crash:{label:"Crash Cymbal",noLoop:!0},cowbell:{label:"Cowbell",noLoop:!0},tambo:{label:"Tambourine",noLoop:!0},bongo:{label:"Bongos",noLoop:!0},shaker:{label:"Shaker",noLoop:!0},woodblock:{label:"Woodblock",noLoop:!0},voice:{label:"Vocal",vol:-1.5},clap:{label:"Clap",noLoop:!0},snap:{label:"Snap",noLoop:!0},ting:{label:"Ting",pitch:5.5},honk:{label:"Honk",pitch:-2,noLoop:!0},scraper:{label:"Scraper",noLoop:!0},boing:{label:"Spring",noLoop:!0,pitch:7},vibraslap:{label:"Vibraslap",noLoop:!0},cow:{label:"Cow",vol:-1.75,noLoop:!0},bark:{label:"Dog",noLoop:!0},duck:{label:"Duck",noLoop:!0},pig:{label:"Pig",noLoop:!0},rooster:{label:"Rooster",pitch:-5,noLoop:!0}},jg=440*2**(-9/12);var Ug={none:[],percussion:[],major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],blues:[0,3,5,6,7,10],pentatonic:[0,2,4,7,9],chromatic:oe(12)};function sh(s,t,e=0,i){if(s==="none")return 0;i&&(t=e-t-1);let n=Ug[s],r=gt(t,n.length);return Math.round((t-r)/n.length)*12+n[r]}function zp(s,t,e){let i=st.createGain();i.connect(qe),i.connect(Or).connect(qe).connect(st.destination);let n=s+1e-5;return i.gain.setValueAtTime(1e-5,n),i.gain.linearRampToValueAtTime(t,n+=e[0]),i.gain.linearRampToValueAtTime(t*.8,n+=e[1]),i.gain.setValueAtTime(t*.8,n+=e[2]),i.gain.linearRampToValueAtTime(1e-5,n+e[3]),i}function Ui(s,t="piano"){return s===void 0?0:t==="synth"?jg*2**(s/12):2**((s+(th[t].pitch||0))/12)||0}function Wg(s,t,e,i,n){let r=Np.get(s);if(!r)throw new Error(`Missing audio sample: ${s}`);let o=zp(e,i,n),a=st.createBufferSource(),h=Ui(t,s);a.playbackRate.value=h,a.buffer=r,a.connect(o),a.start(e);let l=[a],c=a.buffer.duration/h,u=c*.5>1.5?1.1:c*.9,d=n[2]/.6,g=d/u;if(d>1.1&&!th[s].noLoop)for(let y=1;y<g;++y){let f=st.createBufferSource();f.playbackRate.value=h,f.buffer=r;let v=st.createGain(),w=e+u*y+1e-5;v.gain.setValueAtTime(1e-5,w),v.gain.setValueAtTime(1e-5,w+.05*c);let x=2+(th[s].vol||0);v.gain.linearRampToValueAtTime(i+x,w+(s==="clarinet"?.95:.9)*u),f.connect(v).connect(o).connect(Or).connect(qe).connect(st.destination),f.start(e+y*u),l.push(f)}for(let y of l)y.stop(e+d+1);return l}function Kg(s,t,e,i,n,r){let o=zp(t,e,i),a=N(i)+.01,h=st.createOscillator();h.type="triangle",h.connect(o),h.frequency.setValueAtTime(Ui(s,"synth"),t),h.start(t),h.stop(t+a);let l=st.createGain();l.connect(o),l.gain.setValueAtTime(.3,st.currentTime),l.gain.linearRampToValueAtTime(.01,st.currentTime+a/2);let c=st.createGain();c.connect(h.frequency),c.gain.linearRampToValueAtTime(n,st.currentTime+a);let u=st.createOscillator();u.type="square",u.connect(l),u.frequency.setValueAtTime(Ui(s,"synth"),t),u.start(t),u.stop(t+a);let d=st.createOscillator();return d.type="sine",d.connect(c),d.frequency.linearRampToValueAtTime(r,st.currentTime+a/2),d.start(st.currentTime),d.stop(t+a),h}function Xg(s=0,t="piano",e=1,i=.5,n=st.currentTime+Lr,r=2,o=5){Hg();let a=Math.min(1,i),h=[.02,a*.2,i-a*.3,a*.3];return t!=="synth"?Wg(t,s,n,e/6,h):Kg(s,n,e/6,h,r,o)}var Rr=class{constructor(t,e){this.tile=t;this.setup=e;this.isPlaying=!1;this.start=0;this.duration=1;this.lastBeat=-1;this.tempo=1;this.stopCont=new Set;t.props.watch("sound musicScale note modGain modFreq",()=>this.stop())}play(t=st.currentTime+Lr,e=1){if(!this.setup)return 0;this.isPlaying&&this.stop(),this.isPlaying=!0,this.tempo=(this.tile.props.tempo||1)*e;let i=this.tile.props.note||0;if(this.currentData=this.setup(i,this.tempo),!this.currentData.beats.length)return this.isPlaying=!1,this.currentData=void 0,0;let n=O(this.currentData.beats);return this.duration=(n.time+n.duration)/this.tempo,this.start=t,this.lastBeat=-1,Rp.add(this),this.duration}stop(){var t,e;if(this.isPlaying){Rp.remove(this),window.clearInterval(this.timeout),this.isPlaying=!1,(e=(t=this.currentData).end)==null||e.call(t);for(let i of this.stopCont)i.stop();this.stopCont.clear(),this.currentData=void 0,this.tile.$parent.selection.update()}}tick(){var o,a;let t=st.currentTime,e=this.currentData.beats,i=(t-this.start)*this.tempo,n=e.findIndex(h=>h.time>=i);n<0&&(n=e.length-1);for(let h=this.lastBeat+1;h<=n;++h)this.processStep(h);(a=(o=this.currentData).tick)==null||a.call(o,i<0?0:i);let r=this.start+this.duration-t;this.lastBeat>=e.length-1&&r<=0&&this.stop()}processStep(t){var h,l;let e=this.currentData.beats[t],i=this.start+e.time/this.tempo;if(i>st.currentTime+Lr)return;let n=((h=this.tile.props.volume)!=null?h:1)+((l=e.volume)!=null?l:0),r=e.duration/this.tempo,o=e.sound||this.tile.props.sound||"piano";if(e.note instanceof Function)this.playContinuous(e.note,o,i,r,n);else{let c=Array.isArray(e.note)?e.note:[e.note];for(let u of c)this.playNote(u,o,i,r,n)}let a=i-st.currentTime;this.timeout=Zt(()=>{var c,u;return(u=(c=this.currentData).step)==null?void 0:u.call(c,t)},a*1e3),this.lastBeat=t}playNote(t,e=this.tile.props.sound||"piano",i=st.currentTime+Lr,n=.8,r=this.tile.props.volume||1){return Xg(t,e,r,n,i,this.tile.props.modGain,this.tile.props.modFreq)}playContinuous(t,e,i,n,r){let o=this.playNote(Ui(t(0)),e,i,n,r),a=o instanceof OscillatorNode,h=1/60;for(let l=0;l<=n;l+=h){let c=Ui(t(l*this.tempo),e);if(a)o.frequency.setValueAtTime(c,i+l);else for(let u of o)u.playbackRate.setValueAtTime(c,i+l)}if(a)this.stopCont.add(o);else for(let l of o)this.stopCont.add(l)}},eh=class{constructor(){this.running=!1;this.tracks=new Set}add(t){this.tracks.add(t),this.running||(st.state!=="running"&&st.resume(),this.running=!0,this.tick(),requestAnimationFrame(()=>this.tick()))}remove(t){this.tracks.delete(t),this.tracks.size||(this.running=!1)}tick(){for(let t of this.tracks)t.tick();this.running&&requestAnimationFrame(()=>this.tick())}},Rp=new eh;var Yg=new Set(["watch","assign","updateTheme","flushChanges","raw","copy"]);function Bp(s,t){let e,i=new Set,n=!0,r=new Map,o=(u,d)=>{for(let g of K(u))r.has(g)||r.set(g,[]),r.get(g).push(d);d(c)},a=u=>{let d=Object.keys(u).filter(y=>u[y]!==s[y]);if(!d.length)return;Object.assign(s,u),t.$parent.pendingChanges.add(t);for(let y of d)i.add(y);let g=Wt(d.flatMap(y=>{var f;return(f=r.get(y))!=null?f:[]}));for(let y of g)y(c)},h=()=>{var u;for(let d of(u=r.get("color"))!=null?u:[])d(c)},l=()=>{if(t.isDeleting)return i.clear(),n?void 0:[e,void 0];let u=e;if(e=Object.assign({},s),n)return i.clear(),n=!1,[void 0,e];let d={},g={},y=!1;for(let f of i)e[f]!==u[f]&&(y=!0,d[f]=e[f],g[f]=u[f]);return i.clear(),y?[g,d]:void 0},c=new Proxy(s,{get(u,d){switch(d){case"watch":return o;case"assign":return a;case"updateTheme":return h;case"flushChanges":return l;case"raw":return s;case"copy":return()=>Object.assign({},s);case"zIndex":return s.zIndex||0;case"layer":return s.layer||"normal";case"color":return _e(s.color,t.$parent.flipTheme);default:return s[d]}},set(u,d,g){var y;if(Yg.has(d))return!1;if(s[d]===g)return!0;s[d]=g;for(let f of(y=r.get(d))!=null?y:[])f(c);return t.$parent.pendingChanges.add(t),i.add(d),!0}});return c}function _p(s){let t=s.signedArea<0,e=0;for(let[n,r]of s.points.entries())r.y<s.points[e].y-1||r.x>s.points[e].x||(e=n);let i=hs(s.points,e+(t?1:0));return t&&(i=i.reverse()),new V(...i)}function ih(s,t,e=0){let i=s.centroid.x,n=Math.max(...s.points.map(r=>r.y))+42+e;return m("text",{x:i,y:n,style:"font-size:25px"},t)}function Zg(s,t,e,i){t.removeChildren();let n=s.is("polyomino"),r=_p(s.path),o=r.edges,a=as(o.map(A=>A.length)),h=O(a),l=wr(s.props.color),c=z(A=>{let M=sh(s.props.musicScale||"major",A,o.length,s.props.musicScaleRev),P=(a[A-1]||0)*.01;return{note:e+M,time:P,duration:o[A].length*.01}},o.length),u=m("g",{filter:"url(#outline)"},t),d=m("g",{class:"axis-label",fill:l},t),g=s.props.animation==="vertices"?9:6,y=m("path",{path:r,fill:"none",stroke:l,"stroke-width":5,opacity:1,hidden:!0},u),f=r.points.map(A=>m("circle",{cx:A.x,cy:A.y,r:g,fill:l,hidden:!0},u)),v,w,x;return s.props.animation==="vertices"?x=r.points.map((A,M)=>m("text",{text:M+1,x:A.x,y:A.y+5,fill:"white",hidden:!0},u)):s.props.labels==="number"&&(v=ih(r,d),w=o.map(A=>{let M=A.perpendicularBisector,P=M.at(n?0:15/M.length),j=A.length<45?12:15;return m("text",{text:Dt(A.length/50,1),x:P.x,y:P.y+5,hidden:!0,style:`font-size:${j}px`},d)})),{beats:c,step:A=>{A===0&&(y==null||y.enter("draw",10*h/i)),f==null||f[A].show(),x==null||x[A].show(),w==null||w[A].show(),v&&(v.textStr=Dt(a[A]/50,1))}}}function Qg(s,t,e){t.removeChildren();let i=s.path.area/2500,n=e-12,r=i,o=wr(s.props.color),a=m("clipPath",{id:`clip-${s.id}`},t),h=m("path",{path:G.aroundPoints(s.path.points)},a);s.$path.setAttr("id",`shape-${s.id}`),m("path",{path:s.path,"clip-path":`url(#clip-${s.id})`,fill:o,opacity:1},t);let l=m("g",{class:"axis-label",fill:o},t),c=ih(s.path,l,-15);return{beats:[{note:g=>tt(n-i,n,g/r),duration:r,time:0}],tick:g=>{if(s.props.labels){let f=g/r,v=Dt(tt(0,i,f>.95?1:f),1);c.text=v>0?v+" units\xB2":""}let y=G.aroundPoints(s.path.points).h;h.css("transform",`translateY(${y*(1-g/r)}px)`)}}}function Jg(s,t,e,i){t.removeChildren();let n=_p(s.path),r=n.points.length,o=n.points.map((v,w)=>new Vt(n.points[gt(w+1,r)],v,n.points[gt(w-1,r)])),a=o.map(v=>v.deg),h=[0,...as(a)],l=.42*Math.min(...n.edges.map(v=>v.length)),c=s.is("polyomino"),u=wr(s.props.color),d=m("g",{class:"axis-label",fill:u},t),g=ih(n,d);return{beats:a.map((v,w)=>({note:sh(s.props.musicScale||"major",w,a.length,s.props.musicScaleRev)+e,duration:a[w]/90,time:h[w]/90})),step:v=>{let w=o[v],x=m("path",{fill:u});if(t.prepend(x),s.props.labels){let I=w.bisector,A=I.at(-12/I.length),M=`font-size:${c?12:15}px`;m("text",{text:Dt(a[v])+"\xB0",x:A.x,y:A.y+5,style:M},d)}pt(I=>{let A=new Vt(w.arc.at(1-I),w.b,w.c);x.draw(A.shape(!0,l,!0)),s.props.labels&&(g.text=Math.round(tt(h[v],h[v+1],I))+"\xB0")},a[v]/90*1e3/i)}}}function Fp(s,t){let e=()=>{s.props.labels!=="number"&&t.removeChildren()};return new Rr(s,(i,n)=>{switch(s.props.animation){case"area":return ft(ut({},Qg(s,t,i)),{end:e});case"angles":return ft(ut({},Jg(s,t,i,n)),{end:e});default:return ft(ut({},Zg(s,t,i,n)),{end:e})}})}var qp=6,t0="M8.1-1.7l-14-8.8c-0.6-0.4-1.4-0.4-2-0.1c-0.6,0.4-1,1-1,1.7V8.8c0,0.7,0.4,1.4,1,1.7c0.3,0.2,0.6,0.3,1,0.3c0.4,0,0.7-0.1,1.1-0.3l14-8.8C8.6,1.3,9,0.7,9,0S8.6-1.3,8.1-1.7z",Wi=!1;function Hp(s){if(!Array.isArray(s))return Hp([s,0]);let[t,e]=s;if(t instanceof p)return[[t,e]];if(U(t)&&(t=new G(t.c.shift(-t.r),2*t.r,2*t.r)),!(t instanceof V)&&!(t instanceof G))return[[R,0]];let i=t.edges.map(n=>[n.midpoint,n.perpendicularBisector.angle]).filter(n=>!$(n[1],1.5*Math.PI));return hs(i,e)}var Dr=class{constructor(t,e,i){this.tile=t;this.name=e;this.options={};this.cables=new Set;i&&this.setOptions(i)}get location(){let t=this.options.location;return Array.isArray(t)?t[0]:t}get type(){return(this.location||this.tile.path)instanceof p?"POINT":"REGION"}get points(){let t=this.options.location||this.tile.path||R;return Hp(t).map(e=>[this.tile.worldPosn(e[0]),e[1]])}setOptions(t,e=!0){Object.assign(this.options,t),e&&this.redraw()}redraw(){for(let t of this.cables)t.redraw()}},Nr=class extends Dr{sendMessage(t){this.cables.size===0&&this.redraw();for(let e of this.cables.values())e.enqueueMessage(t,!1);jp()}addCable(t,e=!1){this.cables.add(t),!t.to&&!t.dragging&&this.cables.size>1&&this.removeCable(t,!1),e&&(this.tile.updateCableProps(),this.tile.$parent.flushChanges()),this.redraw()}removeCable(t,e=!0){this.cables.delete(t),t.delete(),e&&this.redraw(),this.tile.updateCableProps()}redraw(){if(At(this.cables,t=>t.to))for(let t of this.cables)!t.to&&!t.dragging&&this.removeCable(t);this.cables.size||this.addCable(new ns(this)),super.redraw()}delete(){for(let t of this.cables)t.delete()}},Gr=class extends Dr{setOptions(t,e=!0){Object.assign(this.options,t);let i=Array.isArray(t.location)?t.location[0]:t.location;i instanceof p?this.$dot=m("circle",{class:"link-dot persist",r:qp,cx:i.x,cy:i.y},this.tile.$el):this.$dot&&this.$dot.remove(),e&&this.redraw()}addCable(t,e){e&&this.tile.highlight(!0),this.cables.add(t),this.options.connect&&this.options.connect(t)}removeCable(t,e){var i,n;e&&this.tile.highlight(!1),(n=(i=this.options).disconnect)==null||n.call(i,t),this.cables.delete(t)}delete(){for(let t of this.cables)t.from.tile.$parent.pendingChanges.add(t.from.tile),t.from.removeCable(t)}validateConnection(t){return oh(t,this)}},rh=[],nh=!1;function jp(){var t,e;if(nh)return;nh=!0;let s=0;for(;rh.length;){if(s>=1e4)throw new Error("Queue overflow!");let[i,n]=rh.shift();(t=i.to)!=null&&t.options.message&&((e=i.to)==null||e.options.message(n,i)),s++}nh=!1}function oh(s,t){if(s.tile===t.tile||t.options.max&&[...t.cables].filter(r=>r.from!==s||r.to!==t).length>=t.options.max)return!1;let e=t.options.tileTypes;if(e){let n=s.tile.props.name;if(!e.includes(n))return!1}let i=s.options.tileTypes;if(i){let n=t.tile.props.name;if(!i.includes(n))return!1}return!0}var ns=class s{constructor(t,e){this.from=t;this.dragging=!1;let i=this.from.tile.$parent,n=t.options.persistent?"":"dashed";this.$group=m("g",{class:"link-bar",style:"display:none"},t.tile.$el),this.$line=m("path",{style:"pointer-events: none",class:n},this.$group),this.$originDot=m("circle",{class:"link-dot",r:qp},this.$group),this.$handle=m("path",{class:"link-handle",d:t0},this.$group),this.connectTo(e),i.events.listen(this.$handle,{start:()=>{i.selection.add(t.tile,!0),Wi=this.dragging=!0},move:({posn:o})=>{this.connectTo(i.getInputAt(o,this.from),o)},end:()=>{Wi=this.dragging=!1,this.to&&this.to.tile.highlight(!1),this.redraw(),t.addCable(this,!0)},click:()=>{this.connectTo(),t.addCable(this,!0)}});let r;i.events.listen(this.$originDot,{start:()=>{i.selection.add(t.tile,!0),r=new s(this.from),Wi=r.dragging=!0,this.from.addCable(r)},move:({posn:o})=>{r.connectTo(i.getInputAt(o,this.from),o)},end:()=>{r.to&&r.to.tile.highlight(!1),r.redraw(),Wi=r.dragging=!1,t.addCable(r,!0),r=void 0}})}connectTo(t,e){this.to&&this.to!==t&&this.to.removeCable(this,!0),t?this.to!==t&&oh(this.from,t)&&(this.to=t,t.addCable(this,e!==void 0),this.from.options.connect&&this.from.options.connect(this)):this.to=void 0,this.redraw(e)}redraw(t){var y;if(!((!this.from.options.hidden||this.to||t)&&(this.from.options.persistent||this.from.tile.isActive||((y=this.to)==null?void 0:y.tile.isActive))))return this.$group.hide();if(this.from.tile.$el.append(this.$group),this.$group.show(),!this.to&&!t){let[f,v]=this.from.points[0],w=new wt(R,20).at(v/(Math.PI*2));this.$handle.setTransform(this.from.tile.relativePosn(f).add(w),v),this.$line.setAttr("d",""),this.$originDot.hide();return}let i=this.to?this.to.points:[[t,0]],n=xi(this.from.points,i),[r,o]=Ls(n,([f,v])=>p.distance(f[0],v[0])),a=this.from.tile.relativePosn(r[0]),h=o[1]+J((this.to?this.to.tile.rot:180)-this.from.tile.rot),l=this.to?new wt(R,14).at(h/(Math.PI*2)):R,c=this.from.tile.relativePosn(o[0]).add(l),u=p.distance(a,c),d=a.add(p.fromPolar(r[1],u*.7)),g=c.add(p.fromPolar(h,Math.max(u*.7,40)));this.$line.setAttr("d",`M${c.x} ${c.y}C${g.x} ${g.y},${d.x} ${d.y},${a.x} ${a.y}`),this.$handle.setTransform(c,h+Math.PI,this.to?.8:1),this.$originDot.setTransform(a),this.$originDot.show()}delete(){this.connectTo(),this.$group.remove()}enqueueMessage(t,e=!0){if(rh.push([this,t]),e&&jp(),!this.from.options.highlights)return;let n=t.type==="number"&&t.value===1?q.yellow:q.blue;this.$line.setAttr("style",`stroke: ${n}`),this.$handle.setAttr("style",`fill: ${n}`)}serialize(){return this.to?{fromPort:this.from.name,toTileId:this.to.tile.id,toPort:this.to.name}:void 0}static unSerialize(t,e,i){var o,a;let n=i.tiles.get(t),r=i.tiles.get(e.toTileId);if(n&&r){let h=(o=n.outPorts)==null?void 0:o.get(e.fromPort||"main"),l=(a=r.inPorts)==null?void 0:a.get(e.toPort||"main");h&&l&&oh(h,l)&&h.addCable(new s(h,l))}}static get isMoving(){return Wi}};var Br=["polygon","custom-polygon","reg-polygon","rectangle","polyomino","circle","arrow"],zr=class{constructor(t){this.tileContext=t,this.tileContextProps=this.tileContext.props,this.tileContextProps.watch("color",()=>this.setColor()),this.tileContextProps.watch("textLabel",()=>{var e;this.tileContext.value=(e=dn.fromString(this.tileContextProps.textLabel||""))==null?void 0:e.value,this.renderTextLabel()}),this.tileContextProps.watch("textLabelRotate",()=>this.align()),this.tileContextProps.watch("textLabelFontSize",()=>this.setFontSize())}renderTextLabel(){if(this.$textLabel){this.$textLabel.text=this.tileContextProps.textLabel||"",this.align();return}this.tileContextProps.textLabel&&(this.$textLabel=m("text",{class:"polygon-text-label",text:this.tileContextProps.textLabel,"dominant-baseline":"middle"},this.tileContext.$el),this.setColor(),this.setFontSize(),this.align())}setColor(){this.$textLabel&&this.$textLabel.css("fill",yr(this.tileContextProps.color))}setFontSize(){if(!this.$textLabel)return;let t=this.tileContextProps.textLabelFontSize||0;this.$textLabel.css("font-size",gp(t)),this.$textLabel.setAttr("dy",t)}align(){if(!this.$textLabel)return;let t=this.tileContextProps.textLabelRotate?0:-this.tileContext.rot;this.$textLabel.setTransform(this.tileContext.path&&Ye(this.tileContext.path)?this.tileContext.path.centroid:this.tileContext.center,J(t))}};var q={grey:"#cccccc",darkGrey:"#242436",red:"#cd0e66",orange:"#eb4726",yellow:"#fd8c00",lime:"#bfc212",green:"#22ab24",teal:"#009ea6",blue:"#0f82f2",purple:"#6d3bbf",fg:"var(--canvas-fg)",bg:"var(--canvas-bg)"},e0="M12.5,0H0V25H12.5a12.5,12.5,0,0,0,0-25Z",s0="M0,0V12.5a12.5,12.5,0,0,0,25,0V0Z",_r=new Map,Fr=new Map,i0=[];function Ut(s){_r.set(s.type,s)}function Mt(s){i0.push(...s)}var H=class s{constructor(t,e,i,n){this.$parent=t;this.rot=0;this.snapPoints=[];this.snapLines=[];this.snapAngles=[0,90];this.id=i||We(10),e.name||(e.name=this.constructor.type),this.props=Bp(e,this),this.posn=new p(this.props.x||0,this.props.y||0),this.rot=e.rot||0,this.$el=n||m("g",{class:"tile"}),t.tiles.set(this.id,this),Fr.set(this.$el._el,this),t.pendingChanges.add(this),this.props.watch("status",({status:r})=>{this.$el.setClass("locked-tile",r==="locked"),this.$el.setClass("hidden-tile",r==="hidden"),this.canSelect||this.$parent.selection.remove(this)}),this.props.watch("sound",r=>Gp(r.sound||"piano")),this.props.watch("zIndex layer",()=>this.updateZIndex(!0)),this.props.watch("hideHandles",()=>this.$el.setClass("no-handles",!this.showHandles))}static create(t,e,i){let n=_r.get(e.name);if(!n)throw new Error(`Unknown tile type: ${e.name}`);let r=Object.assign({},n.defaultProps||{},e);r.arpeggio===!1&&!r.musicScale&&(r.musicScale="none",r.arpeggio=void 0);let o=new n(t,r,i);return o.setTransform(),o}static thumbnail(t,e,i){var o,a;let n=_r.get(e);if(!n)throw new Error(`Unknown tile type: ${e}`);let r=we(i.attr("props"),{});return i.setAttr("aria-label",((o=n.altText)==null?void 0:o.call(n,r))||r.name),(a=n.makeThumbnail)==null?void 0:a.call(n,i,r,t)}delete(){var t,e,i;if(!this.isDeleting){this.isDeleting=!0,(t=this.track)==null||t.stop(),this.collision&&this.collision.setCollision();for(let n of this.optionListeners||[])this.$parent.options.unwatch(n);for(let n of this.stateListeners||[])this.$parent.state.unwatch(n);this.$parent.selection.remove(this);for(let n of((e=this.inPorts)==null?void 0:e.values())||[])n.delete();for(let n of((i=this.outPorts)==null?void 0:i.values())||[])n.delete();this.$parent.tiles.delete(this.id),this.$parent.zIndex.remove(this),this.$parent.mathContext.removeSource(this),Fr.delete(this.$el._el),this.$parent.pendingChanges.add(this),this.$el.remove()}}applyChange(t){this.props.assign(t),this.flushChanges(),("x"in t||"y"in t||"rot"in t)&&this.setTransform(new p(this.props.x,this.props.y),this.props.rot)}flushChanges(){return this.props.flushChanges()}setupAudioTrack(){}makeHandle(t,e,i,n,r){let a=m(t==="c"?"circle":"path",{class:"handle"},this.$el);return t==="h"&&a.setAttr("d",e0),t==="v"&&a.setAttr("d",s0),t==="c"&&a.setAttr("r",10),a.css("cursor",t==="c"?"move":t==="h"?"ew-resize":"ns-resize"),this.$parent.events.listen(a,{down:()=>{var h;return(h=this.track)==null?void 0:h.stop()},start:()=>{this.$parent.selection.add(this.root,!0),n==null||n()},move:h=>e(this.relativePosn(h.posn),h.posn,h.event),click:()=>i==null?void 0:i(),end:()=>{r==null||r(),this.$parent.flushChanges()}}),a}is(t){return this.props.name===t}get $container(){return this.$parent.$tiles[this.props.layer==="back"?0:this.props.layer==="front"?2:1]}updateZIndex(t){t&&this.$parent.zIndex.addOrUpdate(this);let e=this.$parent.zIndex.getTileAbove(this);if(!e)return this.$container.append(this.$el);e.$el.insertBefore(this.$el)}get canSelect(){return this.$parent.state.authorMode?!0:this.props.status!=="hidden"&&this.props.status!=="locked"}get canEdit(){return this.$parent.state.authorMode?!0:!this.authoringOnly&&this.props.status!=="fixed"&&this.props.status!=="generator"}get canRotate(){return this.cannotRotateType?!1:this.$parent.state.authorMode?!0:this.canEdit&&!this.$parent.options.noRotating&&!this.props.cannotRotate}get showHandles(){return this.$parent.state.authorMode?!0:!this.props.hideHandles&&!this.authoringOnly&&this.props.status!=="generator"}get altText(){var e;if(this.props.altText)return this.props.altText;let t=_r.get(this.props.name);return((e=t==null?void 0:t.altText)==null?void 0:e.call(t,this.props))||this.props.name}watchPolypadOptions(t){this.optionListeners||(this.optionListeners=[]),this.optionListeners.push(t),this.$parent.options.watch(t)}watchPolypadState(t){this.stateListeners||(this.stateListeners=[]),this.stateListeners.push(t),this.$parent.state.watch(t)}showErrorIcon(t){var e;if(this.currentError=t,!t)return(e=this.$errorIcon)==null?void 0:e.detach();this.$errorIcon||(this.$errorIcon=m("g",{style:"cursor: pointer"}),m("circle",{cx:12,cy:12,r:12,fill:"transparent"},this.$errorIcon),mp("warning",q.yellow,24,void 0,this.$errorIcon),this.transform(),this.$parent.events.listen(this.$errorIcon,{click:()=>{let i=this.$errorIcon.transformMatrix,n=this.posn.shift(i[0][2],i[1][2]);this.$parent.warningBanner.show(n,this.currentError)}})),this.$el.append(this.$errorIcon)}setCollision(t){var e;!this.canEdit||t&&!t.canEdit||t&&t===this.collision||((e=this.collision)==null||e.highlight(!1),this.collision=t,t==null||t.highlight(!0))}collide(t){}get root(){var t;return((t=this.group)==null?void 0:t.root)||this}flipColor(t){let{color:e,backColor:i}=this.props;this.props.color=i||t,this.props.backColor=e}click(t,e){}doubleClick(t){}down(t){}up(t){}format(t,e){}focus(){this.$parent.focussedTile=this,this.$parent.selection.clear(),this.isFocussed=!0,this.$parent.trigger("change-focus",{tiles:[this]})}blur(){this.isFocussed=!1,this.$parent.focussedTile=void 0,this.$parent.trigger("change-focus",{tiles:[]})}highlight(t=!0){}onDropzonesChange(){}select(){this.isActive=!0,this.$el.addClass("active"),this.$el.setClass("no-handles",!this.showHandles),this.noAutoLayering||this.updateZIndex(),this.redrawCables()}deselect(){this.isDeleting||(this.isActive=!1,this.$el.removeClass("active"),this.noAutoLayering||this.updateZIndex(),this.redrawCables())}moveStart(t=!1){this.startPosn=this.posn}move(t,e){var i;if(t){let n=(i=this.startPosn)==null?void 0:i.add(t);n&&(this.posn=n),this.transform(!0)}}moveEnd(){this.collision&&this.collide(this.collision),this.setTransform()}rotate(t,e=R){this.posn=this.posn.rotate(J(t),e),this.rot=gt(this.rot+t,360),this.transform(!0)}transform(t){var i,n;let e=J(this.rot);this.$el.setTransform(this.posn,e),this.redrawCables(),!t&&this.path&&(this.transformed=this.path.rotate(e).translate(this.posn),this.padding&&(this.transformedPadded=Lt(this.path).padding(...this.padding).rotate(e).translate(this.posn)),this.snapPoints=this.getSnapPoints().map(r=>r.rotate(e).translate(this.posn)),this.snapLines=this.getSnapLines().map(r=>r.rotate(e).translate(this.posn)),(i=this.$errorIcon)==null||i.setTransform(Lt(this.path).p.shift(-28,5)),(n=this.group)==null||n.transform())}setTransform(t=this.posn,e=this.rot){this.posn=t,this.props.x=t.x,this.props.y=t.y,this.rot=this.props.rot=gt(e,360),this.transform()}getSnapPoints(){return this.path?rt(this.path)?[this.path]:St(this.path)?this.path.points:it(this.path)?[this.path.p1,this.path.p2]:U(this.path)?[this.path.c,this.path.c.shift(0,this.path.r),this.path.c.shift(0,-this.path.r),this.path.c.shift(this.path.r,0),this.path.c.shift(-this.path.r,0)]:Ze(this.path)?[...this.path.majorVertices,...this.path.minorVertices]:Pe(this.path)?[this.path.c,this.path.start,this.path.end]:Nt(this.path)?[this.path.start,this.path.end]:Ft(this.path)?[]:[]:[]}getSnapLines(){return[]}relativePosn(t){return t.subtract(this.posn).rotate(-J(this.rot))}worldPosn(t){return t.rotate(J(this.rot)).add(this.posn)}get center(){return this.path?U(this.path)||Ze(this.path)?this.path.c:Lt(this.path).center:R}contains(t){let e=this.transformed;return!e||!St(e)&&!U(e)&&!Pe(e)?!1:e.contains(t)}findNearby(t,e,i){let n=i||this.worldPosn(this.center);for(let r of this.$parent.getTilesOfType(t))if(r!==this&&p.distance(n,r.worldPosn(r.center))<e)return r}animateTo(n){return D(this,arguments,function*(t,e=this.rot,i=400){yield s.animate([{tile:this,posn:t,rot:e}],i)})}static animate(t,e=400,i,n="sine"){return D(this,null,function*(){var h;let r=t.flatMap(({tile:l,posn:c,rot:u,scale:d})=>Array.from(ke([l],!0),g=>{let y=g.posn.add(c).subtract(l.posn);return{tile:g,posn:y,rot:u,scale:d}})),o=r.map(l=>l.tile.posn),a=r.map(l=>l.tile.rot);for(let l of r)l.tile.setTransform(l.posn,(h=l.rot)!=null?h:l.tile.rot),e&&(l.tile.isAnimating=!0);if(!e)return Promise.resolve();yield pt(l=>{var c,u;l=yt(n,l);for(let[d,g]of r.entries()){let y=J(tt(a[d],(c=g.rot)!=null?c:g.tile.rot,l));if(g.tile.is("group")){let f=p.interpolate(o[d].subtract(g.posn),R,l);g.tile.transformed=g.tile.path.rotate(y,g.tile.path.center).translate(f)}else{let f=p.interpolate(o[d],g.posn,l),v=g.scale?tt(g.scale[0],g.scale[1],l):void 0;g.tile.$el.setTransform(f,y,v),g.tile.transformed=(u=g.tile.path)==null?void 0:u.rotate(y).translate(f)}}i&&i(l)},e).promise;for(let l of r)l.tile.isAnimating=!1})}delayedSetup(){var e;for(let i of((e=this.outPorts)==null?void 0:e.values())||[])for(let n of i.cables)n.delete();let t=this.props.cables||[];for(let i of t)ns.unSerialize(this.id,i,this.$parent)}redrawCables(){var t,e;for(let i of((t=this.inPorts)==null?void 0:t.values())||[])i.redraw();for(let i of((e=this.outPorts)==null?void 0:e.values())||[])i.redraw()}makeInPort(t,e){this.inPorts||(this.inPorts=new Map),this.inPorts.has(t)||this.inPorts.set(t,new Gr(this,t));let i=this.inPorts.get(t);return i.setOptions(e,!1),i}makeOutPort(t,e){this.outPorts||(this.outPorts=new Map),this.outPorts.has(t)||this.outPorts.set(t,new Nr(this,t));let i=this.outPorts.get(t);return i.setOptions(e,!1),i}emitMessage(t,e){var i;typeof t=="string"&&(t=(i=this.outPorts)==null?void 0:i.get(t)),t==null||t.sendMessage(e)}*getCableData(t="out"){let e=t==="in"?this.inPorts:this.outPorts;if(e)for(let i of e.values())for(let n of i.cables)(t==="in"||n.to)&&(yield n.serialize())}updateCableProps(){if(this.$parent.setup)return;let t=Array.from(this.getCableData());this.props.cables=t.length?t:void 0}getClosestPort(t,e,i=10){if(!this.inPorts)return;let n=this.relativePosn(t);for(let a of this.inPorts.values())if(a.location&&rt(a.location)&&p.distance(a.location,n)<=i&&(!e||a.validateConnection(e)))return a;if(!this.contains(t))return;let r=Array.from(this.inPorts.values()).filter(a=>!e||a.validateConnection(e));for(let a of r.filter(h=>h.type==="REGION"))if((a.location||this.path).contains(n))return a;let o=r.filter(a=>a.type==="POINT");return Ls(o,a=>p.distance(n,a.location))}},n0=new vt(R,new p(0,1)),r0=new G(R,50,50).shift(-25,-25).polygon,ni=class extends H{constructor(t,e,i){super(t,e,i),this.$path=m("path",{class:"polygon-tile"},this.$el),this.$outline=m("path",{class:"outline"},this.$el),this.props.watch("color",({color:n})=>this.$path.setAttr("fill",n)),this.textLabelInstance=new zr(this)}transform(t){var e;super.transform(t),(e=this.textLabelInstance)==null||e.align()}setPath(t=r0,e,i){if(e&&!this.symmetric&&(t=t.reflect(n0)),this.path=t,St(t)&&(this.snapAngles=Wt(t.edges.map(o=>gt(Math.round(Kt(o.angle)),180)))),this.$path.draw(t,{cornerRadius:i}),this.$outline.draw(t,{cornerRadius:i}),this.transform(),!St(t))return;let n=G.aroundPoints(t.points),r=new p(n.center.x,n.p.y);this.showSelectionOutline=p.distance(r,t.project(r))>5}select(){var t,e;(t=this.track)==null||t.stop(),(e=this.$audio)==null||e.removeChildren(),super.select()}setupAudioTrack(){St(this.path)&&(this.$audio=m("g",{style:"font-size:15px;font-weight:600",fill:"white"}),this.$outline.insertBefore(this.$audio),this.track=Fp(this,this.$audio),this.props.watch("labels",()=>this.track.stop()))}flip(t){this.props.isFlipped=!this.props.isFlipped||void 0;let e=new p(2*t.x-this.posn.x,this.posn.y);this.setTransform(e,-this.rot)}};var qr={point:(s,t)=>s!==void 0&&t!==void 0?new p(s,t):void 0,angle:(s,t,e)=>s&&t&&e?new Vt(s,t,e):void 0,line:(s,t)=>s&&t&&!s.equals(t)?new vt(s,t):void 0,segment:(s,t)=>s&&t&&!s.equals(t)?new Y(s,t):void 0,circle:(s,t)=>s&&t?new wt(s,t):void 0,arc:(s,t,e)=>s&&t&&e?new qt(s,t,e):void 0,polygon:(...s)=>s.every(Boolean)?new V(...s):void 0,polyline:(...s)=>s.every(Boolean)?new te(...s):void 0,triangle:(s,t,e)=>s&&t&&e?new Ti(s,t,e):void 0,rectangle:(s,t,e)=>s?new G(s,t,e):void 0,distance:p.distance,intersections:Q},o0=/^_x\d+\.at\([\d.e-]+\)$/,a0=/^intersections\(|\.midpoint$|\.centroid$/,Hr=class{constructor(){this.model=le({});this.tiles=new Map;this.dependencies=new Map;this.model.assign(qr),this.queueLabelPositioning=ve(()=>{for(let t of this.tiles.values())Xp(t)},0,!0)}reset(){this.model.clear(),this.model.assign(qr)}redrawLines(t){for(let e of this.tiles.values())e.path&&Wo(e.path)&&(e.$el.draw(e.path,{box:t}),e.$shadow.setAttr("d",e.$el.attr("d")))}},Yt=class extends H{constructor(e,i,n){super(e,i,n,m("path",{class:"geo-path"},e.$geoPaths));this.$parent=e;this.hideSelectionOutline=!0;this.noAutoLayering=!0;this.isProjection=!1;this.parentKeys=[];this.deleted=!1;this.onDraw=()=>this.draw();this.$shadow=m("path",{class:"geo-shadow"},e.$geoShadows),this.props.key||(this.props.key=e.geoData.model.getKey()),e.geoData.tiles.set(this.props.key,this),this.snapPoints=this.snapLines=this.snapAngles=[],this.props.expr&&this.setExpr(this.props.expr),e.geoData.model.watch(this.onDraw),this.props.color||(this.props.color=e.state.penColor),this.props.watch("color",({color:r})=>{var o,a,h;(o=this.$el)==null||o.css("color",r),(a=this.$shadow)==null||a.css("color",r),(h=this.$label)==null||h.setAttr("fill",r)}),this.props.watch("arrows marks",()=>this.draw(!0)),this.props.watch("label",({label:r})=>{if(!r&&this.$label)return this.$label.detach();this.$label||(this.$label=m("text",{fill:this.props.color,class:"geo-label"})),this.$parent.$geoPoints.append(this.$label),Xp(this)})}applyChange(e){super.applyChange(e),"expr"in e&&this.setExpr(this.props.expr)}setExpr(e,i=!1){let n=ct(e);this.$parent.geoData.model.setComputed(this.props.key,n),!i&&(this.props.expr=e,this.setParentKeys(e.match(/_x\d+/g)||[]),this.isProjection=o0.test(e),this.computed=a0.test(e),this.$el.setClass("intersection",this.computed))}draw(e=!1){let i=this.$parent.geoData.model[this.props.key];if(!e&&i===this.path)return;this.path=i,this.$el.setAttr("hidden",i?void 0:!0),this.isActive&&!i&&this.$shadow.hide();let n=i==null?void 0:i.type;if(n!==this.geoType&&(this.$el.setClass("geo-point",n==="point"),this.$el.setClass("geo-path",n!=="point"),this.geoType=n,this.$container.append(this.$el)),!i)return;n==="point"&&(i=new wt(i,this.computed?3.5:6)),this.$el.setClass("fill",this.geoType==="angle");let r=this.$parent.canvasBounds||this.$parent.viewportBounds;this.$el.draw(i,{box:r.rect,arrows:this.props.arrows,mark:this.props.marks}),this.$shadow.setAttr("d",this.$el.attr("d")),this.transform()}setParentKeys(e){var n;let i=this.$parent.geoData.dependencies;for(let r of this.parentKeys)(n=i.get(r))==null||n.delete(this.props.key);this.parentKeys=e;for(let r of e)i.has(r)||i.set(r,new Set),i.get(r).add(this.props.key)}get parents(){let e=this.$parent.geoData.tiles;return this.parentKeys.map(i=>e.get(i)).filter(Boolean)}get children(){let e=this.$parent.geoData.dependencies.get(this.props.key);return e?Array.from(e).map(i=>this.$parent.geoData.tiles.get(i)).filter(Boolean):[]}get ariaDescription(){var e;return`${(e=this.path)==null?void 0:e.type} ${this.props.key}: ${this.props.expr}`}get $container(){return this.geoType==="point"?this.$parent.$geoPoints:this.$parent.$geoPaths}select(){var e;this.isActive=!0,this.path&&(this.geoType==="angle"?this.$el.addClass("hover"):(this.$shadow.show(),(e=this.$el.parent)==null||e.append(this.$el)))}deselect(){this.isActive=!1,this.$shadow.hide(),this.$el.removeClass("hover")}hover(e=!0){this.isActive||!this.path||(this.geoType==="angle"?this.$el.setClass("hover",e):e?this.$shadow.show():this.$shadow.hide())}transform(){this.transformed=this.path,this.snapPoints=this.pending?[]:this.getSnapPoints(),this.snapLines=this.pending||!this.path||rt(this.path)||Ft(this.path)?[]:[this.path],this.$parent.geoData.queueLabelPositioning()}setTransform(){this.transform()}shift(e){/^point\([\d.-]+,[\d.-]+\)$/.test(this.props.expr)&&this.setExpr(this.path.translate(e).toString())}delete(){var e;this.deleted=!0,super.delete(),this.$parent.geoData.model.unwatch(this.onDraw),this.$parent.geoData.model[this.props.key]=void 0,this.$parent.geoData.tiles.delete(this.props.key),this.$shadow.remove(),(e=this.$label)==null||e.remove();for(let i of this.children)i.delete()}setPending(e=!0){this.pending=e,e||this.transform();for(let i of this.children)i.setPending(e)}moveStart(){if(!(this.computed||!this.path)){if(this.isProjection){if(this.$parent.selection.size>1)return;this.setParentKeys([])}this.setPending(!0);for(let e of this.parents)e.moveStart();this.moveStartValue=this.transformed}}move(e,i){if(!(!e||!this.path||!this.moveStartValue))if(rt(this.path))this.snapTarget=i,this.$el.setClass("intersection",this.computed||!!(i!=null&&i.intersection)),this.$parent.geoData.model[this.props.key]=this.moveStartValue.translate(e);else for(let n of this.parents)n.move(e)}moveEnd(){var e,i,n,r;if(this.moveStartValue){for(let o of this.parents)o.moveEnd();if(this.setPending(!1),(e=this.snapTarget)!=null&&e.intersection)this.setExpr(this.snapTarget.intersection);else if(((n=(i=this.snapTarget)==null?void 0:i.tile)==null?void 0:n.props.name)==="geo"){let o=(r=this.snapTarget)==null?void 0:r.tile;if(o.path&&rt(o.path)){let a=this.children;for(let h of a)h.setExpr(h.props.expr.replaceAll(this.props.key,o.props.key));this.delete(),this.$parent.flushChanges()}else if(o.path){let a=o.path.offset(this.$parent.geoData.model[this.props.key]);this.setExpr(`${o.props.key}.at(${a})`)}}else this.path&&rt(this.path)&&(this.props.expr=`point(${this.path.x},${this.path.y})`,this.isActive||this.$parent.pendingChanges.add(this))}}static getInferredShape(e){if(e=e.filter(h=>h.path),!e.length)return;if(e.length===1)return{type:e[0].path.type,expr:e[0].props.key,value:e[0].path};e=e.filter(h=>h.geoType!=="angle");let i=e.filter(h=>rt(h.path)),n=e.filter(h=>it(h.path)||U(h.path));if(n.length===1&&i.length===e.length-1){let h=n[0].path;if(i.every(l=>h.contains(l.path)))return{type:h.type,expr:n[0].props.key,value:h}}let r=n.filter(h=>it(h.path));if(i.length+r.length!==e.length)return;for(let h of r)if($e(h.path)){let l=h.parentKeys.map(c=>h.$parent.geoData.tiles.get(c));for(let c of l)i.includes(c)||i.push(c)}else if(i.filter(l=>h.path.contains(l.path)).length<2)return;let o=i.map(h=>h.props.key).join(","),a=i.map(h=>h.path);if(i.length===2){let h=new Y(a[0],a[1]);return{type:"segment",expr:`segment(${o})`,value:h}}return i.length===3?{type:"triangle",expr:`triangle(${o})`,value:new Ti(...a)}:{type:"polygon",expr:`polygon(${o})`,value:new V(...a)}}static copy(e,i,n){let r=h=>{let l=e.get(h)||n.model.getKey();return e.set(h,l),l},o=r(i.key),a=i.expr.replace(/\b_x\d+\b/g,r);return{key:o,expr:a}}};Yt.type="geo",Yt=T([Ut],Yt);var Up=new WeakMap,Wp=s=>{let t=Up.get(s);if(t)return t;let e=Yt.getInferredShape(s);return Up.set(s,e),e};Mt([["Midpoint","geo-midpoint","$0.midpoint","segment"],["Perpendicular bisector","geo-perp-bisector","$0.perpendicularBisector","segment"],["Parallel line","geo-parallel","$0.parallel($1)","line","segment"],["Perpendicular line","geo-perpendicular","$0.perpendicular($1)","line","segment"],["Tangent line","geo-tangent","line($0.c,$1).perpendicular($1)","circle"],["Centroid","geo-centroid","$0.centroid","polygon","triangle"],["Circumcircle","geo-circumcircle","$0.circumcircle","triangle"],["Incircle","geo-incircle","$0.incircle","triangle"],["Angle bisector","geo-angle-bisector","$0.bisector","angle"]].map(([s,t,e,...i])=>({id:t,type:"button",tileTypes:["geo"],label:s,icon:t,noFlush:!0,show:n=>{var r;return i.includes(((r=Wp(n))==null?void 0:r.type)||"")},click:(n,r)=>{var h;let o=(h=Wp(n))==null?void 0:h.expr,a=e.replace(/\$0/g,o||"");if(a.includes("$1"))r.tools.geoPending.enable(a);else{let l=H.create(r,{name:"geo",expr:a});r.selection.add(l,!0);let c=rt(l.path)?"pop":"draw",u=l.$el.enter(c,400);l.$shadow.enter(c,400),r.snapping.updateIntersections(),r.flushChanges(),u.promise.then(()=>l.$el.css("display",""))}}})));Mt([{id:"line-style",type:"select",tileTypes:["geo"],label:"Line Type:",location:"more",show:s=>s.every(t=>t.path&&it(t.path)),options:[{key:"line",label:"Line"},{key:"ray",label:"Ray"},{key:"segment",label:"Segment"}],get:s=>s.geoType,set:(s,t)=>t.setExpr(t.props.expr.replace(/\.(line|ray|segment)$/,"")+`.${s}`)},{id:"arrows",type:"select",tileTypes:["geo"],label:"Arrows:",location:"more",show:s=>s.every(t=>t.geoType==="segment"),options:[{key:"",label:"None"},{key:"start",label:"Start"},{key:"end",label:"End"},{key:"both",label:"Both"}],get:s=>s.props.arrows||"",set:(s,t)=>t.props.arrows=s||void 0},{id:"marks",type:"select",tileTypes:["geo"],label:"Decoration:",location:"more",show:s=>s.every(t=>t.path&&it(t.path)),options:[{key:"",label:"None"},{key:"bar",label:"Bar"},{key:"bar2",label:"Double Bars"},{key:"arrow",label:"Arrow"},{key:"arrow2",label:"Double Arrows"}],get:s=>s.props.marks||"",set:(s,t)=>t.props.marks=s||void 0}]);Mt([{id:"label",type:"input",tileTypes:["geo"],label:"Label:",location:"more",get:s=>s.props.label||"",set:(s,t)=>t.props.label=s}]);var Kp=Math.PI/12;function h0(s){return be(s/Kp,.03)?new dn(Math.round(s/Kp),12,"\u03C0").simplified.toString():Rt(s,4)}function l0(s,t){return $e(t)?s.replace(/\$l/g,Rt(t.length/50,4)):St(t)||U(t)?s.replace(/\$[cp]/g,Rt(t.circumference/50,4)).replace(/\$a/g,Rt(t.area/2500,4)):Ft(t)?s.replace(/\$r/g,h0(t.rad)).replace(/\$d/g,Rt(t.deg,4)+"\xB0"):s}function Xp(s){if(!s.props.label||!s.path)return;s.$label.text=l0(s.props.label,s.path);let[t,e]=c0(s);s.$label.css("transform",`translate(${t.x}px,${t.y}px) rotate(${e}rad)`)}function c0(s){let t,e=s.$label.width,i=12,n=new G(new p(-e/2-3,-i-3),e+6,i+6);for(let r of p0(s.path,s,e,i)){t||(t=r);let o=n.rotate(r[1]).translate(r[0]);if(!At(s.$parent.geoData.tiles.values(),a=>{if(!a.path||a.props.status==="hidden"||a===s)return!1;let h=rt(a.path)?new wt(a.path,10):a.path;if(Q(h,o).length)return!0}))return r}return t||[R,0]}function*p0(s,t,e,i){var n;if(rt(s)){let r=t.computed?8:10;yield[s.shift(r+e/2,-r),0],yield[s.shift(-r-e/2,-r),0],yield[s.shift(r+e/2,r+i),0],yield[s.shift(-r-e/2,r+i),0]}else if(it(s)){let r=s.perpendicularVector,o=s.angle;r.y>=0&&(r=r.scale(-1),o+=Math.PI);let a=$e(s)?[.5,.3,.7]:[0,150,-150];for(let h of a)for(let l of[8,-8-i])yield[s.at(h).add(r.scale(l)),o]}else if(St(s))for(let r of s.edges){let o=r.perpendicularVector.scale(8),a=r.angle;o.y>=0&&(o=o.scale(1+i/8),a+=Math.PI),yield[r.midpoint.add(o),a]}else if(U(s))yield[s.at(7/8).shift(5+e/2,-5),0],yield[s.at(5/8).shift(-5-e/2,-5),0],yield[s.at(1/8).shift(5+e/2,5+i),0],yield[s.at(3/8).shift(-5-e/2,5+i),0];else if(Ft(s)){let r=s.isRight?20*Math.sqrt(2):s.radius,o=((n=s.bisector)==null?void 0:n.unitVector.scale(r+6))||R,a=o.angle();yield[s.b.add(o).shift(e/2*Math.cos(a),i/2*(1+Math.sin(a))),0]}}var Cs=25,Zp=5.4,Qp=4.7;var d0="#ddd",u0={1:q.yellow,x:q.green,x2:q.blue,y:q.teal,y2:"#8d2ca1",xy:"#4e53d0"},ah=s=>s[0]==="-"?q.red:u0[s],Yp=s=>s[0]==="-"?s.slice(1):"-"+s;function hh({splitH:s,splitV:t,expr:e},i=!1){let n=s*t;return e.replace(/2$/,"^2")+(n>1?`${i?"//":"/"}${n}`:"")}function jr(s,t,e,i){switch(s.startsWith("-")?s.slice(1):s){case"x2":return[e,e];case"y2":return[i,i];case"xy":return[e,i];case"x":return[t,e];case"y":return[t,i];default:return[t,t]}}function Jp(s){let[t,e]=s.reduce(([n,r],{props:o})=>{let a=o.splitH*o.splitV;return[n*a+r,r*a]},[0,1]),i=xe(t,e);return[t/i,e/i]}function*f0(s){let t=s,e=[];for(let i=1;i<t;++i)s%i||(t=s/i,e.push(t),yield i);for(let i of e.reverse())yield i}var As=class extends ni{constructor(t,e,i){super(t,e,i),this.props.color||(this.props.color=ah(this.props.expr)),this.$label=m("g",{},this.$el);let n=m("g",{style:"font-size:18px;color:white;text-anchor:start",class:"equation"},this.$label);this.labelEqn=new Be(n,void 0,0,""),this.props.watch("color",()=>this.updateFill()),this.props.watch("labels expr",()=>this.updateLabel()),this.resize(),this.move()}applyChange(t){super.applyChange(t),this.resize(),this.move()}get isRotated(){return nt(this.rot,45,135)||nt(this.rot,225,315)}get denominator(){return this.props.splitV*this.props.splitH}isInverseOf(t){return this.denominator===t.denominator&&Yp(this.props.expr)===t.props.expr}get size(){let{algebraXSize:t,algebraYSize:e}=this.$parent.options,{expr:i,splitV:n,splitH:r}=this.props,[o,a]=jr(i,1,t,e);return[o*Cs/r,a*Cs/n]}resize(){let[t,e]=this.size;this.setPath(fp(t,e).polygon)}updateLabel(){let[t,e]=this.size;this.isRotated&&([t,e]=[e,t]);let i=this.props.labels!=="hidden"&&t>=12&&e>=12;if(this.$label.toggle(i),!i)return;this.labelEqn.setValue(this.collision?"0":hh(this.props,e<25));let n=this.labelEqn.root,r=Math.min((t-2)/n.width*.8,e/n.height*.8,1);this.labelEqn.$row.css("transform",`translate(${-n.width/2}px,${-n.height/2}px)`),this.$label.css("transform",`scale(${r}) rotate(${-this.rot}deg)`)}updateFill(){this.$path.setAttr("fill",this.collision?_e(d0,this.$parent.flipTheme):this.props.color)}transform(t){this.updateLabel(),super.transform(t)}getSideLength(t){this.isRotated&&(t=t==="h"?"v":"h");let{expr:e,splitV:i,splitH:n}=this.props,[r,o]=jr(e,"1","x","y");return t==="h"?[r,1/n]:[o,1/i]}getEdge(t){let e=gt(t-Math.round(this.rot/90),4);return this.transformed.edges[e]}setCollision(t){this.collision=t,this.updateFill(),this.updateLabel()}move(t){super.move(t);let e=this.collision;if(e){if(p.distance(this.posn,e.posn)<.95*Cs&&this.isInverseOf(e))return;e.setCollision(),this.setCollision()}for(let i of this.$parent.getTilesOfType("algebra"))if(!(i.collision||!this.isInverseOf(i))&&!(p.distance(this.posn,i.posn)>=.95*Cs)){this.setCollision(i),i.setCollision(this);return}}split(t,e=2){this.isRotated&&(t=t==="h"?"v":"h");let[i,n]=this.size,r=t==="h"?new Y(new p(-i/2,0),new p(i/2,0)):new Y(new p(0,-n/2),new p(0,n/2)),o=ft(ut({},this.props.raw),{splitH:t==="h"?this.props.splitH*e:this.props.splitH,splitV:t==="v"?this.props.splitV*e:this.props.splitV});return this.delete(),z(a=>{let h=this.worldPosn(r.at((a+.5)/e));return H.create(this.$parent,Object.assign({},o,{x:h.x,y:h.y}))},e)}static merge(t){let e=Lt(...t.map(y=>y.transformed)),{x:i,y:n}=e.center,r=t.every(y=>y.isRotated)?90:0,o=t[0].props.expr,{algebraXSize:a,algebraYSize:h}=t[0].$parent.options,l=jr(o,Cs,a*Cs,h*Cs)[0],c=Jp(t)[1],u=[...f0(c)].find(y=>y>=Math.round(l/(r?e.h:e.w)))||1,d=c/u,g=H.create(t[0].$parent,{name:"algebra",expr:o,splitH:u,splitV:d,x:i,y:n,rot:r});for(let y of t)y.delete();return g}static makeThumbnail(t,e){let i=e.expr,[n,r]=jr(i,20,78,64),o=i[0]==="-"?i.slice(1):i,a=o==="y2"?112:["x2","xy"].includes(o)?28:2,h=o==="1"?2:["x","x2"].includes(o)?28:112;e.rot&&([a,h,n,r]=[h,a,r,n]),t.setRect(new G(new p(a,h),n,r)),t.setAttr("fill",ah(i));let l=m("g",{style:"font-size:15px;color:white;text-anchor:start",class:"equation"}),c=new Be(l,void 0,0,"",15,!0);c.setValue(hh(e)),c.$row.css("transform",`translate(${a+n/2-c.root.width/2}px, ${h+r/2-c.root.height/2}px)`),t.insertAfter(l)}static altText(t){return hh(t)+" Algebra Tile"}negate(){this.props.expr=Yp(this.props.expr),this.flipColor(ah(this.props.expr)),this.move()}};As.type="algebra",As.defaultProps={splitH:1,splitV:1},As=T([Ut],As);Mt([{id:"negate",type:"button",tileTypes:["algebra","dot","number-card"],label:"Negate",icon:"turn",useTextLabel:!0,click:s=>{for(let t of s)t.negate()}}]);Mt([{id:"merge-algebra",type:"button",tileTypes:["algebra"],label:"Merge",icon:"merge",useTextLabel:!0,show:s=>s.length<2||!s.every(t=>t.props.expr===s[0].props.expr)?!1:Jp(s)[0]===1,click:(s,t)=>{t.selection.add(As.merge(s),!0)}},{id:"splitV",type:"button",tileTypes:["algebra"],label:"Split Vertically",icon:"split-v",show:s=>s.every(t=>t.props.splitV<8),click:(s,t)=>{t.selection.select(s.flatMap(e=>e.split("v",2)))}},{id:"splitH",type:"button",tileTypes:["algebra"],label:"Split Horizontally",icon:"split-h",show:s=>s.every(t=>t.props.splitH<8),click:(s,t)=>{t.selection.select(s.flatMap(e=>e.split("h",2)))}},{id:"split",type:"range",tileTypes:["algebra"],label:"Denominator:",value:"number",icon:"split-h",location:"more",get:s=>[s.props.splitH,s.props.splitV],set:(s,t)=>{t.props.assign({splitH:B(Math.round(s[0]),1,8),splitV:B(Math.round(s[1]),1,8)}),t.resize(),t.updateLabel()}}]);var td=1,m0=.2,g0=5;function v0([s,t],e,i){if(!i)return[Math.min(s,e),Math.max(t,e)];let n=t<s?t+1:t;if($(n-s,1,.001))return[0,1];if(nt(e<s?e+1:e,s,n))return[s,t];let r=Math.abs(s-e),o=Math.abs(t-e);return Math.min(r,1-r)<Math.min(o,1-o)?[e,t]:[s,e]}function w0(s,t,e){if($(t,0)&&$(e,1))return s;if(it(s))return new Y(s.at(t),s.at(e));if(Nt(s)){let i=s.angle*Math.abs(e-t);return new qt(s.c,s.at(Math.min(t,e)),i)}else if(U(s)){let i=(e-t+(e<t?1:0))*Tt;return new qt(s.c,s.at(t),i)}else if(Ye(s)){let i=as(s.edges.map(h=>h.length)),n=O(i),r=i.findIndex(h=>h/n>t)+1,o=i.findIndex(h=>h/n>e)+1,a=t<=e?s.points.slice(r,o):[...s.points.slice(r),...s.points.slice(0,o)];return new te(s.at(t),...a,s.at(e))}return s}function lh(s,t,e,i){let n=td,r=-1;for(let o=t+1;o<e;o++){let a=new vt(s[t],s[e]).distanceSquared(s[o]);a>n&&(r=o,n=a)}n>td&&(r-t>1&&lh(s,t,r,i),i.push(s[r]),e-r>1&&lh(s,r,e,i))}function y0(s){if(s.length<=2)return s;let t=[s[0]];return lh(s,0,s.length-1,t),t.push(O(s)),t}function b0(s){if(s.length<=2)return De(new te(...s));let t=s.map((e,i)=>{let n=s[i-1]||e.subtract(s[i+1].subtract(e).unitVector),r=s[i+1]||e.subtract(s[i-1].subtract(e).unitVector),o=Math.atan2(r.y-n.y,r.x-n.x),a=Math.abs(new Vt(n,e,r).sup.rad/Math.PI-.5),h=Math.min(p.distance(n,r),100)*a*m0;return new p(Math.cos(o),Math.sin(o)).scale(h)});return s.map((e,i)=>{if(i===0)return`M${e.x.toFixed(2)} ${e.y.toFixed(2)}`;if(p.distance(s[i-1],e)<4)return`L${e.x.toFixed(2)},${e.y.toFixed(2)}`;let n=s[i-1].add(t[i-1]),r=e.subtract(t[i]);return`C${n.x.toFixed(2)},${n.y.toFixed(2)} ${r.x.toFixed(2)},${r.y.toFixed(2)} ${e.x.toFixed(2)},${e.y.toFixed(2)}`}).join("")}var He=class s{constructor(t,e,i,n,r){this.$parent=t;this.brush=n;this.options="";this.$el=m("path",{class:`stroke ${n}`},t.$strokes),this.id=r||We(10),this.setColor(i),e&&this.parse(e),t.strokes.set(this.id,this),this.$parent.pendingStrokes.add(this)}setColor(t){this.color=t,this.$el.setAttr("stroke",_e(t,this.$parent.flipTheme))}parse(t){if(this.options=t,t.startsWith("M")){let e=ra(t);this.path=new te(...e),this.$el.setAttr("d",t)}else this.path=ct(t)(qr),this.path&&(this.snap=!0),this.$el.setAttr("d",this.path?De(this.path):"")}start(t,e){var i;if(this.brush==="ruler"&&(t=((i=this.$parent.snapping.snap([t]))==null?void 0:i.posn)||t),this.startPoint=t,this.path=new te(t,t.shift(.01)),e&&this.brush!=="ruler"){this.utensil=e;let n=e.offset(t);this.utensilRange=[n,n+.01]}this.$el.draw(this.path)}addPoint(t){if(this.brush==="ruler"){let e=this.$parent.snapping.snap([t]),i=(e==null?void 0:e.posn)||t.snap(this.startPoint,g0);this.path=new Y(this.startPoint,i),this.$el.draw(this.path)}else if(this.utensil){let e=B(this.utensil.offset(t),0,1),i=U(this.utensil)||Ye(this.utensil);this.utensilRange=v0(this.utensilRange,e,i),this.path=w0(this.utensil,...this.utensilRange),this.$el.draw(this.path)}else this.path.points.push(t),this.$el.setAttr("d",this.$el.attr("d")+`L${t.x},${t.y}`)}end(){if(this.utensil||this.brush==="ruler")return this.snap=!0,this.options=this.path.toString().replace(/\.(\d{3})\d+/g,(t,e)=>`.${e}`),this.$parent.snapping.addStroke(this);{let t=y0(this.path.points);this.path=new te(...t),this.options=b0(t),this.$el.setAttr("d",this.options)}this.startPoint=this.utensil=this.utensilRange=void 0}flushChanges(){let t=this.serialize();return this.$parent.strokes.has(this.id)?[void 0,t]:[t,void 0]}get snapPoints(){if(this.snap){if($e(this.path))return[this.path.p1,this.path.p2];if(Nt(this.path))return[this.path.start,this.path.end]}}hitTest(t,e){if(!this.path)return!1;let i=this.path.project(t);return(t.x-i.x)**2+(t.y-i.y)**2<e**2}delete(){this.$parent.strokes.delete(this.id),this.$el.remove(),this.$parent.pendingStrokes.add(this)}serialize(t=1/0){return{points:this.options.slice(0,t),color:this.color,brush:this.brush}}get lastSavedData(){return this.serialize()}static create(t,e,i){return new s(t,e.points,e.color||"#000",e.brush||"",i)}};var ed,sd,Ur=new Set,ch=new Set;function x0(s,t,e){let i=gt(s-t,e);return i>e/2?i-e:i}var Wr=class{constructor(t){this.$parent=t;this.angle=0;this.startAngle=0;this.hasChanged=!1;this.showTools=!1;this.isMoving=!1;this.tiles=new Set;this.$tools=t.$(".transform-tools"),this.$shadow=t.$(".group-shadow"),this.$rect=this.$tools.$(".group-outline"),this.$rotateBar=this.$tools.$(".rotate-bar"),this.$rotateCircle=this.$tools.$(".rotate-circle");let e=t.$(".rotate-label");e.hide(),t.events.listen(this.$rotateCircle,{start:()=>{this.startAngle=this.angle,this.rotateStart(),e.show()},move:({startPosn:i,posn:n,event:r})=>{this.rotate(this.startAngle-new Vt(n,this.center,i).deg);let o=It(r).subtract(t.topLeftPosition);e.setTransform(o.shift(b.isMobile?-15:5,b.isMobile?-100:-40)),e.text=gt(Dt(this.angle,1),360)+"\u2009\xB0"},end:()=>{this.rotateEnd(),e.hide()}})}bindKeyboardEvents(t){t.onKey("AllArrows r R",(e,i)=>{if(this.tiles.size){if(i==="r"||i==="R"){if(Array.from(this.tiles).some(r=>!r.canRotate))return;this.rotateStart();let n=i==="r"||i==="R"&&e.shiftKey&&e.getModifierState("CapsLock")?15:-15;this.rotate(this.angle+n),this.rotateEnd()}else{let n=R,r=e.shiftKey?5:25,o=i==="ArrowLeft"?-r:i==="ArrowRight"?r:0,a=i==="ArrowUp"?-r:i==="ArrowDown"?r:0,h=n.shift(o,a);this.moveStart(),this.move({posn:h,startPosn:n}),this.moveEnd()}this.$parent.trigger("shift-selection")}}),t.onKey("Escape",()=>this.clear())}get flatTiles(){return[...ke(this.tiles,!0)]}get size(){return this.tiles.size}add(t,e=!1,i=!1){e&&this.clear(),!t.isActive&&this.$parent.tiles.has(t.id)&&this.select([t],i)}select(t,e=!1){var i;(i=this.$parent.focussedTile)==null||i.blur(),this.$parent.zIndex.bringToFront(ke(t),!1,!0);for(let n of t)n.isActive||!this.$parent.tiles.has(n.id)||n.group||(this.tiles.add(n),n.select(),this.hasChanged=!0);e||this.update(!0)}remove(t,e=!1){t.group||!t.isActive||(t.deselect(),this.hasChanged=!0,this.tiles.delete(t),e||this.update(!0))}clear(){if(!this.isMoving){for(let t of this.tiles)t.deselect();this.tiles.size&&(this.hasChanged=!0),this.tiles.clear(),this.update(!0)}}getTileProperty(t){if(!this.size)return;let e=t(Is(this.tiles.values()));for(let i of this.tiles)if(t(i)!==e)return;return e}update(t=!1){if(t&&!this.hasChanged)return;if(this.hasChanged=!1,!this.size){for(let o of[this.$shadow,this.$tools])o.hide();this.$parent.trigger("change-selection",{tiles:[],color:void 0});return}let e=Array.from(this.tiles).filter(o=>o.transformed);this.angle=this.getTileProperty(o=>o.rot)||0,this.rect=dp(e,J(this.angle)),this.center=this.rect.center;let i=e.every(o=>o.canRotate);if(e.length===1&&U(e[0].transformed)&&(i=!1),i&&this.getTileProperty(o=>o.rotateAroundOrigin)){let o=e[0].posn;e.slice(1).every(a=>a.posn.equals(o))&&(this.center=o,this.angle&&e.length===1&&(this.rect=Lt(e[0].transformed.rotate(-J(this.angle),o))))}this.$rotateBar.toggle(i),this.$rotateCircle.toggle(i);let n=this.size>1||e[0].showSelectionOutline;this.$rect.toggle(n),this.showTools=!this.getTileProperty(o=>o.hideSelectionOutline),this.$tools.toggle(this.showTools),this.$shadow.toggle(n&&this.showTools),(!i||!this.showTools)&&(this.rotateHandle=void 0),(this.size===1?e[0].$container:this.$parent.$svg).append(this.$tools),this.positionTools();let r=this.getTileProperty(o=>o.props.color);this.$parent.trigger("change-selection",{tiles:e,color:r})}positionTools(){if(!this.showTools)return;let t=this.bounds;for(let n of[this.$shadow,this.$rect])n.draw(t);let e=new p(this.center.x,this.rect.p.y),i=new Y(e,e.shift(0,-28)).rotate(J(this.angle),this.center);this.$rotateBar.setLine(i.p1,i.p2),this.$rotateCircle.setCenter(i.p2),this.rotateHandle=i.p2}get bounds(){return this.rect.rotate(J(this.angle),this.center)}getDragBounds(){let{canvas:t,canvasX:e,canvasY:i}=this.$parent.options;if(t==="infinite")return;let n=t==="notebook"?1/0:i!=null?i:0,r=Lt(...Array.from(this.tiles,o=>o.transformed));if(Number.isFinite(r.w))return new lt(-r.p.x,(e!=null?e:0)-r.p.x-r.w,-r.p.y,n-r.p.y-r.h,"swap")}moveStart(t=!1){if(!At(this.tiles,e=>!e.canEdit||e.isAnimating)){this.isMoving=!0,this.$parent.dropzoneManager.onMoveStart(this.tiles);for(let e of this.tiles)e.moveStart(t);this.startSnapPoints=[];for(let e of this.tiles)for(let i of e.snapPoints)this.startSnapPoints.some(n=>i.equals(n))||this.startSnapPoints.push(i);sd=this.rect,ed=this.center,this.dragBounds=this.getDragBounds(),this.$parent.newTileShift=0,this.$parent.trigger("move-start")}}move({posn:t,startPosn:e},i=!1){if(!this.isMoving)return;let n=t.subtract(e);this.dragBounds&&!i&&(n=n.clamp(this.dragBounds));let r=this.startSnapPoints.map(h=>h.add(n)),o=this.$parent.snapping.snap(r);o&&(n=n.add(o.shift));let a=this.tiles.size===1?o:void 0;for(let h of this.tiles)h.move(n,a);this.rect=sd.translate(n),this.center=ed.add(n),this.positionTools(),this.$parent.dropzoneManager.onMove(this.tiles),this.$parent.trigger("move-selection")}moveEnd(t,e=!1){if(this.isMoving){e&&this.$parent.options.canvas!=="infinite"&&this.move(t);for(let i of this.tiles)i.moveEnd();this.$parent.dropzoneManager.onMoveEnd(),At(this.tiles,i=>i.props.name==="geo")&&this.$parent.snapping.updateIntersections(),this.$parent.trigger("move-end"),this.isMoving=!1,this.$parent.flushChanges()}}rotateStart(){ch.clear();for(let t of this.tiles)for(let e of t.snapAngles)ch.add(gt(e+t.rot,180));Ur.clear(),Ur.add(0);for(let t of this.$parent.tiles.values())if(!t.isActive&&At(this.tiles,e=>p.distance(e.posn,t.posn)<140))for(let e of t.snapAngles)Ur.add(gt(e+t.rot,180));this.$parent.dropzoneManager.onMoveStart(this.tiles),this.$parent.newTileShift=0,this.$parent.trigger("rotate-start")}rotate(t){if(t=Pt(t,3),t===this.angle)return;let e=1/0;for(let n of ch)for(let r of Ur){let o=x0(r,n+t-this.startAngle,180);Math.abs(o)<Math.abs(e)&&(e=o)}if(Math.abs(e)<8&&(t+=e),t===this.angle)return;let i=t-this.angle;this.angle=t;for(let n of this.tiles)n.rotate(i,this.center);this.$parent.dropzoneManager.onMove(this.tiles),this.positionTools(),this.$parent.trigger("rotate-selection")}rotateEnd(){for(let t of this.tiles)t.setTransform();this.$parent.dropzoneManager.onMoveEnd(),this.$parent.flushChanges(),this.$parent.trigger("rotate-end")}copy(t){if(!t&&this.$parent.option("noCopyPaste"))return{};if(this.isMoving||!this.tiles.size||ns.isMoving||At(this.tiles,n=>n.cannotCopyDelete))return{};if(!this.$parent.state.authorMode&&At(this.tiles,n=>n.authoringOnly))return{};let e={},i=this.flatTiles;for(let n of i)e[n.id]=n.props.copy();for(let n of i)if(n.is("geo")){for(let r of n.parents)if(!i.includes(r)&&!(r.id in e)&&r.geoType==="point"){let o=`point(${r.path.x},${r.path.y})`;e[r.id]=Object.assign(r.props.copy(),{expr:o})}}return e}delete(){if(this.isMoving||this.$parent.option("noDeleting")||ns.isMoving||At(this.tiles,i=>i.cannotCopyDelete))return;let t=ke([...this.tiles].filter(i=>i.canEdit),!0);this.tiles.clear();for(let i of t)i.delete();At(t,i=>i.props.name==="geo")&&this.$parent.snapping.updateIntersections(),this.$parent.flushChanges(),this.$parent.newTileShift=0}};var xt=class s{constructor(t=0,e=0,i=0){this.x=t;this.y=e;this.z=i}transform(t){if(t instanceof Ki&&(t=t.matrix),t.length!==4||t[0].length!==4)throw new Error("Must use a 4x4 matrix for 3D transforms!");let[[e],[i],[n],[r]]=kt.product(t,[[this.x],[this.y],[this.z],[1]]);return new s(e/r,i/r,n/r)}equals(t){return $(this.x,t.x)&&$(this.y,t.y)&&$(this.z,t.z)}fixFloat(){return new s($(this.x,0)?0:this.x,$(this.y,0)?0:this.y,$(this.z,0)?0:this.z)}add(t){return this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}lerp(t,e){return new s(tt(this.x,t.x||0,e),tt(this.y,t.y||0,e),tt(this.z,t.z||0,e))}scale(t){return new s(this.x*t,this.y*t,this.z*t)}get magnitude(){return Math.hypot(this.x,this.y,this.z)}get normalize(){return this.scale(1/this.magnitude)}get asArray(){return[this.x,this.y,this.z]}get inverse(){return new s(-this.x,-this.y,-this.z)}get xy(){return new p(this.x,this.y)}[Symbol.iterator](){return this.asArray.values()}static get zero(){return new s(0,0,0)}static get oneZ(){return new s(0,0,1)}static get one(){return new s(1,1,1)}static all(t){return new s(t,t,t)}static from2D(t){return new s(t.x,t.y,0)}static average(t){return new s(Rs(t.map(e=>e.x)),Rs(t.map(e=>e.y)),Rs(t.map(e=>e.z)))}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){let i=t.y*e.z-t.z*e.y,n=t.z*e.x-t.x*e.z,r=t.x*e.y-t.y*e.x;return new s(i,n,r)}};var ie={translate({x:s,y:t,z:e}){return[[1,0,0,s],[0,1,0,t],[0,0,1,e],[0,0,0,1]]},rotateX(s){let t=Math.cos(s),e=Math.sin(s);return[[1,0,0,0],[0,t,-e,0],[0,e,t,0],[0,0,0,1]]},rotateY(s){let t=Math.cos(s),e=Math.sin(s);return[[t,0,e,0],[0,1,0,0],[-e,0,t,0],[0,0,0,1]]},rotateZ(s){let t=Math.cos(s),e=Math.sin(s);return[[t,-e,0,0],[e,t,0,0],[0,0,1,0],[0,0,0,1]]},rotateAxis({x:s,y:t,z:e},i){let n=Math.hypot(s,t,e);n=1/n,s*=n,t*=n,e*=n;let r=Math.sin(i),o=Math.cos(i),a=1-o;return[[s*s*a+o,s*t*a-e*r,s*e*a+t*r,0],[t*s*a+e*r,t*t*a+o,t*e*a-s*r,0],[e*s*a-t*r,e*t*a+s*r,e*e*a+o,0],[0,0,0,1]]},fromEulerAngles(s,t,e){return kt.product(ie.rotateX(s),ie.rotateY(t),ie.rotateZ(e))},scale({x:s,y:t,z:e}){return[[s,0,0,0],[0,t,0,0],[0,0,e,0],[0,0,0,1]]},scaleAll(s){return[[s,0,0,0],[0,s,0,0],[0,0,s,0],[0,0,0,1]]},perspective(s,t,e,i){let n=e*Math.tan(J(s)/2),r=-n,o=n*t,a=-o;return[[2*e/(o-a),0,(o+a)/(o-a),0],[0,2*e/(n-r),(n+r)/(n-r),0],[0,0,-((i+e)/(i-e)),-(2*i*e/(i-e))],[0,0,-1,0]]},transformPoint(s,t){return t instanceof xt?t.transform(s):new xt(t.x,t.y).transform(s)}},Ki=class{constructor(){this.matrix=kt.identity(4)}clear(){return this.matrix=kt.identity(4),this}translate(t=0,e=0,i=0){return this.matrix=kt.product(this.matrix,ie.translate({x:t,y:e,z:i})),this}rotate(t=0,e=0,i=0){return this.matrix=kt.product(this.matrix,ie.rotateZ(i),ie.rotateY(e),ie.rotateX(t)),this}scale(t){return this.matrix=kt.product(this.matrix,ie.scale(t)),this}dragToRotate(t,e,i=100){let n=new xt(t.x,t.y,i**3/(i**2+t.length**2)).normalize,r=new xt(e.x,e.y,i**3/(i**2+e.length**2)).normalize,o=B(xt.dot(n,r),-1,1),a=xt.cross(n,r),h=ie.rotateAxis(a,2*Math.acos(o));return this.matrix=kt.product(h,this.matrix),this}isRotationMatrix(){if(!$(kt.determinant(this.matrix),1))return!1;let t=kt.transpose(this.matrix);return kt.product(this.matrix,t).every((i,n)=>i.every((r,o)=>$(r,n===o?1:0)))}toEulerAngles(){let t=this.matrix,e=Math.hypot(t[0][0],t[1][0]);if($(e,0)){let a=Math.atan2(-t[1][2],t[1][1]),h=Math.atan2(-t[2][0],e);return[a,h,0]}let n=Math.atan2(t[2][1],t[2][2]),r=Math.atan2(-t[2][0],e),o=Math.atan2(t[1][0],t[0][0]);return[n,r,o]}};var $0=new $t(0,0,0);function P0(s){let t=s.r,e=s.c.x,i=s.c.y,n=.5523*t;return`M${e} ${i-t}C${e+n} ${i-t} ${e+t} ${i-n} ${e+t} ${i}C${e+t} ${i+n} ${e+n} ${i+t} ${e} ${i+t}C${e-n} ${i+t} ${e-t} ${i+n} ${e-t} ${i}C${e-t} ${i-n} ${e-n} ${i-t} ${e} ${i-t}`}var Kr=class{constructor(){this.transform=new Ki;this.visible=!0}getTransformed(t){let e=this;do t=t.transform(e.transform);while(e=e.parent);return t}get normal(){return this.getTransformed(xt.oneZ).add(this.getTransformed(xt.zero).inverse).normalize}project(t,e={fov:120}){if(e.fov===!1)return new p(t.x,t.y);let i=Math.exp(t.z/e.fov);return new p(t.x*i,t.y*i)}*getProjectedVertices(t){for(let e of this.getVertices())yield this.project(e,t)}},Xi=class extends Kr{constructor(e,i={},n){super();this.children=[];this.sorting=!1;this.$el=m("g",i,n);for(let r of e)this.addChild(r)}addChild(e){return e.parent&&e.parent.removeChild(e),this.children.push(e),this.$el&&e.$el&&this.$el.append(e.$el),e.parent=this,e}removeChild(e){let i=this.children.indexOf(e);i>=0&&this.children.splice(i,1),e.$el&&e.$el.remove(),e.parent=void 0}render(e){if(this.visible){if(this.sorting)for(let i of bi(this.children,n=>n.zIndex))this.$el.append(i.$el);for(let i of this.children)i.render(e)}}*getFaces(){for(let e of this.children)for(let i of e.getFaces())yield i}*getVertices(){for(let e of this.children)for(let i of e.getVertices())yield i}get zIndex(){return Rs(this.children.map(e=>e.zIndex))}},Yi=class extends Kr{constructor(e,i={},n){super();this.shape=e;if(!e)this.commands=[];else if(typeof e=="string")this.commands=Sn(e);else{let o=U(e)?P0(e):De(e);this.commands=Sn(o)}let r=p.average(...this.commands.filter(o=>o.points.length).map(o=>p.average(...o.points)));this.centroid=new xt(r.x,r.y,0),n&&(this.color=n),this.$el=m("path",i)}render(e){if(!this.visible)return;let i=this.normal.z;if(e!=null&&e.hideBackface){let r=i>-.01;if(this.$el.toggle(r),!r)return}if(this.color){let r=$t.mix(this.color,$0,(Math.abs(i)+1)/2);this.$el.setAttr("fill",r),this.$el.setAttr("stroke",r)}let n=this.commands.map(r=>{let o=r.points.map(a=>{let h=this.project(this.getTransformed(new xt(a.x,a.y)),e);return`${h.x},${h.y}`});return r.type+o.join(",")}).join("");this.$el.setAttr("d",n)}get zIndex(){return this.getTransformed(this.centroid).z}*getFaces(){yield this}*getVertices(){if(!(!this.shape||typeof this.shape=="string"||!St(this.shape)))for(let e of this.commands)for(let i of e.points)yield this.getTransformed(new xt(i.x,i.y))}};var W=V.regular(3),ri=V.regular(4),pe=V.regular(5),id={shape:W,children:[{shape:W,dihedral:70.53,rot:180},{shape:W,dihedral:70.53,parentEdge:1,rot:300},{shape:W,dihedral:70.53,parentEdge:2,rot:60}]},nd={shape:ri,children:[{shape:ri,dihedral:90,myEdge:2,children:[{shape:ri,dihedral:90,myEdge:2}]},{shape:ri,dihedral:90,parentEdge:1,rot:270},{shape:ri,dihedral:90,parentEdge:2},{shape:ri,dihedral:90,parentEdge:3,rot:90}]},rd={shape:W,children:[{shape:W,dihedral:109.47,rot:180},{shape:W,dihedral:109.47,parentEdge:1,rot:300,children:[{shape:W,dihedral:109.47,parentEdge:1,rot:300}]},{shape:W,dihedral:109.47,parentEdge:2,rot:60,children:[{shape:W,dihedral:109.47,parentEdge:1,rot:300},{shape:W,dihedral:109.47,parentEdge:2,rot:60,children:[{shape:W,dihedral:109.47,parentEdge:1,rot:300}]}]}]},od={shape:pe,children:[{shape:pe,dihedral:116.57,rot:180},{shape:pe,dihedral:116.57,parentEdge:1,rot:252},{shape:pe,dihedral:116.57,parentEdge:2,rot:324},{shape:pe,dihedral:116.57,parentEdge:3,rot:36},{shape:pe,dihedral:116.57,parentEdge:4,rot:108,children:[{shape:pe,dihedral:116.57,parentEdge:2,rot:324,children:[{shape:pe,dihedral:116.57,parentEdge:3,rot:36,children:[{shape:pe,dihedral:116.57,parentEdge:1,rot:252},{shape:pe,dihedral:116.57,parentEdge:2,rot:324},{shape:pe,dihedral:116.57,parentEdge:3,rot:36},{shape:pe,dihedral:116.57,parentEdge:4,rot:108}]}]}]}]},ad={shape:W,children:[{shape:W,dihedral:138.19,rot:180},{shape:W,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:W,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:W,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:W,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:W,dihedral:138.19,parentEdge:1,rot:300}]},{shape:W,dihedral:138.19,parentEdge:2,rot:60}]},{shape:W,dihedral:138.19,parentEdge:1,rot:300}]},{shape:W,dihedral:138.19,parentEdge:2,rot:60}]},{shape:W,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:W,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:W,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:W,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:W,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:W,dihedral:138.19,parentEdge:1,rot:300}]},{shape:W,dihedral:138.19,parentEdge:2,rot:60}]},{shape:W,dihedral:138.19,parentEdge:1,rot:300}]},{shape:W,dihedral:138.19,parentEdge:2,rot:60}]},{shape:W,dihedral:138.19,parentEdge:1,rot:300}]}]},hd=new V(new p(.587785,.466639),new p(0,.750495),new p(-.587785,.466639),new p(0,-.73981)),je={shape:hd,dihedral:89.7451,rot:180},rE={shape:hd,children:[ft(ut({},je),{parentEdge:1,myEdge:1,children:[ft(ut({},je),{children:[ft(ut({},je),{parentEdge:1,myEdge:1,children:[ft(ut({},je),{children:[ft(ut({},je),{parentEdge:1,myEdge:1,children:[ft(ut({},je),{children:[ft(ut({},je),{parentEdge:1,myEdge:1,children:[ft(ut({},je),{children:[ft(ut({},je),{parentEdge:1,myEdge:1})]})]})]})]})]})]})]})]})]};function ld(s,t,e){let i=V.regular(s).scale(t*Bt(s)),n=new G(R,t,e).polygon,r=[{shape:i,rot:180,parentEdge:2}],o=z(a=>({shape:n,parentEdge:a,rot:360/s*a,children:a?void 0:r}),s);return{shape:i,children:o}}function cd(s,t,e){let i=V.regular(s).scale(t*Bt(s)),n=new V(new p(-t/2,0),new p(t/2,0),new p(0,-e)),r=Kt(Math.acos(t/e/2/Math.tan(Math.PI/s))),o=z(a=>({shape:n,dihedral:r,parentEdge:a,rot:180+360/s*a}),s);return{shape:i,children:o}}var T0=kt.identity(4);function pd(s,t,e,i){var g;let n=t.shape.edges[s.parentEdge||0],r=s.shape.edges[s.myEdge||0],o=J(s.dihedral||90),a=i(s);e.addChild(a);let h=xt.from2D(n.midpoint),l=xt.from2D(r.midpoint),c=xt.from2D(n.unitVector),u=s.rot?J(s.rot):0,d=((g=s.children)==null?void 0:g.map(y=>pd(y,s,e,i)))||[];return[a,h,l,c,u,o,d]}function ph(s,t,e=1){var o;let i=t(s),n=new Xi([i]);n.sorting=!0;let r=((o=s.children)==null?void 0:o.map(a=>pd(a,s,n,t)))||[];return dh(r,n,e),{group:new Xi([n]),foldTree:r}}function dd(s,t,e=T0){let[i,n,r,o,a,h,l]=s,c=tt(Math.PI,h,t),u=ie.rotateAxis(o,Math.PI-c);a&&(u=kt.product(u,ie.rotateZ(a)));let d=r.transform(u),g=ie.translate(d.inverse.add(n));i.transform.matrix=kt.product(e,g,u);for(let y of l||[])dd(y,t,i.transform.matrix)}function dh(s,t,e){t.transform.clear();for(let r of s)dd(r,e);let i=Array.from(t.getFaces()).map(r=>r.getTransformed(r.centroid)),n=xt.average(i).inverse;t.transform.translate(n.x,n.y,n.z)}function S0(s,t,e){let i=Math.cos(s),n=Math.cos(t),r=Math.cos(e),o=Math.sin(t),a=Math.acos((r-i*n)/(Math.sin(s)*o)),h=Math.acos((i-n*r)/(o*Math.sin(e)));return[a,h]}function ud(s,t){return Math.asin(Math.cos(s*t)/Math.cos(s/2))}var E0=new Set([60,90,108]),M0=[{internal:[60,90,90,90],dihedral:[144.74,135,135,135]},{internal:[60,60,60,60,90],dihedral:[153.23,153.23,153.23,142.98,142.98]},{internal:[60,90,108,90],dihedral:[159.09,148.28,148.28,159.09]},{internal:[60,60,60,60,108],dihedral:[164.18,164.18,152.93,152.93,152.93]}];function C0(...s){let t=s.length;if(t===3)return S0(s[0],s[1],s[2]);let e=s.map(n=>Math.round(Kt(n)));if((t===4||t===5)&&e.includes(60)&&e.every(n=>E0.has(n))){for(let n of M0)if(n.internal.length===t){for(let r=0;r<s.length;++r)if(e.every((o,a)=>o===n.internal[(a+r)%t]))return hs(n.dihedral,r).slice(0,t-1).map(o=>J(o))}}if(t===4&&e.filter(n=>n===60).length===3){let n=e.findIndex(l=>l!==60),r=(Math.PI-s[n])/4,o=Math.acos(-1/Math.sqrt(3)*Math.tan(r)),a=Math.acos(1-2/3*((3-Math.tan(r)**2)/4+(Math.sin(3*r)/Math.sin(2*r))**2));return hs([o,a,a,o],4-n).slice(0,t-1)}let i=Math.PI/N(s);return z(n=>{let r=ud(s[n],i),o=ud(s[n+1],i);return r+o},s.length-1)}var uh=(s,t)=>gt(s+1,t.size),fh=(s,t)=>gt(s-1,t.size);function A0(s,t){let e=s.polygon.points[fh(t,s)],i=s.polygon.points[t],n=s.polygon.points[uh(t,s)];return new Vt(n,i,e).sup.rad}function k0(s){let t=s.find(a=>a.neighbours.filter(Boolean).length===1),e=fh(t.neighbours.findIndex(Boolean),t),i=[],n=t,r=e;do{let a=[];for(;a.push({face:n,vertex:r}),!!n.neighbours[r];){let h=n;n=n.neighbours[r],r=uh(n.neighbours.indexOf(h),n)}r=uh(r,n),i.push(a)}while(n!==t||r!==e);let o=new Nh(i);for(;;){let a=Math.max(3,...o.array.map(c=>c.val.length)),h=o.array.filter(c=>c.val.length>=a);if(!h.length)break;let l=new Set;for(let c of h){if(l.has(c))continue;let u=c.val.map(g=>A0(g.face,g.vertex)),d=C0(...u);for(let[g,y]of d.entries()){let f=c.val[g],v=c.val[g+1],w=f.vertex,x=fh(v.vertex,v.face);f.face.dihedral[w]=v.face.dihedral[x]=Math.max(y,f.face.dihedral[w]||0,v.face.dihedral[x]||0)}c.prev.val.push(...c.next.val),l.add(c.next),o.delete(c.next),o.delete(c)}}}function fd(s,t){return Math.max(...s.neighbours.map(e=>!e||e===t?0:fd(e,s)))+1}function md(s,t){return s.visited?!0:(s.visited=!0,s.neighbours.filter(e=>e&&e!==t).some(e=>md(e,s)))}function gd(s,t,e,i){let n=s.neighbours.map((r,o)=>{if(!(!r||r===e))return gd(r,t,s,s.dihedral[o])}).filter(Boolean);return{shape:s.polygon.translate(t.inverse),color:s.tile.props.color,children:n.length?n:void 0,dihedral:i?+Kt(i).toFixed(2):void 0,parentEdge:e?e.neighbours.indexOf(s):void 0,myEdge:e?s.neighbours.indexOf(e):void 0}}function V0(s){let t=s.map(e=>{let i=e.transformed.oriented,n=i.points.length;return{tile:e,polygon:i,size:n,neighbours:re(void 0,n),dihedral:re(void 0,n),edges:i.edges,center:i.centroid,radius:i.radius}});if(!t.some(e=>e.size<3)){for(let[e,i]of t.entries())for(let[n,r]of t.entries())if(!(e>=n)&&!(i.radius+r.radius<p.distance(i.center,r.center)-2)){for(let[o,a]of i.edges.entries())for(let[h,l]of r.edges.entries())if(a.equals(l,2)){if(i.neighbours[o]||r.neighbours[h])return;i.joined=r.joined=!0,i.neighbours[o]=r,r.neighbours[h]=i}}if(!t.some(e=>!e.joined)&&!md(t[0]))return t}}function vd(s){let t=V0(s);if(!t)return;k0(t);let e=Ls(t,n=>fd(n)),i=e.polygon.centroid;return[i,gd(e,i)]}var mh=s=>Zi[s%Zi.length]||q.yellow;function bd(s){var e;let t=((e=s.c||s.children)==null?void 0:e.map(i=>bd(i)))||[];return{shape:Xr(s.shape||s.s),color:s.color||s.a,children:t,dihedral:s.dihedral||s.d,parentEdge:s.parentEdge||s.p,myEdge:s.myEdge||s.m,rot:s.rot||s.r}}function xd(s){var e;let t=(e=s.children)==null?void 0:e.map(i=>xd(i));return t!=null&&t.length||(t=void 0),{s:ai(s.shape),a:s.color,c:t,d:s.dihedral,p:s.parentEdge,m:s.myEdge,r:s.rot}}function I0(s){return bd(we(s.replace(/([a-z]):/g,'"$1":'),{}))}function L0(s){return JSON.stringify(xd(s)).replace(/"([a-z])":/g,"$1:")}function oi(s,t=1){var i;let e=(i=s.children)==null?void 0:i.map(n=>oi(n,t));return Object.assign({},s,{children:e,shape:s.shape.scale(t)})}var wd=s=>s.split(",").map(t=>+t),gh=s=>s.map(t=>t.toFixed(4)).join(","),vh={Tetrahedron:{net:oi(id,Bt(3)*50),scale:1.1,name:"Tetrahedron"},Cube:{net:oi(nd,Bt(4)*50),scale:.8,name:"Cube"},Octahedron:{net:oi(rd,Bt(3)*50),scale:.95,name:"Octahedron"},Dodecahedron:{net:oi(od,Bt(5)*50),scale:.42,name:"Dodecahedron"},Icosahedron:{net:oi(ad,Bt(3)*50),scale:.67,name:"Icosahedron"},Pyramid:{net:cd(6,50,100),scale:.57,name:"Pyramid"},Prism:{net:ld(6,50,100),scale:.45,name:"Prism"}},wh={fov:400},yd=[1.066,.243,-.088],rs=class extends H{constructor(e,i,n){var o;super(e,i,n);this.cannotRotateType=!0;this.net=((o=vh[this.props.net])==null?void 0:o.net)||I0(this.props.net),this.rotation=wd(this.props.rotation);let r=ph(this.net,a=>new Yi(a.shape,{class:"polygon-tile"},a.color||mh(a.shape.points.length)));this.solid=r.group,this.foldTree=r.foldTree,this.$el.append(this.solid.$el),this.$outline=m("path",{class:"outline"},this.$el),this.$moveBar=m("path",{d:"M0 0h30",class:"handle"},this.$el),this.$moveHandle=m("path",{d:"M0 0h14v14h-14Z",class:"handle",style:"cursor: grab"},this.$el),this.solid.$el.css("cursor","move"),this.props.watch("color",({color:a})=>{if(a){for(let h of this.solid.getFaces())h.color=a;this.render(!1)}}),this.render(),this.updateOutline(),e.events.listen(this.solid.$el,{start:()=>{e.selection.add(this,!0),this.$el.removeClass("active")},move:({posn:a,lastPosn:h})=>{this.solid.transform.dragToRotate(h.subtract(this.posn),a.subtract(this.posn),100),this.render(!1)},end:()=>{this.rotation=this.solid.transform.toEulerAngles(),this.props.rotation=gh(this.rotation),this.updateOutline(),e.flushChanges(),this.$el.addClass("active")},click:a=>e.tools.move.down(a),checkIfActive:()=>this.props.hinge>0})}applyChange(e){super.applyChange(e),this.rotation=wd(this.props.rotation),this.render(),this.updateOutline()}render(e=!0){e&&(this.solid.transform.clear(),dh(this.foldTree,this.solid.children[0],-this.props.hinge),this.solid.transform.rotate(...this.rotation)),this.solid.render(wh)}updateOutline(){let e=this.solid.getProjectedVertices(wh);this.path=V.convexHull(...e),this.$outline.draw(this.path),this.transform(),this.$moveBar.translate(this.path.points[0].x-30,this.path.points[0].y),this.$moveHandle.translate(this.path.points[0].x-45,this.path.points[0].y-7)}animateHinges(e,i=!1,n=800){return D(this,null,function*(){let r=i?this.rotation:[0,0,0],o=this.props.hinge;yield pt(a=>{this.props.hinge=tt(o,e,a),i&&(this.rotation=r.map(h=>h*(1-a))),this.render()},n).promise,this.props.rotation=gh(this.rotation),this.updateOutline()})}hingeStart(){this.startRotation=this.rotation,this.startAngle=this.props.hinge,this.$el.removeClass("active")}hingeMove(e){if(!$(e,this.props.hinge)){if(this.props.hinge=B(e,0,1),this.startRotation&&this.startAngle){let i=B(e/this.startAngle,0,1);this.rotation=this.startRotation.map(n=>i*n)}this.render()}}hingeEnd(){this.updateOutline(),this.props.rotation=gh(this.rotation),this.$el.addClass("active")}static fold(e){let i=vd(e);if(!i){br("polyhedron-error");return}let n={name:"polyhedron",net:L0(i[1]),hinge:0,rotation:"0,0,0"},r=H.create(e[0].$parent,n),o=r.solid.children[0].transform.matrix;r.setTransform(i[0].shift(-o[0][3],-o[1][3])),r.props.hinge=1,setTimeout(()=>{r.props.hinge=0,r.animateHinges(1)},10);for(let a of e)a.delete();return r}unfold(){return D(this,null,function*(){this.$parent.selection.remove(this),this.props.hinge>0&&(yield this.animateHinges(0,!0));let e=Array.from(this.solid.getFaces()).map(i=>{let n=new V(...Array.from(i.getProjectedVertices())),r=this.props.color||i.color||mh(n.points.length);return H.create(this.$parent,{name:"polygon",shape:ai(n),color:r,x:this.posn.x,y:this.posn.y})});return this.delete(),e})}static makeThumbnail(e,i){let n=m("svg",{width:70,height:70},e),r=m("g",{transform:"translate(35, 35)"},n),{net:o,scale:a}=vh[i.net],h=ph(o,l=>new Yi(l.shape,{class:"polygon-tile"},mh(l.shape.points.length)),-1).group;h.transform.clear().rotate(...yd).scale({x:a,y:a,z:a}),r.append(h.$el),h.render(wh)}static altText(e){var i;return((i=vh[e.net])==null?void 0:i.name)||"Polyhedron"}};rs.type="polyhedron",rs.defaultProps={hinge:1,rotation:yd.join(",")},rs=T([Ut],rs);Mt([{id:"unfold",type:"button",tileTypes:["polyhedron"],label:"Unfold",click:s=>Promise.all(s.map(t=>t.unfold()))},{id:"hinges",type:"slider",tileTypes:["polyhedron"],label:"Hinges",start:s=>s.hingeStart(),move:(s,t)=>s.hingeMove(t),end:s=>s.hingeEnd(),get:s=>s.props.hinge}]);var L=50,at=Math.sqrt(3)/4*L;function Bt(s){let t=Math.cos(Tt/s);return 1/Math.sqrt(2-2*t)}var $d={"equ-triangle":new V(new p(-L/2,at),new p(L/2,at),new p(0,-at)),square:V.regular(4,L*Bt(4)),"reg-pentagon":V.regular(5,L*Bt(5)),"reg-hexagon":V.regular(6,L*Bt(6)),"reg-heptagon":V.regular(7,L*Bt(7)),"reg-octagon":V.regular(8,L*Bt(8)),"reg-decagon":V.regular(10,L*Bt(10)),"reg-dodecagon":V.regular(12,L*Bt(12)),rectangle:new G(new p(-L,-L/2),2*L,L).polygon,trapezium:new V(new p(-L,at),new p(L,at),new p(L/2,-at),new p(-L/2,-at)),rhombus:new V(new p(-L*3/4,at),new p(L/4,at),new p(L*3/4,-at),new p(-L/4,-at)),"right-triangle":new V(new p(-L/2,-L/2),new p(L/2,-L/2),new p(-L/2,L/2)),"rhombus-2":new V(new p(L/2-at,L/4),new p(-at-L/2,L/4),new p(at-L/2,-L/4),new p(at+L/2,-L/4)),chevron:new V(new p(-.75*L,2*at),new p(.25*L,2*at),new p(.75*L,0),new p(.25*L,-2*at),new p(-.75*L,-2*at),new p(-.25*L,0)),"right-triangle-2":new V(new p(-2*at,-L/2),new p(-2*at,L/2),new p(2*at,-L/2)),kite:new V(new p(0,-L),new p(2*at,-L/2),new p(0,L),new p(-2*at,-L/2)),dart:new V(new p(2*at,.75*L),new p(0,-.75*L),new p(-2*at,.75*L),new p(0,.25*L))},O0={"equ-triangle":"Equilateral Triangle",square:"Square","reg-pentagon":"Regular Pentagon","reg-hexagon":"Regular Hexagon","reg-heptagon":"Regular Heptagon","reg-octagon":"Regular Octagon","reg-decagon":"Regular Decagon","reg-dodecagon":"Regular Dodecagon",rectangle:"Rectangle",trapezium:"Trapezium",rhombus:"Rhombus","right-triangle":"Right Triangle","rhombus-2":"Rhombus",chevron:"Chevron","right-triangle-2":"Right Triangle",kite:"Kite",dart:"Dart"},R0=[[[-15.7728,63.1105],[-65.2725,56.0545],[-61.7426,-21.037],[-34.7275,-63.1105],[65.2725,-63.1105]],[[60.6056,14.8729],[-53.4909,57.394],[-80.668,-12.5086],[-20.582,-57.394],[80.668,-57.394]],[[0,-73.612],[50,12.9905],[15,73.612],[-50,12.9905],[-30,-73.612]],[[67.056,-58.248],[67.056,1.752],[-10.5597,58.248],[-67.056,-19.3675],[7.056,-58.248]],[[-74.4415,-47.6314],[35.5585,-47.6314],[74.4415,-8.733],[60.1965,44.3902],[-19.4415,47.6314]],[[47.6215,-81.108],[43.731,-26.2458],[-24.012,81.108],[-47.6215,-43.6179],[-7.3786,-81.108]],[[94.9659,43.7299],[-5.0343,43.7299],[-94.9659,0],[-5.0343,-43.7299],[42.1151,-41.1631]],[[-13.1927,57.1955],[76.8074,57.1955],[76.8257,-32.8045],[-9.8062,-57.1955],[-76.8257,-6.4506]],[[-3.2764,58.8874],[86.2804,29.1016],[26.2804,-43.7514],[-26.2804,-58.8874],[-86.2804,13.9666]],[[51.5265,-55],[58.4735,-14.7198],[9.6458,43.251],[-58.4735,55],[-58.4735,-55]],[[-95.733,-40.991],[53.87,-40.991],[95.733,-15.7718],[1.5099,40.991],[-95.733,-10.4271]],[[-85.642,-51.4515],[12.4961,-51.4515],[85.642,-13.2965],[-38.4855,51.4515],[-85.642,18.5485]],[[-69.99,67.0025],[84.488,2.9975],[84.488,-67.0025],[14.488,-67.0025],[-84.488,32.0117]],[[-15.6401,96.696],[46.9202,6.219],[8.0799,-96.696],[-46.9202,-96.696],[-46.9202,51.458]],[[-46.6683,85],[-46.6683,22.7758],[15.5561,-85],[46.6683,-31.1122],[15.5561,85]],[[0,-46.65],[-43.301,-21.65],[-43.301,46.65],[43.301,46.65],[43.301,-21.65]],[[-25,46.65],[25,46.65],[59.15,-12.5],[0,-46.65],[-59.15,-12.5]],[[0,-64.951],[-50,21.65],[-25,64.951],[25,64.951],[50,21.65]]].map(s=>new V(...s.map(t=>new p(...t)))),Zi=["","","",q.yellow,q.blue,q.green,q.red,q.teal,q.purple],D0={trapezium:q.orange,"right-triangle":q.green,"rhombus-2":q.lime,chevron:q.orange,kite:q.purple,dart:q.teal},N0={"equ-triangle":q.green,square:q.yellow,"reg-pentagon":q.blue,"reg-hexagon":"#ffd615",rectangle:q.yellow,trapezium:"#cc1030",rhombus:q.blue,"rhombus-2":"#e6e2c6",chevron:"#cc1030","right-triangle-2":"#ffd615",kite:"#134791",dart:q.purple},G0=[...$t.rainbow(15).map(s=>s.hex),q.red,q.blue,q.yellow],z0=new Set(["trapezium","rhombus","rhombus-2","rectangle","right-triangle","right-triangle-2"]),B0=new Set(["equ-triangle","square","reg-pentagon","reg-hexagon","reg-heptagon","reg-octagon","reg-decagon","reg-dodecagon","rectangle","trapezium","kite","dart"]),ai=s=>s.points.map(t=>`${t.x.toFixed(2)} ${t.y.toFixed(2)}`).join(","),_0=s=>new V(...s.split(",").map(t=>{let[e,i]=t.split(" ");return new p(+e||0,+i||0)}));function Xr(s){return s.startsWith("pentagon-")?R0[+s.slice(9)-1]:/^[\d.-]/.test(s)?_0(s):$d[s]||$d.square}function Pd(s,t,e=!1){return s.startsWith("pentagon-")?G0[+s.slice(9)-1]:(e?N0:D0)[s]||Zi[t%Zi.length]||q.yellow}var Qi=class extends ni{constructor(t,e,i){super(t,e,i);let n=Xr(this.props.shape);this.props.watch("scale isFlipped",({isFlipped:r,scale:o})=>this.setPath(n.scale(o||1),r)),this.symmetric=B0.has(this.props.shape),this.props.color||(this.props.color=Pd(this.props.shape,this.path.points.length,t.options.altColors))}static makeThumbnail(t,e,i){let n=z0.has(e.shape)?60:80,r=Xr(e.shape);r=r.scale((e.shape.startsWith("pentagon-")?41:36)/r.radius).shift(40,n/2);let o=m("svg",{width:80,height:n},t),a=m("path",{class:"polygon-tile",path:r},o);i.options.watch(h=>a.setAttr("fill",Pd(e.shape,r.points.length,h.altColors)))}static altText(t){if(t.shape.startsWith("pentagon-")){let e=+t.shape.slice(9);return e<16?`Pentagon ${e}`:e===16?"Prismatic Pentagon":e===17?"Cairo Pentagon":"Floret Pentagon"}return O0[t.shape]||"Polygon"}};Qi.type="polygon",Qi=T([Ut],Qi);var hi=["polygon","tangram","polyomino","custom-polygon","rectangle","reg-polygon","fractal","penrose","aperiodic-hat"];Mt([{id:"flip",type:"button",label:"Flip",icon:"flip",useTextLabel:!0,tileTypes:[...hi,"arrow","egg","garden","number-frame"],show:s=>s.length>1||!!s[0].rot||!s[0].symmetric,click:(s,t)=>{let e=t.selection.center;for(let i of s)i.flip(e)}},{id:"cut",type:"button",tileTypes:hi,label:"Cut",icon:"cut",useTextLabel:!0,noFlush:!0,show:s=>s.every(t=>!(t.is("rectangle")&&t.props.cornerRadius>0)),click:(s,t)=>t.tools.cutPolygon.enable()},{id:"join",type:"button",label:"Join",icon:"merge",useTextLabel:!0,tileTypes:hi,location:"more",show:s=>s.length>1&&s.every(t=>!(t.is("rectangle")&&t.props.cornerRadius>0)),click:(s,t)=>{let e=s.map(o=>o.transformed),i=V.union(...e),n=s[0].props.color,r=i.map(o=>H.create(t,{name:"polygon",shape:ai(o),color:n}));for(let o of s)o.delete();t.selection.select(r,!0)}},{id:"fold-net",type:"button",label:"Fold Net",icon:"cube",useTextLabel:!0,tileTypes:hi,show:s=>s.length>2,click:s=>rs.fold(s)},{id:"animation",type:"select",tileTypes:hi,label:"Animation:",location:"music",flattenGroups:!0,feature:"noMusic",options:[{key:"vertices",label:"Vertices"},{key:"perimeter",label:"Perimeter"},{key:"area",label:"Area"},{key:"angles",label:"Angles"}],get:s=>{var t;return((t=s.props.animation)==null?void 0:t.replace("hidden","perimeter"))||"perimeter"},set:(s,t)=>t.props.animation=s},{id:"audio-labels",type:"checkbox",tileTypes:hi,label:"Show labels:",location:"music",flattenGroups:!0,feature:"noMusic",show:s=>s.every(t=>!["vertices"].includes(t.props.animation)),get:s=>s.props.labels==="number",set:(s,t)=>t.props.labels=s?"number":void 0}]);Mt([{id:"label",type:"input",label:"Label:",tileTypes:Br,icon:"text",authorOnly:!0,get:s=>s.props.textLabel||"",set:(s,t)=>t.props.textLabel=`${s}`},{id:"labelFontSize",type:"input",label:"Font size:",tileTypes:Br,icon:" ",value:"number",range:[1,15],increment:1,authorOnly:!0,show:s=>s.some(t=>t.props.textLabel),get:s=>5+(s.props.textLabelFontSize||0),set:(s,t)=>t.props.textLabelFontSize=+s-5},{id:"textLabelRotate",type:"checkbox",label:"Rotate label:",tileTypes:Br,icon:" ",authorOnly:!0,show:s=>s.some(t=>t.props.textLabel),get:s=>!!s.props.textLabelRotate,set:(s,t)=>t.props.textLabelRotate=s}]);Mt([{id:"scale",type:"input",label:"Scale:",location:"more",value:"number",range:[.1,10],icon:"geo-scale",increment:.1,tileTypes:["polygon","reg-polygon","rectangle","custom-polygon"],get:s=>s.props.scale||1,set:(s,t)=>{let e=t.path.centroid.scale(1-+s/(t.props.scale||1));t.setTransform(t.posn.add(e)),t.props.scale=+s,t.$parent.selection.update()}}]);var Td='<g class="leg-pin" style="transform-origin:bottom right"><polygon points="0,-21 -7,-21 0,0" fill="#3a3645"></polygon><path d="M-23.9-375H0v354h-7l-17-19v-335H-23.9z" fill="#d6d4db"></path></g><g class="pencil"><rect class="leg-pencil" x="0" y="-375" width="24" height="307" style="transform-box:fill-box;transform-origin:bottom center" fill="#d6d4db"></rect><g><path d="M72-48c-0.5,0-3,5-3,5H39c0,0-2.5-5-3-5v-106h36C72-154,72-48,72-48z"></path><rect x="47" y="-154" width="14" height="111" fill="#000" opacity="0.3"></rect><path d="M37.4-47.3l2.2,2.6c0.4,0.5,1,0.8,1.6,0.8c0.5,0,1-0.2,1.4-0.6l2.8-3.9c0.9-0.8,2.3-0.9,3.3-0.2l3.6,3.2c1,0.8,2.4,0.8,3.4,0l3.6-3.2c1-0.7,2.4-0.6,3.3,0.2l2.8,3.9c0.4,0.4,0.9,0.6,1.4,0.6c0.6,0,1.2-0.3,1.6-0.8l2.2-2.6c0.3-0.4,0.8-0.7,1.4-0.7L61.4-19.6c-4.8-1.9-10-1.9-14.8,0L36-48C36.6-48,37.1-47.7,37.4-47.3z" fill="#f7eecb"></path><path d="M46.6-19.6c4.8-1.9,10-1.9,14.8,0L54,0L46.6-19.6z"></path></g><path d="M81-56H15c-1.7,0-3-1.3-3-3v-18c0-1.7,1.3-3,3-3h66c1.7,0,3,1.3,3,3v18C84-57.3,82.7-56,81-56z" fill="#d6d4db"></path><circle cx="12" cy="-68" r="16" fill="#d6d4db"></circle><circle cx="12" cy="-68" r="9" fill="#3a3645"></circle></g><g class="top"><path d="M19-422H9v-25c0-2.8-2.2-5-5-5h-8c-2.8,0-5,2.2-5,5v25h-10c-2.8,0-5,2.2-5,5l0.1,42l9.2,19.2c0.4,1,1.4,4,4,4h21.7c2.7,0,3.7-3,4.1-4L24-375v-42C24-419.8,21.8-422,19-422z" fill="#3a3645"></path><circle cy="-386" r="9" fill="#d6d4db"></circle></g>';var bt=50,F0=100,fi=class extends H{constructor(e,i,n){super(e,i,n);this.cannotRotateType=!0;this.cannotDragToSelect=!0;this.$el.addClass("utensil"),this.setup(),this.$handles=[0,1].map(r=>this.makeHandle("c",(o,a)=>{let h=r?this.posn:this.absoluteEnd;a=this.$parent.snapping.orthogonal(a,h),r&&(this.absoluteEnd=a);let l=r?this.posn:a;this.props.isFixed||(this.props.width=Math.max(p.distance(l,this.absoluteEnd),F0)),this.setTransform(l,Kt(this.absoluteEnd.angle(l))),this.update()})),this.update()}applyChange(e){super.applyChange(e),this.update()}flip(){this.props.isFlipped=!this.props.isFlipped,this.update()}transform(e){super.transform(e),this.absoluteEnd=this.worldPosn(new p(this.props.width,0))}update(){this.$handles[1].setCenter({x:this.props.width,y:0}),this.transform()}getDrawingPath(e){var n;let i=(n=this.transformed)==null?void 0:n.project(e);if(i&&p.distance(e,i)<30)return this.transformed}},q0=new Set(["ruler","protractor","set-triangle","compass"]);function Ed(s){return q0.has(s.props.name)}var H0=2.54,Yr=60,li=bt*H0;function*Sd(s,t,e,i){let n=(t+.1)/s;for(let r=0;r<=n;r+=1){let o=i?i.findIndex(h=>!(r%h)):-1,a=r*s;yield[e?t-a:a,o]}}var ci=class extends fi{constructor(e,i,n){super(e,i,n);this.padding=[0,20,0,20];this.props.watch("units fixed",()=>this.update())}setup(){this.$glass=m("rect",{x:-20,height:Yr,class:"glass",rx:5},this.$el),this.$ticks=m("path",{class:"ticks"},this.$el),this.$labelsTop=z(e=>m("text",{text:e},this.$el),31),this.$labelsBottom=z(e=>m("text",{text:e,y:42},this.$el),12),this.$labelsBottom[0].text="0 in"}update(){let{units:e,width:i,isFlipped:n}=this.props,r=e==="both",o=e==="hidden";this.$glass.setAttr("width",i+40),this.path=new G(R,i,Yr);let a="";if(!o&&e!=="in")for(let[l,c]of Sd(bt/10,i,n,[10,5]))a+=`M${l} 0v${([20,15][c]||10)*(r?.8:1)}`;if(!o&&e!=="cm"){let l=r?Yr:0;for(let[c,u]of Sd(li/16,i,n,[16,8,4]))a+=`M${c} ${l}v${([20,16,12][u]||8)*(r?-.8:1)}`}this.$ticks.setAttr("d",a),this.$labelsTop[0].text=e==="in"?"0 in":"0 cm";let h=e==="in"?li:bt;for(let[l,c]of this.$labelsTop.entries())c.toggle(!o&&l*h<=i+.1),c.setAttr("y",r?26:32),c.setAttr("x",n?i-h*l:h*l);for(let[l,c]of this.$labelsBottom.entries())c.toggle(!o&&r&&l*li<=i+.1),c.setAttr("x",n?i-li*l:li*l);super.update()}getSnapPoints(){if(this.props.units==="hidden")return[];let e=this.props.units==="both",i=li/2,n=z(o=>new p(this.props.isFlipped?this.props.width-o*bt:o*bt,0),this.props.width/bt),r=z(o=>new p(this.props.isFlipped?this.props.width-o*i:o*i,e?Yr:0),this.props.width/i);return this.props.units==="cm"?n:e?[...n,...r]:r}getSnapLines(){let[e,i,n]=this.path.edges;return this.props.units==="both"?[e,n]:[e]}getDrawingPath(e){if(!this.transformed)return;let[i,n,r]=this.transformed.edges,o=p.distance(e,i.project(e)),a=p.distance(e,r.project(e));return o<30?i:this.props.units==="both"&&a<30?r:void 0}static altText(){return"Ruler"}};ci.type="ruler",ci.defaultProps={width:400,layer:"front",units:"cm"},ci=T([Ut],ci);function j0(s){return`M0-${s}A${s},${s},0,0,0-${s},0V3a5,5,0,0,0,5,5H${s-5}a5,5,0,0,0,5-5V0A${s},${s},0,0,0,0-${s}Z`}var pi=class extends fi{constructor(){super(...arguments);this.padding=[0,0,10,0]}setup(){this.$glass=m("path",{d:"",class:"glass"},this.$el),this.$ticks=m("path",{class:"ticks"},this.$el),this.$labels=z(e=>[m("text",{text:e*10},this.$el),m("text",{text:e*10,style:"font-size:9px"},this.$el)],19),this.$labels[9][0].css("font-size","20px"),this.$labels[9][1].hide()}update(){let e=this.props.width;this.path=new qt(R,new p(-this.props.width,0),Math.PI),this.$glass.setAttr("d",j0(e));let i="",n=this.props.width<120?5:1;for(let r=0;r<=180;r+=n){let o=!(r%10),a=!o&&!(r%5),h=p.fromPolar(J(-r)),l=e-(o?30:a?23:15);i+=`M${h.x*e} ${h.y*e}L${h.x*l} ${h.y*l}`,o&&(i+=`M${h.x*8} ${h.y*8}L${h.x*(e-60)} ${h.y*(e-60)}`)}this.$ticks.setAttr("d",i);for(let[r,[o,a]]of this.$labels.entries()){if(r===9){o.setAttr("y",52-e);continue}o.toggle(e>160||!(r%3)),a.toggle(e>160),o.setAttr("y",44-e),a.setAttr("y",55-e),o.setAttr("transform",`rotate(${(this.props.isFlipped?-1:1)*(90-10*r)})`),a.setAttr("transform",`rotate(${(this.props.isFlipped?1:-1)*(90-10*r)})`)}super.update()}getSnapPoints(){return[R,this.path.start,this.path.at(.5),this.path.end]}getSnapLines(){return[]}static altText(){return"Protractor"}};pi.type="protractor",pi.defaultProps={width:200,layer:"front"},pi=T([Ut],pi);var yh=234,Jr=150;function U0(s){let t=s<Jr?s/(Jr/(yh/6)):s<yh?yh/6:s/6,e=t+t*Math.SQRT2;return`M0,0 H${s} L0,${-s} V0 M${t},${-t} H${s-e} L${t},${-s+e} V${t},${-t}`}var di=class extends fi{setup(){this.$glass=m("path",{d:"","fill-rule":"evenodd",class:"glass"},this.$el),this.$ticks=m("path",{class:"ticks"},this.$el),this.$hLabels=z(t=>m("text",{text:t,y:-23},this.$el),31),this.$hLabels[0].hide(),this.$vLabels=z(t=>m("text",{text:t,x:25,"dominant-baseline":"central"},this.$el),31),this.$vLabels[0].hide()}update(){this.path=new V(R,new p(this.props.width,0),new p(0,-this.props.width)),this.$glass.setAttr("d",U0(this.props.width));let t=this.props.width-50,e="",i=2,n=1;for(let r=0;r<=t;r+=bt/10){let o=r%bt?r%(bt/2)?0:n:i,a=r<10?-10*(r/10):[-10,-15,-20][o];e+=`M${r} 0V${a}`}for(let r=0;r<=t;r+=bt/10){let o=r%bt?r%(bt/2)?0:n:i,a=r<10?10*(r/10):[10,15,20][o];e+=`M0,${-r} H${a}`}this.$ticks.setAttr("d",e);for(let[r,o]of this.$hLabels.entries())r>0&&o.toggle(this.props.width>=Jr&&r<t/bt),o.setAttr("x",bt*r);for(let[r,o]of this.$vLabels.entries())r>0&&o.toggle(this.props.width>=Jr&&r<t/bt),o.setAttr("y",bt*-r);super.update()}getSnapPoints(){let t=this.props.width,e=new Y(R,new p(t,0)),i=new Y(R,new p(0,-t)),n=z(o=>e.at(o*bt/t),t/bt),r=z(o=>i.at(o*bt/t),t/bt);return n.concat(r)}getSnapLines(){return[this.path]}static altText(){return"Set Triangle"}};di.type="set-triangle",di.defaultProps={width:280,layer:"front"},di=T([Ut],di);var Zr=375,Qr=new p(54,68),ui=class extends fi{setup(){this.$el.html=Td,this.$pencil=this.$el.$(".pencil"),this.$top=this.$el.$(".top"),this.$legPin=this.$el.$(".leg-pin"),this.$legPencil=this.$el.$(".leg-pencil"),this.props.watch("color",({color:i})=>this.$pencil.css("fill",i));let t,e=0;this.$parent.events.listen(this.$pencil.$("g"),{start:i=>{let n=new p(this.props.width,0).rotate(J(this.rot)).add(this.posn);t=new He(this.$parent,"",this.props.color,"pen"),t.start(n,new wt(this.posn,this.props.width)),e=Kt(i.posn.angle(this.posn))-this.rot;for(let r of this.$handles)r.setAttr("hidden",!0)},move:i=>{this.rot=Kt(i.posn.angle(this.posn))-e,this.transform();let n=p.fromPolar(J(this.rot),this.props.width).add(this.posn);t.addPoint(n)},end:()=>{t.end(),this.$parent.flushChanges(),t=void 0;for(let i of this.$handles)i.removeAttr("hidden")}}),this.$parent.events.listen(this.$top,{start:i=>{e=Kt(i.posn.angle(this.posn))-this.rot;for(let n of this.$handles)n.setAttr("hidden",!0)},move:i=>{this.rot=Kt(i.posn.angle(this.posn))-e,this.transform()},end:()=>{this.$parent.flushChanges();for(let i of this.$handles)i.removeAttr("hidden")}})}update(){this.props.width>730&&(this.props.width=730);let t=this.props.width-Qr.x,e=Zr-Qr.y,i=new wt(R,Zr),n=new wt(new p(t,-Qr.y),e),r=Q(i,n)[0],o=Math.acos(r.x/Zr),a=Math.acos((t-r.x)/e);this.$legPin.css("transform",`rotate(${-o+Xa}rad`),this.$legPencil.css("transform",`rotate(${a-Xa}rad`),this.$pencil.setTransform({x:this.props.width-Qr.x,y:0}),this.$top.setTransform({x:r.x,y:Zr+r.y}),this.path=new Y(R,new p(this.props.width,0)),super.update()}getSnapPoints(){return[R,new p(this.props.width,0)]}getDrawingPath(){}static altText(){return"Compass"}};ui.type="compass",ui.defaultProps={width:300,layer:"front",color:q.red},ui=T([Ut],ui);Mt([{id:"flip",type:"button",tileTypes:["ruler","protractor"],label:"Flip",icon:"flip",useTextLabel:!0,click:s=>{for(let t of s)t.flip()}}]);Mt([{id:"labels",type:"select",tileTypes:["ruler"],label:"Labels:",options:[{label:"Centimeters",key:"cm"},{label:"Inches",key:"in"},{label:"Both",key:"both"},{label:"None",key:"hidden"}],location:"more",get:s=>s.props.units,set:(s,t)=>t.props.units=s},{id:"fixed-length",type:"checkbox",tileTypes:["ruler"],label:"Fixed Length",location:"more",get:s=>!!s.props.isFixed,set:(s,t)=>t.props.isFixed=s}]);var Ue=class{constructor(t){this.$parent=t}getTileAt(t){let e=this.$parent.snapping.snapGeo(t.posn);if(e!=null&&e.tile&&e.tile.canSelect)return e.tile;let i=t.target;for(;i;){let n=Fr.get(i);if(n!=null&&n.canSelect&&n.props.name!=="geo")return n;if(i=i.parentNode||void 0,i===this.$parent._el)return}}hoverGeoTile(t){var e;this.hoveringTile!==t&&((e=this.hoveringTile)==null||e.hover(!1)),t==null||t.hover(),this.hoveringTile=t}down(t){}start(t){}move(t){}up(t){}end(t){}click(t){}hover(t){}cancel(){}},to=class extends Ue{constructor(){super(...arguments);this.clickTimeout=0}down(e){var n,r;let i=this.activeTile=(n=this.getTileAt(e))==null?void 0:n.root;this.activeTileWasSelected=i==null?void 0:i.isActive,this.previousSelection=void 0,(r=this.$parent.focussedTile)==null||r.blur(),this.$parent.warningBanner.hide(),i?(i.isActive&&this.$parent.events.shiftKey?this.$parent.selection.remove(i):(this.$parent.events.shiftKey||!i.isActive)&&this.$parent.selection.add(i,!this.$parent.events.shiftKey),i.down(e),this.$parent.events.grabbing()):this.$parent.events.shiftKey?this.previousSelection=new Set(this.$parent.selection.tiles):this.$parent.selection.clear()}up(e){var i;(i=this.activeTile)==null||i.up(e)}start(){if(!this.activeTile){this.$parent.$selection.show();return}if(this.$parent.events.altKey)this.$parent.paste(this.$parent.selection.copy(!0),R,!1);else if(!this.$parent.state.authorMode){let e=Array.from(this.$parent.selection.tiles).filter(i=>i.props.status!=="generator");for(let i of e)this.$parent.selection.remove(i);this.$parent.paste(this.$parent.selection.copy(!0),R,!1);for(let i of e)this.$parent.selection.add(i)}this.$parent.selection.moveStart()}move(e){var n;if(this.activeTile){this.$parent.selection.move(e);return}let i=G.aroundPoints([e.startPosn,e.posn]);this.$parent.$selection.setRect(i);for(let r of this.$parent.tiles.values()){if(!r.canSelect||r.cannotDragToSelect||!r.transformed||r.group)continue;let o=qi(i,r.transformed,r.props.name);(this.$parent.events.shiftKey&&((n=this.previousSelection)==null?void 0:n.has(r))?!o:o)?this.$parent.selection.add(r,!1,!0):this.$parent.selection.remove(r,!0)}this.$parent.selection.update(!0)}end(){this.activeTile?this.$parent.selection.moveEnd():this.$parent.$selection.hide(),this.$parent.events.grabbing(!1)}click(e){if(this.activeTile){this.activeTile.click(e,!this.activeTileWasSelected);let i=Date.now();i-this.clickTimeout<500&&this.activeTile.doubleClick(e),this.clickTimeout=i}}hover(e){let i=this.getTileAt(e);this.hoverGeoTile(i!=null&&i.is("geo")?i:void 0),this.$parent.$svg.css("cursor",i?"grab":"")}},eo=class extends Ue{down({posn:t}){this.erase(t)}move({posn:t,lastPosn:e}){let i=p.distance(t,e)/4;for(let n=0;n<i;++n)this.erase(p.interpolate(t,e,n/i))}shouldErase(t,e,i){return rt(e)?p.distance(e,t)<10:it(e)?e.distanceSquared(t)<100:gn(e)?e.edges.some(n=>n.distanceSquared(t)<100):U(e)&&i==="geo"?Math.abs(p.distance(t,e.c)-e.r)<10:e.contains(t)}erase(t){let e=this.$parent.option("noDeleting")?[]:this.$parent.tiles.values();for(let i of e)if(!(!i.transformed||i.cannotDragToSelect||!i.canSelect||!i.canEdit)&&this.shouldErase(t,i.transformed,i.props.name)){i.delete();return}for(let i of this.$parent.strokes.values())if(i.hitTest(t,10)){i.delete();return}}end(){this.$parent.flushChanges(),this.$parent.snapping.updateIntersections()}click(){this.end()}},so=class extends Ue{constructor(){super(...arguments);this.options="text"}down({posn:e}){let i=H.create(this.$parent,{name:this.options,x:e.x-10,y:e.y-15});this.$parent.trigger("add-tile",{tile:i}),this.$parent.setActiveTool("move"),i.focus(!0)}},io=class extends Ue{enable(){this.previousTool=this.$parent.state.tool,this.$parent.setActiveTool("pan")}down(t){this.initialOrigin=this.$parent.origin,this.startPosn=It(t.event)}move(t){let e=It(t.event).subtract(this.startPosn),i=this.initialOrigin.subtract(e.scale(1/this.$parent.zoom));this.$parent.setViewport(i,this.$parent.zoom)}disable(){this.$parent.setActiveTool(this.previousTool)}},no=class extends Ue{constructor(){super(...arguments);this.options="pen"}getUtensil(e){for(let i of this.$parent.tiles.values()){let n=Ed(i)?i.getDrawingPath(e):void 0;if(n)return n}}down({posn:e}){this.stroke=new He(this.$parent,"",this.$parent.state.penColor,this.options),this.stroke.start(e,this.getUtensil(e))}move({posn:e}){this.stroke.addPoint(e)}click(){this.$parent.flushChanges(),this.stroke=void 0}end(e){this.stroke.end(),this.click()}},Ji=class extends Ue{constructor(){super(...arguments);this.options="line";this.angleIndex=0}expr(e,i){var n;switch(this.options){case"line":return`segment(${e},${i})`;case"circle":return`circle(${e},distance(${e},${i}))`;case"rect":return`rectangle(${e},${i}.x-${e}.x,${i}.y-${e}.y)`;case"angle":return`angle(${i},${(n=this.midPoint)==null?void 0:n.props.key},${e})`}}snapPoint(e){var o;this.$parent.options.canvas!=="infinite"&&(e=e.clamp(this.$parent.canvasBounds));let i=this.$parent.snapping.snap([e]);i&&(e=e.add(i.shift));let n="",r=((o=i==null?void 0:i.tile)==null?void 0:o.props.name)==="geo"?i==null?void 0:i.tile:void 0;return r!=null&&r.path&&rt(r.path)&&(n=r.props.key),i!=null&&i.intersection&&(n=i.intersection),{point:e,tile:r,expr:n||`point(${e.x},${e.y})`}}getOrMakePointTile(e){var n,r;if((n=e==null?void 0:e.tile)!=null&&n.path&&rt(e.tile.path))return e.tile;if((r=e==null?void 0:e.tile)!=null&&r.path){let o=e.tile.path.offset(e.point),a=new Yt(this.$parent,{expr:`${e.tile.props.key}.at(${o})`});return this.$parent.trigger("add-tile",{tile:a}),a}let i=new Yt(this.$parent,{expr:e.expr});return this.$parent.trigger("add-tile",{tile:i}),i}drawPendingPoint(e){var r,o;let i=((o=(r=e.tile)==null?void 0:r.path)==null?void 0:o.type)==="point",n=e.expr.startsWith("intersection");this.$parent.$pendingPoint.toggle(!i),i||(this.$parent.$pendingPoint.setCenter(e.point),this.$parent.$pendingPoint.setClass("intersection",n),this.$parent.$pendingPoint.setAttr("r",n?3.5:6))}down({posn:e}){let i=this.snapPoint(e),n=this.getOrMakePointTile(i);this.options==="angle"?(this.angleIndex===0?(this.startPoint=n,this.angleIndex=1):this.angleIndex===1?(this.midPoint=n,this.angleIndex=2,this.path=new Yt(this.$parent,{expr:this.expr(this.startPoint.props.key,n.props.key)})):(this.path.setExpr(this.expr(this.startPoint.props.key,n.props.key)),this.angleIndex=0,this.path=this.startPoint=this.midPoint=void 0),this.$parent.flushChanges()):this.startPoint=n}start(){var e;this.options!=="angle"&&(this.path=new Yt(this.$parent,{}),this.startPoint.pending=this.path.pending=!0,(e=this.$parent.$pendingPoint)==null||e.show(),this.hoverGeoTile())}move({posn:e}){var i;this.options!=="angle"&&(this.endSnap=this.snapPoint(e),this.path.setExpr(this.expr(this.startPoint.props.key,this.endSnap.expr),!0),this.drawPendingPoint(this.endSnap),this.hoverGeoTile((i=this.endSnap)==null?void 0:i.tile))}end(){var n;if(this.options==="angle")return;let e=p.distance(this.startPoint.path,this.endSnap.point)<8,i;e?this.path.delete():(i=this.getOrMakePointTile(this.endSnap),this.path.setExpr(this.expr(this.startPoint.props.key,i.props.key)),this.path.setPending(!1),this.$parent.trigger("add-tile",{tile:this.path})),this.startPoint.setPending(!1),(n=this.$parent.$pendingPoint)==null||n.hide(),this.hoverGeoTile(),this.$parent.snapping.updateIntersections(),this.$parent.flushChanges(),this.startPoint=this.path=this.endSnap=void 0}click(){this.options!=="angle"&&this.$parent.flushChanges()}hover(e){var n;let i=this.snapPoint(e.posn);this.drawPendingPoint(i),this.hoverGeoTile(((n=i==null?void 0:i.tile)==null?void 0:n.props.name)==="geo"?i.tile:void 0),this.options==="angle"&&this.angleIndex===2&&this.path.setExpr(this.expr(this.startPoint.props.key,i.expr))}cancel(){this.$parent.$pendingPoint.hide(),this.path&&this.path.delete(),this.startPoint=this.path=this.endSnap=void 0,this.angleIndex=0}},ro=class extends Ji{constructor(){super(...arguments);this.expression=""}enable(e){var i;this.expression=e,this.$parent.selection.clear(),this.$parent.setActiveTool("geoPending"),(i=window.event)!=null&&i.clientX&&this.hover({posn:me(window.event,this.$parent.$svg)})}makePath(){return this.path=new Yt(this.$parent,{}),this.path.$el.css("opacity",.5),this.path.pending=!0,this.path}down(e){if(!this.expression)return;super.down(e);let i=this.path||this.makePath();i.$el.css("opacity",1),i.setExpr(this.expression.replace(/\$1/g,this.startPoint.props.key)),i.pending=!1,this.path=void 0,this.$parent.selection.add(i,!0),this.$parent.flushChanges(),this.$parent.snapping.updateIntersections(),this.$parent.trigger("add-tile",{tile:i}),this.$parent.setActiveTool("move")}hover({posn:e}){var n;if(!this.expression)return;let i=this.snapPoint(e);this.drawPendingPoint(i),this.hoverGeoTile(((n=i==null?void 0:i.tile)==null?void 0:n.props.name)==="geo"?i.tile:void 0),this.path||this.makePath(),this.path.setExpr(this.expression.replace(/\$1/g,i.expr))}cancel(){super.cancel(),this.expression=""}},oo=class extends Ue{enable(){if(this.tiles=Array.from(this.$parent.selection.tiles),!this.tiles.length)return this.cancel();this.$parent.selection.clear(),this.$parent.setActiveTool("cutPolygon");for(let t of this.tiles)t.$el.addClass("active")}down(){}start({posn:t}){var e;this.tiles&&(this.startPoint=((e=this.$parent.snapping.snap([t]))==null?void 0:e.posn)||t,this.$stroke=m("line",{class:"stroke cut"},this.$parent.$strokes))}move({posn:t}){var e,i;this.tiles&&(this.endPoint=((e=this.$parent.snapping.snap([t]))==null?void 0:e.posn)||t.snap(this.startPoint,5),(i=this.$stroke)==null||i.setLine(this.startPoint,this.endPoint))}end(t){var i;if(!this.tiles)return;if(t.cancelled)return this.cancel();let e=new vt(this.startPoint,this.endPoint);for(let n of this.tiles||[]){let o=n.transformed.cut(e);if(o.length>1){for(let a of o)H.create(this.$parent,ft(ut({},n.props.raw),{name:"polygon",shape:ai(a),scale:void 0,index:void 0,isFlipped:void 0,width:void 0,height:void 0,sides:void 0,x:0,y:0,rot:0}));n.delete()}else n.$el.removeClass("active")}this.$parent.flushChanges(),(i=this.$stroke)==null||i.remove(),this.$stroke=this.tiles=this.startPoint=this.endPoint=void 0,this.$parent.setActiveTool("move")}click(){this.cancel()}cancel(){var t;for(let e of this.tiles||[])e.$el.removeClass("active");(t=this.$stroke)==null||t.remove(),this.$stroke=this.tiles=this.startPoint=this.endPoint=void 0,setTimeout(()=>this.$parent.setActiveTool("move"))}};var Md='<x-icon class="bg-icon" name="construction" size="360" hidden></x-icon><svg class="canvas" tabindex="0"><defs><pattern class="grid-pattern" id="square2-grid" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="50" height="50" opacity="0.4"></rect></pattern><pattern class="grid-pattern" id="square-dots" x="-4" y="-4" width="25" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="4" r="2" opacity="0.6"></circle></pattern><pattern class="grid-pattern" id="square-grid" x="0" y="0" width="125" height="125" patternUnits="userSpaceOnUse"><g opacity="0.4"><line x1="25" y1="0" x2="25" y2="125"></line><line x1="0" y1="25" x2="125" y2="25"></line><line x1="50" y1="0" x2="50" y2="125"></line><line x1="0" y1="50" x2="125" y2="50"></line><line x1="75" y1="0" x2="75" y2="125"></line><line x1="0" y1="75" x2="125" y2="75"></line><line x1="100" y1="0" x2="100" y2="125"></line><line x1="0" y1="100" x2="125" y2="100"></line></g><rect x="0" y="0" width="125" height="125"></rect></pattern><pattern class="grid-pattern" id="tri-dots" x="0" y="-4" width="25" height="43.302" patternUnits="userSpaceOnUse"><circle cx="0" cy="4" r="2" opacity="0.6"></circle><circle cx="25" cy="4" r="2" opacity="0.6"></circle><circle cx="12.5" cy="25.651" r="2" opacity="0.6"></circle></pattern><pattern class="grid-pattern" id="tri-grid" x="0" y="0" width="25" height="43.302" patternUnits="userSpaceOnUse"><g opacity="0.4"><line x1="0" y1="0" x2="25" y2="0"></line><line x1="0" y1="21.651" x2="25" y2="21.651"></line><line x1="0" y1="43.302" x2="25" y2="43.302"></line><line x1="0" y1="0" x2="25" y2="43.302"></line><line x1="25" y1="0" x2="0" y2="43.302"></line></g></pattern><pattern class="grid-pattern" id="tri2-dots" x="-4" y="0" width="43.302" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="0" r="2" opacity="0.6"></circle><circle cx="4" cy="25" r="2" opacity="0.6"></circle><circle cx="25.651" cy="12.5" r="2" opacity="0.6"></circle></pattern><pattern class="grid-pattern" id="tri2-grid" x="0" y="0" width="43.302" height="25" patternUnits="userSpaceOnUse"><g opacity="0.4"><line x1="0" y1="0" x2="0" y2="25"></line><line x1="21.651" y1="0" x2="21.651" y2="25"></line><line x1="43.302" y1="0" x2="43.302" y2="25"></line><line x1="0" y1="0" x2="43.302" y2="25"></line><line x1="0" y1="25" x2="43.302" y2="0"></line></g></pattern><pattern class="grid-pattern" id="square-checked" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect class="filled" x="0" y="0" width="25" height="25" opacity="0.4"></rect><rect class="filled" x="25" y="25" width="25" height="25" opacity="0.4"></rect></pattern><radialGradient id="sphere-gradient" cx="65%" cy="35%" r="65%"><stop offset="0" stop-color="white" stop-opacity="0.3"></stop><stop offset="0.32" stop-color="white" stop-opacity="0"></stop><stop offset="0.33" stop-opacity="0"></stop><stop offset="1" stop-opacity="0.2"></stop></radialGradient><linearGradient id="card-gradient"><stop offset="0" stop-color="#999"></stop><stop offset="0.08" stop-color="#bbb"></stop><stop offset="0.92" stop-color="#bbb"></stop><stop offset="1" stop-color="#999"></stop></linearGradient><filter id="handdrawn" x="-20%" y="-20%" width="140%" height="140%"><feTurbulence type="fractalNoise" basefrequency="0.004 0.004" numoctaves="26" stitchtiles="stitch" result="turbulence"></feTurbulence><feDisplacementMap in="SourceGraphic" in2="turbulence" scale="20" xchannelselector="R" ychannelselector="G" result="displacementMap"></feDisplacementMap></filter><filter id="pencil" x="-10%" y="-10%" width="110%" height="110%" filterUnits="objectBoundingBox"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="3" result="noise"></feTurbulence><feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="2" in="SourceGraphic" result="newSource"></feDisplacementMap></filter><filter id="outline"><feMorphology in="SourceAlpha" result="DILATED" operator="dilate" radius="1.2"></feMorphology><feFlood flood-color="var(--canvas-bg)" flood-opacity="1" result="WHITE"></feFlood><feComposite in="WHITE" in2="DILATED" operator="in" result="OUTLINE"></feComposite><feMerge><feMergeNode in="OUTLINE"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter><symbol id="suit-c" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m0-10c2.3.1 4.2 1.9 4.3 4.2 0 1.6-.9 3-2.3 3.8.8-.3 1.6-.5 2.5-.5 2.4-.1 4.4 1.7 4.5 4.1v.2c0 2.3-1.9 4.2-4.2 4.2-.1 0-.2 0-.3 0-1.2-.1-2.4-.4-3.5-1 0 0-.3 2 2 5h-6c2.3-3 2-5 2-5-1.1.6-2.3.9-3.5 1-2.3.2-4.3-1.6-4.5-3.9 0-.1 0-.2 0-.3 0-2.4 1.9-4.3 4.3-4.3h.2c.9 0 1.7.2 2.5.5-1.4-.8-2.3-2.2-2.3-3.8.1-2.3 2-4.1 4.3-4.2z"></path></symbol><symbol id="suit-s" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m0-10c-3 5-8 7-8 12 .1 2.1 1.9 3.9 4 4 1.1.1 2.2-.2 3-1 0 0 .3 2-2 5h6c-2-3-2-5-2-5 .8.8 1.9 1.1 3 1 2.1-.1 3.9-1.9 4-4 0-5-5-7-8-12z"></path></symbol><symbol id="suit-h" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m0 8.5-1.3-1.3c-4.6-4.1-7.7-6.9-7.7-10.3-.1-2.7 2.1-4.9 4.8-5h.2c1.5 0 3.1.7 4 1.9 1-1.2 2.5-1.9 4-1.9 2.8-.1 4.9 2.1 5 4.8v.2c0 3.4-3.1 6.2-7.7 10.3z"></path></symbol><symbol id="suit-d" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m7 0-7 10-7-10 7-10"></path></symbol><pattern id="card-bg" width="6" height="8" patternUnits="userSpaceOnUse"><rect width="6" height="8" fill="#0f82f2"></rect><line x2="6" y2="8" stroke="#eee" stroke-width="1"></line><line x1="6" y2="8" stroke="#eee" stroke-width="1"></line></pattern></defs><rect class="grid"></rect><path class="group-shadow"></path><path class="mask"></path><g class="tiles"></g><g class="tiles"></g><g class="strokes"></g><g class="geo-shadows"></g><g class="geo-paths"></g><g class="geo-points"></g><g class="tiles"></g><rect class="selection"></rect><g class="transform-tools" hidden><path class="group-outline"></path><line class="rotate-bar"></line><circle class="rotate-circle" r="10"></circle></g></svg><div class="html-overlay"></div><div class="rotate-label"></div><slot></slot>';var Ad=new Set(["x","y","\u03B8","r"]);function Cd(s,t){if(s instanceof jt&&s.fn==="="){let[e,i]=s.args;if(e instanceof Qs&&!(t==="graphing"&&Ad.has(e.i)))return{variable:e.i,expression:i}}return{expression:s}}var ao=class{constructor(){this.assignments=new Map;this.callbackDeps=new Map;this.updatedNames=new Set}get defined(){return[...this.assignments.keys()]}findFirstAssigner(t){var e;return(e=this.assignments.get(t))==null?void 0:e.keys().next().value}findDependants(t,e=[]){let i=[];for(let[r,o]of this.assignments.entries())o.size===1&&r!==t&&!e.includes(r)&&Is(o.values()).unknowns.filter(h=>!e.includes(h)).includes(t)&&i.push(r);let n=Bh(i,r=>this.findDependants(r,i.filter(o=>o!==r)));return[...i,...n]}validate(t){let e=new Set,i=(n,r=[])=>{if(!this.assignments.has(n)){e.add(n);return}if(r.includes(n))return{message:`The variable <em>${n}</em> is defined recursively.`,locations:r.splice(r.indexOf(n)).map(a=>this.findFirstAssigner(a))};let o=this.assignments.get(n);if(o.size===1){let a=Is(o.values());for(let h of a.unknowns){let l=i(h,[...r,n]);if(l)return l}}else return{message:`You have defined <em>${n}</em> in multiple places.`,locations:Array.from(o.keys())}};for(let n of t.unknowns){let r=i(n);if(r)return{error:r,dependsOn:[],unknowns:[]}}return{dependsOn:[],unknowns:Array.from(e)}}evaluate(t){try{let{error:e,unknowns:i}=this.validate(t);return e||i.length?{error:e,value:Number.NaN}:{value:t.evaluate(this.evalContext)}}catch(e){return{value:Number.NaN}}}get evalContext(){let t={};for(let[e,i]of this.assignments.entries())i.size===1&&(t[e]=Is(i.values()));return t}serializeEvalContext(t){let e={};for(let[i,n]of Object.entries(this.evalContext))t==="graphing"&&Ad.has(i)||(e[i]=n.toString());return e}substituteAssignments(t,e){let i=Cd(t,e);return i.variable?new jt("=",[new Qs(i.variable),i.expression.recursiveSubstitute(this.evalContext)]):t.recursiveSubstitute(this.evalContext)}markUpdated(t){this.updatedNames.add(t);for(let e of this.findDependants(t))this.updatedNames.add(e)}flushChanges(){for(let[e,i]of this.callbackDeps.entries())i.some(n=>this.updatedNames.has(n))&&e();let t=Array.from(this.updatedNames);return this.updatedNames.clear(),t}updateSource(t,e,i,n=!0){this.removeSource(t,!1),this.assignments.has(e)||this.assignments.set(e,new Map),this.assignments.get(e).set(t,i),this.markUpdated(e),n&&this.flushChanges()}attemptUpdateSource(t,e,i,n=!0){if(typeof e=="string")try{e=Et.parse(e).collapse()}catch(o){return}let r=Cd(e,i);return r.variable?this.updateSource(t,r.variable,r.expression,n):this.removeSource(t),r}removeSource(t,e=!0){for(let[i,n]of this.assignments.entries())n.has(t)&&this.markUpdated(i),n.delete(t),n.size===0&&this.assignments.delete(i);e&&this.flushChanges()}watch(t,e,i=!1){this.callbackDeps.set(e,t),i&&e()}unwatch(t){t&&this.callbackDeps.delete(t)}};var de="/audio",kd={roll:new ee(`${de}/roll.mp3`,.6,!1),spin:new ee(`${de}/spin.mp3`,.5,!1),coinToss:new ee(`${de}/coin-toss.mp3`,.3,!1),shuffle:new ee(`${de}/shuffle.mp3`,.3,!1),rng:new ee(`${de}/rng-roll.mp3`,.3,!1),draw:new ee(`${de}/card-draw.mp3`,.2,!1),click:new ee(`${de}/click.mp3`,.3,!1),woosh:new ee(`${de}/woosh.mp3`,.2,!1),rise:new ee(`${de}/rise.mp3`,.3,!1),fall:new ee(`${de}/fall.mp3`,.3,!1),splitCoins:new ee(`${de}/split-coins.mp3`,.175,!1),mergeCoins:new ee(`${de}/merge-coins.mp3`,.3,!1)};var Le=25,bh=Le*Math.sqrt(3)/2,W0=Math.sqrt(2*Le**2)/2;function mi(s,t,e){let i,n,r;t:for(let o of e)for(let a of t){let h=o.posn||o.path.project(a),l=h.subtract(a),c=l.length;if(c<s&&(s=c,i=h,n=l,r=o,c<1))break t}return n?ft(ut({},r),{posn:i,shift:n}):void 0}function*xh(s){var t;for(let[e,i]of s){let n=Q(e.path,i.path);for(let[r,o]of n.entries())yield{posn:o,intersection:`intersections(${e.props.key},${((t=i==null?void 0:i.props)==null?void 0:t.key)||i.path})[${r}]`}}}var ho=class{constructor(t){this.$parent=t;this.geoIntersections=new Set;this.strokeIntersections=new Set}*getGeoPoints(){for(let t of this.$parent.getTilesOfType("geo"))t.isActive||t.pending||t.props.status==="hidden"||t.path&&rt(t.path)&&(yield{posn:t.path,tile:t});for(let t of this.geoIntersections)yield t}*getVertices(){for(let t of this.$parent.tiles.values())if(!(t.isActive||t.pending||t.props.name==="geo"))for(let e of t.snapPoints)yield{posn:e,tile:t};for(let t of this.$parent.strokes.values())for(let e of t.snapPoints||[])yield{posn:e};for(let t of this.strokeIntersections)yield t}*getGridPoints(t){if(!this.$parent.options.grid||this.$parent.options.grid==="none")return;let e=this.$parent.options.grid.split("-")[0],i=G.aroundPoints(t),n=new lt(i.p.x-Le,i.p.x+i.w+2*Le,i.p.y-Le,i.p.y+i.h+2*Le);if(e.startsWith("square")){let r=(e==="square2"?2:1)*Le,o=Pt(n.xMin,r);for(let a=Pt(n.yMin,r);a<n.yMax;a+=r)for(let h=o;h<n.xMax;h+=r)yield{posn:new p(h,a)}}else if(e.startsWith("tri")){let r=e==="tri2";r&&(n=n.flip);let o=Pt(n.xMin,Le);for(let a=Math.floor(n.yMin/bh);a*bh<n.yMax;++a)for(let h=o+(a%2?Le/2:0);h<n.xMax;h+=Le){let l=new p(h,a*bh);yield{posn:r?l.flip:l}}}}*getSnapLines(){for(let t of this.$parent.tiles.values())if(!(t.isActive||t.pending))for(let e of t.snapLines)yield{path:e,tile:t};for(let t of this.$parent.strokes.values())t.snap&&(yield{path:t.path})}snap(t){var e,i,n;if(!this.$parent.option("noSnapping"))return(n=(i=(e=mi(12,t,this.getGeoPoints()))!=null?e:mi(8,t,this.getVertices()))!=null?i:mi(W0,t,this.getGridPoints(t)))!=null?n:mi(6,t,this.getSnapLines())}*getGeoEls(t=!0){for(let e of this.$parent.getTilesOfType("geo"))!e.canSelect||!e.transformed||(t&&rt(e.transformed)&&(yield{posn:e.transformed,tile:e}),!t&&!rt(e.transformed)&&(yield{path:e.transformed,tile:e}))}snapGeo(t){if(!this.$parent.option("noSnapping"))return mi(12,[t],this.getGeoEls(!0))||mi(6,[t],this.getGeoEls(!1))}*geoTiles(){for(let t of this.$parent.getTilesOfType("geo"))t.path&&t.props.status!=="hidden"&&!rt(t.path)&&(yield t)}*strokes(){for(let t of this.$parent.strokes.values())t.snap&&(yield t)}updateIntersections(){this.geoIntersections.clear(),this.strokeIntersections.clear();let t=Array.from(this.geoTiles()),e=Array.from(this.strokes());for(let i of xh(Oo(t)))this.geoIntersections.add(i);for(let i of xh(xi(t,e)))this.geoIntersections.add(i);for(let[i,n]of Oo(e))for(let r of Q(i.path,n.path))this.strokeIntersections.add({posn:r})}addStroke(t){if(t.snap){for(let e of this.strokes())if(e!==t)for(let i of Q(e.path,t.path))this.strokeIntersections.add({posn:i});for(let e of xh(xi(this.geoTiles(),[t])))this.geoIntersections.add(e)}}orthogonal(t,e,i=10){var r;let n=(r=this.$parent.snapping.snap([t]))==null?void 0:r.shift;return n?t.add(n):t.snap(e||R,i)}};function $h(s,t){var a,h,l,c,u,d,g,y;if(t.value!==void 0)return["",t.value,0,t.value,0];if(t.is("algebra")){let f=(t.props.expr.startsWith("-")?-1:1)/t.denominator,v=f<0?t.props.expr.slice(1):t.props.expr,w=(a=s.tileWeights.get("x"))!=null?a:5,x=(h=s.tileWeights.get("y"))!=null?h:4;switch(v){case"1":return["",f,0,f,0];case"x":return["x",f,0,f*w,w];case"x2":return["x",0,f,f*w*w,w];case"y":return["y",f,0,f*x,x];case"y2":return["y",0,f,f*x*x,x];case"xy":return["x",f*x,0,f*x*w,w]}}if(t.is("ten-frame"))return["",0,0,0,0];let e=t.props,i=(g=(d=(u=(c=(l=e.shape)!=null?l:e.index)!=null?c:e.href)!=null?u:e.sides)!=null?d:e.expr)!=null?g:"",n=t.props.name+i+t.props.raw.color,r=btoa(n.replace(/\W/g,"")).replace(/=/g,""),o=(y=s.tileWeights.get(r))!=null?y:1;return[r,1,0,o,o]}function K0(s,t,e){let i={},n=0,r=(d,g=1)=>{let[y,f,v,w,x]=$h(s,d);n+=g*w,y&&(i[y]||(i[y]=[0,0,0]),i[y][0]+=g*f,i[y][1]+=g*v,i[y][2]=x)};for(let d of t)r(d,1);for(let d of e)r(d,-1);if($(n,0))return;let o=Object.keys(i).filter(d=>i[d][0]||i[d][1]),a=o.find(d=>!s.tileWeights.has(d))||O(o);if(!a)return!0;let[h,l,c]=i[a],u=$(l,0)?c-n/h:Math.max(...zo(l,h,n-h*c-l*c*c));s.tileWeights.set(a,u),s.options.tileWeights=Array.from(s.tileWeights.entries()).map(d=>d.join("=")).join(",")}function Ph(s,t){s.tileWeights.clear();for(let e of t.split(",")){let[i,n]=e.split("=");i&&s.tileWeights.set(i,+n||0)}}var Vd="M0,26A18.1,18.1,0,0,0-18,44V72H18V44A18.1,18.1,0,0,0,0,26Z",X0=new Set(["text","number-line","spinner","decimal-grid","axes","custom-spinner","ruler","protractor","compass","geo","dot-machine","abacus","balance","chess-board","multi-jump","set-triangle","bucket","table","number-grid","chart","pie-chart","box-whisker","clock","polyhedron","rectangle","question-blank","logic-switch","logic-gate","logic-speaker","chess-piece","function-machine"]),tn=15,Ot=40,Id=180;function lo(s){let t=s/2;return`M${t},0C${t},16,66.3,20,0,20S${-t},16${-t},0Z`}var gi=class extends H{constructor(e,i,n){super(e,i,n);this.cannotRotateType=!0;this.$beam=m("path",{class:"balance-beam"},this.$el),this.$left=m("path",{class:"balance"},this.$el),this.$right=m("path",{class:"balance"},this.$el),this.$base=m("path",{d:Vd,class:"balance"},this.$el),this.dropzones=this.targetAreas().map(r=>this.$parent.dropzoneManager.createDropzone(this,{path:r,ignored:X0})),this.$handle=this.makeHandle("c",r=>{this.props.size=B(Pt(r.x-Ot,20),120,800),this.resize(),this.draw(),this.transform()}),this.$handle.css("cursor","ew-resize"),this.props.watch("color",({color:r})=>{this.$beam.css("stroke",r);for(let o of[this.$base,this.$left,this.$right])o.css("fill",r)}),this.customTransform(),this.resize(),this.draw()}onDropzonesChange(){this.rebalance(400)}applyChange(e){super.applyChange(e),"level"in e&&this.draw()}targetAreas(){let e=new G(new p(0,-Id),this.props.size,Id),i=e.shift(-this.props.size-Ot,this.props.level*tn),n=e.shift(Ot,-this.props.level*tn);return[i,n]}resize(){this.$left.setAttr("d",lo(this.props.size)),this.$right.setAttr("d",lo(this.props.size)),this.customTransform()}draw(e=this.props.level){let i=this.props.size/2+Ot,n=new p(-i,e*15),r=new p(i,-e*15);this.$beam.draw(new te(n.shift(0,10),n.shift(0,44),r.shift(0,44),r.shift(0,10))),this.$left.setTransform(n),this.$right.setTransform(r),this.$handle.setCenter({x:this.props.size+Ot,y:-e*15});let[o,a]=this.targetAreas();this.dropzones[0].updateTarget(o),this.dropzones[1].updateTarget(a)}rebalance(e=400){return D(this,null,function*(){let[i,n]=this.dropzones.map(d=>d.containedTiles),r=N(Array.from(ke(i),d=>$h(this.$parent,d)[3])),o=N(Array.from(ke(n),d=>$h(this.$parent,d)[3])),a=$(r,o)?0:r<o?-1:1;if(a===this.props.level||this.isAnimating)return;let h=this.props.level,l=(a-h)*tn;this.props.level=a,this.isAnimating=!0;let c=Array.from(i,d=>({tile:d,posn:d.posn.shift(0,l)})),u=Array.from(n,d=>({tile:d,posn:d.posn.shift(0,-l)}));yield H.animate([...c,...u],e,d=>{this.draw(tt(h,a,d)),this.$parent.selection.update()}),this.isAnimating=!1,this.transform(),this.$parent.selection.update()})}customTransform(){let e=this.props.level*tn,i=this.props.size+Ot;this.path=new V(new p(-i,e),new p(-Ot,e),new p(-Ot,25),new p(Ot,25),new p(Ot,-e),new p(i,-e),new p(i,-e+48),new p(Ot,-e+48),new p(Ot,72),new p(-Ot,72),new p(-Ot,e+48),new p(-i,e+48))}getSnapPoints(){let e=this.props.level*tn,i=this.props.size+Ot;return[new p(-i,e),new p(-Ot,e),new p(Ot,-e),new p(i,-e)]}getSnapLines(){let[e,i,n,r]=this.getSnapPoints();return[new Y(e,i),new Y(n,r)]}balance(){let[e,i]=this.dropzones.map(r=>r.containedTiles);if(K0(this.$parent,e,i))return br("balance-error");for(let r of this.$parent.getTilesOfType("balance"))r.rebalance()}static makeThumbnail(e){let i=m("svg",{width:250,height:50,viewBox:"-290 -10 580 82",class:"scale"},e);m("path",{d:"M-160 10v34h320v-34",fill:"transparent",stroke:"#bbb","stroke-width":10},i),m("path",{d:lo(240),transform:"translate(-160 0)",fill:"#bbb"},i),m("path",{d:lo(240),transform:"translate(160 0)",fill:"#bbb"},i),m("path",{d:Vd,fill:"#bbb"},i)}static altText(){return"Balance Scale"}};gi.type="balance",gi.defaultProps={level:0,size:240,color:"#bbb"},gi=T([Ut],gi);Mt([{id:"balance",type:"button",tileTypes:["balance"],label:"Balance",show:s=>s.length===1&&!!s[0].props.level,click:s=>{s[0].balance()}}]);function Ld(s){return[...s].sort((t,e)=>t.props.zIndex-e.props.zIndex)}function Od(s,t,e){let i=Lo(s,t,e);i>=0&&s.splice(i,1)}function Y0(s,t){if(!s.length)return s.push({item:t,val:t.props.zIndex});let e=Io(s,t.props.zIndex,Vo.firstGreater);s.splice(e<0?s.length:e,0,{item:t,val:t.props.zIndex})}var co=class{constructor(t){this.$parent=t;this.sorted={front:[],normal:[],back:[]};this.layers=new WeakMap}clear(){this.sorted={front:[],normal:[],back:[]},this.layers=new WeakMap}addOrUpdate(t){let e=this.layers.get(t);e&&Od(this.sorted[e.layer],t,e.z);let i=e&&e.layer!==t.props.layer,n=this.sorted[t.props.layer];(t.props.raw.zIndex===void 0||i)&&(t.props.raw.zIndex=n.length?O(n).val+1:0),this.layers.set(t,{layer:t.props.layer,z:t.props.zIndex}),Y0(n,t)}remove(t){let e=this.sorted[t.props.layer];Od(e,t,t.props.zIndex),this.layers.delete(t)}bringToFront(t,e,i){for(let n of Ld(t)){if(n.noAutoLayering&&!e)continue;let r=O(this.sorted[n.props.layer]);r.item!==n&&(n.props.zIndex=r?r.val+1:0,i&&this.$parent.pendingChanges.add(n))}}bringToBack(t,e){for(let i of Ld(t)){if(i.noAutoLayering&&!e)continue;let n=this.sorted[i.props.layer][0];if(n.item===i)return;i.props.zIndex=n?n.val-1:0}}getTileAbove(t){let e=this.sorted[t.props.layer],i=Lo(e,t,t.props.zIndex);for(let n=i+1;n<e.length;++n){let r=e[n].item;if(r!==t&&r.$container===t.$container)return r}}};var Rd=`<div class="section-block"><label class="form-row color"><x-icon name="color" size="18"></x-icon><span>Background</span><input type="color"><span class="swatch"></span></label><p class="bg-warn">This colour is adjusted in dark mode.</p><label class="form-row"><x-icon name="canvas" size="18"></x-icon><span>Canvas size</span><select class="input-field" :bind="canvas"><option value="infinite">Infinite</option><option value="fixed">Fixed</option><option value="notebook">Notebook</option></select></label><label class="form-row" :show="canvas == 'fixed'" data-display="flex"><x-icon name="axes" size="18"></x-icon><span>Dimensions</span><input class="input-field input-pair size" type="number" min="5" max="100" aria-label="Width" placeholder="Width"><input class="input-field input-pair size" type="number" min="5" max="100" aria-label="Height" placeholder="Height"></label><label class="form-row" :show="canvas == 'notebook'" data-display="flex"><x-icon name="axes" size="18"></x-icon><span>Width</span><input class="input-field size" type="number" min="5" max="100" aria-label="Width" placeholder="Width"></label><label class="form-row"><x-icon name="construction" size="18"></x-icon><span>Authoring mode</span><input class="toggle authoring" type="checkbox"><div class="control"></div></label><p class="caption">Customise the Polypad features and UI, or use advanced tile properties and authoring tools. <a href="https://polypad.amplify.com/lesson/authoring" target="_blank">Learn more</a></p><div class="advanced"><p class="caption"><button class="preset">Enable all</button> \u2022 <button class="preset">Disable all</button> \u2022 <a href="https://polypad.amplify.com/lesson/authoring" target="_blank">Learn more</a></p><h4>Polypad UI and features</h4><label class="form-row"><x-icon name="shapes" size="18"></x-icon><span>Show tiles sidebar</span><input class="toggle sidebar" type="checkbox"><div class="control"></div></label><label class="form-row"><x-icon name="fullscreen" size="18"></x-icon><span>Fullscreen toggle</span><input class="toggle setting" type="checkbox" data-key="fullscreen"><div class="control"></div></label><label class="form-row"><x-icon name="undo" size="18"></x-icon><span>Undo and redo</span><input class="toggle" type="checkbox" :bind="!noUndoRedo"><div class="control"></div></label><label class="form-row"><x-icon name="reset" size="18"></x-icon><span>Disable reset</span><input class="toggle" type="checkbox" :bind="!resetState"><div class="control"></div></label><label class="form-row"><x-icon name="grid" size="18"></x-icon><span>Grid selection panel</span><input class="toggle setting" type="checkbox" data-key="grid"><div class="control"></div></label><label class="form-row"><x-icon name="screenshot" size="18"></x-icon><span>Image exporting</span><input class="toggle setting" type="checkbox" data-key="download"><div class="control"></div></label><label class="form-row"><x-icon name="hand" size="18"></x-icon><span>Pinch and pan</span><input class="toggle" type="checkbox" :bind="!noPinchPan"><div class="control"></div></label><label class="form-row"><x-icon name="custom-view" size="18"></x-icon><span>Set initial viewport</span><input class="toggle" type="checkbox" :bind="customInitialViewport"><div class="control"></div></label><label class="form-row"><x-icon name="button" size="18"></x-icon><span>Pin Actionbar</span><select class="input-field" :bind="pinActions"><option value="custom">Custom</option><option value="always">Always</option><option value="never">Never</option></select></label><h4>Tile actions and properties</h4><label class="form-row"><x-icon name="copy" size="18"></x-icon><span>Copy and paste</span><input class="toggle" type="checkbox" :bind="!noCopyPaste"><div class="control"></div></label><label class="form-row"><x-icon name="delete" size="18"></x-icon><span>Delete tiles</span><input class="toggle" type="checkbox" :bind="!noDeleting"><div class="control"></div></label><label class="form-row"><x-icon name="geo-angle" size="18"></x-icon><span>Rotate tiles</span><input class="toggle" type="checkbox" :bind="!noRotating"><div class="control"></div></label><label class="form-row"><x-icon name="snap-to-grid" size="18"></x-icon><span>Snapping</span><input class="toggle" type="checkbox" :bind="!noSnapping"><div class="control"></div></label><label class="form-row"><x-icon name="music" size="18"></x-icon><span>Music tools</span><input class="toggle" type="checkbox" :bind="!noMusic"><div class="control"></div></label><label class="form-row"><x-icon name="cards" size="18"></x-icon><span>Merge number cards</span><input class="toggle" type="checkbox" :bind="mergeTiles"><div class="control"></div></label><h4>Display and audio options</h4><label class="form-row"><x-icon name="audio" size="18"></x-icon><span>Play sound effects</span><input class="toggle" type="checkbox" :bind="!noAudio"><div class="control"></div></label><label class="form-row"><x-icon name="color" size="18"></x-icon><span>Alternate tile colours</span><input class="toggle" type="checkbox" :bind="altColors"><div class="control"></div></label><label class="form-row"><x-icon name="brightness" size="18"></x-icon><span>High contrast mode</span><input class="toggle" type="checkbox" :bind="highContrast"><div class="control"></div></label><label class="form-row"><x-icon name="pen" size="18"></x-icon><span>Hand-drawn mode</span><input class="toggle handdrawn" type="checkbox" :bind="handdrawn"><div class="control"></div></label></div></div>`;function Th(s=!0){let t=s?"":"hidden";return{mergeTiles:s,sidebar:t,toolbar:t,actionbar:t,settings:t,noCopyPaste:!s,noUndoRedo:!s,resetState:!s,noPinchPan:!s,noDeleting:!s,noAudio:!s,noMusic:!s,noRotating:!s,noSnapping:!s,altColors:!1}}var po=class extends E{bindPolypad(t){var u;this.bindModel(t.options);let e=this.$('input[type="color"]');e.change(d=>t.options.background=d),e.on("blur",()=>t.flushChanges());let i=this.$(".bg-warn"),n=()=>{let d=t.options.background||"#ffffff";e.value=d,e.next.css("background",d),i==null||i.toggle(b.theme.isDark&&t.flipTheme)};t.options.watch(n),b.onThemeChange(n),this.$("select").on("change",()=>{let d=t.options.canvas;t.options.canvasX=d==="infinite"?void 0:750,t.options.canvasY=d==="fixed"?750:void 0,t.resetViewport(),t.flushChanges()});for(let[d,g]of this.$$(".size").entries()){let y=d===1?"canvasY":"canvasX";g.onKey("Enter",()=>g.blur()),g.change(f=>{f&&(t.options[y]=(Math.round(+f)||15)*50,t.resetViewport())}),g.on("blur",()=>t.flushChanges()),t.options.watch(f=>g.value=`${(f[y]||0)/50}`)}for(let d of this.$$("input.toggle"))d.on("change",()=>t.selection.update());let o=this.$(".sidebar");t.options.watch(d=>o.checked=d.sidebar!=="hidden"),o.on("click",()=>t.options.sidebar=o.checked?"":"hidden");let a=this.$$(".setting");t.options.watch(({settings:d})=>{let g=(d==null?void 0:d.split(","))||[];for(let y of a)y.checked=!d||g.includes(y.data.key)});for(let d of a)d.on("change",()=>{t.options.settings=a.every(g=>g.checked)?void 0:a.filter(g=>g.checked).map(g=>g.data.key).join(",")||"other"});for(let d of this.$$(".advanced input, .authoring, .advanced select"))d.on("change",()=>setTimeout(()=>t.flushChanges()));Sh||(u=this.$(".handdrawn"))==null||u.parent.remove(),this.$(".authoring").bindVariable(t.state,"authorMode");let l=this.$$(".caption, .advanced");t.state.watch(d=>l.map((g,y)=>g.toggle(d.authorMode?!!y:!y)));let c=this.$$(".preset");for(let[d,g]of c.entries())g.on("click",()=>t.options.assign(Th(!d)))}};po=T([S("pp-customise",{template:Rd})],po);var Dd=12,Nd=s=>s.path.rotate(J(s.rot),s.is("group")?s.path.center:void 0),uo=class{constructor(t,e){this.tile=t;this.options=e;this.containedTiles=new Set;this.$path=m("path",{class:"dropzone",path:e.path,hidden:!0},t.$el)}canInsert(t){var n,r,o,a;let e=(r=(n=this.options.allowed)==null?void 0:n.has(t.props.name))!=null?r:!0,i=(a=(o=this.options.ignored)==null?void 0:o.has(t.props.name))!=null?a:!1;return e&&!i&&(!this.options.canAdd||this.options.canAdd(t))}hasReachedTileLimit(){return this.options.maxTiles?this.containedTiles.size>=this.options.maxTiles:!1}overlaps(t){if(!t.path)return!1;let e=Nd(t).translate(t.posn.subtract(this.tile.posn)).rotate(-J(this.tile.rot));return qi(this.options.path,e)}addTile(t){this.containedTiles.add(t),t.inDropZone=this}delete(){for(let t of this.containedTiles)t.inDropZone=void 0;this.containedTiles.clear(),this.$path.remove()}updateTarget(t,e){var n;this.options.path=t;let i=-((n=this.options.boxOffset)!=null?n:0);this.$path.draw(t.padding(i,i,i,i)),this.reflowLayout(e)}reflowLayout(t){if(!this.containedTiles.size||!this.options.layout||this.options.layout==="none")return;let e=this.getSortedTiles(),i=this.options.layout==="flow"?this.flowLayout(e):this.centerLayout(e),n=t?0:240;H.animate(i,n,()=>this.tile.$parent.selection.update())}getSortedTiles(){return Array.from(this.containedTiles).sort((t,e)=>Math.abs(t.posn.y-e.posn.y)<25?t.posn.x-e.posn.x:t.posn.y-e.posn.y)}flowLayout(t){var l;let e=Math.min(this.options.path.h,this.options.path.w),i=B(0,(e-50)/2,(l=this.options.padding)!=null?l:Dd),n=i,r=i,o=0,a=0,h=this.tile.posn.add(this.options.path.p);return t.map(c=>{let u=Lt(c.transformed);n+u.w+i>this.options.path.w+.001&&(r+=o+i,r>this.options.path.h-25+.001&&(a++,r=i+5*a),n=i+5*a,o=0);let d=h.add(c.posn).subtract(u.p).shift(n,r);return n+=u.w+i,o=Math.max(o,u.h),{tile:c,posn:d}})}centerLayout(t){var v;let e=t.map(w=>Lt(Nd(w))),i=Math.ceil(Math.sqrt(t.length)),n=Math.ceil(t.length/i),r=z(w=>oe(w*i,Math.min((w+1)*i,t.length)-1),n),o=z(w=>N(r[w].map(x=>e[x].w)),n),a=Math.max(...o),h=z(w=>Math.max(...r[w].map(x=>e[x].h)),n),l=N(h),c=(v=this.options.padding)!=null?v:Dd,u=o.map(w=>i>1?Math.min((this.options.path.w-w)/(i-1),c):0),d=n>1?Math.min((this.options.path.h-l)/(n-1),c):0,g=this.tile.posn.add(this.options.path.center).shift(-(a+(i-1)*Math.min(...u))/2,-(l+(n-1)*d)/2),y=0,f=0;return t.map((w,x)=>{let I=x%i,A=Math.floor(x/i),M=g.shift(y,f).subtract(e[x].p);return(I+1)%i?y+=e[x].w+u[A]:(y=0,f+=h[A]+d),{tile:w,posn:M}})}};var Gd=s=>s.props.status!=="locked"&&s.props.status!=="hidden",fo=class{constructor(t){this.polypad=t;this.dropzones=new Map;this.lockedTiles=new Set;this.tilesMoved=!1}createDropzone(t,e){this.dropzones.has(t)||this.dropzones.set(t,new Set);let i=new uo(t,e);return this.dropzones.get(t).add(i),i}deleteDropzone(t){var e;t.delete(),(e=this.dropzones.get(t.tile))==null||e.delete(t)}clear(){for(let t of this.dropzones.values())for(let e of t)e.delete();this.dropzones.clear()}lockToZone(t,e){var i;(i=t.inDropZone)==null||i.containedTiles.delete(t),e.containedTiles.add(t),this.lockedTiles.add(t)}update(t){if(!this.dropzones.size)return;if(!t||At(t,n=>this.dropzones.has(n))){let n=zh(t||[],r=>r.isDeleting);t=an(this.polypad.tiles.values(),n)}let e=new Set,i=!1;t:for(let n of vp(t)){if(n.isDeleting&&(i=!0),n.isDeleting&&this.dropzones.has(n)){for(let r of this.dropzones.get(n))r.delete();this.dropzones.delete(n);continue}if(n.inDropZone){if(e.add(n.inDropZone.tile),!n.isDeleting&&this.lockedTiles.has(n))continue;n.inDropZone.containedTiles.delete(n),n.inDropZone=void 0}if(Gd(n)&&!(this.dropzones.has(n)||n.is("song")||n.isDeleting)){for(let r of this.dropzones.values())for(let o of r)if(o.overlaps(n)){if(!o.canInsert(n)){o.options.ejectInvalid&&this.ejectFromZone(n,o);continue}if(o.hasReachedTileLimit()&&o.containedTiles.size){let a=O([...o.containedTiles]);this.ejectFromZone(a,o)}o.addTile(n),e.add(o.tile);continue t}}}for(let n of e){if(this.tilesMoved||i)for(let r of this.dropzones.get(n)||[])r.reflowLayout();n.isDeleting||n.onDropzonesChange()}this.polypad.trigger("dropzone-change",{tiles:e}),this.lockedTiles.clear(),this.tilesMoved=!1}ejectFromZone(t,e,i=20){let n=Lt(t.transformed),r=e.tile.posn.add(e.options.path.p),o=[{y:r.y-n.p.y-n.h-i},{x:r.x+e.options.path.w-n.p.x+i},{y:r.y+e.options.path.h-n.p.y+i},{x:r.x-n.p.x-n.w-i}];for(let[a,h]of o.entries()){let l=t.posn.shift(h.x||0,h.y||0);if(!(a<3&&this.polypad.getTileAt(l,["categorizer"])))return e.containedTiles.delete(t),t.inDropZone=void 0,H.animate([{tile:t,posn:l}],200,()=>t.$parent.selection.update())}}onMoveStart(t){if(!this.dropzones.size)return;let e=new Set;for(let i of t)for(let n of this.dropzones.get(i)||[])if(n.$path.show(),n.options.sticky)for(let r of n.containedTiles)e.add(r);this.polypad.selection.select(e)}onMove(t){if(!this.dropzones.size)return;let e=new Set;for(let[i,n]of this.dropzones.entries())if(!i.isActive)for(let r of n)r.$path.toggle(At(t,o=>{if(!Gd(o))return;let a=!e.has(o)&&(r.containedTiles.has(o)||r.canInsert(o))&&r.overlaps(o);return a&&e.add(o),a}))}onMoveEnd(){if(this.dropzones.size){this.tilesMoved=!0;for(let t of this.dropzones.values())for(let e of t)e.$path.hide()}}};var mo=4,go=s=>`${s.xMin} ${s.yMin} ${s.dx} ${s.dy}`,zd=s=>!!s.name,Sh=b.isChrome&&!b.isMobile,vo=class extends E{constructor(){super(...arguments);this.tiles=new Map;this.strokes=new Map;this.options=le({});this.state=le({tool:"move",changeCount:0,penColor:"#242436",audioPlaying:0});this.mathContext=new ao;this.snapping=new ho(this);this.zIndex=new co(this);this.dropzoneManager=new fo(this);this.geoData=new Hr;this.tools={move:new to(this),pen:new no(this),geo:new Ji(this),geoPending:new ro(this),eraser:new eo(this),text:new so(this),pan:new io(this),cutPolygon:new oo(this)};this.origin=R;this.zoom=1;this.margins=[40,40,40,40];this.initial={};this.newTileShift=0;this.tileWeights=new Map;this.setup=!1;this.undoStack=[];this.redoStack=[];this.pendingChanges=new Set;this.pendingStrokes=new Set}ready(){this.$svg=this.$("svg.canvas"),this.$tiles=this.$svg.$$(".tiles"),this.$selection=this.$svg.$(".selection"),this.$strokes=this.$svg.$(".strokes"),this.$grid=this.$svg.$(".grid"),this.$html=this.$(".html-overlay"),this.$mask=this.$(".mask"),this.$geoShadows=this.$svg.$(".geo-shadows"),this.$geoPaths=this.$svg.$(".geo-paths"),this.$geoPoints=this.$svg.$(".geo-points"),this.$pendingPoint=m("circle",{class:"geo-point pending",hidden:!0},this.$geoPoints),this.setAttr("data-tool","move"),this.events=new si(this.$svg,{down:i=>this.tools[this.state.tool].down(i),up:i=>this.tools[this.state.tool].up(i),start:i=>this.tools[this.state.tool].start(i),move:i=>this.tools[this.state.tool].move(i),end:i=>this.tools[this.state.tool].end(i),click:i=>this.tools[this.state.tool].click(i),hover:i=>this.tools[this.state.tool].hover(i),cursor:!1}),this.selection=new Wr(this),this.warningBanner=new vr(this),this.setViewport(R,1),this.options.watch(i=>{this.$grid.setAttr("fill",i.grid&&i.grid!=="none"?`url(#${i.grid})`:"none"),this.$grid.setRect(this.viewportBounds.rect)}),this.$svg.on("contextmenu",i=>{this.focussedTile||i.preventDefault()}),this.enablePinchPan(),this.enableAccessibility(),b.onThemeChange(()=>{this.setBackground(this.options.background);for(let i of this.tiles.values())i.props.updateTheme();for(let i of this.strokes.values())i.setColor(i.color);this.updateCursor()}),this.options.watch(i=>this.setBackground(i.background)),this.options.watch(i=>this.setClass("high-contrast",!!i.highContrast)),Sh&&this.options.watch(i=>this.setClass("handdrawn",!!i.handdrawn)),this.state.watch(()=>this.updateCursor());let e=this.$(".bg-icon");this.state.watch(i=>{e.toggle(i.authorMode),this.setClass("author-mode",!!i.authorMode),this.selection.clear()}),this.options.watch(i=>this.toggleViewportTile(i.customInitialViewport)),this.options.watch(()=>{let{canvas:i,canvasX:n=750,canvasY:r=750}=this.options,o=2e4;this.$mask.toggle(i!=="infinite"),i==="notebook"?this.$mask.setAttr("d",`M-1 -1h${n+2}V${o}H${o}V${-o}H${-o}V${o}H-1z`):i==="fixed"&&this.$mask.setAttr("d",`M-1 -1h${n+2}v${r+2}h${-n-2}zM${-o}${-o}V${o}H${o}V${-o}z`),this.canvasBounds=i==="infinite"?void 0:new lt(0,n,0,i==="notebook"?1e10:r)})}playSound(e){this.options.noAudio||kd[e].play()}toggleViewportTile(e){if(!this.setup)if(e)H.create(this,{name:"initial-viewport",x:this.viewportBounds.center.x-200,y:this.viewportBounds.center.y-200},"INITIAL_VIEWPORT");else for(let i of this.getTilesOfType("initial-viewport"))i.delete()}get customInitialBounds(){if(!this.options.customInitialViewport)return;let e=this.tiles.get("INITIAL_VIEWPORT");if(e)return Fi(new Map([["INITIAL_VIEWPORT",e]]),new Map,!0)}setBackground(e="#fff"){let i=$t.fromHex(e).hsl[2],n=e;this.flipTheme=i>=70,b.theme.isDark&&this.flipTheme&&(n=i>99?"#22212e":_e(e),i=100-i);let r=i<50?"#e2e1e6":"#181824";this.parent.css("--canvas-bg",n),this.parent.css("--canvas-fg",r),this.parent.css("--grid-opacity",.5-Math.abs(i/50-1)/4),this.parent.setClass("dark",i<50),this.$mask.css("fill",$t.mix("#000",n,.25).hex);let o=this.margins.some(a=>a>0);this.$mask.css("stroke",o?$t.mix(r,n,.4).hex:"transparent")}updateCursor(){let{tool:e,toolOptions:i,penColor:n}=this.state;if(e!=="pen"&&e!=="eraser")return this.css("cursor","");let r=e==="eraser"?10:i==="highlighter"?12:5,o=e==="eraser"?"#fff":_e(n||"#000",this.flipTheme);this.css("cursor",`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="${2*r+2}" width="${2*r+2}"><circle cx="${r+1}" cy="${r+1}" r="${r}" fill="${o}" stroke="${yr(o)}"/></svg>') ${r+1} ${r+1}, auto`.replaceAll("#","%23"))}getTileAt(e,i){for(let n of this.tiles.values())if(!(i&&!i.includes(n.props.name))&&n.contains(e))return n}getInputAt(e,i){for(let n of this.tiles.values()){let r=n.getClosestPort(e,i);if(r)return r}}*getTilesOfType(e){for(let i of this.tiles.values())i.is(e)&&(yield i)}getBounds(e=0){let{canvas:i,canvasX:n,canvasY:r}=this.options;if(i==="infinite")return this.contentBounds.extend(e);let o=i==="notebook"?this.contentBounds.yMax+e:r;return new lt(0,n!=null?n:0,0,o!=null?o:0)}getThumbnailBounds(e=0){var a;let{canvas:i,canvasX:n,canvasY:r}=this.options,o=(a=this.customInitialBounds)!=null?a:this.contentBounds.extend(e);return i==="infinite"||(o.xMin=Math.max(0,o.xMin),o.yMin=Math.max(0,o.yMin),o.xMax=n?Math.min(o.xMax,n):o.xMax,o.yMax=o.dx/1.5,o.yMax=r?Math.min(o.yMax,r):o.yMax),o}option(e){return this.state.authorMode?!1:!!this.options[e]}hasAction(e){let i=this.options.actionbar;return i?i.split(",").includes(e):!0}enablePinchPan(){this.on("wheel",n=>{if(!this.options.noPinchPan)if(n.preventDefault(),n.ctrlKey){let r=this.zoom*(1-n.deltaY/100);this.setViewport(this.origin,r,me(n,this.$svg))}else{let r=this.origin.shift(n.deltaX/this.zoom,n.deltaY/this.zoom);this.setViewport(r,this.zoom)}});let e=0,i=this.origin;this.on("gesturestart",n=>{this.options.noPinchPan||(n.preventDefault(),i=new p(n.pageX,n.pageY).subtract(this.origin),e=this.zoom,this.events.cancel())}),this.on("gesturechange",n=>{if(this.options.noPinchPan)return;n.preventDefault();let r=e*n.scale,o=new p(n.pageX,n.pageY).subtract(i);this.setViewport(o,r,me(n,this.$svg))}),this.on("gestureend",n=>{this.options.noPinchPan||n.preventDefault()})}enableImageDrop(e,i){let n=m("div",{class:"image-drop"},this);this.imageUploadCallback=e,this.on("dragenter dragover dragleave drop",o=>o.preventDefault()),this.on("dragenter dragover",()=>n.show()),this.on("dragleave drop",()=>n.hide());let r=(o,a)=>D(this,null,function*(){let l=Array.from((o==null?void 0:o.files)||[]).slice(0,10).map((c,u)=>this.newImage(c,a.shift(u*25),e));yield Promise.all(l),this.flushChanges(),this.trigger("paste")});this.on("drop",o=>r(o.dataTransfer,me(o,this.$svg))),i==null||i.on("change",()=>D(this,null,function*(){yield r(i._el,this.viewportBounds.center),i.value=""}))}bindKeyboardEvents(e=C,i){this.selection.bindKeyboardEvents(e),e.onKey("Backspace Clear Delete",()=>this.selection.delete()),e.onKey("z",n=>{n.preventDefault(),this[n.shiftKey?"redo":"undo"]()},{meta:!0}),e.onKey("y",n=>{n.preventDefault(),this.redo()},{meta:!0}),e.onKey("c C",()=>{if(this.option("noCopyPaste"))return;let n=this.selection.copy();this.paste(n,new p(25,25)),this.flushChanges()}),e.onKey("a",n=>{var o;if((o=k("x-modal"))!=null&&o.getOpenModal())return;n.preventDefault();let r=Array.from(this.tiles.values());this.state.authorMode||(r=r.filter(a=>a.canSelect)),this.selection.select(r)},{meta:!0}),C.on("cut copy",n=>{var o;if(i!=null&&i()||!this.selection.tiles.size||this.option("noCopyPaste")||b.formIsActive)return;let r=this.selection.copy();(o=window.navigator.clipboard)==null||o.writeText(JSON.stringify(r)),n.type==="cut"&&this.selection.delete()}),C.on("paste",n=>D(this,null,function*(){var a;if(i!=null&&i()||this.option("noCopyPaste")||b.formIsActive)return;let r=up(n.clipboardData);if(r&&this.imageUploadCallback)return yield this.newImage(r,this.center.shift(-50),this.imageUploadCallback),this.flushChanges(),this.trigger("paste");let o=yield(a=window.navigator.clipboard)==null?void 0:a.readText();if(o){try{let h=JSON.parse(o);if(!Object.keys(h).length)return;this.paste(h)}catch(h){let l=H.create(this,{name:"text",html:o});l.setTransform(this.viewportBounds.center.subtract(l.center)),this.selection.add(l,!0),this.flushChanges(),this.trigger("paste"),this.selection.select([l])}this.flushChanges()}})),e.onKey("Space",n=>{this.options.noPinchPan||this.state.tool==="pan"||(n.preventDefault(),this.tools.pan.enable())}),e.onKey("Space",n=>{this.options.noPinchPan||this.state.tool!=="pan"||(n.preventDefault(),this.tools.pan.disable())},{up:!0})}enableAccessibility(){let e,i=!1,n=r=>{this.focussedTile||(e=r,this.$svg.setAttr("aria-description",r?r.altText:"Empty Canvas"),r&&this.selection.add(r,!0))};this.$svg.on("focusin",()=>{if(!i)return;let r=Array.from(this.tiles.values()).filter(o=>!o.props.status);n(this.events.shiftKey?O(r):r[0])}),this.$svg.on("focusout",()=>e=void 0),C.on("keydown",r=>{var a;if(i=!0,r.key==="Escape")return(a=this.focussedTile)==null||a.blur(),this.setActiveTool("move");if(r.key!=="Tab"||!e)return;let o=Array.from(this.tiles.values()).filter(h=>!h.group&&!h.props.status);n(o[o.indexOf(e)+(r.shiftKey?-1:1)]),e&&r.preventDefault()}),C.on("pointerdown",()=>i=!1),this.$svg.on("pointerdown",()=>{i=!1,this.focussedTile||this.$svg.focus()})}newImage(e,i,n){return D(this,null,function*(){let r=new FileReader;r.readAsDataURL(e),yield new Promise(a=>r.onloadend=a);let o=H.create(this,{name:"image",href:(r.result||"").toString(),x:i.x,y:i.y});return this.selection.add(o,!0),yield n==null?void 0:n(e,o),o})}setViewport(e,i=1,n){var v;if(i=B(i,1/mo,mo),n){let w=this.zoom/i;e=n.subtract(n.subtract(this.origin).scale(w))}let r=this.width/i,o=this.height/i,{canvas:a,canvasX:h=0,canvasY:l=0,grid:c}=this.options,[u,d,g,y]=this.margins;if(a==="infinite")this.origin=e.clamp(this.contentBounds.extend(o,0,0,r),50/i);else{let w=a==="notebook"?this.contentBounds.yMax+o-u/i:l,x=new lt(-y/i,h-r+d/i,-u/i,w-o+g/i,"center");this.origin=e.clamp(x)}this.zoom=i,this.viewportBounds=new lt(this.origin.x,this.origin.x+r,this.origin.y,this.origin.y+o),this.$svg.setAttr("viewBox",this.attr("viewBox")||go(this.viewportBounds)),this.$html.setTransform(this.origin.inverse.scale(this.zoom),0,this.zoom);let f=this.viewportBounds.rect;c!=="none"&&this.$grid.setRect(f),this.geoData.redrawLines(((v=this.canvasBounds)==null?void 0:v.rect)||f),this.newTileShift=0,this.trigger("viewport")}resetViewport(){if(this.options.canvas==="infinite"&&!this.tiles.size&&!this.strokes.size)return this.setViewport(R,1);this.panToBounds(this.customInitialBounds)}panToBounds(e,i=0){let{width:n,height:r,margins:o,origin:a,zoom:h,options:l}=this,[c,u,d,g]=o,y=!e&&l.canvas==="notebook",f=!e&&l.canvas==="infinite",v=e||this.getBounds(),w=(n-g-u)/v.dx,x=y?1:(r-c-d)/v.dy,I=B(Math.min(w,x),1/mo,f?1:mo),A=new p(n+g-u,r+c-d),M=y?new p(0,-c):v.center.subtract(A.scale(1/2/I)),P=new p(n/2,r/2);pt(j=>{let ne=yt("cubic",j),ks=Math.exp(tt(Math.log(h),Math.log(I),ne)),nn=p.interpolate(a,M,ne).add(P.scale(tt(1/h,1/I,ne)-1/ks));this.setViewport(nn,ks)},i)}setZoom(e){let i=this.viewportBounds.center;this.setViewport(this.origin,this.zoom*e,i)}bindSource(e,i){let n=e.attr("tile");e.setAttr("tabindex",0),H.thumbnail(this,n,e);let r,o=i==null?void 0:i.$(".tiles");this.events.listen(e,{down:()=>this.trigger("add-tile-start"),start:({posn:a})=>{r=H.create(this,Object.assign({name:n},we(e.attr("props"),{}))),r.setTransform(a.subtract(r.center)),this.selection.add(r,!0),this.selection.moveStart(!0),i&&i.setAttr("viewBox",go(this.viewportBounds)),(o||r.$container).append(r.$el),this.trigger("add-tile",{tile:r})},move:a=>this.selection.move(a,!0),end:a=>{r.$container.append(r.$el),this.selection.moveEnd(a,!0)},click:()=>{r=H.create(this,Object.assign({name:n},we(e.attr("props"),{}))),r.setTransform(this.center.subtract(r.center).shift(this.newTileShift*25)),this.selection.add(r,!0),r.moveEnd(),this.trigger("add-tile",{tile:r}),this.flushChanges(),this.newTileShift+=1}})}get center(){let[e,i,n,r]=this.margins;return this.viewportBounds.center.shift((r-i)/this.zoom/2,(e-n)/this.zoom/2)}setActiveTool(e,i){this.tools[this.state.tool].cancel(),this.warningBanner.hide(),this.selection.clear(),this.state.assign({tool:e,toolOptions:i}),i&&(this.tools[this.state.tool].options=i),this.setAttr("data-tool",e)}clear(e=!0){this.selection.clear();for(let i of this.tiles.values())i.delete();for(let i of this.strokes.values())i.delete();e&&this.setViewport(R,1),this.flushChanges()}thumbnail(e,i,n="jpg"){return D(this,null,function*(){return this.state.authorMode&&(this.state.authorMode=!1),yield this.$svg.image(n,e,i,go(this.getThumbnailBounds(50)))})}downloadImage(e="png",i){var o;this.selection.clear();let n=i||((o=this.state.title)==null?void 0:o.replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase())||"polypad",r=this.getBounds(50);this.$svg.downloadImage(`${n}.${e}`,r.dx,r.dy,go(r))}paste(e,i,n=!0){this.selection.clear();let r=new Map;for(let l of Object.keys(e))r.set(l,We(10));let o=new Map,a=Object.entries(e).sort((l,c)=>(l[1].zIndex||0)-(c[1].zIndex||0)).map(([l,c])=>{var u,d,g;return c.name==="geo"&&Object.assign(c,Yt.copy(o,c,this.geoData)),c.name==="group"&&(c.children=(u=c.children)==null?void 0:u.split(",").map(y=>r.get(y)).join(",")),c.status=void 0,c.zIndex=void 0,c.cables=(d=c.cables)==null?void 0:d.map(y=>ft(ut({},y),{toTileId:r.get(y.toTileId)})),(c.name==="table"||c.name==="action-card")&&(c.links=(g=c.links)==null?void 0:g.split(",").map(y=>r.get(y)||y).join(",")),H.create(this,c,r.get(l))}).filter(Boolean);for(let l of a)l.delayedSetup();let h=Lt(...a.map(l=>l.transformed)).center;i===void 0&&(i=this.center.subtract(h).shift(this.newTileShift*25));for(let l of a)l.is("geo")?l.shift(i):l.setTransform(l.posn.add(i));this.newTileShift+=1,n&&(this.dropzoneManager.onMoveEnd(),this.flushChanges(),this.trigger("paste")),this.selection.select(a)}check(e){let i=!1;return new Promise(n=>{this.on("change",()=>{!i&&e(Array.from(this.tiles.values()))&&(i=!0,n())})})}flushChanges(){if(this.setup)return;this.trigger("change",{action:"change"});let e=new Map,i=this.options.getChanges();Object.keys(i[0]).length&&e.set("options",i),this.dropzoneManager.update(this.pendingChanges);for(let n of an(this.pendingChanges,this.pendingStrokes)){let r=n.flushChanges();r&&e.set(n.id,r)}this.pendingChanges.clear(),this.pendingStrokes.clear(),e.size&&(this.contentBounds=Fi(this.tiles,this.strokes),!this.options.noUndoRedo&&(this.undoStack.push(e),this.undoStack.length>50&&this.undoStack.shift(),this.redoStack=[],this.state.canUndo=!0,this.state.canRedo=!1,this.state.changeCount+=1))}undo(){this.undoStack.length&&(this.applyChange(O(this.undoStack),!0),this.redoStack.push(this.undoStack.pop()),this.state.canUndo=!!this.undoStack.length,this.state.canRedo=!0,this.state.changeCount-=1,this.selection.update(),this.trigger("change",{action:"undo"}))}redo(){this.redoStack.length&&(this.applyChange(O(this.redoStack)),this.undoStack.push(this.redoStack.pop()),this.state.canUndo=!0,this.state.canRedo=!!this.redoStack.length,this.state.changeCount+=1,this.selection.update(),this.trigger("change",{action:"redo"}))}applyChange(e,i=!1){var r,o;let n=new Set;for(let[a,[h,l]]of e.entries()){if(i&&([h,l]=[l,h]),a==="options")this.options.assign(l),("canvas"in l||"canvasX"in l||"canvasY"in l)&&this.resetViewport(),"tileWeights"in l&&Ph(this,l.tileWeights||"");else if(h)if(l){let c=this.tiles.get(a);c==null||c.applyChange(l),c&&n.add(c)}else if(zd(h)){let c=this.tiles.get(a);c==null||c.delete(),c&&n.add(c)}else(r=this.strokes.get(a))==null||r.delete();else if(zd(l)){let c=H.create(this,l,a);c.flushChanges(),n.add(c)}else He.create(this,l,a);this.contentBounds=Fi(this.tiles,this.strokes)}for(let a of e.keys())(o=this.tiles.get(a))==null||o.delayedSetup();this.dropzoneManager.update(n),this.pendingChanges.clear(),this.pendingStrokes.clear(),this.options.getChanges()}serialize(e=5e3,i=2e3,n=16e3){var r;return{title:(r=this.state.title)==null?void 0:r.slice(0,30),version:2,tiles:Za(this.tiles.values(),o=>o.props.copy(),e),strokes:Za(this.strokes.values(),o=>o.serialize(n),i),options:this.options.copy()}}resetState(e=this.initial){this.load(e)}load(e){this.setup=!0,this.clear(!1),this.geoData.reset(),this.zIndex.clear(),this.dropzoneManager.clear(),this.initial=e,this.state.assign({title:e.title,canUndo:!1,canRedo:!1,changeCount:0,audioPlaying:0,authorMode:!1}),this.undoStack=this.redoStack=[],e.options||(e.options=Th(!0)),e.options.grid||(e.options.grid="none"),e.options.canvas||(e.options.canvas="infinite"),e.options.algebraXSize||(e.options.algebraXSize=Zp),e.options.algebraYSize||(e.options.algebraYSize=Qp),e.options.pinActions||(e.options.pinActions="custom"),this.options.assign(e.options,!0),this.options.forceUpdate(),Ph(this,e.options.tileWeights||"");for(let[i,n]of Object.entries(e.tiles||{}))H.create(this,n,i).flushChanges();for(let[i,n]of Object.entries(e.strokes||{}))He.create(this,n,i);for(let i of this.tiles.values())i.delayedSetup();this.snapping.updateIntersections(),this.contentBounds=Fi(this.tiles,this.strokes),this.dropzoneManager.update(),this.resetViewport(),this.setActiveTool("move"),this.pendingChanges.clear(),this.pendingStrokes.clear(),this.options.getChanges(),this.setup=!1}};vo=T([S("x-polypad",{template:Md})],vo);var Bd=`<div class="factris-panel-left"><div class="keys-play"><button @click="app.reset()" title="Restart Game"><x-icon name="restart" size="36"></x-icon></button><button @click="app.toggle()" :title="playing ? 'Pause' : 'Play'"><span :show="playing"><x-icon name="pause" size="36"></x-icon></span><span :show="!playing"><x-icon name="play" size="36"></x-icon></span></button><button class="highscore-btn" @click="app.showHighscore()" title="Highscore"><x-icon name="trophy" size="36"></x-icon></button></div><div class="panel-item"><div class="text-large" :class="points &gt; 999999 ? 'narrow' : ''">\${numberFormat(points)}</div><div class="text-small">Points</div></div><div class="panel-item"><div class="text-large margin"><span :show="min(time)" data-display="inline">\${min(time)}m</span> \${time % 60}s</div><div class="text-small">Time</div></div><hr :show="highscore.length"><div class="highscore-panel" :show="highscore.length"><div class="highscore-title">Highscore</div><table><tr><td>\${highscore[0].name.slice(0, 4)}</td><td>\${numberFormat(highscore[0].score)}</td></tr><tr><td>\${highscore[1].name.slice(0, 4)}</td><td>\${numberFormat(highscore[1].score)}</td></tr><tr><td>\${highscore[2].name.slice(0, 4)}</td><td>\${numberFormat(highscore[2].score)}</td></tr><tr><td>\${highscore[3].name.slice(0, 4)}</td><td>\${numberFormat(highscore[3].score)}</td></tr><tr><td colspan="2"><a @click="app.showHighscore()">View more\u2026</a></td></tr></table></div><div class="corner"><svg width="13" height="17"><path class="dark" d="M0,0V5A12,12,0,0,1,12,17h1V0Z"></path><path d="M0,0V1A12,12,0,0,1,12,13v4h1V0Z"></path></svg></div></div><div class="factris-panel-right"><div class="panel-item"><div class="text-small">Next blocks:</div><div class="text-large">\${next[0]}</div><div class="text-large">\${next[1]}</div><div class="text-large">\${next[2]}</div><div class="text-large">\${next[3]}</div><div class="text-large">\${next[4]}</div></div><hr><div class="text-small discharge-label">Discharge:</div><button class="discharge" :show="!discardCounter" data-display="inline-block" @click="app.discharge()" title="Discard Tile"><x-icon name="delete" size="36"></x-icon></button><svg class="discharge-count" :show="discardCounter" data-display="inline-block" width="74" height="74" viewBox="0 0 74 74"><circle cx="37" cy="37" r="32" style="strokeDashoffset:\${201*discardCounter/5}px"></circle><text class="large" x="37" y="38">\${discardCounter}</text><text class="small" x="37" y="51">needed</text></svg><div class="corner"><svg width="13" height="17"><path class="dark" d="M0,0V17H1A12,12,0,0,1,13,5V0Z"></path><path d="M0,0V17H1V13A12,12,0,0,1,13,1V0Z"></path></svg></div></div><div class="factris-body"><svg class="factris-board" :show="(playing || lost) &amp;&amp; !showHighscore &amp;&amp; !initial" data-display="visibility"><defs><linearGradient id="shadow" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color: white; stop-opacity: 0.2"></stop><stop offset="100%" style="stop-color: white; stop-opacity: 0.05"></stop></linearGradient></defs><rect class="shadow" fill="url(#shadow)"></rect><g class="tiles"></g><g class="grid"><g class="faint-grid"></g></g><g class="scores"></g></svg><div class="logo" :class="initial &amp;&amp; !showHighscore ? 'show' : ''"><svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg"><g fill="#ffffff"><path d="m1.5039 59.1143v-57.9034h24.7227v7.8077h-16.4278v17.5659h14.313v7.8071h-14.313v24.7227z"/><path d="m23.7871 59.1143 12.9307-57.9034h6.9122l12.931 57.9034h-8.2954l-2.4394-12.4429h-11.3042l-2.44 12.4429zm20.4937-20.25-4.066-20.9815h-.1626l-4.0664 20.9815z"/><path d="m86.9766 42.6055v3.5781a12.9 12.9 0 0 1 -1.0166 5.083 14.0881 14.0881 0 0 1 -2.8057 4.27 13.5323 13.5323 0 0 1 -4.1885 2.9683 12.2636 12.2636 0 0 1 -5.164 1.0977 18.5964 18.5964 0 0 1 -4.7984-.65 11.3307 11.3307 0 0 1 -4.3911-2.2774 12.5723 12.5723 0 0 1 -3.2123-4.1889 14.814 14.814 0 0 1 -1.2608-6.5463v-31.8795a14.0993 14.0993 0 0 1 .976-5.2861 12.4357 12.4357 0 0 1 2.7648-4.229 12.863 12.863 0 0 1 4.27-2.8054 14.35 14.35 0 0 1 5.4892-1.0169 12.5807 12.5807 0 0 1 9.5151 3.8223 13.6266 13.6266 0 0 1 2.8057 4.4321 14.9842 14.9842 0 0 1 1.0166 5.5708v3.253h-8.2954v-2.7652a6.7153 6.7153 0 0 0 -1.3824-4.2285 4.4819 4.4819 0 0 0 -3.7412-1.789q-3.0915 0-4.1064 1.9111a10.23 10.23 0 0 0 -1.0166 4.8384v29.6025a7.6635 7.6635 0 0 0 1.0976 4.2285q1.098 1.7081 3.9444 1.708a6.0109 6.0109 0 0 0 1.7485-.2846 5.2115 5.2115 0 0 0 1.7485-.9351 4.953 4.953 0 0 0 1.22-1.79 7.2474 7.2474 0 0 0 .4878-2.8462v-2.8457z"/><path d="m99.1748 59.1143v-50.0957h-9.5967v-7.8077h27.4878v7.8077h-9.5959v50.0957z"/><path d="m120.7246 59.1143v-57.9034h13.3369q14.6385 0 14.6385 16.9971a21.4218 21.4218 0 0 1 -1.5859 8.7017 12.2983 12.2983 0 0 1 -5.5708 5.7739l8.9458 26.4307h-8.7832l-7.7256-24.7227h-4.9603v24.7227zm8.2954-50.0957v18.0537h4.7168a8.348 8.348 0 0 0 3.4971-.61 4.7555 4.7555 0 0 0 2.0332-1.7485 7.9534 7.9534 0 0 0 .8945-2.8057 26.9748 26.9748 0 0 0 .2437-3.8628 26.99 26.99 0 0 0 -.2437-3.8628 7.7387 7.7387 0 0 0 -.976-2.8872q-1.5467-2.2753-5.8556-2.2767z"/><path d="m155.6123 59.1143v-57.9034h8.2954v57.9034z"/><path d="m198.7954 17.8828h-8.2949v-1.8706a8.8535 8.8535 0 0 0 -1.3423-4.92 4.962 4.962 0 0 0 -4.5132-2.0737 5.2227 5.2227 0 0 0 -2.7651.65 5.4612 5.4612 0 0 0 -1.708 1.6265 6.8624 6.8624 0 0 0 -.8946 2.3989 15.6706 15.6706 0 0 0 -.2436 2.8057 27.5758 27.5758 0 0 0 .1216 2.8467 5.3954 5.3954 0 0 0 .61 2.0332 4.5014 4.5014 0 0 0 1.4229 1.5449 12.9606 12.9606 0 0 0 2.562 1.3013l6.3433 2.521a15.7628 15.7628 0 0 1 4.4726 2.48 10.7272 10.7272 0 0 1 2.6839 3.2943 15.4228 15.4228 0 0 1 1.22 4.4321 44.0689 44.0689 0 0 1 .3252 5.6524 29.8066 29.8066 0 0 1 -.7319 6.7905 14.3039 14.3039 0 0 1 -2.3584 5.3267 11.699 11.699 0 0 1 -4.4727 3.5781 15.7942 15.7942 0 0 1 -6.75 1.3013 14.7745 14.7745 0 0 1 -5.6113-1.0572 13.31 13.31 0 0 1 -4.4732-2.9277 14.2235 14.2235 0 0 1 -2.9682-4.3506 13.2116 13.2116 0 0 1 -1.0982-5.4082v-3.09h8.2955v2.6025a6.7761 6.7761 0 0 0 1.3418 4.1069q1.3418 1.83 4.5136 1.83a7.2794 7.2794 0 0 0 3.2935-.61 4.3859 4.3859 0 0 0 1.83-1.7486 6.4244 6.4244 0 0 0 .7729-2.7246q.1216-1.5856.1221-3.5376a35.0565 35.0565 0 0 0 -.1631-3.7407 6.4528 6.4528 0 0 0 -.65-2.3584 4.59 4.59 0 0 0 -1.5044-1.4639 19.57 19.57 0 0 0 -2.4805-1.22l-5.9365-2.44q-5.3679-2.1958-7.1972-5.8145a19.9948 19.9948 0 0 1 -1.83-9.0679 21.0112 21.0112 0 0 1 .8945-6.1806 14.0506 14.0506 0 0 1 2.6841-5.042 12.3042 12.3042 0 0 1 4.3506-3.375 14.5257 14.5257 0 0 1 6.3018-1.2609 13.7661 13.7661 0 0 1 5.6519 1.1387 14.5927 14.5927 0 0 1 4.4326 3.0088 12.5712 12.5712 0 0 1 3.7407 8.9458z"/></g></svg></div><x-icon class="play" :class="initial &amp;&amp; !showHighscore ? 'show' : ''" @click="app.play()" name="play" size="80"></x-icon><div class="overlay lost" :class="lost &amp;&amp; !showHighscore ? 'show' : ''">Game over!</div><div class="overlay paused" :class="playing || lost || initial || showHighscore ? '' : 'show'">Paused</div><div class="highscore" :show="showHighscore"><div class="text-large"><x-icon name="trophy" size="36"></x-icon> Highscore</div><table><tr><td>\${highscore[0].name}</td><td>\${numberFormat(highscore[0].score)}</td></tr><tr><td>\${highscore[1].name}</td><td>\${numberFormat(highscore[1].score)}</td></tr><tr><td>\${highscore[2].name}</td><td>\${numberFormat(highscore[2].score)}</td></tr><tr><td>\${highscore[3].name}</td><td>\${numberFormat(highscore[3].score)}</td></tr><tr><td>\${highscore[4].name}</td><td>\${numberFormat(highscore[4].score)}</td></tr><tr><td>\${highscore[5].name}</td><td>\${numberFormat(highscore[5].score)}</td></tr><tr><td>\${highscore[6].name}</td><td>\${numberFormat(highscore[6].score)}</td></tr><tr><td>\${highscore[7].name}</td><td>\${numberFormat(highscore[7].score)}</td></tr><tr><td>\${highscore[8].name}</td><td>\${numberFormat(highscore[8].score)}</td></tr><tr><td>\${highscore[9].name}</td><td>\${numberFormat(highscore[9].score)}</td></tr><tr><td>\${highscore[10].name}</td><td>\${numberFormat(highscore[10].score)}</td></tr></table></div></div><div class="factris-keys"><button class="key-left" :class="key === 'ArrowLeft' ? 'active' : ''" title="Left" @pointerdown="app.keyPress('ArrowLeft')"><x-icon name="left" size="36"></x-icon></button><div class="keys-center"><button class="key-up" :class="key === 'ArrowUp' ? 'active' : ''" title="Resize" @pointerdown="app.keyPress('ArrowUp')"><svg class="icon" width="54" height="36" viewBox="0 0 54 36" xmlns="http://www.w3.org/2000/svg"><path d="m41.1973 11 1.5975-1.635a.75.75 0 0 1 1.2751.5325v.495a6 6 0 0 1 5.2501 5.8575.75.75 0 0 1 -1.5 0 4.5 4.5 0 0 0 -3.75-4.3426v1.1475a.75.75 0 0 1 -1.2751.5326l-1.5975-1.56a.7676.7676 0 0 1 -.0001-1.0275z"/><path d="m12.8027 11-1.5975-1.635a.75.75 0 0 0 -1.2752.5324v.495a6 6 0 0 0 -5.25 5.8576.75.75 0 0 0 1.5 0 4.5 4.5 0 0 1 3.75-4.3426v1.1475a.75.75 0 0 0 1.2751.5326l1.5975-1.56a.7676.7676 0 0 0 .0001-1.0275z"/><rect height="11" rx="2" width="11" x="15" y="6"/><rect height="11" rx="2" width="11" x="28" y="6"/><rect height="11" rx="2" width="11" x="15" y="19"/><rect height="11" rx="2" width="11" x="28" y="19"/><path d="m50 21v7h-7v-7zm0-2h-7a2 2 0 0 0 -2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-7a2 2 0 0 0 -2-2z"/><path d="m11 21v7h-7v-7zm0-2h-7a2 2 0 0 0 -2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-7a2 2 0 0 0 -2-2z"/></svg>
</button><button class="key-down" :class="key === 'ArrowDown' ? 'active' : ''" title="Down" @pointerdown="app.keyPress('ArrowDown')"><x-icon name="down" size="36"></x-icon></button></div><button class="key-right" :class="key === 'ArrowRight' ? 'active' : ''" title="Right" @pointerdown="app.keyPress('ArrowRight')"><x-icon name="right" size="36"></x-icon></button></div><div class="factris-panel-top" :class="showHighscore ? 'hide' : ''"><div class="text-small">Block size:</div><div class="text-large">\${active[0] || '?' } = \${active[2]|| '?'} \xD7 \${active[1]|| '?'}</div><div class="corner left"><svg width="13" height="13"><path d="M12,0A12,12,0,0,1,0,12v1H13V0Z"></path></svg></div><div class="corner right"><svg width="13" height="13"><path d="M1,0A12,12,0,0,0,13,12v1H0V0Z"></path></svg></div></div>`;var Z0=1e3,Z=B(+Nl(location.search).size||16,8,24),Q0=5,vi=Math.ceil(Z/2),yo=Z+vi,bo=[];for(let s=2;s<=Z*1.5;s+=1){let t=Bo(s);t&&s>.75*Z||s>Z&&Yh(s)[0]>Z/2||(t&&s>Z/2||s>1.25*Z?bo.push(s):bo.push(s,s))}var en=()=>bo[_t.integer(bo.length)],J0=oe(1,Z),tv=Z*10,_d=z(s=>tv*2**s,Z),Eh=class{constructor(t,e,i){this.$el=m("rect",{width:20,height:20},i),this.setPosition(t,e)}setPosition(t,e){this.x=t,this.y=e,this.$el.setTransform({x:10+20*this.x,y:10+20*this.y})}go(t,e,i){this.setPosition(this.x+i-e,this.y+t)}canSet(t,e,i){return!i.find(n=>n.x===t&&n.y===e)}canGo(t,e,i,n){let r=this.x+i-e,o=this.y+t;return o>=yo||r<0||r>=Z?!1:this.canSet(r,o,n)}canGoDown(t){return this.canGo(1,0,0,t)}goDown(t=1){if(t!==0)return this.go(t,0,0)}},wo=class extends E{constructor(){super(...arguments);this.interval=void 0;this.tiles=[];this.activeTiles=[];this.activeSize=[0,0,0];this.activeFactors=[];this.isDown=!1;this.keyLock=!1;this.requestQueue=Promise.resolve("");this.highscore=!0}ready(){this.$svg=this.$(".factris-board"),this.$tiles=this.$svg.$(".tiles"),this.$shadow=this.$svg.$(".shadow"),this.attr("highscore")==="no"&&(this.highscore=!1);let e=this.$svg.$(".scores");this.$scores=_d.map((i,n)=>{let r=m("g",{},e);return m("text",{text:"+"+i,class:`s${n+1}`},r),r}),this.bindModel(le({time:0,points:0,playing:!1,lost:!1,initial:!0,key:void 0,discardCounter:0,next:[],active:[],highscore:[],showHighscore:!1,min:i=>Math.floor(i/60),numberFormat:Rt,app:this}));for(let i of this.$$("button, .play"))i.on("contextmenu",n=>n.preventDefault());C.onKey("AllArrows",(i,n)=>{this.model.playing&&(i.preventDefault(),this.isDown=!0,this.model.key=n,this.keyPress(n))}),C.onKey("AllArrows",()=>{this.model.playing&&(this.isDown=this.keyLock=!1,this.model.key=void 0)},{up:!0}),this.setupSVG(),this.updateHighscore()}setupSVG(){this.$svg.setAttr("viewBox",`0 0 ${(Z+1)*20} ${(yo+1)*20}`);let e=this.$svg.$(".grid"),i=e.$(".faint-grid");for(let n=0;n<=Z;n+=1){let r=10+n*20,o=10+(vi+n)*20,a=!(n%4)||n===Z?e:i,h=!(n%2)||n===Z?"thick":"";m("line",{x1:10,y1:o,x2:10+Z*20,y2:o,class:h},a),m("line",{x1:r,y1:10+vi*20,x2:r,y2:yo*20+10,class:h},a)}}drawShadow(){this.activeTiles.length&&(this.$shadow.setAttr("x",10+20*this.activeSize[0]),this.$shadow.setAttr("y",10+20*this.activeSize[1]),this.$shadow.setAttr("width",20*this.activeSize[2]),this.$shadow.setAttr("height",20*(yo-this.activeSize[1])))}newRect(){let e=this.getNewTileSize();this.activeFactors=J0.filter(r=>e%r===0);let i=this.activeFactors.pop(),n=Math.floor((Z-i)/2);this.activeTiles=z(r=>new Eh(n+r%i,Math.floor(r/i),this.$tiles),e),this.model.active=[e,i,e/i],this.activeSize=[n,e/i,i],this.drawShadow(),this.isDown&&(this.keyLock=!0)}reset(){this.pause(),this.model.time=0,this.model.points=0,this.model.discardCounter=0,this.model.showHighscore=!1,this.model.lost=!1,this.model.next=[en(),en(),en(),en()];for(let e of this.tiles)e.$el.remove();for(let e of this.activeTiles)e.$el.remove();this.tiles=[],this.newRect(),this.play(),this.requestQueue=Promise.resolve("")}toggle(){this.model.lost?this.reset():this.model.playing?this.pause():this.play()}pause(){this.model.playing=!1,clearInterval(this.interval)}play(){var e,i;if(this.model.showHighscore=!1,(e=window.ga)==null||e.call(window,"send","event","Factris","play"),(i=window.gtag)==null||i.call(window,"event","factris",{action:"play"}),this.model.initial||this.model.lost)return this.model.initial=!1,this.reset();this.model.playing=!0,this.interval=window.setInterval(()=>this.tick(),Z0)}getNewTileSize(){let e=Z*Z-this.tiles.length;if(this.model.next[0]>e)return e>Z?e-Z:Z;this.model.discardCounter>0&&(this.model.discardCounter-=1);let i=this.model.next[0];return this.model.next=[...this.model.next.slice(1),en()],i}tick(){if(this.model.time+=1,this.activeTiles.every(o=>o.canGoDown(this.tiles))){for(let o of this.activeTiles)o.goDown();this.activeSize[1]+=1,this.drawShadow();return}this.tiles.push(...this.activeTiles);for(let o of this.activeTiles)o.$el.addClass("fixed");if(this.tiles.some(o=>o.y<vi))return this.gameOver();this.activeTiles=[];let i=this.getFullRows();if(!i.length)return this.newRect();this.model.points+=N(_d.slice(0,i.length)),i.length>=6&&Ci(10,150*i.length/Z),this.removeRows(i);let n=this.model.points,r=(n+Z)%13+(n-Z)%87;this.requestQueue=this.requestQueue.then(o=>Ne("/factris-verify",{token:o,size:Z,score:n,check:r})),this.trigger("score",{points:n})}getFullRows(){return z(e=>this.tiles.filter(i=>i.y===e+vi),Z).filter(e=>e.length===Z)}removeRows(e){let i=ye(e);this.tiles=this.tiles.filter(o=>!i.includes(o)),this.$tiles.addClass("animated"),b.redraw();for(let o of i)o.$el.addClass("removing");let n=e.map(o=>o[0].y);for(let o of this.tiles)o.goDown(n.filter(a=>a>o.y).length);let r=400/e.length;for(let[o,a]of n.reverse().entries())this.$scores[o].setTransform({x:10+vi*20,y:27+a*20}),Zt(()=>this.$scores[o].addClass("visible"),o*r);return setTimeout(()=>{for(let o of this.$scores)o.removeClass("visible")},600),setTimeout(()=>{for(let o of i)o.$el.remove();this.$tiles.removeClass("animated"),this.newRect()},1e3),!1}gameOver(){this.model.lost=!0;for(let e of this.activeTiles)e.$el.addClass("error");this.pause(),this.requestQueue.then(e=>{e&&this.trigger("game-over",{token:e,points:this.model.points})})}discharge(){if(this.model.playing){for(let e of this.activeTiles)e.$el.remove();this.newRect(),this.model.discardCounter=Q0}}keyPress(e,i=!0){if(this.model.playing&&!this.keyLock){if(e==="ArrowUp"){if(!this.activeFactors.length)return;let n=this.activeFactors.pop(),r=this.activeSize[0]+Math.floor((this.activeSize[2]-n)/2),o=this.activeSize[1];if(this.activeTiles.some((l,c)=>!l.canSet(r+c%n,o-1-Math.floor(c/n),this.tiles)))return;for(let[l,c]of this.activeTiles.entries())c.setPosition(r+l%n,o-1-Math.floor(l/n));let h=this.model.active[0];this.model.active=[h,n,h/n],this.activeSize=[r,o,n]}else{let n=e==="ArrowDown"?1:0,r=e==="ArrowLeft"?1:0,o=e==="ArrowRight"?1:0;if(this.activeTiles.every(a=>a.canGo(n,r,o,this.tiles))){for(let a of this.activeTiles)a.go(n,r,o);this.activeSize[0]+=o-r,this.activeSize[1]+=n}i&&e==="ArrowDown"&&setTimeout(()=>this.keyPress("ArrowDown",!1),100)}this.drawShadow()}}showHighscore(){this.highscore&&(this.pause(),this.model.showHighscore=!0)}updateHighscore(){return D(this,null,function*(){if(!this.highscore)return;let e=yield fetch(`/factris-highscore?size=${Z}`);this.model.highscore=yield e.json()})}};wo=T([S("x-factris",{template:Bd})],wo);var xo=class extends E{ready(){let t=Array.from(this._el.children);this.removeChildren();let e=m("svg",{class:"equation"},this),i=m("g",{transform:"translate(2 0)"},e),n=m("div",{class:"overlay"},this),r=parseFloat(this.css("font-size")),o=this.parents(".text-center").length||this.hasClass("display"),a=new Be(i,n,0,"",r,!!o);a.setValue(this.attr("expr")||t),this.css({width:a.root.width+4+"px",height:a.root.height+"px","vertical-align":`-${a.root.height-a.root.baseline}px`})}};xo=T([S("x-math")],xo);window.$=k;window.$$=Te;window.Browser=b;var $o=k("x-modal#privacy");$o&&$o.$("form").on("submit",s=>{s.preventDefault();let t=$o.$('input[name="newsletter"]');Ne("/settings/privacy",{policies:"on",newsletter:t.checked?"on":"off"}),$o.close()});var Fd="";function Ch(){return fetch("/joke").then(s=>s.text()).then(s=>Fd=s),Fd}var Mh=k(".error-box");Mh&&Mh.on("click",()=>Mh.html=Ch());Ch();window.tellMeAJoke=function(){return Ch().replace(/<p>/g,"").replace(/<\/p>/g,`
`).trim()};console.log(`%cWelcome to Mathigon!
%cYou can see our source code at https://github.com/mathigon
%cIf you want to contribute, visit https://mathigon.io
%cJust here for fun? Run tellMeAJoke()`,"color: #cd0e66; font-weight: bold; font-size: 18px;","color: #0f82f2; font-weight: bold;","color: #22ab24; font-weight: bold;","color: #fd8c00; font-weight: bold;");var qd=[38,38,40,40,37,39,37,39,66,65],sn=0;document.addEventListener("keydown",s=>{s.keyCode===qd[sn]?(sn+=1,sn===qd.length&&(Ci(),sn=0)):sn=0});})();